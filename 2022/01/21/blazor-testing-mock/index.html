<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">
  <meta name="google-site-verification" content="TkcPr92_udHOBNGH4btaY7gv5Ei9zHUs58Kid16XOr4">
  <meta name="msvalidate.01" content="3B44C55C817CED2F642154B1168B77E2">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiaming0708.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","hits":"找到 ${hits} 個搜索結果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前一篇 [Blazor] 元件測試 - 基礎篇 中已經介紹過基本的測試，今天要來介紹的是 Mock 的應用。  使用上次的 repo 接續操作">
<meta property="og:type" content="article">
<meta property="og:title" content="[Blazor] 元件測試 - mock">
<meta property="og:url" content="http://jiaming0708.github.io/2022/01/21/blazor-testing-mock/index.html">
<meta property="og:site_name" content="Secret Note">
<meta property="og:description" content="前一篇 [Blazor] 元件測試 - 基礎篇 中已經介紹過基本的測試，今天要來介紹的是 Mock 的應用。  使用上次的 repo 接續操作">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2022-01-21T07:40:56.000Z">
<meta property="article:modified_time" content="2024-12-15T01:16:49.317Z">
<meta property="article:author" content="Jimmy Ho">
<meta property="article:tag" content="Testing">
<meta property="article:tag" content="Blazor">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://jiaming0708.github.io/2022/01/21/blazor-testing-mock/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"http://jiaming0708.github.io/2022/01/21/blazor-testing-mock/","path":"2022/01/21/blazor-testing-mock/","title":"[Blazor] 元件測試 - mock"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[Blazor] 元件測試 - mock | Secret Note</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5LXTGJNLYY"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-5LXTGJNLYY","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3000875971450027"
     crossorigin="anonymous"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Secret Note" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Secret Note</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">機密檔案</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜尋..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#FetchData-%E9%A0%81%E9%9D%A2"><span class="nav-number">1.</span> <span class="nav-text">FetchData 頁面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mock-HttpClient"><span class="nav-number">1.1.</span> <span class="nav-text">Mock HttpClient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mock-API"><span class="nav-number">1.2.</span> <span class="nav-text">mock API</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Index-%E9%A0%81%E9%9D%A2"><span class="nav-number">2.</span> <span class="nav-text">Index 頁面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mock-Component"><span class="nav-number">2.1.</span> <span class="nav-text">Mock Component</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mock-content"><span class="nav-number">2.2.</span> <span class="nav-text">Mock content</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mock-content-with-parameter"><span class="nav-number">2.3.</span> <span class="nav-text">Mock content with parameter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6"><span class="nav-number">2.4.</span> <span class="nav-text">使用第三方套件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B8%BD%E7%B5%90"><span class="nav-number">3.</span> <span class="nav-text">總結</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jimmy Ho"
      src="/images/avator.JPG">
  <p class="site-author-name" itemprop="name">Jimmy Ho</p>
  <div class="site-description" itemprop="description">記錄一些自己記不住的東西</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">89</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaming0708" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaming0708" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Secret_GoGo" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Secret_GoGo" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/secretgogoworld" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;secretgogoworld" rel="noopener me" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          連結
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://blog.kevinyang.net/" title="https:&#x2F;&#x2F;blog.kevinyang.net&#x2F;" rel="noopener" target="_blank">CK's Notepad</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://blog.miniasp.com/" title="https:&#x2F;&#x2F;blog.miniasp.com&#x2F;" rel="noopener" target="_blank">The Will Will Web | Will 保哥</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://wellwind.idv.tw/blog/" title="https:&#x2F;&#x2F;wellwind.idv.tw&#x2F;blog&#x2F;" rel="noopener" target="_blank">全端開發人員天梯</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://poychang.github.io/" title="https:&#x2F;&#x2F;poychang.github.io&#x2F;" rel="noopener" target="_blank">POY CHANG | Trial and Error</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://dog0416.blogspot.com/" title="https:&#x2F;&#x2F;dog0416.blogspot.com&#x2F;" rel="noopener" target="_blank">Duran 的技術冶煉廠</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://kyleap.github.io/" title="https:&#x2F;&#x2F;kyleap.github.io&#x2F;" rel="noopener" target="_blank">凱哥打扣</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://csscoke.com/" title="http:&#x2F;&#x2F;csscoke.com" rel="noopener" target="_blank">CSS可樂</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://blog.darkthread.net/" title="https:&#x2F;&#x2F;blog.darkthread.net&#x2F;" rel="noopener" target="_blank">黑暗執行緒</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.dotblogs.com.tw/yc421206" title="https:&#x2F;&#x2F;www.dotblogs.com.tw&#x2F;yc421206" rel="noopener" target="_blank">余小章 @ 大內殿堂</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://dotblogs.com.tw/billchung" title="https:&#x2F;&#x2F;dotblogs.com.tw&#x2F;billchung" rel="noopener" target="_blank">海角點部落</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://blog.crazyalu.com/" title="https:&#x2F;&#x2F;blog.crazyalu.com&#x2F;" rel="noopener" target="_blank">Jeff Wu's Note</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://blog.anna-yufeng.com/" title="https:&#x2F;&#x2F;blog.anna-yufeng.com&#x2F;" rel="noopener" target="_blank">安娜的自我探索與成長筆記</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://imall.dev/" title="https:&#x2F;&#x2F;imall.dev&#x2F;" rel="noopener" target="_blank">Imall's Blog</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    相關文章
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2024/11/27/dotnet-core-httpclient-header/" rel="bookmark">
        <time class="popular-posts-time">2024-11-27</time>
        <br>
      [DotnetCore] HttpClient 加上 Header 的作法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2022/01/28/blazor-testing-service/" rel="bookmark">
        <time class="popular-posts-time">2022-01-28</time>
        <br>
      [Blazor] 元件測試 - Service
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2017/03/02/angular-dynamic-component/" rel="bookmark">
        <time class="popular-posts-time">2017-03-03</time>
        <br>
      [Angular] 動態載入Component
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2023/08/07/remix-wget-mirror-to-github-page/" rel="bookmark">
        <time class="popular-posts-time">2023-08-07</time>
        <br>
      Remix 佈署到 Github Pages
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2021/12/23/blazor-testing-basic/" rel="bookmark">
        <time class="popular-posts-time">2021-12-23</time>
        <br>
      [Blazor] 元件測試 - 基礎篇
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://jiaming0708.github.io/2022/01/21/blazor-testing-mock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.JPG">
      <meta itemprop="name" content="Jimmy Ho">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Secret Note">
      <meta itemprop="description" content="記錄一些自己記不住的東西">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[Blazor] 元件測試 - mock | Secret Note">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Blazor] 元件測試 - mock
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2022-01-21 15:40:56" itemprop="dateCreated datePublished" datetime="2022-01-21T15:40:56+08:00">2022-01-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-12-15 09:16:49" itemprop="dateModified" datetime="2024-12-15T09:16:49+08:00">2024-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Frontend/" itemprop="url" rel="index"><span itemprop="name">Frontend</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Frontend/Blazor/" itemprop="url" rel="index"><span itemprop="name">Blazor</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>5 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>前一篇 <a href="/2021/12/23/blazor-testing-basic/" title="[Blazor] 元件測試 - 基礎篇">[Blazor] 元件測試 - 基礎篇</a> 中已經介紹過基本的測試，今天要來介紹的是 <code>Mock</code> 的應用。</p>
<blockquote>
<p>使用上次的 <a target="_blank" rel="noopener" href="https://github.com/jiaming0708/blazor-testing-demo">repo</a> 接續操作</p>
</blockquote>
<span id="more"></span>

<h1 id="FetchData-頁面"><a href="#FetchData-頁面" class="headerlink" title="FetchData 頁面"></a>FetchData 頁面</h1><p>開啟 <code>Pages</code> 中的 <code>FetchData.razor</code> 這個元件，可以注意到 <code>OnInitializedAsync</code> 的部份，是透過 <code>HttpClient</code> 打 API 取得資料回來呈現。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/fetchdata&quot;</span><br><span class="line">@inject HttpClient Http</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Weather forecast<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Weather forecast<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This component demonstrates fetching data from the server.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@if (forecasts == null)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Date<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Temp. (C)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Temp. (F)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Summary<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            @foreach (var forecast in forecasts)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.Date.ToShortDateString()<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.TemperatureC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.TemperatureF<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.Summary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private WeatherForecast[]? forecasts;</span><br><span class="line"></span><br><span class="line">    protected override async Task OnInitializedAsync()</span><br><span class="line">    &#123;</span><br><span class="line">        forecasts = await Http.GetFromJsonAsync&lt;WeatherForecast[]&gt;(&quot;sample-data/weather.json&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class WeatherForecast</span><br><span class="line">    &#123;</span><br><span class="line">        public DateTime Date &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public int TemperatureC &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public string? Summary &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Mock-HttpClient"><a href="#Mock-HttpClient" class="headerlink" title="Mock HttpClient"></a>Mock HttpClient</h2><p>在測試專案中，新增一個檔案 <code>FetchDataTest.cs</code>，並加上一個測試案例直接針對 FetchData 這個元件的輸出來看看結果。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  Console.WriteLine(comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>應該會看到測試失敗，原因就是在 init 時有使用到 HttpClient。</p>
<blockquote>
<p>This test requires a HttpClient to be supplied, because the component under test invokes the HttpClient during the test. The request that was sent is contained within the ‘Request’ attribute of this exception. Guidance on mocking the HttpClient is available on bUnit’s website.</p>
</blockquote>
<p>要對 HttpClient 進行 mock 的話，還需要安裝另外一個 library <strong>RichardSzalay.MockHttp</strong>，打開 Nuget 管理並且加入這個套件到測試專案中。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; <span class="built_in">Install-Package</span> RichardSzalay.MockHttp</span><br></pre></td></tr></table></figure>

<p>建立一個檔案 <code>MockHttpClientBunitHelpers</code>  來實作兩個功能</p>
<ul>
<li>註冊 HttpClient 到 Service</li>
<li>Response 的介面</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http.Headers;</span><br><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"><span class="keyword">using</span> Bunit;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> RichardSzalay.MockHttp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">MockHttpClientBunitHelpers</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockHttpMessageHandler <span class="title">AddMockHttpClient</span>(<span class="params"><span class="keyword">this</span> TestServiceProvider services</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> mockHttpHandler = <span class="keyword">new</span> MockHttpMessageHandler();</span><br><span class="line">    <span class="keyword">var</span> httpClient = mockHttpHandler.ToHttpClient();</span><br><span class="line">    httpClient.BaseAddress = <span class="keyword">new</span> Uri(<span class="string">&quot;http://localhost&quot;</span>);</span><br><span class="line">    services.AddSingleton&lt;HttpClient&gt;(httpClient);</span><br><span class="line">    <span class="keyword">return</span> mockHttpHandler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockedRequest <span class="title">RespondJson</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> MockedRequest request, T content</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    request.Respond(req =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> response = <span class="keyword">new</span> HttpResponseMessage(HttpStatusCode.OK);</span><br><span class="line">      response.Content = <span class="keyword">new</span> StringContent(JsonSerializer.Serialize(content));</span><br><span class="line">      response.Content.Headers.ContentType = <span class="keyword">new</span> MediaTypeHeaderValue(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockedRequest <span class="title">RespondJson</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> MockedRequest request, Func&lt;T&gt; contentProvider</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    request.Respond(req =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> response = <span class="keyword">new</span> HttpResponseMessage(HttpStatusCode.OK);</span><br><span class="line">      response.Content = <span class="keyword">new</span> StringContent(JsonSerializer.Serialize(contentProvider()));</span><br><span class="line">      response.Content.Headers.ContentType = <span class="keyword">new</span> MediaTypeHeaderValue(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著來修改剛剛的測試案例，在 Service 註冊 HttpClient 就可以讓測試順利通過，並且看到結果包含著 <strong>Loading…</strong> 的字串。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Loading...&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mock-API"><a href="#mock-API" class="headerlink" title="mock API"></a>mock API</h2><p>使用 mock 物件提供的 When 以及剛剛所寫的 RespondJson 方法，來處理資料。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Loading...&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以發現這樣怎麼還是沒重新 render 拿到新的 html 結構，因為是使用非同步的方法取得資料，因此測試也需要使用非同步的方式。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderMockResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  comp.WaitForAssertion(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    Assert.IsNotNull(comp.Find(<span class="string">&quot;.table&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了使用 <code>WaitForAssertion</code> 也可以採用另一種等待狀態變更 <code>WaitForState</code> 的作法，後面就能變回同步的狀態。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderMockResponse_WaitState</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  comp.WaitForState(() =&gt; !comp.Markup.Contains(<span class="string">&quot;Loading...&quot;</span>));</span><br><span class="line">  Assert.IsNotNull(comp.Find(<span class="string">&quot;.table&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Index-頁面"><a href="#Index-頁面" class="headerlink" title="Index 頁面"></a>Index 頁面</h1><p>看完 Mock HttpClient 的作法後，接著要來做 Mock Component，有時候我們可以假設 Child component 的行為都是正確的，把測試主力放在自己身上，這時候就會需要這個技巧。</p>
<p>開啟 Pages 中 <code>Index.razor</code> 的內容，裡面使用到 <code>SurveyPrompt</code> 元件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Welcome to your new app.</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">SurveyPrompt</span> <span class="attr">Title</span>=<span class="string">&quot;How is Blazor working for you?&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Mock-Component"><a href="#Mock-Component" class="headerlink" title="Mock Component"></a>Mock Component</h2><p>在測試專案中，新增檔案 <code>IndexTest.cs</code>。<br>在 ComponntFactories 加上要 mock 的元件，先試著 mock SurveyPrompt 看輸出內容，就可以發現那個元件的部份是完全空白。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildComp</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  Console.WriteLine(comp.Markup);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;h1&gt;Hello, world!&lt;/h1&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Welcome to your new app.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用 <code>IRenderedComponent.HasComponent&lt;T&gt;()</code> 檢查元件是否有存在，將測試案例調整一下。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildComp</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  Assert.False(comp.HasComponent&lt;SurveyPrompt&gt;());</span><br><span class="line">  Assert.True(comp.HasComponent&lt;Stub&lt;SurveyPrompt&gt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock-content"><a href="#Mock-content" class="headerlink" title="Mock content"></a>Mock content</h2><p>剛剛的測試是沒有任何內容，如果想要自訂內容的話，可以在 <code>AddStub&lt;T&gt;(&quot;xxxx&quot;)</code> 中放入字串。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildCompContent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> content = <span class="string">&quot;&lt;div&gt;Mock SurveyPrompt&lt;/div&gt;&quot;</span>;</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  StringAssert.Contains(content, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock-content-with-parameter"><a href="#Mock-content-with-parameter" class="headerlink" title="Mock content with parameter"></a>Mock content with parameter</h2><p>除了寫死的內容以外，也能夠支援傳遞參數的方法，在 AddStub 的方法內改用函式的作法，來取得並輸出參數。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildCompContentWithParameter</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;(paras =&gt; <span class="string">$&quot;&lt;div&gt;<span class="subst">&#123;paras.Get(x =&gt; x.Title)&#125;</span>&lt;/div&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;How is Blazor working for you?&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用第三方套件"><a href="#使用第三方套件" class="headerlink" title="使用第三方套件"></a>使用第三方套件</h2><p>除了 bUnit 的這種作法外，也可以使用第三方的 mock 套件，像是 <code>MOQ</code> 及 <code>NSubtitute</code>。作法跟上面的類似，將 <code>AddStub&lt;T&gt;()</code> 改為 <code>Add&lt;T&gt;(mock object)</code> 。</p>
<p>打開 Nuget 管理將 <code>MOQ</code> 這個套件加入到測試專案中，這邊將使用 MOQ 做範例。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; <span class="built_in">Install-Package</span> MOQ</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockComponentByMOQ</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mockComp = <span class="keyword">new</span> Mock&lt;SurveyPrompt&gt;();</span><br><span class="line">  ctx.ComponentFactories.Add(mockComp.Object);</span><br><span class="line">  <span class="comment">// 另一種寫法</span></span><br><span class="line">  <span class="comment">// ctx.ComponentFactories.Add(() =&gt; Mock.Of&lt;SurveyPrompt&gt;());</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  <span class="keyword">var</span> actualComp = comp.FindComponent&lt;SurveyPrompt&gt;();</span><br><span class="line">  Assert.AreSame(mockComp.Object, actualComp.Instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>今天介紹了 HttpClient 及 Component 的 mock 方法，個人覺得還要另外採用第三方套件來做 Mock 是蠻麻煩的，但官方目前的態度就是這樣，bUnit 不去依賴第三方套件。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/jiaming0708/blazor-testing-demo">範例程式</a> 也放在 github 上，如果有需要也可以按照 commit 的步驟來跟著操作學習。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://bunit.dev/docs/providing-input/substituting-components.html?tabs=moq">mocking component</a></li>
<li><a target="_blank" rel="noopener" href="https://bunit.dev/docs/test-doubles/mocking-httpclient.html">mocking HttpClient</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Testing/" rel="tag"># Testing</a>
              <a href="/tags/Blazor/" rel="tag"># Blazor</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/12/29/dll-publish-nuget/" rel="prev" title="將獨立的 dll 打包發佈到 nuget server">
                  <i class="fa fa-angle-left"></i> 將獨立的 dll 打包發佈到 nuget server
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/01/28/blazor-testing-service/" rel="next" title="[Blazor] 元件測試 - Service">
                  [Blazor] 元件測試 - Service <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2008 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Jimmy Ho</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="總字數">99k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="所需總閱讀時間">6:01</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"jiaming0708/jiaming0708.github.io","repo_id":"MDEwOlJlcG9zaXRvcnk4Mjc2OTM4OQ==","category":"Q&A","category_id":"DIC_kwDOBO717c4B_0N9","mapping":"title","strict":0,"reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"en","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
