<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>[Flutter] 排版應用介紹</title>
      <link href="/2023/04/15/flutter-ui-layout/"/>
      <url>/2023/04/15/flutter-ui-layout/</url>
      
        <content type="html"><![CDATA[<p>作為一名主要開發平台為網頁的開發者，進入 Flutter 世界的開發體驗讓我發現元件結構是最需要適應的地方。在網頁開發中，我們可以透過 CSS 樣式來控制元素的排版，包括長寬、內外邊距，甚至彈性佈局 (flex) 或網格系統 (grid) 等。除非使用定位 (position)，否則所有元素都處於同一層級。然而在 app 中，每個元素都被當作不同的「層」來處理，因此為了達到類似網頁的效果，必須使用不同的元件進行組合。</p><span id="more"></span><h2 id="長寬和內外邊距的控制"><a href="#長寬和內外邊距的控制" class="headerlink" title="長寬和內外邊距的控制"></a>長寬和內外邊距的控制</h2><p>在 Flutter 中，長寬和內外邊距的控制可以透過不同的元件來實現。以下是兩種常見的元件：</p><h3 id="SizeBox"><a href="#SizeBox" class="headerlink" title="SizeBox"></a>SizeBox</h3><p>如果只需要設定元件的長寬，可以使用 SizeBox 元件。例如：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = <span class="keyword">const</span> SizedBox(</span><br><span class="line">height: <span class="number">36</span>,</span><br><span class="line">child: Text(<span class="string">&#x27;我是文字&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>若想讓元件自動擴展到 parent 的大小，可以使用 Expanded 或 Flexible 元件。</p></blockquote><h3 id="內外邊距"><a href="#內外邊距" class="headerlink" title="內外邊距"></a>內外邊距</h3><p>若想同時控制元件的內外邊距、長寬、背景色等等，可以使用 Container 元件。Container 還可以設定邊框、圓角等等，是相當常用的元件之一。例如：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Container(</span><br><span class="line">  margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">16.0</span>),</span><br><span class="line">  padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">  color: Colors.grey.shade200,</span><br><span class="line">  height: <span class="number">100</span>,</span><br><span class="line">  width: <span class="number">100</span>,</span><br><span class="line">  child: <span class="keyword">const</span> Text(<span class="string">&#x27;我是文字&#x27;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/container.png" alt="image-20230412222104812"></p><h2 id="元件排版"><a href="#元件排版" class="headerlink" title="元件排版"></a>元件排版</h2><h3 id="統一內縮"><a href="#統一內縮" class="headerlink" title="統一內縮"></a>統一內縮</h3><p>想要一個區塊內的元件都有同樣的內縮並且有背景色，那我們可以使用 <code>Container</code> 搭配 <code>Column</code> 這個元件來完成。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Container(</span><br><span class="line">  padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">  color: Colors.grey.shade200,</span><br><span class="line">  child: Column(</span><br><span class="line">    children: [</span><br><span class="line">      <span class="keyword">const</span> Text(<span class="string">&#x27;文字1&#x27;</span>),</span><br><span class="line">      <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">16.0</span>)),</span><br><span class="line">      <span class="keyword">const</span> Text(<span class="string">&#x27;文字2&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/column.png" alt="column"></p><h3 id="併排呈現"><a href="#併排呈現" class="headerlink" title="併排呈現"></a>併排呈現</h3><p>當有好幾個元件，想要再同一排中做呈現的時候，可以使用 <code>Row</code> 這個元件。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Container(</span><br><span class="line">  padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">  color: Colors.grey.shade200,</span><br><span class="line">  child: Row(</span><br><span class="line">    mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">    children: [</span><br><span class="line">      <span class="keyword">const</span> Text(<span class="string">&#x27;文字1&#x27;</span>),</span><br><span class="line">      <span class="keyword">const</span> Padding(padding: EdgeInsets.only(left: <span class="number">16.0</span>)),</span><br><span class="line">      <span class="keyword">const</span> Text(<span class="string">&#x27;文字2&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/row.png" alt="row"></p><h2 id="進階使用"><a href="#進階使用" class="headerlink" title="進階使用"></a>進階使用</h2><h3 id="自動寬高度"><a href="#自動寬高度" class="headerlink" title="自動寬高度"></a>自動寬高度</h3><p>如果希望併排的元件中，有一些是固定寬度，而剩下的元件則佔滿剩餘的全部寬度，可以使用 Expanded。在 Row 中使用 Expanded 元件時，會讓剩下的空間平均分配給 Expanded 元件，因此可以讓剩下的元件都自動調整寬度。</p><blockquote><p>在 <code>Column</code> 中也可以使用 <code>Expanded</code> 元件來達成自動調整高度的效果</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Container(</span><br><span class="line">  padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16</span>),</span><br><span class="line">  color: Colors.grey.shade200,</span><br><span class="line">  child: Row(</span><br><span class="line">    mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">    children: [</span><br><span class="line">      <span class="keyword">const</span> Expanded(</span><br><span class="line">              child: Text(<span class="string">&#x27;文字1&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">      <span class="keyword">const</span> Padding(padding: EdgeInsets.only(left: <span class="number">16.0</span>)),</span><br><span class="line">      <span class="keyword">const</span> Text(<span class="string">&#x27;文字2&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/expand-in-row.png" alt="expand-in-row"></p><h3 id="Flex"><a href="#Flex" class="headerlink" title="Flex"></a>Flex</h3><p>如果想要更精細地控制元件的寬度和高度，可以使用 Flexible 元件。設定 flex 屬性，讓元件按照比例分配空間。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Row(</span><br><span class="line">  mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">  children: [</span><br><span class="line">    <span class="comment">// 只會佔用剩下的空間</span></span><br><span class="line">    Flexible(</span><br><span class="line">      child: Container(</span><br><span class="line">        color: Colors.amber,</span><br><span class="line">        width: <span class="number">100</span>,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    Flexible(</span><br><span class="line">      <span class="comment">// 佔用 10 等份</span></span><br><span class="line">      flex: <span class="number">10</span>,</span><br><span class="line">      child: Container(</span><br><span class="line">        color: Colors.teal,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">// 固定大小</span></span><br><span class="line">    Container(</span><br><span class="line">      color: Colors.cyan,</span><br><span class="line">      width: <span class="number">200</span>,</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>看到底下結果是第一個元件並不會真正佔用到 100，反而會是第二和第三個元件所佔用的空間後剩下來的才會分配給他。</p><p><img src="/2023/04/15/flutter-ui-layout/flex-in-row.png" alt="flex-in-row"></p><h2 id="有雷要注意"><a href="#有雷要注意" class="headerlink" title="有雷要注意"></a>有雷要注意</h2><h3 id="併排呈現-1"><a href="#併排呈現-1" class="headerlink" title="併排呈現"></a>併排呈現</h3><p>當使用 <code>Row</code> 的時候，底下的元件總寬度必須要在裝置的寬度之內，不然就會直接噴錯，在這邊是建議直接加上 <code>Flexiable</code> 讓元件平均分配，避免這個問題產生。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = Row(</span><br><span class="line">  mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">  children: [</span><br><span class="line">    Container(</span><br><span class="line">      color: Colors.amber,</span><br><span class="line">      width: <span class="number">200</span>,</span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      color: Colors.teal,</span><br><span class="line">      width: <span class="number">200</span>,</span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      color: Colors.cyan,</span><br><span class="line">      width: <span class="number">200</span>,</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/not-enough-space-in-row.png" alt="not-enough-space-in-row"></p><p><img src="/2023/04/15/flutter-ui-layout/error-message-for-row.png" alt="error-message-for-row"></p><h3 id="垂直呈現"><a href="#垂直呈現" class="headerlink" title="垂直呈現"></a>垂直呈現</h3><p>在 Flutter 中，預設的排版方式是垂直往下，當元件超過裝置的高度時，也是一樣會噴錯，那這時候可以加上捲軸的元件 <code>SingleChildScrollView</code>，就可以解決高度不夠的問題。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> comp = SingleChildScrollView(</span><br><span class="line">  child: Column(</span><br><span class="line">    children: [</span><br><span class="line">      Container(</span><br><span class="line">        color: Colors.amber,</span><br><span class="line">        height: <span class="number">500</span>,</span><br><span class="line">      ),</span><br><span class="line">      Container(</span><br><span class="line">        color: Colors.teal,</span><br><span class="line">        height: <span class="number">200</span>,</span><br><span class="line">      ),</span><br><span class="line">      Container(</span><br><span class="line">        color: Colors.cyan,</span><br><span class="line">        height: <span class="number">300</span>,</span><br><span class="line">      ),</span><br><span class="line">    ],</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="/2023/04/15/flutter-ui-layout/over-height.png" alt="over-height"></p><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>在 Flutter 的世界中，當你的排版比較複雜，要往下排又有元件要併排，然後還要控制內外邊距時，就會有很多階層的產生，這時候會建議適度的抽成元件，讓主要的 build 比較容易懂。</p><p>如果你跟我一樣主要是網頁的開發者，記得請拋棄你的既定印象和習慣，多多使用元件來搭配，才能排版出符合設計的樣式。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">SingleChildScrollView(</span><br><span class="line">  child: Container(</span><br><span class="line">    padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">38</span>),</span><br><span class="line">    color: <span class="keyword">const</span> Color.fromRGBO(<span class="number">217</span>, <span class="number">217</span>, <span class="number">217</span>, <span class="number">0.5</span>),</span><br><span class="line">    child: Column(</span><br><span class="line">      children: [</span><br><span class="line">        _LastNameInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _FirstNameInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _BirthdayInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _GenderInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _PhoneInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _EmailInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _PasswordInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _ConfirmedPasswordInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _ReceiveNewsInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">12.0</span>)),</span><br><span class="line">        _AgreePolicyInput(),</span><br><span class="line">        <span class="keyword">const</span> Padding(padding: EdgeInsets.only(top: <span class="number">40.0</span>)),</span><br><span class="line">        _RegisterButton(),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSL空間擴增問題排除</title>
      <link href="/2023/03/09/wsl-disk-space-move-location/"/>
      <url>/2023/03/09/wsl-disk-space-move-location/</url>
      
        <content type="html"><![CDATA[<p>最近發現工作電腦的c槽突然間快滿了，查了一下被哪些東西吃掉，才發現一個噁心的怪獸，就是 WSL 的虛擬硬碟 vhdx 吃掉了 30G，底下會說明該怎麼解決這個問題。</p><span id="more"></span><p>在 Windows 安裝 WSL 大多是為了使用 Docker Desktop 這個軟體，WSL 的虛擬硬碟檔案則是放在使用者資料夾下的 <code>AppData\Local\Docker\wsl\data</code>，可以看到一個叫做 <code>ext4.vhdx</code> 的檔案。<br>有另外安裝 ubuntu 之類的系統的話，檔案路徑則不一樣的是在 Packges 並且根據你安裝的系統後面加上一些獨立的名稱， <code>AppData\Local\Packages\CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc\LocalState</code> 。</p><p>當我們使用完畢 container 關閉後，vhdx 的檔案並不會因此而釋放掉所使用到的空間，每次使用就會吃掉一點，不斷的擴增並且是沒有限制！！<br>這個問題從 2019 年就有人開 <a href="https://github.com/microsoft/WSL/issues/4699">issue</a>，但都還沒有辦法解決，裡面有些人提出一些作法是把檔案路徑搬走，至少不要讓系統c槽的空間被吃光。</p><p>底下是根據裡面討論到的有效解法，蠻建議安裝完後就移動這個位置，讓自己的 windows 不會因此有空間不足而產生的效能問題。</p><blockquote><p>記得要使用系統管理員的權限執行，不然最後連結檔案的步驟會失敗</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 其他槽的位置</span></span><br><span class="line"><span class="variable">$newLocation</span> = <span class="string">&quot;E:\WSL2\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;~\AppData\Local\Docker\wsl\data&quot;</span></span><br><span class="line"><span class="comment"># cd &quot;~\AppData\Local\Packages\&#123;distro folder name&#125;\LocalState&quot;</span></span><br><span class="line">wsl <span class="literal">--shutdown</span></span><br><span class="line">mkdir <span class="variable">$newLocation</span> <span class="literal">-Force</span></span><br><span class="line"><span class="built_in">mv</span> ext4.vhdx <span class="variable">$newLocation</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">rm</span> <span class="string">&quot;data&quot;</span></span><br><span class="line"><span class="comment"># 若是 distro 的話是放在 LocalState 目錄下</span></span><br><span class="line"><span class="comment"># rm &quot;LocalState&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用連結檔案的方式，讓實體是在其他指定的位置</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="literal">-ItemType</span> SymbolicLink <span class="literal">-Path</span> <span class="string">&quot;data&quot;</span> <span class="literal">-Target</span> <span class="variable">$newLocation</span></span><br><span class="line"><span class="comment"># New-Item -ItemType SymbolicLink -Path &quot;LocalState&quot; -Target $newLocation</span></span><br></pre></td></tr></table></figure><p><del>另外補充給使用 Podman 的朋友，路徑跟以上完全不同，檔案是在 <code>.local</code> 資料夾中， <code>~\.local\share\containers\podman\machine\wsl</code><br>podman 可以建立多個，預設叫做 <code>podman-machine-default</code> ，若有改名字記得底下的內容要跟著調整</del></p><blockquote><p>抱歉，隔天重開機後，machine 會一直說 permission denied，還需要再研究一下</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他槽的位置</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">newLocation = <span class="string">&quot;E:\WSL2\&quot;</span></span></span><br><span class="line"></span><br><span class="line">cd &quot;~\.local\share\containers\podman\machine\wsl\wsldist\podman-machine-default&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">關閉 podman machine</span></span></span><br><span class="line">podman machine stop podman-machine-default</span><br><span class="line"></span><br><span class="line">mkdir $newLocation -Force</span><br><span class="line">mv ext4.vhdx $newLocation</span><br><span class="line">cd ..</span><br><span class="line">rm &quot;podman-machine-default&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">使用連結檔案的方式，讓實體是在其他指定的位置</span></span></span><br><span class="line">New-Item -ItemType SymbolicLink -Path &quot;podman-machine-default&quot; -Target $newLocation</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">啟動 podman machine</span></span></span><br><span class="line">podman machine start podman-machine-default</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Flutter] SVG應用</title>
      <link href="/2023/02/20/flutter-svg/"/>
      <url>/2023/02/20/flutter-svg/</url>
      
        <content type="html"><![CDATA[<p>在網頁使用 icon 的時候，會想要採用 svg，主要原因是可以渲染並且不會失真，而且可以做動態渲染的效果，接下來看看如何在 flutter 使用 svg 來開發。</p><span id="more"></span><h2 id="安裝使用"><a href="#安裝使用" class="headerlink" title="安裝使用"></a>安裝使用</h2><p>執行以下的指令安裝套件 <a href="https://pub.dev/packages/flutter_svg">flutter_svg</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_svg</span><br></pre></td></tr></table></figure><p>在 <code>pubspec.yml</code> 可以看到增加這行（若沒有請自己加上）。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">flutter_svg:</span> <span class="string">^2.0.0+1</span></span><br></pre></td></tr></table></figure><p>安裝後，在程式裡面引用並且使用 <code>SvgPicture</code> 這個類別。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_svg/flutter_svg.dart&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="檔案在本地"><a href="#檔案在本地" class="headerlink" title="檔案在本地"></a>檔案在本地</h2><p>當 icon 檔案在本地的時候，要使用的是 <code>SvgPicture.asset</code> 這個方法。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icon = SvgPicture.asset(<span class="string">&#x27;assets/add.svg&#x27;</span>);</span><br></pre></td></tr></table></figure><p>直接放路徑是最基本的用法，若是希望指定元件的大小，則可以加上 <code>width</code> 及 <code>height</code> 兩個參數。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icon = SvgPicture.asset(<span class="string">&#x27;assets/add.svg&#x27;</span>, width: <span class="number">16</span>, height: <span class="number">16</span>);</span><br></pre></td></tr></table></figure><h2 id="檔案在網路"><a href="#檔案在網路" class="headerlink" title="檔案在網路"></a>檔案在網路</h2><p>使用上跟前面差不多，主要是方法改成 <code>network</code>。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icon = SvgPicture.network(path);</span><br></pre></td></tr></table></figure><p>要指定大小的話，一樣可以加上 <code>width</code> 及 <code>height</code> 兩個參數。</p><h2 id="改變顏色"><a href="#改變顏色" class="headerlink" title="改變顏色"></a>改變顏色</h2><p>把 add 改成紅色，只需要加上 <code>color</code> 這個參數。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Widget svgIcon = SvgPicture.asset(</span><br><span class="line">  <span class="string">&#x27;assets/add.svg&#x27;</span>,</span><br><span class="line">  width: <span class="number">16</span>,</span><br><span class="line">  height: <span class="number">16</span>,</span><br><span class="line">  color: <span class="keyword">const</span> Color(<span class="number">0xFFFF0000</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="內縮效果"><a href="#內縮效果" class="headerlink" title="內縮效果"></a>內縮效果</h2><p>如果 icon 是需要有 padding 的話，就可以搭配 <code>Container</code> 這個物件來完成。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icon = SvgPicture.asset(<span class="string">&#x27;assets/add.svg&#x27;</span>);</span><br><span class="line"><span class="comment">// icon 最終的寬高為 16</span></span><br><span class="line"><span class="keyword">var</span> iconWithPadding = Container(</span><br><span class="line">  margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">8.0</span>),</span><br><span class="line">  height: <span class="number">32</span>,</span><br><span class="line">  width: <span class="number">16</span>,</span><br><span class="line">  child: icon,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>在 flutter 的世界中，效果都是透過疊加的方式做呈現，很少有一個元件就能達成全部的效果。<br>如果你跟我一樣平常主要接觸是網頁開發，這個地方要稍微習慣一下。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitea 資料庫遷移</title>
      <link href="/2023/02/20/gitea-database-migration/"/>
      <url>/2023/02/20/gitea-database-migration/</url>
      
        <content type="html"><![CDATA[<p>公司的 Gitea 原本資料庫是用 SQLServer，那台 Server 本身也比較舊，在有些操作下也會覺得不順，剛好有機會可以停機可以轉成 Postgres，這邊來記錄一下我的操作步驟。</p><span id="more"></span><h2 id="備份指令介紹"><a href="#備份指令介紹" class="headerlink" title="備份指令介紹"></a>備份指令介紹</h2><p>我們可以透過指令的方式針對 Gitea 來做<a href="https://docs.gitea.io/en-us/backup-and-restore/">備份和還原</a>，備份功能本身能夠支援輸出成不同資料庫，詳細的指令的話在文件上就沒看到，我是透過 <a href="https://discourse.gitea.io/t/migrate-gitea-db-from-mariadb-to-postgresql/2072/2">Migrate Gitea DB from MariaDB to PostgreSQL - Support - Gitea</a> 這篇的討論和 <a href="https://github.com/go-gitea/gitea/blob/main/cmd/dump.go">Source code</a> 來找到需要的指令。</p><p>對於 Gitea 來說，備份的內容包含 sql file、log、repository，需要做的只有資料庫的部分，省略其他的輸出可以讓備份的速度加快，最終的指令如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/gitea/gitea dump -d postgres -R -L -c /data/gitea/conf/app.ini</span><br></pre></td></tr></table></figure><ul><li>database(d)，可以指定輸出的資料庫類型 <code>PostgreSQL</code>, <code>MySQL </code>, <code>SQLite</code>, <code>MSSQL</code></li><li>skip-repository(R)，略過 repository 備份</li><li>skip-log(L)，略過 log 備份</li><li>config(c)，指定 app.ini 檔案的路徑</li></ul><h2 id="執行備份"><a href="#執行備份" class="headerlink" title="執行備份"></a>執行備份</h2><p>接著就要實際的下指令囉，在公司的環境中，是用 Docker 來做安裝，因此要先連到 Gitea 的 Container 中。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it gitea bash</span><br></pre></td></tr></table></figure><p>執行前面所介紹的指令，這邊會收到一個 permission 的錯誤，主要是不能使用 root 來做 dump 的指令。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023/02/20 11:43:31 ...s/setting/setting.go:1059:loadFromConf() [F] Gitea is not supposed to be run as root. Sorry. If you need to use privileged TCP ports please instead use setcap and the `cap_net_bind_service` permission</span><br></pre></td></tr></table></figure><p>這邊只要切換使用者為 <code>git</code> ，再次執行前面的指令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su git</span><br></pre></td></tr></table></figure><p>就可以看到開始備份的訊息，完成的時候會看到一個 <code>gitea-dump-*.zip</code> 的檔案名稱在你執行的目錄底下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2023/02/20 03:55:26 ...dules/setting/log.go:288:newLogService() [I] Gitea v1.18.3 built with GNU Make 4.3, go1.19.5 : bindata, timetzdata, sqlite, sqlite_unlock_notify</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">2023/02/20 03:55:49 cmd/dump.go:405:runDump() [I] Finish dumping in file gitea-dump-1676865326.zip</span><br></pre></td></tr></table></figure><p>那整合一下以上的作法，可以這樣下指令，一次匯出。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it -u git -w /data $(docker ps -qf &#x27;name=^gitea$&#x27;) bash -c &#x27;/app/gitea/gitea dump -d postgres -R -L -c /data/gitea/conf/app.ini&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>-w 為工作目錄，因為 data 的資料夾有跟外面的實體做對應，為了要方便拿到檔案，所以放在這邊</p></blockquote><h2 id="匯入資料庫"><a href="#匯入資料庫" class="headerlink" title="匯入資料庫"></a>匯入資料庫</h2><p>把 dump.zip 中的 sql file 拿出來後放到 Postgres 的 container 中。</p><blockquote><p>這邊我對應到 app 的資料夾中</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it database bash</span><br><span class="line">su postgres</span><br><span class="line">psql</span><br></pre></td></tr></table></figure><p>根據官方的文件 <a href="https://docs.gitea.io/en-us/database-prep/#postgresql">Database Preparation - Docs (gitea.io)</a> 先建立好使用者和資料庫。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;gitea&quot; <span class="keyword">WITH</span> PASSWORD <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE dbgitea <span class="keyword">WITH</span> OWNER gitea TEMPLATE template0 ENCODING UTF8 LC_COLLATE <span class="string">&#x27;en_US.UTF-8&#x27;</span> LC_CTYPE <span class="string">&#x27;en_US.UTF-8&#x27;</span>;</span><br></pre></td></tr></table></figure><p>接著就可以開始匯入資料。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql --username gitea -h localhost --set ON_ERROR_STOP=on dbgitea &lt; /app/gitea-db.sql</span><br></pre></td></tr></table></figure><h2 id="修改連線資料"><a href="#修改連線資料" class="headerlink" title="修改連線資料"></a>修改連線資料</h2><p>以上的步驟都做完，最後就是要修改 app.ini 裡的連線資訊，找到 <code>database</code> 的區塊，把資訊改成以下即可。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">DB_TYPE</span>  = postgres</span><br><span class="line"><span class="attr">HOST</span>     = database:<span class="number">5432</span></span><br><span class="line"><span class="attr">NAME</span>     = dbgitea</span><br><span class="line"><span class="attr">USER</span>     = gitea</span><br><span class="line"><span class="attr">PASSWD</span>   = password</span><br></pre></td></tr></table></figure><p>把服務重新啟動，連線進去確認一下所有內容都是遷移前的狀態，那就可以收工啦!!</p>]]></content>
      
      
      <categories>
          
          <category> Infra </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gitea </tag>
            
            <tag> Infra </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[flutter] 使用 16 進制定義顏色</title>
      <link href="/2023/01/24/flutter-hex-color/"/>
      <url>/2023/01/24/flutter-hex-color/</url>
      
        <content type="html"><![CDATA[<p>在 Flutter 中有提供好幾種方法可以來定義 <code>Color</code> 這個物件，這篇會介紹如何使用這些方法。</p><span id="more"></span><h2 id="已知的顏色"><a href="#已知的顏色" class="headerlink" title="已知的顏色"></a>已知的顏色</h2><ul><li>使用到的是常用的顏色，例如黑、白、紅、綠、黃等等的，可以直接使用 <code>Colors</code> 來找到需要的顏色。</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color danger = Colors.red;</span><br></pre></td></tr></table></figure><ul><li>若是要使用 0-255 間的數字來設定顏色，則有兩種作法，主要的差異在於 <code>opacity</code></li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// opacity 於最後一個參數，值介於 0-1 的浮點數</span></span><br><span class="line">Color danger = Color.fromRGBO(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// opacity 於第一個參數，值介於 0-255 的整數</span></span><br><span class="line">Color danger = Color.fromARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><ul><li>使用 hex 定義，組成方式為 alpha red green blue</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color danger = Color(<span class="number">0xFFFF0000</span>);</span><br></pre></td></tr></table></figure><h2 id="未知的顏色"><a href="#未知的顏色" class="headerlink" title="未知的顏色"></a>未知的顏色</h2><p>當顏色的不是先定義好，而是由 API 的資料來決定的話，會需要將字串做個轉換；在這個情況下，建議跟後端溝通拿到的顏色字串為 hex 格式，也就是 <code>RRGGBB</code>。<br>在根據前面所說的 hex 顏色定義方法，適度的補上 alpha 值，在透過 int 的方式來宣告成 <code>Color</code> 物件。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Color hexToColor(<span class="built_in">String</span> hexString) &#123;</span><br><span class="line">  <span class="keyword">final</span> buffer = <span class="built_in">StringBuffer</span>();</span><br><span class="line">  <span class="keyword">if</span> (hexString.length == <span class="number">6</span> || hexString.length == <span class="number">7</span>) buffer.write(<span class="string">&#x27;ff&#x27;</span>);</span><br><span class="line">  buffer.write(hexString.replaceFirst(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">  <span class="keyword">return</span> Color(<span class="built_in">int</span>.parse(buffer.toString(), radix: <span class="number">16</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以宣告成一個新的物件，或是擴充功能，就看怎麼用比較順手了。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> ColorExtension <span class="keyword">on</span> <span class="built_in">String</span> &#123;</span><br><span class="line">Color toColor(<span class="built_in">String</span> hexString) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Color danger = <span class="string">&#x27;#ff0000&#x27;</span>.toColor();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何建立 Oracle database image</title>
      <link href="/2023/01/16/build-oracle-database-image/"/>
      <url>/2023/01/16/build-oracle-database-image/</url>
      
        <content type="html"><![CDATA[<p>原本 Oracle 有提供 image 在 <a href="https://hub.docker.com/_/oracle-database-enterprise-edition">DockerHub</a>上，現在已經沒有再提供了，那對於習慣用 container 做開發的我來說，非常的不方便，還好 Oracle 也有提供另外的做法可以來建立 image，接下來分享該如何操作。</p><span id="more"></span><p>Oracle 已經將很多的服務寫好 dockerfile 放到 <a href="https://github.com/oracle/docker-images">github</a> 上，從 OracleDatabase 目錄進入，有分 SingleInstance 及 RAC 就根據自己需求去選，這邊我是要自己開發用的所以選擇是 <strong>SingleInstance</strong>，進去以後可以看到從 11g 到 21c 都有提供，就根據自己的需要去選擇，今天會使用 19c 來做為展示。</p><blockquote><p>雖然我的環境是用 windows，在 mac 的環境下是沒有差的。</p></blockquote><h2 id="Sparse-checkout"><a href="#Sparse-checkout" class="headerlink" title="Sparse checkout"></a>Sparse checkout</h2><p>整個 repo 很多內容，我們只需要 SingleInstance 底下的 dockerfiles 資料夾，選擇使用 sparse checkout 的做法，只拿部分的內容。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth 1 --sparse https://github.com/oracle/docker-images.git oracle-images</span><br><span class="line">cd oracle-images</span><br></pre></td></tr></table></figure><p>設定只取得 <code>OracleDatabase/SingleInstance/dockerfiles</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git sparse-checkout set &quot;OracleDatabase/SingleInstance/dockerfiles&quot;</span><br></pre></td></tr></table></figure><p><img src="/2023/01/16/build-oracle-database-image/dockerfiles-folder.png" alt="dockerfiles-folder"></p><h2 id="下載dbhome"><a href="#下載dbhome" class="headerlink" title="下載dbhome"></a>下載dbhome</h2><p><a href="https://www.oracle.com/database/technologies/oracle-database-software-downloads.html">Database Software Downloads | Oracle</a> 接著到 Oracle 官網下載 dbhome，選擇好版本並且點擊 linux x86_64 來下載。</p><p><img src="/2023/01/16/build-oracle-database-image/download_dbhome_linux.png" alt="download_dbhome_linux"></p><p>下載後的檔案放到剛剛所 clone 的專案目錄底下對應的版本資料夾中。</p><p><img src="/2023/01/16/build-oracle-database-image/dbhome_in_dockerfile_folder.png" alt="dbhome_in_dockerfile_folder"></p><h2 id="產生image"><a href="#產生image" class="headerlink" title="產生image"></a>產生image</h2><p>前置作業終於完成，可以來最作後一個步驟，產生 image 啦!<br>來到 dockerfiles 的資料夾，看到 <code>buildContainerImage.sh</code> 檔案，Oracle 已經寫好指令，讓我們可以更為方便的產生 image。</p><blockquote><p>如果是在 windows 環境下，無法直接執行 bash 的檔案，可以改用 WSL 來執行。</p></blockquote><p>後面加上 <code>-v</code> 指定版本，<code>-t</code> 指定 image tag 名稱。</p><blockquote><p>共有三種模式可以選擇，Enterprise Edition(-e), Standard Edition 2(-s), Express Edition(-x)</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./buildContainerImage.sh -v 19.3.0 -s -t oracle/database:19.3.0s</span><br></pre></td></tr></table></figure><p>執行會有一陣子(我的電腦最後花費 280 秒)，最後看到這樣的訊息就代表成功囉。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> =&gt; =&gt; naming to docker.io/oracle/database:19.3.0s                         0.0s</span><br><span class="line"></span><br><span class="line">Use &#x27;docker scan&#x27; to run Snyk tests against images to find vulnerabilities and learn how to fix them</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Oracle Database container image for &#x27;se2&#x27; version 19.3.0 is ready to be extended:</span><br><span class="line"></span><br><span class="line">    --&gt; oracle/database:19.3.0s</span><br><span class="line"></span><br><span class="line">  Build completed in 280 seconds.</span><br></pre></td></tr></table></figure><p>開啟 DockerDesktop 切換到 Images 的頁面，就可以看到所產生的 image 啦!!</p><p><img src="/2023/01/16/build-oracle-database-image/image-build-successfully.png" alt="image-build-successfully"></p><h2 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h2><p>最後就是跑起來!! (<del>還慢慢走啊，動作</del>)<br>如果想要保留檔案，可以使用 volumn 做對應 <code>/opt/oracle/oradata</code>；使用環境變數指定管理者密碼 <code>ORACLE_PWD</code>。</p><blockquote><p>如果沒有 volumn 的話，第一次的啟動會花較多時間；有 volumn 就會蠻快的。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name oracle -d -it --rm -p 1521:1521 -v $&#123;PWD&#125;/data19c:/opt/oracle/oradata -e ORACLE_PWD=&quot;p@ssw0rd&quot; oracle/database:19.3.0s</span><br></pre></td></tr></table></figure><p>到了這個步驟，終於可以開始我們的開發啦，也不用擔心重灌系統還要先 dump&#x2F;import 資料，可以大大的節省時間啦!!</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Database </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[flutter] 在 GoRoute 中使用 NavigationBar</title>
      <link href="/2023/01/09/flutter-goroute-with-navigation-bar/"/>
      <url>/2023/01/09/flutter-goroute-with-navigation-bar/</url>
      
        <content type="html"><![CDATA[<p>在 App 中通常會把主要的幾個頁面放在下方 icon，讓使用者能夠方便操作，這個元件在 flutter 中稱為 <code>BottomNavigationBar</code>。<br><code>GoRouter</code> 是 Flutter 官方所提供的套件，可以用來整合整個專案的路由，當這兩個功能整合在一起的時候，一個不小心呈現出來的效果就會差很多。</p><span id="more"></span><blockquote><p>版本資訊<br>Flutter 3.3.4<br>go_router: ^6.0.0</p></blockquote><p>先產生一個新的專案叫做 <code>my_app</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter create my_app</span><br><span class="line">cd my_app</span><br></pre></td></tr></table></figure><h2 id="加入BottomNavigationBar"><a href="#加入BottomNavigationBar" class="headerlink" title="加入BottomNavigationBar"></a>加入BottomNavigationBar</h2><p> 在 <code>MyHomePage</code> 元件中找到 <code>build</code> 的方法，在 Scaffold 加上 <code>bottomNavigationBar</code> 的屬性，加上兩個有 icon 的元件。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">      items: <span class="keyword">const</span> [</span><br><span class="line">        BottomNavigationBarItem(</span><br><span class="line">          icon: Icon(Icons.search),</span><br><span class="line">          label: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">        BottomNavigationBarItem(</span><br><span class="line">          icon: Icon(Icons.add),</span><br><span class="line">          label: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(widget.title),</span><br><span class="line">    ),</span><br><span class="line">    body: Center(</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          <span class="keyword">const</span> Text(</span><br><span class="line">            <span class="string">&#x27;You have pushed the button this many times:&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">          Text(</span><br><span class="line">            <span class="string">&#x27;<span class="subst">$_counter</span>&#x27;</span>,</span><br><span class="line">            style: Theme.of(context).textTheme.headline4,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行指令 <code>flutter run</code> 就可以看到畫面的下方有一個 icon 的區塊，顯示剛剛所加入的 search 和 add。</p><p><img src="/2023/01/09/flutter-goroute-with-navigation-bar/navigation-bar-without-router.png" alt="navigation-bar-without-router"></p><h2 id="加入GoRouter"><a href="#加入GoRouter" class="headerlink" title="加入GoRouter"></a>加入GoRouter</h2><p>接著要來加入 <a href="https://pub.dev/packages/go_router">GoRouter</a> 這個套件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add go_router</span><br></pre></td></tr></table></figure><h3 id="定義Router"><a href="#定義Router" class="headerlink" title="定義Router"></a>定義Router</h3><p>定義兩個 route，會使用同一個元件，但是透過傳入不同 title 的內容來做識別。<br>找到 MyApp 這個元件，在 build 裡面加上這段。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = GoRouter(</span><br><span class="line">  initialLocation: <span class="string">&#x27;/page1&#x27;</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    GoRoute(</span><br><span class="line">      path: <span class="string">&#x27;/page1&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;page1&#x27;</span>,</span><br><span class="line">      builder: (BuildContext context, GoRouterState state) =&gt;</span><br><span class="line">          <span class="keyword">const</span> MyHomePage(</span><br><span class="line">        title: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    GoRoute(</span><br><span class="line">      path: <span class="string">&#x27;/page2&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;page2&#x27;</span>,</span><br><span class="line">      builder: (BuildContext context, GoRouterState state) =&gt;</span><br><span class="line">          <span class="keyword">const</span> MyHomePage(</span><br><span class="line">        title: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>接著要調整 return 的行為，原本是用 <code>MaterialApp</code>，現在要來改用 <code>MaterialApp.router</code> 才能加上路由的設定。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> MaterialApp.router(</span><br><span class="line">  title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">  theme: ThemeData(</span><br><span class="line">    primarySwatch: Colors.blue,</span><br><span class="line">  ),</span><br><span class="line">  <span class="comment">// 把原本的 home 屬性刪除並加上這段</span></span><br><span class="line">  routeInformationProvider: router.routeInformationProvider,</span><br><span class="line">  routeInformationParser: router.routeInformationParser,</span><br><span class="line">  routerDelegate: router.routerDelegate,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>最後回去調整 BottomNavigationBar 的行為，監聽 <code>onTap</code> 的事件，來達到切換頁面的效果。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">items: <span class="keyword">const</span> [</span><br><span class="line">  BottomNavigationBarItem(</span><br><span class="line">    icon: Icon(Icons.search),</span><br><span class="line">    label: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">  ),</span><br><span class="line">  BottomNavigationBarItem(</span><br><span class="line">    icon: Icon(Icons.add),</span><br><span class="line">    label: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">  ),</span><br><span class="line">],</span><br><span class="line"><span class="comment">// 監聽點擊事件</span></span><br><span class="line">onTap: (index) =&gt; context.go(<span class="string">&#x27;/page<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>),</span><br></pre></td></tr></table></figure><p>改好以後回到剛剛沒有中斷的 terminal 按下 <code>r</code> 做個重新整理，切換的頁面的功能是正常的，但是整個頁面包含 NavigationBar 也都跟著重新載入。</p><blockquote><p>請先忽略點選了第二頁但是 icon 還是停留在第一頁的問題</p></blockquote><p><img src="/2023/01/09/flutter-goroute-with-navigation-bar/gorouter-navigation-bar.gif" alt="gorouter-navigation-bar"></p><h3 id="使用ShellRoute"><a href="#使用ShellRoute" class="headerlink" title="使用ShellRoute"></a>使用ShellRoute</h3><p>根據 GoRouter 的<a href="https://pub.dev/documentation/go_router/latest/go_router/ShellRoute-class.html">介紹</a>，當有需要 BottomNavigationBar 的時候，應該要採用 <code>ShellRoute</code> 的架構，就能夠只有內容重新載入。<br>接著就要動一個比較大的工程，要將 Scaffold 整個拉出來放到 ShellRoute 中。</p><p>建立一個新的元件，就叫他 <code>ScaffoldWithBottomNavBar</code>。</p><blockquote><p>這邊方便就不切檔案了，直接一個 main.dart 到底。</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScaffoldWithBottomNavBar</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ScaffoldWithBottomNavBar(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.child&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;ScaffoldWithBottomNavBar&gt; createState() =&gt;</span><br><span class="line">      _ScaffoldWithBottomNavBarState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ScaffoldWithBottomNavBarState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ScaffoldWithBottomNavBar</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">        items: <span class="keyword">const</span> [</span><br><span class="line">          BottomNavigationBarItem(</span><br><span class="line">            icon: Icon(Icons.search),</span><br><span class="line">            label: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">          BottomNavigationBarItem(</span><br><span class="line">            icon: Icon(Icons.add),</span><br><span class="line">            label: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">        onTap: (index) =&gt; context.go(<span class="string">&#x27;/page<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">      <span class="comment">// 內容由外面來決定</span></span><br><span class="line">      body: widget.child,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把這個元件加到路由的設定上面。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = GoRouter(</span><br><span class="line">  initialLocation: <span class="string">&#x27;/page1&#x27;</span>,</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// 在原本的路由前面加上 ShellRoute 並且回傳剛剛所建立的元件</span></span><br><span class="line">    ShellRoute(</span><br><span class="line">      builder: ((context, state, child) =&gt;</span><br><span class="line">          ScaffoldWithBottomNavBar(child: child)),</span><br><span class="line">      routes: [</span><br><span class="line">        GoRoute(</span><br><span class="line">          path: <span class="string">&#x27;/page1&#x27;</span>,</span><br><span class="line">          name: <span class="string">&#x27;page1&#x27;</span>,</span><br><span class="line">          builder: (BuildContext context, GoRouterState state) =&gt;</span><br><span class="line">              <span class="keyword">const</span> MyHomePage(</span><br><span class="line">            title: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        GoRoute(</span><br><span class="line">          path: <span class="string">&#x27;/page2&#x27;</span>,</span><br><span class="line">          name: <span class="string">&#x27;page2&#x27;</span>,</span><br><span class="line">          builder: (BuildContext context, GoRouterState state) =&gt;</span><br><span class="line">              <span class="keyword">const</span> MyHomePage(</span><br><span class="line">            title: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>前面已經將 BottomNavigationBar 抽出去放到 ShellRoute 中，回到 <code>MyHomePage</code> 元件將原本加上去的設定移除掉。</p><blockquote><p>Scaffold 可以多次宣告，後面宣告的會疊加上去。</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">  <span class="comment">// 移除 bottomNavigationBar 屬性</span></span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(widget.title),</span><br><span class="line">    ),</span><br><span class="line">    body: Center(</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          <span class="keyword">const</span> Text(</span><br><span class="line">            <span class="string">&#x27;You have pushed the button this many times:&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">          Text(</span><br><span class="line">            <span class="string">&#x27;<span class="subst">$_counter</span>&#x27;</span>,</span><br><span class="line">            style: Theme.of(context).textTheme.headline4,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>都改完後一樣回到 terminal 按下 r 重新整理，BottomNavigationBar 的區塊是固定的了，只有內容頁是不同。</p><p><img src="/2023/01/09/flutter-goroute-with-navigation-bar/gorouter-shellroute.gif" alt="gorouter-shellroute"></p><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>在 web 上會很習慣這種功能的存在，轉到 flutter 時，一時間沒找到也沒特別注意到問題，後來是測試的時候才被點出來。一個元件使用上的小地方，用錯方法就會讓使用者看起來沒有那麼舒服（或是習慣？）。</p><p>最後附上完整的程式碼。</p><script src="//gist.github.com/998dd50d8692c79cdf9c2a3383bc0a1a.js?file=main.dart"></script>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Debug] AjaxToolKit Calendar的時間問題</title>
      <link href="/2023/01/05/ajaxtoolkit-calendar-time-issue/"/>
      <url>/2023/01/05/ajaxtoolkit-calendar-time-issue/</url>
      
        <content type="html"><![CDATA[<p>在一個 Webform 的專案中，使用到 AjaxToolKit 的元件 <code>CalendarExtender</code>來選擇日期，設定的時間格式為 <code>2023/01/05  23:59:59</code>，在瀏覽器做日期的選擇後，會變成 <code>2023/01/05 23:59:00</code>，也沒有看到任何地方有去變更時間，同事覺得奇怪，一起追查問題以後發現這是一個 bug。</p><span id="more"></span><h2 id="問題追查"><a href="#問題追查" class="headerlink" title="問題追查"></a>問題追查</h2><p>專案中的程式是這樣寫，<code>ttbEndDate</code> 的值是給今天的 23:59:59，沒有去接任何事件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">asp:TextBox</span> <span class="attr">ID</span>=<span class="string">&quot;ttbEndDate&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">CssClass</span>=<span class="string">&quot;CSInput&quot;</span> <span class="attr">Width</span>=<span class="string">&quot;90%&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">asp:TextBox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ajaxToolkit:CalendarExtender</span> <span class="attr">ID</span>=<span class="string">&quot;ttbEndDate_CalendarExtender&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">TargetControlID</span>=<span class="string">&quot;ttbEndDate&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">PopupButtonID</span>=<span class="string">&quot;ibtEndDate&quot;</span> <span class="attr">Format</span>=<span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ajaxToolkit:CalendarExtender</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">asp:ImageButton</span> <span class="attr">ID</span>=<span class="string">&quot;ibtEndDate&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">ImageUrl</span>=<span class="string">&quot;../../Images/Calendar.JPG&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;20px&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>這是 ajax 的元件，那就試著從 javascript 開始找起，開啟網頁的開發者工具，html 的內容中，搜尋 <code>ttbEndDate_CalendarExtender</code> 可以找到下面這段程式，確定的是這段只有做初始化，沒有塞入值之類的行為。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Sys</span>.<span class="property">Application</span>.<span class="title function_">add_init</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $create(<span class="title class_">Sys</span>.<span class="property">Extended</span>.<span class="property">UI</span>.<span class="property">CalendarBehavior</span>, &#123;<span class="string">&quot;button&quot;</span>:$get(<span class="string">&quot;ibtEndDate&quot;</span>),<span class="string">&quot;format&quot;</span>:<span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="string">&quot;ttbEndDate_CalendarExtender&quot;</span>&#125;, <span class="literal">null</span>, <span class="literal">null</span>, $get(<span class="string">&quot;ttbEndDate&quot;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>前面是從 html 去看原始碼的宣告，接著就要切換到來源找到 <code>CalendarBehavior</code> 的運作，開啟網頁的 aspx 可以看到裡面有滿滿的 js 宣告，可以從註解中找到 <code>CalendarBehavior</code> 的區塊。</p><blockquote><p>這種壓縮過的程式會比較難閱讀，可以點下方的 <code>&#123;&#125;</code> 圖示來還原比較好讀的排版。參考 <a href="https://5xruby.tw/posts/how-to-use-chrome-devtools">開發不難，會 Debug 就好！如何靈活運用 Chrome DevTools 來開發網站 | 五倍紅寶石・專業程式教育 (5xruby.tw)</a></p></blockquote><p><img src="/2023/01/05/ajaxtoolkit-calendar-time-issue/source-aspx-js.png" alt="source-aspx-js"></p><p>看展開後的排版，從上到下的把一段大概看一下，猜測寫入值的部分應該是在 <code>set_selectedDate</code>，從這邊下個中斷點，開始一行一行的看邏輯。<br><img src="/2023/01/05/ajaxtoolkit-calendar-time-issue/calendarbehavior.png" alt="calendarbehavior.png"></p><p><code>d</code> 是選擇到的日期，<code>f</code> 是原本選擇的日期也就是帶有時分秒的，在 4734 行開始，會把 <code>f</code> 的時分秒開始寫入到 <code>d</code> 身上，問題就在這邊，有 <code>時Hour</code>、<code>分Minute</code>、<code>毫秒Millisecond</code>，但是沒看到 <code>秒Second</code>。<br>嘗試把這行程式在 <code>監看</code> 執行，可以看到 <code>ttbEndDate</code> 的值就是正確的了!!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d.<span class="title function_">setUTCSeconds</span>(e.<span class="title function_">getUTCSeconds</span>());</span><br></pre></td></tr></table></figure><h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>上面雖然找到問題了，但那個是元件中所產生的 js，沒辦法直接去改動到，先檢查專案 AjaxToolKit 的版本為 <code>4.0.60919</code> ，在 nuget 中最新的版本為 <code>20.1.0</code>，在 github 上面有找到 <a href="https://github.com/DevExpress/AjaxControlToolkit/blob/master/AjaxControlToolkit/Scripts/Calendar.js">source code</a>，在最新版本中已經有被修正。</p><blockquote><p>這個問題一直到 <code>15.1.4</code> 才被修正</p></blockquote><p>同事是採用不升級的手法來處理，寫一個 js 的方法，把後面的時間固定。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">endDateSelect</span>(<span class="params">ev</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> calendarBehavior1 = $find(<span class="string">&quot;ttbEndDate_CalendarExtender&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> d = calendarBehavior1.<span class="property">_selectedDate</span>;            </span><br><span class="line">    calendarBehavior1.<span class="title function_">get_element</span>().<span class="property">value</span> = d.<span class="title function_">format</span>(<span class="string">&quot;yyyy/MM/dd&quot;</span>) + <span class="string">&quot; 23:59:59&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 <code>CalendarExtender</code> 的屬性宣告<code>OnClientDateSelectionChanged</code>，讓元件可以去呼叫剛剛所寫好的方法。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ajaxToolkit:CalendarExtender</span> <span class="attr">ID</span>=<span class="string">&quot;ttbEndDate_CalendarExtender&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">TargetControlID</span>=<span class="string">&quot;ttbEndDate&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">PopupButtonID</span>=<span class="string">&quot;ibtEndDate&quot;</span> <span class="attr">Format</span>=<span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span> <span class="attr">OnClientDateSelectionChanged</span>=<span class="string">&quot;endDateSelect&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ajaxToolkit:CalendarExtender</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>雖然這是古老的技術，也是可以透過現代的工具來幫助我們更容易地找到問題，感謝 open source 的年代，可以更容易的去找到版本的變更，可惜的是版本的紀錄是從 15 開始，無法看到更早的變更，就不能那麼確認是否有 breaking change。</p>]]></content>
      
      
      <categories>
          
          <category> Webform </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
            <tag> Debug </tag>
            
            <tag> Webform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 搞懂 css scope</title>
      <link href="/2022/11/02/blazor-css-scope/"/>
      <url>/2022/11/02/blazor-css-scope/</url>
      
        <content type="html"><![CDATA[<p>Blazor 的 css 作用域預設是元件內有效，那如果想要往子元件渲染的話，可以怎麼做？今天要來搞懂 Blazor 的 css scope 是怎麼樣運作，let’s go!</p><span id="more"></span><blockquote><p>環境:<br>dotnet 6<br>blazor wasm</p></blockquote><p>使用 dotnet cli 來產生一個 blazor web assembly 的專案，應該可以看到以下的內容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new blazorwasm -n blazor-css-scope</span><br></pre></td></tr></table></figure><p><img src="/2022/11/02/blazor-css-scope/project-files.png" alt="project-files"></p><p>什麼都不動的情況下，有看到兩個元件有自己的 css file，一個是 <code>MainLayout</code> 另一個則是 <code>NavMenu</code>，這兩個都是基底的元件，任一個畫面都會使用到。<br>我們就直接跑起來看看網站的 f12 是長什麼樣</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet watch run</span><br></pre></td></tr></table></figure><h2 id="預設的行為"><a href="#預設的行為" class="headerlink" title="預設的行為"></a>預設的行為</h2><p>這邊是 MainLayout.razor 內容，可以看到有 <code>page</code>, <code>sidebar</code> 這些的 class 宣告</p><p><img src="/2022/11/02/blazor-css-scope/MainLayout.png" alt="MainLayout"></p><p>接著打開網站開發者工具，檢視元素的部份，找到 <code>id=&quot;app&quot;</code> 並且打開裡面的節點，可以看到 MainLayout 這個元件，有 <code>page</code>, <code>sidebar</code> 這些的 class 宣告。</p><blockquote><p>不知道你有沒有注意到一個小地方，每個元素上面都被加上了 <code>b-jrym99nura</code> 這個屬性，等等會用到喔！</p></blockquote><p><img src="/2022/11/02/blazor-css-scope/MainLayoutHtml.png" alt="MainLayoutHtml"></p><p>點到 page 的元素，看到 style 的渲染結果，原本的 <code>page</code> class 還被添加了一個奇怪的屬性。</p><p><img src="/2022/11/02/blazor-css-scope/page-style.png" alt="page-style"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page</span><span class="selector-attr">[b-jrym99nura]</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>blazor 為了避免各個元件的 css 互相的干擾，加上了這個機制，在該元件的每個元素上都給一個唯一的編碼作為屬性，對應的 css 也會加上這個屬性。<br>也就是說，不同的元件，就會有不同的編碼，子元件也不會這樣就被影響到樣式。</p><blockquote><p>前端三御家，其實也有差不多的作法，用來控制樣式不會互相污染</p></blockquote><p>這邊我們可以用 MainLayout 裡面的 <code>NavMenu</code> 這個元件來看，可以發現到跟 MainLayout 的編碼不同。</p><p><img src="/2022/11/02/blazor-css-scope/different-id.png" alt="different-id"></p><h2 id="跨元件渲染"><a href="#跨元件渲染" class="headerlink" title="跨元件渲染"></a>跨元件渲染</h2><p>從前面例子可以看到 blazor 預設是不會去影響子元件，想要跨元件的話，blazor 也有提供一個關鍵字 <code>::deep</code>，可以讓編譯器知道作用域是要往下影響。</p><p>寫一個元件 <code>CssScope.razor</code> 裡面放兩個 h1，來做為測試用。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hi css<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hi scope<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在 <code>Index.razor</code> 加上 <code>CssScope</code> 的元件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Welcome to your new app.</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">CssScope</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">SurveyPrompt</span> <span class="attr">Title</span>=<span class="string">&quot;How is Blazor working for you?&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>在 <code>Index.razor.css</code> 中去改變 h1 的顏色為紅色。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這樣寫就如同前面所提到的只會渲染到自己的元件，底下的元件是不會理，那我們試著加上 <code>::deep</code> 看看。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">::deep h1 &#123;</span><br><span class="line"><span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>8bq了，底下元件沒渲染到就算，連自己都沒了，這到底有沒有實際的效果呢？<br>不要緊張，開啟開發者工具，在 source 中可以找到專案的 css 檔案 <code>blazor-css-scope.styles.css</code>，屬於這個專案的樣式全部都會集中在這個檔案中。<br>我們要從裡面來看看到底 css 被定義成什麼樣的內容，剛好第一段就是我們要找的。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* /Pages/Index.razor.rz.scp.css */</span></span><br><span class="line"><span class="selector-attr">[b-hrxucffzsm]</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到被編譯成擁有 <code>b-hrxucffzsm</code> 這個屬性底下的所有 h1 都可以套用到這個結果，那就好奇這個編碼有被套用在哪些元素身上。</p><p><img src="/2022/11/02/blazor-css-scope/index-scope.png" alt="index-scope"></p><p>只有 hellow world 的 h1 被加上編碼屬性，那依照剛剛的 css 規則來說，等於沒有任何元素是在那個編碼屬性底下。<br>要讓 css 能應用到子元件，有幾個作法可以考慮看看</p><ul><li><p>使用 <code>~</code>，接在 index 編碼屬性後的 h1 都套用</p><blockquote><p>這缺點就是只能是同層，如果 h1 有被其他元素包住，就沒有效果</p></blockquote></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">::deep ~ h1 &#123;</span><br><span class="line"><span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>用一個元素來包住子元素，原本的 css 規則不用動</p><blockquote><p>不管子元素的 h1 有幾層，都可以被套用到</p></blockquote></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  Welcome to your new app.</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">CssScope</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>這邊的觀念其實是回到了 css 規則的部份，在開發的時候善用開發者工具，可以幫助到偵錯前端的問題。</p><blockquote><p>對於規則沒那麼熟悉的話，推薦可以看 Amos 的 <a href="https://ithelp.ithome.com.tw/users/20112550/ironman/2799">金魚都能懂的 CSS 選取器</a>。</p></blockquote><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/components/css-isolation?view=aspnetcore-6.0">ASP.NET Core Blazor CSS isolation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[dotnet framework] 如何使用 cli 執行測試</title>
      <link href="/2022/10/14/dotnet-framework-test-project-command-line/"/>
      <url>/2022/10/14/dotnet-framework-test-project-command-line/</url>
      
        <content type="html"><![CDATA[<p>昨天收到同事的一個 bug，使用公司 library 所提供的方法所引發的一個錯誤，這錯誤蠻基本也蠻蝦的，雖然這個 library 已經很少再改，基於保護自己的想法，還是要幫這個方法加上測試，因為這個專案的版本還是 dotnet framework 4.5.1，希望能透過 cli 的方式在 CI 的時候跑測試。</p><p>在 cli 測試的話目前有兩種做法，第一種是新版 SDK 所提供的 <code>dotnet cli</code>；另一種就是 Visual Studio 的工具。</p><span id="more"></span><h2 id="使用-VisualStudio-的工具"><a href="#使用-VisualStudio-的工具" class="headerlink" title="使用 VisualStudio 的工具"></a>使用 VisualStudio 的工具</h2><p>VS 所提供的工具其實有兩種，一個是舊的作法 <code>mstest.exe</code> ，另一才是 <code>vstest.console.exe</code>。</p><blockquote><p>不管用哪一種方法，都要先編譯專案產生 dll 後才能執行。 </p></blockquote><h3 id="MSTest-exe"><a href="#MSTest-exe" class="headerlink" title="MSTest.exe"></a>MSTest.exe</h3><p><strong>微軟已經不建議使用這個做法</strong>，找到安裝 VS 的目錄底下 <code>Common7\IDE\MSTest.exe</code> </p><blockquote><p>{install folder}\Microsoft Visual Studio\{version}\{edition}\Common7\IDE\MSTest.exe</p></blockquote><p>示範的指令如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSTest.exe /testcontainer:testproject\bin\debug\testproject.dll</span><br></pre></td></tr></table></figure><p>更詳細的指令介紹請參考 <a href="https://blog.yowko.com/mstest-exe/">使用 MSTest.exe 指令來進行測試 - Yowko’s Notes</a></p><h3 id="VSTest-Console-exe"><a href="#VSTest-Console-exe" class="headerlink" title="VSTest.Console.exe"></a>VSTest.Console.exe</h3><p>微軟所提供比較新的做法，官方有詳細的介紹 <a href="https://learn.microsoft.com/en-us/visualstudio/test/vstest-console-options?view=vs-2022">VSTest.Console.exe command-line options - Visual Studio (Windows) | Microsoft Learn</a>。</p><p>最後我找到的檔案目錄和官方介紹的不一樣，大家可以都試試看。</p><ul><li>官方檔案路徑</li></ul><blockquote><p>{install folder}\Microsoft Visual Studio\{version}\{edition}\common7\ide\CommonExtensions\{Platform | Microsoft}</p></blockquote><ul><li>我的檔案路徑</li></ul><blockquote><p>{install folder}\Microsoft Visual Studio\{version}\{edition}\Common7\IDE\Extensions\TestPlatform</p></blockquote><p>示範的指令如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vstest.console.exe testproject\bin\debug\testproject.dll</span><br></pre></td></tr></table></figure><blockquote><p>若要指定執行的環境為 x64，可以加上參數 <code>/platform:x64</code></p></blockquote><h2 id="使用-dotnet-cli"><a href="#使用-dotnet-cli" class="headerlink" title="使用 dotnet cli"></a>使用 dotnet cli</h2><p>自從微軟推出 dotnet core 以後，也跟著推出 dotnet cli，理論上你可以使用 cli 來執行各種專案(包含 framework)，但我自己測試後發現 dotnet build&#x2F;msbuild 對於 framework 的編譯會有些錯誤，後面就沒細去看。<br>回到這篇的主軸，可以使用 dotnet test 這個指令，來針對 framework 版本的專案進行測試，但直接執行的話什麼結果都沒，應該是專案的結構導致 dotnet cli 看不懂。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">❯  dotnet test</span><br><span class="line">  正在判斷要還原的專案...</span><br><span class="line">  所有專案都在最新狀態，可進行還原。</span><br></pre></td></tr></table></figure><p>仔細看一下<a href="https://learn.microsoft.com/zh-tw/dotnet/core/tools/dotnet-test">官方的文件</a>，可以針對以下幾種來執行 [&lt;PROJECT&gt; | &lt;SOLUTION&gt; | &lt;DIRECTORY&gt; | &lt;DLL&gt; | &lt;EXE&gt;]，既然 framework 的結構讓 dotnet cli 看不懂，就跟前面一樣針對 dll 來進行測試。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯  dotnet test testproject\bin\Debug\testproject.dll</span><br><span class="line">Microsoft (R) Test Execution Command Line Tool 17.3.1 (x64) 版</span><br><span class="line">Copyright (C) Microsoft Corporation. 著作權所有，並保留一切權利。</span><br><span class="line"></span><br><span class="line">正在啟動測試執行，請稍候...</span><br><span class="line">總共有 1 個測試檔案與指定的模式相符。</span><br><span class="line"></span><br><span class="line">已通過! - 失敗:     0，通過:     2，略過:     0，總計:     2，持續時間: 596 ms - testproject.dll (net451)</span><br></pre></td></tr></table></figure><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>dotnet framework 畢竟是舊時代的產物，如果要使用新時代的東西 dotnet cli，就要稍微繞路一下，但這個前提就會是 CI server 有 dotnet cli，如果沒有的話，可以直接採用 vstest.console.exe，應該會比較好處理。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://blog.yowko.com/mstest-exe/">使用 MSTest.exe 指令來進行測試 - Yowko’s Notes</a></li><li><a href="https://learn.microsoft.com/en-us/visualstudio/test/vstest-console-options?view=vs-2022">VSTest.Console.exe command-line options - Visual Studio (Windows) | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/zh-tw/dotnet/core/tools/dotnet-test">dotnet test 命令 - .NET CLI | Microsoft Learn</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Dotnet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Dotnet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Dotnet] 如何切換 SDK 版本</title>
      <link href="/2022/09/06/dotnet-sdk-version-swtich/"/>
      <url>/2022/09/06/dotnet-sdk-version-swtich/</url>
      
        <content type="html"><![CDATA[<p>DotnetCore的版本更新的很快，為了要有支援多個環境，電腦都會安裝很多的 SDK，預設 cli 會使用最新的版本，理論上新版都應該是可以支援舊版的編譯；但偏偏<del>雨漸漸</del>為了要測試一個功能，就安裝了 Dotnet 7 preview，結果導致原本可以編譯的專案變成失敗，而且錯誤訊息還很難看懂，還好可以指定舊版的 SDK，就可以避免掉這樣的問題。</p><span id="more"></span><p>首先我們要先確定現在電腦中有安裝那些版本，在 cli 中下指令來取得清單，裡面包含版本號及安裝路徑。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet --list-sdks</span><br></pre></td></tr></table></figure><p><img src="/2022/09/06/dotnet-sdk-version-swtich/sdk-list.png" alt="sdk-list"></p><p>接著可以透過 cli 來產生 <code>global.json</code> 的檔案，用來指定 SDK 版本。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new globaljson</span><br></pre></td></tr></table></figure><p><img src="/2022/09/06/dotnet-sdk-version-swtich/cli-globaljson.png" alt="cli-globaljson"></p><p>要注意的是，這個檔案會產生在你所下的目錄位置內，並不是真的在 User 底下的一個檔案，可以透過 cat 來看內容是什麼。</p><p><img src="/2022/09/06/dotnet-sdk-version-swtich/cat-globaljson.png" alt="cat-globaljson"></p><p>像是我要改成指定 <code>6.0.300</code> 的話，就可以開啟這個檔案，並且替換 version 的內容，存檔後可以下 <code>dotnet --version</code> 來確認現在版本是符合預期的。</p><blockquote><p>如果只想要透過指令，也可以考慮使用 jq 這個套件來完成，或是用 vim</p></blockquote><p><img src="/2022/09/06/dotnet-sdk-version-swtich/change-sdk-version.png" alt="change-sdk-version"></p><p>當然也有更快的方法，產生 global.json 時就直接指定需要的版本號。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new globaljson --sdk-version 6.0.300</span><br></pre></td></tr></table></figure><p><img src="/2022/09/06/dotnet-sdk-version-swtich/cli-globaljson-version.png" alt="cli-globaljson-version"></p><p>用以上的方法就可以先排除掉因為 SDK 太新導致編譯失敗的問題，不建議把這個檔案加入版控，畢竟這算是個人環境因素，另外就是如果未來專案升級，這個檔案也要砍掉或跟著調整，不然執行上就會有問題。</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/core/tools/global-json?WT.mc_id=DT-MVP-4015686">global.json overview - .NET CLI | Microsoft Docs</a></li><li><a href="https://blog.miniasp.com/post/2018/04/19/How-to-switch-between-DotNet-SDK-versions">如何在多個 .NET Core SDK 版本之間進行切換 (global.json) | The Will Will Web (miniasp.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> DotnetCore </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DotnetCore </tag>
            
            <tag> SDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[DotnetCore] 讀取 excel 套件整理</title>
      <link href="/2022/08/22/dotnet-core-read-excel-library/"/>
      <url>/2022/08/22/dotnet-core-read-excel-library/</url>
      
        <content type="html"><![CDATA[<p>dotnet core 的專案現在有讀取 excel 的需求了，測試幾套後整理做法，給有需要的人。總共看了四套，其中一套在商用上是需要付費的，使用上要注意一下。</p><span id="more"></span><p>Excel 的資料格式如下，並且定義類別。</p><p><img src="/2022/08/22/dotnet-core-read-excel-library/excel-sample.png" alt="excel-sample"></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WIP &#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WIP_STATUS &#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line"><span class="keyword">public</span> Detetime DEADLINE &#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="OpenXML"><a href="#OpenXML" class="headerlink" title="OpenXML"></a>OpenXML</h2><p><a href="https://github.com/OfficeDev/Open-XML-SDK">OfficeDev&#x2F;Open-XML-SDK: Open XML SDK by Microsoft (github.com)</a>，由微軟自己所提供，也算是蠻成熟的套件，缺點是寫起來蠻囉嗦的；在 nuget 中搜尋 <code>DocumentFormat.OpenXml</code> 並且安裝到專案中。</p><p>如果是字串的話，資料會放在 <a href="https://docs.microsoft.com/en-us/office/open-xml/working-with-the-shared-string-table?redirectedfrom=MSDN">ShareString Table</a>，一開始取得的資料就會是 index。日期的話可以用 <code>DateTime.FromOADate</code> 做處理。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="string">@&quot;D:\Import_WIP_Example.xlsx&quot;</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> doc = SpreadsheetDocument.Open(path, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">var</span> workbookPart = doc.WorkbookPart;</span><br><span class="line"><span class="keyword">var</span> sheet = workbookPart.Workbook.Sheets.GetFirstChild&lt;Sheet&gt;();</span><br><span class="line"><span class="keyword">var</span> worksheet = ((WorksheetPart)workbookPart.GetPartById(sheet.Id)).Worksheet;</span><br><span class="line"><span class="keyword">var</span> sheetData = worksheet.GetFirstChild&lt;SheetData&gt;();</span><br><span class="line"><span class="keyword">var</span> sharedTable = workbookPart.SharedStringTablePart.SharedStringTable;</span><br><span class="line"><span class="comment">// 使用物件來承接資料</span></span><br><span class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> List&lt;Data&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳過欄位名稱的 row1</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> row <span class="keyword">in</span> sheetData.ChildElements.Select(x =&gt; x <span class="keyword">as</span> Row).Skip(<span class="number">1</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> Data();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; row.ChildElements.Count; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> cell = row.ChildElements[i] <span class="keyword">as</span> Cell;</span><br><span class="line">         <span class="comment">// 取得欄位資料</span></span><br><span class="line"><span class="keyword">var</span> innerText = cell.InnerText;</span><br><span class="line">         <span class="comment">// 只有字串的資料會在 SharedString Table，需要另外取資料</span></span><br><span class="line"><span class="keyword">if</span> (cell.DataType != <span class="literal">null</span> &amp;&amp; cell.DataType == CellValues.SharedString)</span><br><span class="line">&#123;</span><br><span class="line">SharedStringItem item = sharedTable.Elements&lt;SharedStringItem&gt;().ElementAt(Int32.Parse(innerText));</span><br><span class="line">innerText = item.InnerText;</span><br><span class="line">&#125;</span><br><span class="line">         <span class="comment">// 預期 C 欄位是日期，可以用 FromOADate 來轉成 DateTime</span></span><br><span class="line"><span class="keyword">if</span>(cell.CellReference.Value.StartsWith(<span class="string">&quot;C&quot;</span>) &amp;&amp; Int32.TryParse(innerText, <span class="keyword">out</span> <span class="keyword">var</span> oaDate))&#123;</span><br><span class="line">data.DEADLINE = DateTime.FromOADate(Convert.ToInt32(oaDate));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">         <span class="comment">// 寫入到物件</span></span><br><span class="line"><span class="keyword">switch</span> (i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">data.WIP = innerText;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">data.WIP_STATUS = innerText;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 去除空白資料</span></span><br><span class="line"><span class="keyword">if</span>(data.WIP == <span class="string">&quot;&quot;</span> &amp;&amp; data.WIP_STATUS == <span class="string">&quot;&quot;</span>) <span class="keyword">continue</span>;</span><br><span class="line">list.Add(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用 LINQPad 的話可以解除註解來看資料</span></span><br><span class="line"><span class="comment">// list.Dump();</span></span><br></pre></td></tr></table></figure><h2 id="NPOI"><a href="#NPOI" class="headerlink" title="NPOI"></a>NPOI</h2><p><a href="https://github.com/nissl-lab/npoi">nissl-lab&#x2F;npoi: a .NET library that can read&#x2F;write Office formats without Microsoft Office installed. No COM+, no interop. (github.com)</a>，在 nuget 搜尋 <code>NPOI</code> 並安裝。</p><p>相對於 OpenXML 的優點是</p><ul><li>可以直接移除空白列</li><li>更好的日期處理</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="string">@&quot;D:\Import_WIP_Example.xlsx&quot;</span>;</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">using</span> FileStream fs = <span class="keyword">new</span>(path, FileMode.Open);</span><br><span class="line"><span class="keyword">var</span> xssWorkbook = <span class="keyword">new</span> XSSFWorkbook(fs);</span><br><span class="line"><span class="keyword">var</span> sheet = xssWorkbook.GetSheetAt(<span class="number">0</span>);</span><br><span class="line">IRow headerRow = sheet.GetRow(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">int</span> cellCount = headerRow.LastCellNum;</span><br><span class="line"><span class="comment">// 使用物件來承接資料</span></span><br><span class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> List&lt;Data&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = (sheet.FirstRowNum + <span class="number">2</span>); i &lt;= sheet.LastRowNum; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> row = sheet.GetRow(i);</span><br><span class="line"><span class="keyword">if</span> (row == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line"><span class="comment">// 移除空白列</span></span><br><span class="line"><span class="keyword">if</span> (row.Cells.All(d =&gt; d.CellType == CellType.Blank)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> Data();</span><br><span class="line">list.Add(data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = row.FirstCellNum; j &lt; cellCount; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> cell = row.GetCell(j);</span><br><span class="line"><span class="keyword">if</span> (cell == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">         <span class="comment">// 日期處理</span></span><br><span class="line"><span class="keyword">if</span> (cell.CellType == CellType.Numeric &amp;&amp; DateUtil.IsCellDateFormatted(cell))</span><br><span class="line">&#123;</span><br><span class="line">data.DEADLINE = cell.DateCellValue;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">data.WIP = cell.ToString();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">data.WIP_STATUS = cell.ToString();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用 LINQPad 的話可以解除註解來看資料</span></span><br><span class="line"><span class="comment">// list.Dump();</span></span><br></pre></td></tr></table></figure><h2 id="EPPlus"><a href="#EPPlus" class="headerlink" title="EPPlus"></a>EPPlus</h2><p><a href="https://github.com/EPPlusSoftware/EPPlus">EPPlusSoftware&#x2F;EPPlus: EPPlus 5-Excel spreadsheets for .NET (github.com)</a>，<strong>商用需要付費</strong>；在 nuget 中搜尋 <code>EPPlus</code> 並且安裝。</p><ul><li>可以快速移除空白列</li><li>資料型態可以判斷</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="string">@&quot;D:\Import_WIP_Example.xlsx&quot;</span>;</span><br><span class="line">ExcelPackage.LicenseContext = LicenseContext.Commercial;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> package = <span class="keyword">new</span> ExcelPackage(<span class="keyword">new</span> FileInfo(path));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sheet = package.Workbook.Worksheets[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> startRowNumber = sheet.Dimension.Start.Row;</span><br><span class="line"><span class="keyword">var</span> endRowNumber = sheet.Dimension.End.Row;</span><br><span class="line"><span class="keyword">var</span> startColumn = sheet.Dimension.Start.Column;</span><br><span class="line"><span class="keyword">var</span> endColumn = sheet.Dimension.End.Column;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> List&lt;Data&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> currentRow = startRowNumber + <span class="number">1</span>; currentRow &lt;= endRowNumber; currentRow++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移除空白列</span></span><br><span class="line">ExcelRange range = sheet.Cells[currentRow, startColumn, currentRow, endColumn];</span><br><span class="line"><span class="keyword">if</span> (range.All(c =&gt; !<span class="built_in">string</span>.IsNullOrEmpty(c.Text)) == <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> Data();</span><br><span class="line">list.Add(data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> j = startColumn; j &lt;= endColumn; j++)</span><br><span class="line">&#123;</span><br><span class="line">         <span class="comment">// 使用 Value 可以拿到日期型態</span></span><br><span class="line"><span class="keyword">var</span> cellValue = sheet.Cells[currentRow, j].Value;</span><br><span class="line">         <span class="comment">// 欄位是從 1 開始</span></span><br><span class="line"><span class="keyword">switch</span> (j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">data.WIP = cellValue.ToString();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">data.WIP_STATUS= cellValue.ToString();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">data.DEADLINE = (DateTime)cellValue;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用 LINQPad 的話可以解除註解來看資料</span></span><br><span class="line"><span class="comment">// list.Dump();</span></span><br></pre></td></tr></table></figure><h2 id="MiniExcel"><a href="#MiniExcel" class="headerlink" title="MiniExcel"></a>MiniExcel</h2><p><a href="https://github.com/MiniExcel/MiniExcel">MiniExcel&#x2F;MiniExcel: Fast, Low-Memory, Easy Excel .NET helper to import&#x2F;export&#x2F;template spreadsheet (github.com)</a>，在 nuget 搜尋 <code>MiniExcel</code> 並安裝。</p><p>算是比較新的套件，可以直接轉成物件，寫起來簡潔明瞭。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="string">@&quot;D:\Import_WIP_Example.xlsx&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> list = <span class="keyword">await</span> MiniExcel.QueryAsync&lt;Data&gt;(path, startCell: <span class="string">&quot;A1&quot;</span>);</span><br><span class="line">list = list.Where(p =&gt; p.WIP <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> &amp;&amp; p.WIP_STATUS <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 使用 LINQPad 的話可以解除註解來看資料</span></span><br><span class="line"><span class="comment">// list.Dump();</span></span><br></pre></td></tr></table></figure><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>以上四套，大家就看看自己的需求來使用囉，前面三套都蠻多資料可以查詢，只有最後一套 MiniExcel 就比較少，個人最後是選用 MiniExcel 這套，主要是可以搭配 EF 更快速的寫入資料庫。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://blog.darkthread.net/blog/open-xml-sdk-read-excel-string/">使用Open XML SDK讀取Excel中的文字-黑暗執行緒 (darkthread.net)</a></li><li>[<a href="https://hackmd.io/@carlochuang/npoi">VB] NPOI - 讀寫Excel檔案 - HackMD</a></li><li>[<a href="https://dotblogs.com.tw/shadow/2012/07/13/73385">C#] EPPlus 讀寫(read&#x2F;write) Excel檔案 懶人包範例程式碼 | 高級打字員的技術雲 - 點部落 (dotblogs.com.tw)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> DotnetCore </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DotnetCore </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 上傳檔案</title>
      <link href="/2022/08/11/blazor-upload-file/"/>
      <url>/2022/08/11/blazor-upload-file/</url>
      
        <content type="html"><![CDATA[<p>本篇會介紹如何在 Blazor 使用 <code>multipart/form-data</code> 上傳檔案的功能，並且在 API 要如何接收。</p><span id="more"></span><h2 id="Blazor"><a href="#Blazor" class="headerlink" title="Blazor"></a>Blazor</h2><p>在 Blazor 中，有一個專門的元件叫做 <code>InputFile</code> 是給檔案上傳使用，其實等於 <code>&lt;input type=&quot;file&quot;&gt;</code>，基本上除了 <code>OnChnage</code> 這個是 Blazor 提供的以外，其他原生的屬性都能直接使用；像下面這個範例，就是可以選取多個 xlsx 的檔案。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">InputFile</span> <span class="attr">OnChange</span>=<span class="string">&quot;@OnInputFileChange&quot;</span> <span class="attr">multiple</span> <span class="attr">accept</span>=<span class="string">&quot;.xlsx&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><code>InputFileChangeEventArgs</code> 對於單檔和多檔有不同做法，那不管哪一種都是會拿到 <code>IBrowserFile</code> 這個型別的物件。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnInputFileChange</span>(<span class="params">InputFileChangeEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> singleFile = args.File;</span><br><span class="line">    <span class="keyword">var</span> multipleFiles = args.GetMultipleFiles();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著來準備上傳的物件，要先轉成 stream 然後存到 <code>MultipartFormDataContent</code> 這個類別中，加入的時候記得要使用 <strong>files</strong> 作為 name；呼叫 API 時，記得要使用 <code>PostAsync</code> 而不是 <code>PostAsJsonAsync</code>，content-type 才會是正確的 <code>multipart/form-data</code>。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnInputFileChange</span>(<span class="params">InputFileChangeEventArgs args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> singleFile = args.File;</span><br><span class="line">    <span class="keyword">var</span> fileContent = <span class="keyword">new</span> StreamContent(singleFile.OpenReadStream());</span><br><span class="line">    fileContent.Headers.ContentType = <span class="keyword">new</span> MediaTypeHeaderValue(file.ContentType);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">var</span> formData = <span class="keyword">new</span> MultipartFormDataContent();</span><br><span class="line">    <span class="comment">// 中間的名稱記得一定要給 files</span></span><br><span class="line">    formData.Add(fileContent, <span class="string">&quot;files&quot;</span>, singleFile.Name);</span><br><span class="line"><span class="comment">// 一定要用 PostAsync 才會是正確的 multipart/form-data</span></span><br><span class="line">    <span class="keyword">await</span> HttpClient.PostAsync(<span class="string">&quot;api/upload&quot;</span>, formData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要在 <code>MultipartFormDataContent</code> 中放入其他非檔案的資料，要先轉換成 <code>StringContent</code> 才行。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> formData = <span class="keyword">new</span> MultipartFormDataContent();</span><br><span class="line">formData.Add(<span class="keyword">new</span> StringContent(<span class="string">&quot;jimmy&quot;</span>), <span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><p>前端搞定以後，後端的 API 就相對的簡單，只要用 <code>FromForm</code> 的屬性來對應就好，檔案的話請用 <code>List&lt;IFormFIle&gt;</code> 作為型別也就是對應到前面所寫的 <strong>files</strong>，其他的資料則是各自對應名稱。<br>使用 FileStream 來寫入到檔案，或是用 MemoryStream 載入到記憶體中。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IActionResult&gt; <span class="title">Upload</span>(<span class="params">[FromForm] List&lt;IFormFile&gt; files, [FromForm] <span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> path = <span class="string">$@&quot;<span class="subst">&#123;_environment.WebRootPath&#125;</span>\upload\&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="keyword">var</span> file <span class="keyword">in</span> files)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 寫入檔案</span></span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">using</span> FileStream fs = <span class="keyword">new</span>(<span class="string">$&quot;<span class="subst">&#123;path&#125;</span><span class="subst">&#123;file.FileName&#125;</span>&quot;</span>, FileMode.Create);</span><br><span class="line">        <span class="keyword">await</span> file.CopyToAsync(fs);</span><br><span class="line">        <span class="comment">// 放在記憶體</span></span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> ms = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">        <span class="keyword">await</span> file.CopyToAsync(ms);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>API 後續的邏輯就看需要做些什麼，接續著做就好。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/file-uploads?view=aspnetcore-6.0&pivots=server">ASP.NET Core Blazor file uploads | Microsoft Docs</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[c#] EF使用動態LINQ做查詢</title>
      <link href="/2022/08/02/introduce-dynamic-linq/"/>
      <url>/2022/08/02/introduce-dynamic-linq/</url>
      
        <content type="html"><![CDATA[<p>LINQ 是一個好用的工具，撰寫的時候可以透過強行別的特性，讓篩選資料等的行為很輕鬆，偏偏成也強型別敗也強型別，在做查詢的時候十幾個欄位，總不可能一個一個比對，還好查到一個好用的套件 [Dynamic-LINQ](<a href="https://dynamic-linq.net/">Dynamic LINQ (dynamic-linq.net)</a>)，可以解決這樣的問題。</p><span id="more"></span><p>先來建立一個簡單的客戶類別，並產生一些資料</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Customer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> CustomerId;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> FirstName;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> LastName;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Company;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data  = <span class="keyword">new</span> List&lt;Customer&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">new</span> Customer()</span><br><span class="line">    &#123;</span><br><span class="line">        CustomerId = <span class="number">1</span>,</span><br><span class="line">        FirstName = <span class="string">&quot;Jimmy&quot;</span>,</span><br><span class="line">        LastName = <span class="string">&quot;Ho&quot;</span>,</span><br><span class="line">        Company = <span class="string">&quot;Jimmy Company&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">new</span> Customer()</span><br><span class="line">    &#123;</span><br><span class="line">        CustomerId = <span class="number">2</span>,</span><br><span class="line">        FirstName = <span class="string">&quot;Secret&quot;</span>,</span><br><span class="line">        LastName = <span class="string">&quot;Ho&quot;</span>,</span><br><span class="line">        Company = <span class="string">&quot;Secret note&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">new</span> Customer()</span><br><span class="line">    &#123;</span><br><span class="line">        CustomerId = <span class="number">3</span>,</span><br><span class="line">        FirstName = <span class="string">&quot;Tina&quot;</span>,</span><br><span class="line">        LastName = <span class="string">&quot;Hu&quot;</span>,</span><br><span class="line">        Company = <span class="string">&quot;Tina Company&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>標準 Linq 的寫法，取得 <code>Company</code> 包含 <code>Compnay</code> 字樣的資料。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = data.Where(p =&gt; p.Company.Contains(<span class="string">&quot;Ho&quot;</span>));</span><br></pre></td></tr></table></figure><p>接著來安裝 Dynamic LINQ，在 Nuget 中找到 <strong>System.Linq.Dynamic.Core</strong>，並改用 Dynamic 的寫法。</p><blockquote><p>如果不是 dotnet core 請直接搜尋 System.Linq.Dynamic</p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = data.Where(<span class="string">&quot;Company.Contains(\&quot;Ho\&quot;)&quot;</span>);</span><br></pre></td></tr></table></figure><p>透過字串的方式，來描述原本強型別的語句，當欄位是由前端傳來只有名稱，這時候就會很好處理。<br>使用 Dynamic LINQ 要注意的是，要參照原本 Linq 的寫法，不然就會死得不明不白。</p><blockquote><p>當然這也不是沒有缺點，因為不是強型別了，所以屬性名稱寫錯的話，就要等到 runtime 才會死在旁邊。</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><p>[<a href="https://dotblogs.com.tw/wasichris/2015/12/17/001236">LINQ] 使用 Dynamic LINQ 補足強型別所帶來的小遺憾 | 搞搞就懂 - 點部落 (dotblogs.com.tw)</a></p></li><li><p><a href="https://blog.miniasp.com/post/2008/06/23/Introduce-LINQ-Dynamic-Query-Library">Dynamic LINQ 讓 LINQ 的世界變的更美好 | The Will Will Web (miniasp.com)</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> linq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dotnet </tag>
            
            <tag> linq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[nginx] reverse proxy 在 docker compose 架構下</title>
      <link href="/2022/06/22/nginx-reverse-proxy-docker-compose/"/>
      <url>/2022/06/22/nginx-reverse-proxy-docker-compose/</url>
      
        <content type="html"><![CDATA[<p>在非 windows 的環境下架站，nginx 會是首選，把一些服務搭配 nginx 並且使用 docker compose 作架站，也是一個不錯的選擇。<br>今天會使用 Gitea&#x2F;Drone 這兩個服務，並且搭配 ngrok 來作為模擬。</p><span id="more"></span><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前寫過另一篇 <a href="/2021/03/22/gitea-drone-docker/" title="在本機使用Docker架Gitea和DroneCI">在本機使用Docker架Gitea和DroneCI</a>，用 ngrok 對應 3000 和 8000 兩個 port，如果是用 ngrok 還算方便，畢竟都還是 80&#x2F;443 的連線，但如果轉換成自己的 domain，就會變成 <code>git.jimmy.com:3000</code> 和 <code>ci.jimmy.com:8000</code> 這樣的連線方式，對於這樣的網址其實是難以接受的，那我們可以使用 reverse proxy 來達成。</p><p>之前我也是用 IIS 做 reverse proxy，gitea 相關的設定可以參考這兩篇 <a href="/2021/04/09/iis-reverse-proxy-header/" title="[IIS] 修正 reverse proxy 的 host 問題">[IIS] 修正 reverse proxy 的 host 問題</a> 和 <a href="/2021/04/19/gitea-iis-reverse-proxy-trouble-shooting/" title="[IIS] Gitea 搭配 reverse proxy 的問題排解">[IIS] Gitea 搭配 reverse proxy 的問題排解</a>，如果你是用 windows 10 來作為伺服器，就會遇到一個問題同時連線數過多時就會連不上的問題，這個在微軟的文件中有提到 <a href="https://docs.microsoft.com/en-us/iis/troubleshoot/request-restrictions">Understanding IIS Request Restrictions on Windows Client OS | Microsoft Docs</a>，改用 nginx 就可以忽略掉這個問題。</p><p>好啦~囉嗦完後還是要實際看看怎麼樣的實作吧!</p><h1 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h1><p>使用 ngrok 作為本機架站的工具，並把 gitea&#x2F;drone 兩個服務躲在 nginx 背後，只開放 80 port 出來。</p><h2 id="ngrok"><a href="#ngrok" class="headerlink" title="ngrok"></a>ngrok</h2><p>首先針對 <code>ngrok.yml</code> 做調整，改成設定兩個都是 80 port。</p><blockquote><p>也許你會擔心不能跑，這點倒是不用擔心。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authtoken:</span> &#123;&#123;<span class="string">your</span> <span class="string">token</span>&#125;&#125;</span><br><span class="line"><span class="attr">tunnels:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">proto:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">drone:</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">proto:</span> <span class="string">http</span></span><br></pre></td></tr></table></figure><p>執行 <code>ngrok.exe start --all --config ngrok.yml</code>，就可以看到以下的畫面，會有兩個 domain 都對應著 80。</p><p><img src="/2022/06/22/nginx-reverse-proxy-docker-compose/ngrok.png" alt="ngrok"></p><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>先把 domain 搞定以後，接著要來調整 <code>docker-compose.yml</code> 的內容，把 gitea 和 drone 對外的 port 都刪掉，改加上 nginx 並且開放 80 port 對外。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:1.16</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROOT_URL=http://1374-1-171-251-189.ngrok.io</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DEFAULT_BRANCH=main</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitea:/data</span></span><br><span class="line">  <span class="attr">drone-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">drone/drone:2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">drone-server</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./drone:/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_SERVER_HOST=8372-1-171-251-189.ngrok.io</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_SERVER_PROTO=http</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_RPC_SECRET=d733ce6f00905a05395ea8198c22234b</span></span><br><span class="line">      <span class="comment"># Gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_ID=12d97e72-1489-4df6-a547-946ded390617</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_SECRET=e7lAy3SbWAKDm5FaVIuBr6vfQQIVLXUCitkv4xLFIQIP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_GITEA_SERVER=http://1374-1-171-251-189.ngrok.io</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">DRONE_GIT_ALWAYS_AUTH=true</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">drone-server</span></span><br><span class="line"><span class="attr">networks:</span> </span><br><span class="line">  <span class="attr">default:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">infra</span></span><br></pre></td></tr></table></figure><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>在 docker compose 文件 <a href="https://docs.docker.com/compose/networking/">Networking in Compose | Docker Documentation</a> 中提到，<strong>同一個 network 裡面</strong>，可以直接網內互打，不用知道另一個 container 的 ip，只要指定名稱就可以，我們就可以透過這個功能，讓 nginx 直接對應到 service。</p><p>底下是 <code>nginx.conf</code> 的設定。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">1374</span>-<span class="number">1</span>-<span class="number">171</span>-<span class="number">251</span>-<span class="number">189</span>.ngrok.io;</span><br><span class="line">        </span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://gitea:3000;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">8372</span>-<span class="number">1</span>-<span class="number">171</span>-<span class="number">251</span>-<span class="number">189</span>.ngrok.io;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://drone-server:80;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">            <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">chunked_transfer_encoding</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.gitea.io/en-us/reverse-proxies/">Usage: Reverse Proxies - Docs (gitea.io)</a></li><li><a href="https://discourse.drone.io/t/documentation-for-drone-behind-ssl-reverse-proxy/3373">Documentation for Drone behind SSL reverse proxy - Support - Drone</a></li><li><a href="https://docs.docker.com/compose/networking/">Networking in Compose | Docker Documentation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> nginx </tag>
            
            <tag> reverse-proxy </tag>
            
            <tag> ngrok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Github Action 檢查套件更新並發送 PR</title>
      <link href="/2022/06/07/github-dependabot-pr-notification/"/>
      <url>/2022/06/07/github-dependabot-pr-notification/</url>
      
        <content type="html"><![CDATA[<p>放在 Github 上面的 Repository 可以開啟相依套件的更新檢查，甚至會自動幫你發送 PR，今天來看一下怎麼樣設定並在最後發出通知。</p><span id="more"></span><h1 id="開啟-Dependabot"><a href="#開啟-Dependabot" class="headerlink" title="開啟 Dependabot"></a>開啟 Dependabot</h1><blockquote><p>Github 的設定可能會改變位置，這是到目前為止的設定，如果找不到，請試著用類似的字眼去找。</p></blockquote><p>到你的 Repository 中，移到 <code>Security</code> 頁籤，將 <code>Dependabot alerts</code> 啟用。</p><p><img src="/2022/06/07/github-dependabot-pr-notification/repo-security.png" alt="repo-security"></p><p><img src="/2022/06/07/github-dependabot-pr-notification/setting-code-security.png" alt="setting-code-security"></p><p>系統會帶你到 Setting 頁籤，先 <code>Dependabot security updates</code> 啟用，就可以看到第一個項目 <code>Alert</code> 也會被啟用。</p><p><img src="/2022/06/07/github-dependabot-pr-notification/setting-enabled-security-update.png" alt="setting-enabled-security-update"></p><p>接著再將 <code>Dependabot version updates</code> 啟用，系統會帶你去建議一個 yaml 檔案。</p><p><img src="/2022/06/07/github-dependabot-pr-notification/create-dependabot-yaml.png" alt="create-dependabot-yaml"></p><p>這邊要注意的是， <code>package-ecosystem</code> 是留空要自己填寫，可以在 <a href="https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file#package-ecosystem">Configuration options for the dependabot.yml file - GitHub Docs</a> 中找到自己的套件管理，像我的是用 yarn 做管理。</p><p>做完以上的設定以後，只要 Github 檢查到相依套件中有任何危險或是更新，就會建立一個 PR。</p><h1 id="當-PR-建立時通知"><a href="#當-PR-建立時通知" class="headerlink" title="當 PR 建立時通知"></a>當 PR 建立時通知</h1><p>當 Dependabot 建立 PR 的時候，除了上去 Github 看以外，就是要透過收信的方式，但我個人是不喜歡信件的通知，比較喜歡用通訊軟體即時的收到通知，在這時候我們就可以使用 Github Action 來做到這件事情。</p><p>剛剛啟用 <code>Dependabot version updates</code> 所建立的 <code>dependabot.yml</code> 是放在 <code>.github</code> 這個目錄底下，Github Action 也是一樣在這目錄底下，新增一個目錄 <code>workflows</code>，建立一個叫做 <code>notify-pull-request.yml</code> 的檔案，並將底下內容貼上。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Send</span> <span class="string">Message</span> <span class="string">on</span> <span class="string">Pull</span> <span class="string">Request</span> <span class="string">open.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">types:</span> [<span class="string">opened</span>, <span class="string">reopened</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">sendMessage:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">hmarr/debug-action@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">send</span> <span class="string">telegram</span> <span class="string">message</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">appleboy/telegram-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">to:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.TELEGRAM_CHAT_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.TELEGRAM_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment"># 注意 tg message 長度有限制，不要放太多內容會爆掉</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            Author: $&#123;&#123; github.event.pull_request.user.login &#125;&#125;</span></span><br><span class="line"><span class="string">            Title: $&#123;&#123; github.event.pull_request.title &#125;&#125;</span></span><br><span class="line"><span class="string">            Link: $&#123;&#123; github.event.pull_request.html_url &#125;&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>關於 Github Action 的基礎介紹，可以參考 <a href="/2020/05/21/github-action-and-package/" title="使用 Github Action 作為 CI&#x2F;CD 將 libraray 發佈到 Github Package">使用 Github Action 作為 CI&#x2F;CD 將 libraray 發佈到 Github Package</a>，或是 <a href="https://ithelp.ithome.com.tw/users/20091494/ironman/4464">不僅是程式碼代管平台 - Github 能做些什麼? :: 2021 iThome 鐵人賽</a></p></blockquote><p>根據<a href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request">文件</a> PR 預設行為是 <code>opened</code>, <code>synchronize</code>, or <code>reopened</code>，這邊重新設定將 <code>synchronize</code> 去掉。</p><blockquote><p>Telegram 的設定教學可以參考 [<a href="https://fullstackladder.dev/blog/2021/11/01/github-actions-send-telegram/">GitHub Actions] 發送 Telegram 訊息 | 全端開發人員天梯 (fullstackladder.dev)</a>。</p></blockquote><p>接著我們要來設定 secrets，現在的設定有分為 <code>Actions</code> 及 <code>Dependabot</code> 兩個，雖然發送 PR 的通知是透過 Action，但建立 PR 的是 bot，因此兩個地方都必須要將 Telegram 的設定放進去。</p><p><img src="/2022/06/07/github-dependabot-pr-notification/setting-secret-actions.png" alt="setting-secret-actions"></p><p><img src="/2022/06/07/github-dependabot-pr-notification/setting-secret-dependabot.png" alt="setting-secret-dependabot"></p><p>都設定好以後，不管是誰建立的 PR，我們都可以在 Telegram 收到啦!!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file#package-ecosystem">Configuration options for the dependabot.yml file - GitHub Docs</a></li><li><a href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request">Events that trigger workflows - GitHub Docs</a></li><li>[<a href="https://fullstackladder.dev/blog/2021/11/01/github-actions-send-telegram/">GitHub Actions] 發送 Telegram 訊息 | 全端開發人員天梯 (fullstackladder.dev)</a></li><li><a href="https://ithelp.ithome.com.tw/users/20091494/ironman/4464">不僅是程式碼代管平台 - Github 能做些什麼? :: 2021 iThome 鐵人賽</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Github Action </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github Action </tag>
            
            <tag> Telegram </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在 cli 快速操作 json 資料 - jq</title>
      <link href="/2022/06/04/cli-json-processor-jq/"/>
      <url>/2022/06/04/cli-json-processor-jq/</url>
      
        <content type="html"><![CDATA[<p>想在 cli 的環境下要對 json 的檔案做修改，如果要用一行一行讀取後處理，實在是太麻煩而且太容易改錯，還好有一套工具 <a href="https://stedolan.github.io/jq/">jq</a> ，可以快速的操作整個 json 資料。<br>我把這個應用在 CI&#x2F;CD 的環節中，在當下調整一些設定檔。</p><blockquote><p>jq 到哪都是強者!!!</p></blockquote><span id="more"></span><p>jq 可以被使用在任何一個有 cli 的 os 上 (Linux, OS X and Windows…etc.)，選取的方法是透過 filter 來進行操作，先用個簡單的範例來示範，如何取得 foo 的值。</p><blockquote><p>好像看到 $jq 的影子?</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.foo&#x27;</span></span><br><span class="line">&gt; 42</span><br></pre></td></tr></table></figure><h1 id="linux-安裝"><a href="#linux-安裝" class="headerlink" title="linux 安裝"></a>linux 安裝</h1><p>接下來將會起一個 Debian 的容器來做為示範，如何安裝並且操作。</p><blockquote><p>不想安裝只是想嘗試的話可以用官方提供的線上工具 <a href="https://jqplay.org/">jq play</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -it debian</span><br></pre></td></tr></table></figure><p>進入到容器的環境內後，開始執行安裝，記得先 update 確保安裝的時候找的到套件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install -y jq</span><br></pre></td></tr></table></figure><h1 id="認識-filter"><a href="#認識-filter" class="headerlink" title="認識 filter"></a>認識 filter</h1><p>主要會專注在介紹最後實務上要用到的功能。</p><h2 id="根節點"><a href="#根節點" class="headerlink" title="根節點"></a>根節點</h2><p>json 資料的格式都會有個最上層，也就是所謂的根結點，不管是陣列或是物件的形式，都是從最外層開始往內找。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.&#x27;</span></span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;  <span class="string">&quot;foo&quot;</span>: 42,</span><br><span class="line">&gt;  <span class="string">&quot;bar&quot;</span>: <span class="string">&quot;less interesting data&quot;</span></span><br><span class="line">&gt; &#125;</span><br></pre></td></tr></table></figure><h2 id="物件操作"><a href="#物件操作" class="headerlink" title="物件操作"></a>物件操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 單一屬性</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.foo&#x27;</span></span><br><span class="line">&gt; 42</span><br><span class="line"><span class="comment"># 屬性不存在回 null</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;notfoo&quot;: true, &quot;alsonotfoo&quot;: false&#125;&#x27;</span> | jq <span class="string">&#x27;.foo&#x27;</span></span><br><span class="line">&gt; null</span><br><span class="line"><span class="comment"># 多個屬性</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.[&quot;foo&quot;, &quot;bbb&quot;]&#x27;</span></span><br><span class="line">&gt; 42</span><br><span class="line">&gt; null</span><br></pre></td></tr></table></figure><h2 id="陣列操作"><a href="#陣列操作" class="headerlink" title="陣列操作"></a>陣列操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取得整個陣列並轉成 iterator</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&#123;&quot;name&quot;:&quot;JSON&quot;, &quot;good&quot;:true&#125;, &#123;&quot;name&quot;:&quot;XML&quot;, &quot;good&quot;:false&#125;]&#x27;</span> | jq <span class="string">&#x27;.[]&#x27;</span></span><br><span class="line">&gt; &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;JSON&quot;</span>, <span class="string">&quot;good&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line">&gt; &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;XML&quot;</span>, <span class="string">&quot;good&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line"><span class="comment"># 指定陣列位置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&#123;&quot;name&quot;:&quot;JSON&quot;, &quot;good&quot;:true&#125;, &#123;&quot;name&quot;:&quot;XML&quot;, &quot;good&quot;:false&#125;]&#x27;</span> | jq <span class="string">&#x27;.[0]&#x27;</span></span><br><span class="line">&gt; &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;JSON&quot;</span>, <span class="string">&quot;good&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line"><span class="comment"># 切割陣列 (也可用在字串中) [start:end]</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;]&#x27;</span> | jq <span class="string">&#x27;.[2:4]&#x27;</span></span><br><span class="line">&gt; [<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="資料運算"><a href="#資料運算" class="headerlink" title="資料運算"></a>資料運算</h2><p><code>+</code> 和 <code>-</code> 可以用來運算數值或是陣列&#x2F;字串的串接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 運算數值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.foo + 3&#x27;</span></span><br><span class="line">&gt; 45</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.foo - 2&#x27;</span></span><br><span class="line">&gt; 40</span><br><span class="line"><span class="comment"># 陣列串接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;]&#x27;</span> | jq <span class="string">&#x27;. + [&quot;f&quot;,&quot;g&quot;]&#x27;</span></span><br><span class="line">&gt; [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;g&quot;</span>]</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;]&#x27;</span> | jq <span class="string">&#x27;. - [&quot;a&quot;]&#x27;</span></span><br><span class="line">&gt; [<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>]</span><br><span class="line"><span class="comment"># 字串串接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.bar + &quot; concat another string&quot;&#x27;</span></span><br><span class="line">&gt; <span class="string">&quot;less interesting data concat another string&quot;</span></span><br></pre></td></tr></table></figure><h2 id="修改內容"><a href="#修改內容" class="headerlink" title="修改內容"></a>修改內容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq <span class="string">&#x27;.foo = 44&#x27;</span></span><br><span class="line">&gt; &#123;<span class="string">&quot;foo&quot;</span>: 44, <span class="string">&quot;bar&quot;</span>: <span class="string">&quot;less interesting data&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="讀取檔案"><a href="#讀取檔案" class="headerlink" title="讀取檔案"></a>讀取檔案</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> &gt; file.json</span><br><span class="line">jq <span class="string">&#x27;.foo&#x27;</span> file.json</span><br><span class="line">&gt; 42</span><br></pre></td></tr></table></figure><h2 id="傳入參數"><a href="#傳入參數" class="headerlink" title="傳入參數"></a>傳入參數</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非 json 格式</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;foo&quot;: 42, &quot;bar&quot;: &quot;less interesting data&quot;&#125;&#x27;</span> | jq --arg concat <span class="string">&quot; pass from arg&quot;</span> <span class="string">&#x27;.bar + $concat&#x27;</span></span><br><span class="line">&gt; <span class="string">&quot;less interesting data pass from arg&quot;</span></span><br><span class="line"><span class="comment"># json 格式</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;]&#x27;</span> | jq --argjson concat <span class="string">&#x27;[&quot;f&quot;,&quot;g&quot;]&#x27;</span> <span class="string">&#x27;. + $concat&#x27;</span></span><br><span class="line">&gt; [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;g&quot;</span>]</span><br></pre></td></tr></table></figure><h1 id="實際修改"><a href="#實際修改" class="headerlink" title="實際修改"></a>實際修改</h1><p>實際上真正需要的是調整 db.json 這個檔案，先來看看資料格式。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;DBConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;DefaultDB&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LocalOrcl&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;EnableLog&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DoNotCompleteFlag&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DataBases&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;DBName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LocalOrcl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ConnectionString&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Data Source=localhost/ORCL;USER ID=jimmy;PASSWORD=jimmy;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oracle&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>目標是要修改 DefaultDB 的值，並且增加一組連線資訊，基本上就是把前面所提到的 filter 都用過一次。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONNECTION=<span class="string">&#x27;&#123;&quot;DBName&quot;:&quot;CI&quot;,&quot;ConnectionString&quot;:&quot;Data Source=localhost/ORCL;USER ID=CI;PASSWORD=CI;&quot;,&quot;Provider&quot;:&quot;Oracle&quot;&#125;&#x27;</span></span><br><span class="line">jq <span class="string">&#x27;.DBConfig.DefaultDB = &quot;CI&quot;&#x27;</span> db.json &gt; tmp.$$.json &amp;&amp; <span class="built_in">mv</span> tmp.$$.json db.json</span><br><span class="line">jq --arg CONNECTION <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span> <span class="string">&#x27;.DBConfig.DataBases += $CONNECTION&#x27;</span> db.json &gt; tmp.$$.json &amp;&amp; <span class="built_in">mv</span> tmp.$$.json db.json</span><br></pre></td></tr></table></figure><p>就可以看到 db.json 的內容被改成以下。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;DBConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;DefaultDB&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CI&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;EnableLog&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DoNotCompleteFlag&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DataBases&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;DBName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LocalOrcl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ConnectionString&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Data Source=localhost/ORCL;USER ID=jimmy;PASSWORD=jimmy;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oracle&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;DBName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CI&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ConnectionString&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Data Source=localhost/ORCL;USER ID=CI;PASSWORD=CI;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oracle&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://stedolan.github.io/jq/manual/">jq Manual (development version) (stedolan.github.io)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jq </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[除蟲] AngularJS button click 執行兩次</title>
      <link href="/2022/06/02/angularjs-button-ngclick-twice/"/>
      <url>/2022/06/02/angularjs-button-ngclick-twice/</url>
      
        <content type="html"><![CDATA[<p>同事詢問了一個 AngularJS button click 的時候會執行兩次的問題，只有在 IE 上會發生，但在 edge&#x2F;chrome 就不會。聽到這個問題，第一個反應是先去看看網路上有沒有人有類似的問題，<code>angularjs button click execute twice</code> ，果然我們不是孤單的，蠻多人討論過。</p><blockquote><p>比較多人提到的，反而是在 safari 上會有這個行為。</p></blockquote><span id="more"></span><ul><li><a href="https://github.com/angular/angular.js/issues/6251">ngClick using ngTouch fires twice · Issue #6251 · angular&#x2F;angular.js (github.com)</a></li><li><a href="https://stackoverflow.com/questions/18709297/angularjs-ng-click-fires-twice">javascript - AngularJS ng-click fires twice - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/21708730/why-are-multiple-click-events-fired-when-using-ngtouch">javascript - Why are multiple click events fired when using ngTouch? - Stack Overflow</a></li></ul><p>看到兩個方法可以解決這個問題</p><ul><li>button 增加屬性 <code>type=&quot;button&quot;</code> (最後選擇這個解法)</li></ul><p><a href="https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/button">MDN</a> 有提到 button 的 type 預設值是 <code>submit</code>，通常 submit 會對應到 form 的 post 行為給 API，在我們的程式中並沒有被包在 form 裡面。<br>找到黑暗大也曾經抓過類似的問題，<a href="https://blog.darkthread.net/blog/enter-submit-in-ie/">【茶包射手日記】當IE遇上Enter-黑暗執行緒 (darkthread.net)</a>，提到 submit 如果沒有 form 的話會觸發 click 事件。</p><blockquote><p>不管是不是 IE 或是什麼的，讓元素有正確的行為，其實是撰寫的人應該要做到的。</p></blockquote><ul><li><code>event.preventDefault(); event.stopPropagation();</code></li></ul><p><code>preventDefault</code> 或者是 <code>stopPropagation</code> 就很單純了，避免<a href="https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/">事件的冒泡</a>，當然就可以解決掉重複執行的問題。</p><p>回過頭來看 angularjs 自己如何針對這個 issue 做修正，其中來看幾個原本已經改好但最後關閉的 PR</p><ul><li><a href="https://github.com/angular/angular.js/pull/13852/files">fix(ngTouch): remove ngClick override by Narretz · Pull Request #13852 · angular&#x2F;angular.js (github.com)</a></li><li><a href="https://github.com/angular/angular.js/pull/13857/files">fix(ngTouch): deprecate ngClick override directive, disable it by def… by Narretz · Pull Request #13857 · angular&#x2F;angular.js (github.com)</a></li></ul><p>上面兩個都是針對 ngTouch 做修改，其中還有把引入 ngClick 的檔案移除掉 (個人是蠻懷疑這是造成 submit 會重複送的原因)，最後這兩個 PR 直接被重新的調整並且放入到 1.5 的版本 <a href="https://docs.angularjs.org/guide/migration#ngtouch-ngclick-">AngularJS: Developer Guide: Migrating from Previous Versions</a>。</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
            <tag> Debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Jenkins] 環境建置 - 整合 Gitea 登入</title>
      <link href="/2022/03/24/jenkins-gitea-oauth/"/>
      <url>/2022/03/24/jenkins-gitea-oauth/</url>
      
        <content type="html"><![CDATA[<p>Jenkins 和 Gitea 的環境都建置好後，會希望登入的使用者能在一個地方控管就好， Gitea 自從 1.8 以後就開始提供 Oauth 的方法給其他系統，今天就針對這個部分來做介紹。</p><span id="more"></span><h1 id="設定-Gitea"><a href="#設定-Gitea" class="headerlink" title="設定 Gitea"></a>設定 Gitea</h1><p>進入系統後，開啟 <code>設定</code> &gt; <code>應用程式</code>，拉到最下面的 <code>管理 OAuth2 應用程式</code> 區塊。</p><ul><li>應用程式名稱: <code>Jenkins</code></li><li>重新導向 URI: <code>http://&#123;domain&#125;/securityRealm/finishLogin</code></li></ul><p>輸入以上資訊後按下 <code>建立應用程式</code>。</p><p><img src="/2022/03/24/jenkins-gitea-oauth/gitea-oauth-create.png" alt="gitea-oauth-create"></p><p>就會拿到一組 <code>客戶端 ID</code> 及 <code>密鑰</code> ，這個頁面先不要關閉，等一下要把這兩個資訊貼到 Jenkins 上。</p><blockquote><p>建議使用公用帳號操作，避免使用者被砍掉或停用，導致後續的麻煩</p></blockquote><h1 id="設定-Jenkins"><a href="#設定-Jenkins" class="headerlink" title="設定 Jenkins"></a>設定 Jenkins</h1><h2 id="安裝-Plugin"><a href="#安裝-Plugin" class="headerlink" title="安裝 Plugin"></a>安裝 Plugin</h2><p>Jenkins 的 OAuth 相關 plugin 蠻多的，但就是沒有直接對應 Gitea 的，可以選擇這套 <a href="https://plugins.jenkins.io/oic-auth/">OpenId Connect Authentication | Jenkins plugin</a> 來作為整合的套件。<br>進入 <code>Manage Jenkins</code> &gt; <code>Plugin Manager</code> &gt; <code>Available</code>，安裝套件並且重啟。</p><h2 id="設定-Oauth"><a href="#設定-Oauth" class="headerlink" title="設定 Oauth"></a>設定 Oauth</h2><p>安裝完套件後，進入到 <code>Manage Jenkins</code> &gt; <code>Confiure Global Security</code>，找到 <code>Security Realm</code> 區塊</p><p><img src="/2022/03/24/jenkins-gitea-oauth/jenkins-security-realm.png" alt="jenkins-security-realm"></p><p>預設應該會使用 <code>Jenkins’ own user database</code> ，要改成 <code>Login with Openid Connect</code>，並且將前面 Gitea 所產生 <code>客戶端 ID</code> 及 <code>密鑰</code> 填入，<code>Configuration mode</code> 選擇 <code>Automatic confiuration</code> 填入 Gitea 的網址。</p><p><img src="/2022/03/24/jenkins-gitea-oauth/jenkins-login-openid-connect.png" alt="jenkins-login-openid-connect"></p><p>設定完成以後，登出系統，並且回到 Jenkins 網站的跟目錄，就會發現被轉到 Gitea 網站做登入授權。</p><p><img src="/2022/03/24/jenkins-gitea-oauth/gitea-auth-application.png" alt="gitea-auth-application"></p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>其實跟 DroneCI 很像，可以參考 <a href="/2021/03/22/gitea-drone-docker/" title="在本機使用Docker架Gitea和DroneCI">在本機使用Docker架Gitea和DroneCI</a> 的作法，雖然沒有直接的套件讓我們整合 Gitea，但也是能夠做到相同的事情。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
            <tag> Gitea </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WCF AJAX 服務建置於 https</title>
      <link href="/2022/03/23/wcf-ajax-https/"/>
      <url>/2022/03/23/wcf-ajax-https/</url>
      
        <content type="html"><![CDATA[<p>今天接到同事來的一個求救，有一個產品基於 WCF 服務建置 https 時無法正常運行，原本以為簡單，但卡了一陣子，特別來筆記一下。</p><span id="more"></span><h1 id="WCF-架站於-https"><a href="#WCF-架站於-https" class="headerlink" title="WCF 架站於 https"></a>WCF 架站於 https</h1><p>WCF 建置於 https 的資料超多超好查，微軟官方就有提供作法 <a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/how-to-configure-an-iis-hosted-wcf-service-with-ssl">How to: Configure an IIS-hosted WCF service with SSL - WCF | Microsoft Docs</a>，看到這樣的資料立馬動手試試看。</p><p>重點是在 binding，要增加一組 <code>basicHttpBinding</code> ，並且設定到 endpoint 上。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bindings</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">basicHttpBinding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">&quot;secureHttpBinding&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">security</span> <span class="attr">mode</span>=<span class="string">&quot;Transport&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transport</span> <span class="attr">clientCredentialType</span>=<span class="string">&quot;None&quot;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">binding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">basicHttpBinding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bindings</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">services</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;MySecureWCFService.Service1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">binding</span>=<span class="string">&quot;basicHttpBinding&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">bindingConfiguration</span>=<span class="string">&quot;secureHttpBinding&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">contract</span>=<span class="string">&quot;MySecureWCFService.IService1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">services</span>&gt;</span></span><br></pre></td></tr></table></figure><p>設定完很開心的就打開系統，測試下去，還是一樣收到 404 的錯誤…</p><p>為了要確認問題，決定先建立一個新的 WCF 服務，並且加上同樣的設定，新的專案的確是可以順利運行。<br>馬上回過頭檢查系統的寫法，突然發現一個不一樣的地方，服務的 endpoint 有加上 <code>behaviorConfiguration</code> 並且裡面的內容有 Ajax 的字樣，以及 binding <code>webHttpBinding</code>。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span> <span class="attr">behaviorConfiguration</span>=<span class="string">&quot;MySecureWCFService.Service1AspNetAjaxBehavior&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;webHttpBinding&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;MySecureWCFService.Service1&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>趕快拿著剛建立的專案，再新增一個檔案 <strong>WCF Service (Ajax enabled)</strong> ，馬上看到設定出現在 web.config 中。先來查詢看看官方怎麼定義 binding (<a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/system-provided-bindings">System-provided bindings - WCF | Microsoft Docs</a>)。</p><table><thead><tr><th>Binding</th><th>Description</th></tr></thead><tbody><tr><td><div style="word-break: keep-all;"><a href="https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.basichttpbinding">BasicHttpBinding</a></div></td><td>A binding that is suitable for communicating with WS-Basic Profile-conformant Web services, for example, ASP.NET Web services (ASMX)-based services. This binding uses HTTP as the transport and text&#x2F;XML as the default message encoding.</td></tr><tr><td><a href="https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.webhttpbinding">WebHttpBinding</a></td><td>A binding used to configure endpoints for WCF Web services that are exposed through HTTP requests instead of SOAP messages.</td></tr></tbody></table><p>從文字描述來看，<code>BasicHttpBinding</code> 會回傳 xml 格式，那 <code>WebhttpBinding</code> 則是 json，可以確定 Ajax enabled 的意義是指這個服務 response 格式不同。</p><p>這樣就可以確定做法，要將官方給的範例調整為 <code>WebHttpBinding</code> ，並且設定到 endpoint 上，就可以打完收工。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bindings</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">webHttpBinding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">&quot;secureHttpBinding&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">security</span> <span class="attr">mode</span>=<span class="string">&quot;Transport&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transport</span> <span class="attr">clientCredentialType</span>=<span class="string">&quot;None&quot;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">binding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">webHttpBinding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bindings</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">services</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;MySecureWCFService.Service1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">behaviorConfiguration</span>=<span class="string">&quot;MySecureWCFService.Service1AspNetAjaxBehavior&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">binding</span>=<span class="string">&quot;webHttpBinding&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">bindingConfiguration</span>=<span class="string">&quot;secureHttpBinding&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">contract</span>=<span class="string">&quot;MySecureWCFService.IService1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">services</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/how-to-configure-an-iis-hosted-wcf-service-with-ssl">How to: Configure an IIS-hosted WCF service with SSL - WCF | Microsoft Docs</a></li><li><a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/system-provided-bindings">System-provided bindings - WCF | Microsoft Docs</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> WCF </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins 與 Gitea 整合</title>
      <link href="/2022/03/15/jenkins-gitea-setup/"/>
      <url>/2022/03/15/jenkins-gitea-setup/</url>
      
        <content type="html"><![CDATA[<p>Dotnet framework 的 docker image 只有 window 版本，要特別將 Docker Desktop 切換成 Windows container 才能跑，為了讓 Dotnet framework 及 Dotnet core 能同時跑在一個 CI&#x2F;CD 的平台，最後選擇了 Jenkins 這位老爺爺。</p><blockquote><p>必須說老爺爺的功能很強大，但也真的很不友善…很多東西一直查資料，只好寫一篇來筆記一下orz</p></blockquote><span id="more"></span><h1 id="安裝-Jenkins"><a href="#安裝-Jenkins" class="headerlink" title="安裝 Jenkins"></a>安裝 Jenkins</h1><p>Jenkins 在 Windows 的安裝方法有兩種，第一個是透過 <a href="https://hub.docker.com/r/jenkins/jenkins">jenkins&#x2F;jenkins - Docker Image | Docker Hub</a>，另一個是走標準安裝的方法，我選擇後者標準安裝的作法。</p><blockquote><p>不使用 docker 是因為要 volumn 太多東西，反而造成自己困擾<br>但很建議要先體驗的朋友，先透過 docker</p></blockquote><blockquote><p>環境資訊<br>Jenkins 2.332.1 LTS<br>Windows 11</p></blockquote><h2 id="設定使用者"><a href="#設定使用者" class="headerlink" title="設定使用者"></a>設定使用者</h2><p>選完安裝目錄後，要指定一個使用者作為服務執行用，這邊我採用的是目前使用者。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-install-logon.png" alt="jenkins-install-logon"></p><p>輸入後得到一個錯誤訊息 <strong>This account either does not have the privilege to logon as a service or the account was unable to be verified</strong>，這表示帳號登入成功但沒有權限作為登入服務；官方的介紹在這 <a href="https://www.jenkins.io/doc/book/installing/windows/#invalid-service-logon-credentials">Windows (jenkins.io)</a>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/invalid-logon.png" alt="invalid-logon"></p><p>接著要將登入的使用者加上可以登入服務的權限，打開 <code>本機安全性原則(Security Configuration Management)</code>，開啟 <code>本機原則</code> &gt; <code>使用者權限指派</code> &gt; <code>以服務方式登入</code>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/security-configuration-management.png" alt="security-configuration-management"></p><p>找到使用者後加入。</p><p><img src="/2022/03/15/jenkins-gitea-setup/search-user.png" alt="search-user"></p><p>再次檢查使用者，可以往下一步了!</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-install-logon-validate.png" alt="jenkins-install-logon-validate"></p><h2 id="安裝-JAVA"><a href="#安裝-JAVA" class="headerlink" title="安裝 JAVA"></a>安裝 JAVA</h2><p>Jenkins 需要 JAVA 的執行環境，安裝過程中會要求指定目錄，可以直接到<a href="https://java.com/zh-TW/download/ie_manual.jsp?locale=zh_TW">官網下載</a>，安裝完畢後在 Jenkins 中指向剛剛的目錄。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-install-java.png" alt="jenkins-install-java"></p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>根據安裝時所指定的 Port ，用瀏覽器開啟網站，可以看到 <strong>Unlock Jenkins</strong> 的畫面，到紅字所描述的路徑打開檔案，將裡面的密碼複製貼上。</p><p><img src="/2022/03/15/jenkins-gitea-setup/unlock-jenkins.png" alt="unlock-jenkins"></p><p>接著要安裝 Plugin，這邊不會建議使用官方推薦的，而改用自行挑選。</p><p><img src="/2022/03/15/jenkins-gitea-setup/customize-jenkins.png" alt="customize-jenkins"></p><p>裝 Jenkins 的目的是為了要可以編譯 dotnet framework，找到 Build Tools 將 <code>MSBuild</code> 打勾，若還有前端則需要把 <code>NodeJS</code> 也打勾。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-plugin-build-tool.png" alt="jenkins-plugin-build-tool"></p><p>往下看到 Pipelines and Continuous Delivery，整合的目標是 Gitea 因此將 Github 的兩個選項都取消。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-plugin-pipeline.png" alt="jenkins-plugin-pipeline"></p><p>最後，會建議將 <code>Locale</code> 這個套件裝起來，可以強制看到的語系不是根據瀏覽器來決定。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-plugin-locale.png" alt="jenkins-plugin-locale"></p><p>都挑選完畢以後，就可以開始安裝啦。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-getting-start.png" alt="jenkins-getting-start"></p><h1 id="整合-Gitea"><a href="#整合-Gitea" class="headerlink" title="整合 Gitea"></a>整合 Gitea</h1><p>都安裝完以後，進入系統，先來到 <code>管理Jenkins</code> &gt; <code>設定系統</code>，找到 locale 的區塊將預設語言設定為 <strong>en-us</strong>，並將下面核選方塊打勾，儲存後就可以看到系統變成英文版。</p><blockquote><p>我會習慣切成英文版是為了要找資料比較方便</p></blockquote><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-locale-setting.png" alt="jenkins-locale-setting"></p><h2 id="安裝-Gitea"><a href="#安裝-Gitea" class="headerlink" title="安裝 Gitea"></a>安裝 Gitea</h2><p>接著要安裝 Gitea 的<a href="https://plugins.jenkins.io/gitea/">套件</a>，在 <code>Manage Jenkins</code> &gt; <code>Manage Plugins</code> &gt; <code>Available</code> 搜尋 Gitea，打勾後選擇下方的 <code>Download now and install after restart</code>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-plugin-gitea.png" alt="jenkins-plugin-gitea"></p><p>安裝後回到 <code>Manage Jenkins</code> &gt; <code>Configure System</code>，找到 <code>Gitea Server</code> 的區塊，點選 Add，將公司的 Gitea Server 資訊輸入進去。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-configure-gitea-server.png" alt="jenkins-configure-gitea-server"></p><p>官方建議勾選 <code>Manage Hooks</code> 並使用 Personal Token 的方式，Add &gt; Jenkins 新增 <strong>Credential Provider</strong>，Kind 選擇 <code>Gitea Personal Access Token</code>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-credential-add.png" alt="jenkins-credential-add"></p><p>開啟 Gitea 的網站，在 <code>設定</code> &gt; <code>應用程式</code> 中，產生新的 Token。</p><p><img src="/2022/03/15/jenkins-gitea-setup/gitea-access-token.png" alt="gitea-access-token"></p><p>複製所產生的 Token 並且回到 Jenkins 畫面貼上，最後按下儲存。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-configure-gitea-server-hook.png" alt="jenkins-configure-gitea-server-hook"></p><blockquote><p>建議使用一個公用的帳號，例如: ci，來產生 Token，才可以避免權限相關的問題，也不要有人員異動後需要重新弄得問題。</p></blockquote><h2 id="連接-Repo"><a href="#連接-Repo" class="headerlink" title="連接 Repo"></a>連接 Repo</h2><blockquote><p> 呼~終於要開始整合。</p></blockquote><p>回到 Jenkins 主畫面，點選 <code>NewItem</code>，輸入名稱並選擇 <code>Organization Folder</code>，按下 OK。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-new-item.png" alt="jenkins-new-item"></p><p>移動到 Projects 區塊，選擇 <code>Gitea Organization</code>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-folder-config.png" alt="jenkins-org-folder-config"></p><p>選擇前面所輸入的 <strong>Gitea Server</strong> 及 <strong>Credentials</strong>，Owner 輸入要納入的組織或是使用者名稱。</p><blockquote><p>這邊是用自己作為設定</p></blockquote><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-config-gitea-org.png" alt="jenkins-org-config-gitea-org"></p><p>只要前面的所有設定都正確，系統會先掃一次整個 Owner 底下的 repo，檢查是否有 <code>Jenkinsfile</code> 檔案。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-folder-scan.png" alt="jenkins-org-folder-scan"></p><h2 id="建立-Jenkinsfile"><a href="#建立-Jenkinsfile" class="headerlink" title="建立 Jenkinsfile"></a>建立 Jenkinsfile</h2><p>萬事俱備，只欠東風，現在只要建立一個 Repo，並且加上 <code>Jenkinsfile</code> 即可。<br>在個人使用者底下建立一個新的 Repo 叫做 <code>JenkinsTest</code>。</p><p><img src="/2022/03/15/jenkins-gitea-setup/gitea-create-repo.png" alt="gitea-create-repo"></p><p>在本地開一個資料夾並且新增檔案 <code>Jenkinsfile</code> 將下面的內容貼上，並且 commit 後 push 上去。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&#x27;Build&#x27;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &#x27;Building..&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#x27;Test&#x27;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &#x27;Testing..&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#x27;Deploy&#x27;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &#x27;Deploying....&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回到 Jenkins 組織的畫面，直接點選 <code>Scan Gitea Organization Now</code>，讓系統重新掃描一次，看到 log 就會有剛剛建立的 repo 並且發現有 Jenkinksfile 的存在。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-folder-scan-with-repo.png" alt="jenkins-org-folder-scan-with-repo"></p><p>點選左側的 Status，就可以看到 Repo 會在右側的列表中。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-folder-status.png" alt="jenkins-org-folder-status"></p><p>點進 Repo 可以看到 Branch 及 Pull Request 的狀態。</p><p><img src="/2022/03/15/jenkins-gitea-setup/jenkins-org-folder-repo-status.png" alt="jenkins-org-folder-repo-status"></p><p>到目前這個狀態，可以確定 Gitea 及 Jenkins 的整合成功!!</p><blockquote><p>寫到這邊發現篇幅有點長了，接下來的 jenkinsfile 撰寫，就挪到下一篇囉</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://www.jenkins.io/doc/book/installing/windows/#invalid-service-logon-credentials">Windows (jenkins.io)</a></li><li><a href="https://plugins.jenkins.io/gitea/">Gitea | Jenkins plugin</a></li><li><a href="https://plugins.jenkins.io/locale/">Locale | Jenkins plugin</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CI/CD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
            <tag> Gitea </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 元件測試 - JSRuntime、NavigationManager</title>
      <link href="/2022/02/26/blazor-testing-js-navigation/"/>
      <url>/2022/02/26/blazor-testing-js-navigation/</url>
      
        <content type="html"><![CDATA[<p>這是系列文的第四篇，今天要講的是針對 JSRuntime 及 NavigationManager 做測試。<br>如果還沒看過前面幾篇的話，請往這邊走</p><ul><li><a href="/2021/12/23/blazor-testing-basic/" title="[Blazor] 元件測試 - 基礎篇">[Blazor] 元件測試 - 基礎篇</a></li><li><a href="/2022/01/21/blazor-testing-mock/" title="[Blazor] 元件測試 - mock">[Blazor] 元件測試 - mock</a></li><li><a href="/2022/01/28/blazor-testing-service/" title="[Blazor] 元件測試 - Service">[Blazor] 元件測試 - Service</a></li></ul><blockquote><p>使用同一個 <a href="https://github.com/jiaming0708/blazor-testing-demo">repo</a> 接續操作</p></blockquote><span id="more"></span><h1 id="JSRuntime"><a href="#JSRuntime" class="headerlink" title="JSRuntime"></a>JSRuntime</h1><h2 id="使用-JSRuntime"><a href="#使用-JSRuntime" class="headerlink" title="使用 JSRuntime"></a>使用 JSRuntime</h2><p>到目前為止，都還沒有呼叫到 JS 的部份，接著要將 Counter 的計算放到 JS 中處理。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注入JSRuntime --&gt;</span></span><br><span class="line">@inject IJSRuntime _jsRuntime;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @CurrentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line"></span><br><span class="line">  [Parameter]</span><br><span class="line">  public int CurrentCount &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">  private async Task IncrementCount()</span><br><span class="line">  &#123;</span><br><span class="line">    // 將計算放到 JS 中，並取得回傳值</span><br><span class="line">    CurrentCount = await _jsRuntime.InvokeAsync<span class="tag">&lt;<span class="name">int</span>&gt;</span>(&quot;incrementCount&quot;, CurrentCount);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建立新資料夾 <code>js</code> 放在 <code>wwwroot</code> 底下，並產生 <code>counter.js</code> 的檔案，準備用來寫被呼叫的函式。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">incrementCount</span>(<span class="params">count</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> count+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最後就是在 <code>index.html</code> 中引用 <code>counter.js</code> 即可。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引用剛剛寫好的檔案 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/counter.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>都寫完以後試著執行看看，確認行為是正確的就沒問題。</p><h2 id="改寫測試案例"><a href="#改寫測試案例" class="headerlink" title="改寫測試案例"></a>改寫測試案例</h2><p>修改後執行沒問題，試著重新測試 <code>CounterTest.cs</code> 的所有案例，可以看到有三個測試案例失敗。</p><p><img src="/2022/02/26/blazor-testing-js-navigation/counter-testing-failure.png" alt="counter-testing-failure"></p><p>在 bUnit 中有提供 JSInterop 來做為測試的 JSRuntime 實體，像是前面幾篇用的 mock 手法，將取代原本的函式行為。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterShouldIncrementWhenClicked</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="comment">// 宣告要 mock 的函式及結果</span></span><br><span class="line">  ctx.JSInterop.Setup&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;incrementCount&quot;</span>, <span class="number">0</span>).SetResult(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  comp.Find(<span class="string">&quot;button&quot;</span>).Click();</span><br><span class="line"></span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Current count: 1&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也可以用另一種方法，不要馬上指定結果，而是被呼叫前再指定。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterShouldIncrementWhenClicked_CompareWithSnapshot</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="comment">// 先宣告好呼叫的函式</span></span><br><span class="line">  <span class="keyword">var</span> jsruntime = ctx.JSInterop.Setup&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;incrementCount&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  <span class="keyword">var</span> button = comp.Find(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  <span class="comment">// 使用前才給值</span></span><br><span class="line">  jsruntime.SetResult(<span class="number">1</span>);</span><br><span class="line">  button.Click();</span><br><span class="line"></span><br><span class="line">  comp.SaveSnapshot();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 參數的部分如果不一樣，就需要重新的設定（也許有其他方法可以使用）</span></span><br><span class="line">  jsruntime = ctx.JSInterop.Setup&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;incrementCount&quot;</span>, <span class="number">1</span>);</span><br><span class="line">  jsruntime.SetResult(<span class="number">2</span>);</span><br><span class="line">  button.Click();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> diffs = comp.GetChangesSinceSnapshot();</span><br><span class="line">  <span class="keyword">var</span> diff = diffs.ShouldHaveSingleChange();</span><br><span class="line">  diff.ShouldBeTextChange(<span class="string">&quot;Current count: 2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Navigation"><a href="#Navigation" class="headerlink" title="Navigation"></a>Navigation</h1><p>執行登入後，驗證成功後會需要導到主頁，或者是說在選單點擊了某個連結要跳轉過去，在元件的測試中，也會希望確定這樣的行為能夠被驗證。</p><p>在 blazor 中，頁面的切換是透過 <code>NavigationManager</code> 來操作，在 bUnit 的測試框架中，提供了 <code>FakeNavigationManger</code> 這個物件，來取得相關的資料。</p><h2 id="使用-NavigationManager-做導頁"><a href="#使用-NavigationManager-做導頁" class="headerlink" title="使用 NavigationManager 做導頁"></a>使用 NavigationManager 做導頁</h2><p>在範例中，有一個元件 <code>NavMenu.razor</code> 提供三個頁面的連結可以點擊，將其中一個改成由 NavigationManager 來做導頁的行為。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@inject NavigationManager _navMan</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav-item px-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">class</span>=<span class="string">&quot;nav-link counter&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;GoCounter&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;oi oi-plus&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> Counter</span><br><span class="line">            <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  </span><br><span class="line">@code &#123;</span><br><span class="line">  private void GoCounter()</span><br><span class="line">  &#123;</span><br><span class="line">    _navMan.NavigateTo(&quot;counter&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="撰寫測試"><a href="#撰寫測試" class="headerlink" title="撰寫測試"></a>撰寫測試</h2><p>先寫最基本的測試案例，確保元件的內容如我們預期。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderComponent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;NavMenu&gt;();</span><br><span class="line"></span><br><span class="line">  StringAssert.Contains(<span class="string">@&quot;class=&quot;&quot;nav-link counter&quot;&quot;&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著就是來寫當按下 Counter 的連結，會透過 NavigationManager 來進行導頁的動作。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Navigate2CounterPage</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> navMan = ctx.Services.GetRequiredService&lt;FakeNavigationManager&gt;();</span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;NavMenu&gt;();</span><br><span class="line">  <span class="keyword">var</span> menu = comp.Find(<span class="string">@&quot;a.counter&quot;</span>);</span><br><span class="line">  menu.Click();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;/counter&quot;</span>, navMan.Uri);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://bunit.dev/docs/test-doubles/emulating-ijsruntime.html">JSRuntime</a></li><li><a href="https://bunit.dev/docs/test-doubles/fake-navigation-manager.html">NavigationManager</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 元件測試 - Service</title>
      <link href="/2022/01/28/blazor-testing-service/"/>
      <url>/2022/01/28/blazor-testing-service/</url>
      
        <content type="html"><![CDATA[<p>這是系列文的第三篇，今天要講到的是針對 Service 做測試。<br>如果還沒看過前面兩篇的話，請往這邊走 <a href="/2021/12/23/blazor-testing-basic/" title="[Blazor] 元件測試 - 基礎篇">[Blazor] 元件測試 - 基礎篇</a>、<a href="/2022/01/21/blazor-testing-mock/" title="[Blazor] 元件測試 - mock">[Blazor] 元件測試 - mock</a>。</p><blockquote><p>使用上次的 <a href="https://github.com/jiaming0708/blazor-testing-demo">repo</a> 接續操作</p></blockquote><span id="more"></span><h1 id="重構成-service"><a href="#重構成-service" class="headerlink" title="重構成 service"></a>重構成 service</h1><p>在原本的 FetchData.razor 頁面中，是直接用 HttpClient 呼叫 API，今天的測試重點是 Service ，因此需要先將使用 HttpClient 的部分抽出成 Service。<br>建立資料夾 <code>Services</code> 及檔案 <code>IDataService.cs</code> 。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> client.Pages;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">client.Services</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDataService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Task&lt;FetchData.WeatherForecast[]?&gt; GetWeatherForecast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再建立一個檔案 <code>DataService.cs</code>  來繼承 <code>IDataService</code>，並且使用透過 DI 的方法取得 HttpClient。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http.Json;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> client.Pages;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">client.Services</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DataService</span>: <span class="title">IDataService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> HttpClient _http;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DataService</span>(<span class="params">HttpClient http</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _http = http;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">FetchData.WeatherForecast</span>[]?&gt; <span class="title">GetWeatherForecast</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> _http.GetFromJsonAsync&lt;FetchData.WeatherForecast[]&gt;(<span class="string">&quot;sample-data/weather.json&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blazor 要用到 Service 的話需要在 Program.cs 中宣告。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebAssemblyHostBuilder.CreateDefault(args);</span><br><span class="line">builder.RootComponents.Add&lt;App&gt;(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line">builder.RootComponents.Add&lt;HeadOutlet&gt;(<span class="string">&quot;head::after&quot;</span>);</span><br><span class="line"></span><br><span class="line">builder.Services.AddScoped&lt;IDataService, DataService&gt;(); <span class="comment">// &lt;== 定義 DataService 及 IDataService 的關係</span></span><br><span class="line">builder.Services.AddScoped(sp =&gt; <span class="keyword">new</span> HttpClient &#123; BaseAddress = <span class="keyword">new</span> Uri(builder.HostEnvironment.BaseAddress) &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> builder.Build().RunAsync();</span><br></pre></td></tr></table></figure><p>最後一個步驟，就是將 FetchData.razor 改呼叫 Service。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/fetchdata&quot;</span><br><span class="line">@using client.Services</span><br><span class="line">@inject IDataService _dataService;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- html 省略 --&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private WeatherForecast[]? forecasts;</span><br><span class="line"></span><br><span class="line">    protected override async Task OnInitializedAsync()</span><br><span class="line">    &#123;</span><br><span class="line">        forecasts = await _dataService.GetWeatherForecast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="修改測試"><a href="#修改測試" class="headerlink" title="修改測試"></a>修改測試</h1><p>都改完以後先執行看看，確認功能跑起來是否正確，並且檢查測試案例是否通過，不出意料測試案例果然是失敗的，因為多了一個 Service。<br>Service 在 bUnit 中的做法跟 blazor 差不多，都是要加入 <code>Services</code> 的集合中。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">ctx.Services.AddScoped&lt;IDataService, DataService&gt;(); <span class="comment">// &lt;=== 定義 DataService 及 IDataService 的關係</span></span><br><span class="line"><span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">StringAssert.Contains(<span class="string">&quot;Loading...&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Mock-Service"><a href="#Mock-Service" class="headerlink" title="Mock Service"></a>Mock Service</h1><p>DataService 是繼承 Interface，有兩種做法可以使用</p><ul><li>建立另一個的 DataService 給測試使用</li><li>使用 <code>MOQ</code> &#x2F; <code>NSubtitute</code></li></ul><p>在前一篇已經安裝過 MOQ ，這邊就繼續採用他來作為測試的方法。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockService</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mockService = <span class="keyword">new</span> Mock&lt;IDataService&gt;();</span><br><span class="line">mockService</span><br><span class="line">  .Setup(p =&gt; p.GetWeatherForecast())</span><br><span class="line">  .ReturnsAsync(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;.ToArray());</span><br><span class="line">ctx.Services.AddSingleton&lt;IDataService&gt;(mockService.Object);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">comp.WaitForState(() =&gt; !comp.Markup.Contains(<span class="string">&quot;Loading...&quot;</span>));</span><br><span class="line">Assert.IsNotNull(comp.Find(<span class="string">&quot;.table&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>透過 Mock Interface 的方法搭配上使用 AddSignleton。</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://github.com/Moq/moq4/wiki/Quickstart#async-methods">Quickstart · moq&#x2F;moq4 Wiki (github.com)</a></li><li><a href="https://bunit.dev/docs/interaction/awaiting-async-state.html">Awaiting an asynchronous state change in a component under test | bUnit</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 元件測試 - mock</title>
      <link href="/2022/01/21/blazor-testing-mock/"/>
      <url>/2022/01/21/blazor-testing-mock/</url>
      
        <content type="html"><![CDATA[<p>前一篇 <a href="/2021/12/23/blazor-testing-basic/" title="[Blazor] 元件測試 - 基礎篇">[Blazor] 元件測試 - 基礎篇</a> 中已經介紹過基本的測試，今天要來介紹的是 <code>Mock</code> 的應用。</p><blockquote><p>使用上次的 <a href="https://github.com/jiaming0708/blazor-testing-demo">repo</a> 接續操作</p></blockquote><span id="more"></span><h1 id="FetchData-頁面"><a href="#FetchData-頁面" class="headerlink" title="FetchData 頁面"></a>FetchData 頁面</h1><p>開啟 <code>Pages</code> 中的 <code>FetchData.razor</code> 這個元件，可以注意到 <code>OnInitializedAsync</code> 的部份，是透過 <code>HttpClient</code> 打 API 取得資料回來呈現。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/fetchdata&quot;</span><br><span class="line">@inject HttpClient Http</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Weather forecast<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Weather forecast<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This component demonstrates fetching data from the server.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@if (forecasts == null)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Date<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Temp. (C)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Temp. (F)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>Summary<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            @foreach (var forecast in forecasts)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.Date.ToShortDateString()<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.TemperatureC<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.TemperatureF<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>@forecast.Summary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private WeatherForecast[]? forecasts;</span><br><span class="line"></span><br><span class="line">    protected override async Task OnInitializedAsync()</span><br><span class="line">    &#123;</span><br><span class="line">        forecasts = await Http.GetFromJsonAsync&lt;WeatherForecast[]&gt;(&quot;sample-data/weather.json&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class WeatherForecast</span><br><span class="line">    &#123;</span><br><span class="line">        public DateTime Date &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public int TemperatureC &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public string? Summary &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Mock-HttpClient"><a href="#Mock-HttpClient" class="headerlink" title="Mock HttpClient"></a>Mock HttpClient</h2><p>在測試專案中，新增一個檔案 <code>FetchDataTest.cs</code>，並加上一個測試案例直接針對 FetchData 這個元件的輸出來看看結果。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  Console.WriteLine(comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>應該會看到測試失敗，原因就是在 init 時有使用到 HttpClient。</p><blockquote><p>This test requires a HttpClient to be supplied, because the component under test invokes the HttpClient during the test. The request that was sent is contained within the ‘Request’ attribute of this exception. Guidance on mocking the HttpClient is available on bUnit’s website.</p></blockquote><p>要對 HttpClient 進行 mock 的話，還需要安裝另外一個 library <strong>RichardSzalay.MockHttp</strong>，打開 Nuget 管理並且加入這個套件到測試專案中。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; <span class="built_in">Install-Package</span> RichardSzalay.MockHttp</span><br></pre></td></tr></table></figure><p>建立一個檔案 <code>MockHttpClientBunitHelpers</code>  來實作兩個功能</p><ul><li>註冊 HttpClient 到 Service</li><li>Response 的介面</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http.Headers;</span><br><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"><span class="keyword">using</span> Bunit;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> RichardSzalay.MockHttp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">MockHttpClientBunitHelpers</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockHttpMessageHandler <span class="title">AddMockHttpClient</span>(<span class="params"><span class="keyword">this</span> TestServiceProvider services</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> mockHttpHandler = <span class="keyword">new</span> MockHttpMessageHandler();</span><br><span class="line">    <span class="keyword">var</span> httpClient = mockHttpHandler.ToHttpClient();</span><br><span class="line">    httpClient.BaseAddress = <span class="keyword">new</span> Uri(<span class="string">&quot;http://localhost&quot;</span>);</span><br><span class="line">    services.AddSingleton&lt;HttpClient&gt;(httpClient);</span><br><span class="line">    <span class="keyword">return</span> mockHttpHandler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockedRequest <span class="title">RespondJson</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> MockedRequest request, T content</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    request.Respond(req =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> response = <span class="keyword">new</span> HttpResponseMessage(HttpStatusCode.OK);</span><br><span class="line">      response.Content = <span class="keyword">new</span> StringContent(JsonSerializer.Serialize(content));</span><br><span class="line">      response.Content.Headers.ContentType = <span class="keyword">new</span> MediaTypeHeaderValue(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MockedRequest <span class="title">RespondJson</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> MockedRequest request, Func&lt;T&gt; contentProvider</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    request.Respond(req =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> response = <span class="keyword">new</span> HttpResponseMessage(HttpStatusCode.OK);</span><br><span class="line">      response.Content = <span class="keyword">new</span> StringContent(JsonSerializer.Serialize(contentProvider()));</span><br><span class="line">      response.Content.Headers.ContentType = <span class="keyword">new</span> MediaTypeHeaderValue(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著來修改剛剛的測試案例，在 Service 註冊 HttpClient 就可以讓測試順利通過，並且看到結果包含著 <strong>Loading…</strong> 的字串。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Loading...&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mock-API"><a href="#mock-API" class="headerlink" title="mock API"></a>mock API</h2><p>使用 mock 物件提供的 When 以及剛剛所寫的 RespondJson 方法，來處理資料。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderWithoutResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Loading...&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以發現這樣怎麼還是沒重新 render 拿到新的 html 結構，因為是使用非同步的方法取得資料，因此測試也需要使用非同步的方式。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderMockResponse</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  comp.WaitForAssertion(() =&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    Assert.IsNotNull(comp.Find(<span class="string">&quot;.table&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了使用 <code>WaitForAssertion</code> 也可以採用另一種等待狀態變更 <code>WaitForState</code> 的作法，後面就能變回同步的狀態。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RenderMockResponse_WaitState</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mock = ctx.Services.AddMockHttpClient();</span><br><span class="line">  mock.When(<span class="string">&quot;/sample-data/weather.json&quot;</span>).RespondJson(<span class="keyword">new</span> List&lt;FetchData.WeatherForecast&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">new</span>() &#123;Date = <span class="keyword">new</span> DateTime(<span class="number">2022</span>, <span class="number">01</span>, <span class="number">20</span>), TemperatureC = <span class="number">15</span>, Summary = <span class="string">&quot;first data&quot;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;FetchData&gt;();</span><br><span class="line">  comp.WaitForState(() =&gt; !comp.Markup.Contains(<span class="string">&quot;Loading...&quot;</span>));</span><br><span class="line">  Assert.IsNotNull(comp.Find(<span class="string">&quot;.table&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Index-頁面"><a href="#Index-頁面" class="headerlink" title="Index 頁面"></a>Index 頁面</h1><p>看完 Mock HttpClient 的作法後，接著要來做 Mock Component，有時候我們可以假設 Child component 的行為都是正確的，把測試主力放在自己身上，這時候就會需要這個技巧。</p><p>開啟 Pages 中 <code>Index.razor</code> 的內容，裡面使用到 <code>SurveyPrompt</code> 元件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Welcome to your new app.</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">SurveyPrompt</span> <span class="attr">Title</span>=<span class="string">&quot;How is Blazor working for you?&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Mock-Component"><a href="#Mock-Component" class="headerlink" title="Mock Component"></a>Mock Component</h2><p>在測試專案中，新增檔案 <code>IndexTest.cs</code>。<br>在 ComponntFactories 加上要 mock 的元件，先試著 mock SurveyPrompt 看輸出內容，就可以發現那個元件的部份是完全空白。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildComp</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  Console.WriteLine(comp.Markup);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;h1&gt;Hello, world!&lt;/h1&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Welcome to your new app.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以使用 <code>IRenderedComponent.HasComponent&lt;T&gt;()</code> 檢查元件是否有存在，將測試案例調整一下。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildComp</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  Assert.False(comp.HasComponent&lt;SurveyPrompt&gt;());</span><br><span class="line">  Assert.True(comp.HasComponent&lt;Stub&lt;SurveyPrompt&gt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Mock-content"><a href="#Mock-content" class="headerlink" title="Mock content"></a>Mock content</h2><p>剛剛的測試是沒有任何內容，如果想要自訂內容的話，可以在 <code>AddStub&lt;T&gt;(&quot;xxxx&quot;)</code> 中放入字串。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildCompContent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> content = <span class="string">&quot;&lt;div&gt;Mock SurveyPrompt&lt;/div&gt;&quot;</span>;</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  StringAssert.Contains(content, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Mock-content-with-parameter"><a href="#Mock-content-with-parameter" class="headerlink" title="Mock content with parameter"></a>Mock content with parameter</h2><p>除了寫死的內容以外，也能夠支援傳遞參數的方法，在 AddStub 的方法內改用函式的作法，來取得並輸出參數。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockChildCompContentWithParameter</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  ctx.ComponentFactories.AddStub&lt;SurveyPrompt&gt;(paras =&gt; <span class="string">$&quot;&lt;div&gt;<span class="subst">&#123;paras.Get(x =&gt; x.Title)&#125;</span>&lt;/div&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;How is Blazor working for you?&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用第三方套件"><a href="#使用第三方套件" class="headerlink" title="使用第三方套件"></a>使用第三方套件</h2><p>除了 bUnit 的這種作法外，也可以使用第三方的 mock 套件，像是 <code>MOQ</code> 及 <code>NSubtitute</code>。作法跟上面的類似，將 <code>AddStub&lt;T&gt;()</code> 改為 <code>Add&lt;T&gt;(mock object)</code> 。</p><p>打開 Nuget 管理將 <code>MOQ</code> 這個套件加入到測試專案中，這邊將使用 MOQ 做範例。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; <span class="built_in">Install-Package</span> MOQ</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MockComponentByMOQ</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line">  <span class="keyword">var</span> mockComp = <span class="keyword">new</span> Mock&lt;SurveyPrompt&gt;();</span><br><span class="line">  ctx.ComponentFactories.Add(mockComp.Object);</span><br><span class="line">  <span class="comment">// 另一種寫法</span></span><br><span class="line">  <span class="comment">// ctx.ComponentFactories.Add(() =&gt; Mock.Of&lt;SurveyPrompt&gt;());</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Index&gt;();</span><br><span class="line">  <span class="keyword">var</span> actualComp = comp.FindComponent&lt;SurveyPrompt&gt;();</span><br><span class="line">  Assert.AreSame(mockComp.Object, actualComp.Instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>今天介紹了 HttpClient 及 Component 的 mock 方法，個人覺得還要另外採用第三方套件來做 Mock 是蠻麻煩的，但官方目前的態度就是這樣，bUnit 不去依賴第三方套件。</p><p><a href="https://github.com/jiaming0708/blazor-testing-demo">範例程式</a> 也放在 github 上，如果有需要也可以按照 commit 的步驟來跟著操作學習。</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://bunit.dev/docs/providing-input/substituting-components.html?tabs=moq">mocking component</a></li><li><a href="https://bunit.dev/docs/test-doubles/mocking-httpclient.html">mocking HttpClient</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>將獨立的 dll 打包發佈到 nuget server</title>
      <link href="/2021/12/29/dll-publish-nuget/"/>
      <url>/2021/12/29/dll-publish-nuget/</url>
      
        <content type="html"><![CDATA[<p>nuget 是 dotnet 的套件管理工具，就像是 npm 是屬於 nodejs 的平台一樣，在上面的版本只能升不能降，還會有所有的版本異動紀錄，可以讓專案的參考管理更為有效。<br>有 source code 的話要做到打包其實非常的簡單，今天要分享只有 dll 的話該如何發佈到 nuget server。</p><span id="more"></span><h1 id="安裝-Explorer"><a href="#安裝-Explorer" class="headerlink" title="安裝 Explorer"></a>安裝 Explorer</h1><p>要發佈到 nuget 前要先做打包成 <code>*.nupkg</code> 的檔案，有 source code 的話可以透過 <code>nuget.exe</code> CLI (下載 <a href="https://www.nuget.org/downloads">NuGet Gallery | Downloads</a>) 來進行打包，打包後如果還要編輯 unpkg 的話，就可以透過 <a href="https://github.com/NuGetPackageExplorer/NuGetPackageExplorer">Nuget Package Explorer</a> 。</p><p>目前有兩個方法可以安裝</p><ul><li><p><a href="https://www.microsoft.com/store/apps/9wzdncrdmdm3">Microsoft Store</a> (推薦)<br>![microsoft store].\microsoft-store.png)</p></li><li><p><a href="https://chocolatey.org/packages/NugetPackageExplorer">Chocolatey</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install nugetpackageexplorer</span><br></pre></td></tr></table></figure></li></ul><h1 id="打包-dll"><a href="#打包-dll" class="headerlink" title="打包 dll"></a>打包 dll</h1><p>打開 <code>NuGet Package Explorer</code> 並且選擇 <code>Create a new package</code> 來產生一個新的檔案</p><p><img src="/2021/12/29/dll-publish-nuget/create-new-package.png" alt="create new package"></p><p>接著會看到畫面分為兩個區塊</p><ul><li>metadata: 描述 package 的基本資訊，版本、作者、說明…等。</li><li>contents: 包含在這個 package 中的內容，dotnet 版本、dll…等。</li></ul><p><img src="/2021/12/29/dll-publish-nuget/package-view.png" alt="package view"></p><h2 id="編輯-metadata"><a href="#編輯-metadata" class="headerlink" title="編輯 metadata"></a>編輯 metadata</h2><p>點下 metadata 的左上角的 icon，進入編輯的畫面</p><p><img src="/2021/12/29/dll-publish-nuget/edit-metadata.png" alt="edit metadata"></p><p>通常會編輯幾個區塊</p><ul><li>Id: 需要唯一名稱，不可和 nuget 平台上的重複 (同一個 Id 可以在不同的 nuget server 上，也就是 nuget.org 和 private 的可以用同一個名稱)。</li><li>Version: 每次推到 nuget server 都必須比原本的版本還要新。</li><li>Author: 作者資訊。</li><li>Description: 對於這個 package 的描述。</li></ul><h2 id="編輯-content"><a href="#編輯-content" class="headerlink" title="編輯 content"></a>編輯 content</h2><p>要將 dll 放進去前，要先新增 <code>lib</code> 的資料夾</p><p><img src="/2021/12/29/dll-publish-nuget/add-lib-folder.png" alt="add lib folder"></p><p>如果 dll 有指定平台或是版本，就可以選擇上面的 <code>Add &#123;*&#125; folder</code> ，若沒有的話，可以直接點選 <code>Add Existing File</code> 。<br>我要放進去的 dll 是 framework 4.5 的版本，就先指定版本再來新增檔案。</p><p><img src="/2021/12/29/dll-publish-nuget/specify-dotnet-version.png" alt="specify dotnet version"></p><p><img src="/2021/12/29/dll-publish-nuget/add-dll-in-content.png" alt="add dll in content"></p><h2 id="產生-unpkg"><a href="#產生-unpkg" class="headerlink" title="產生 unpkg"></a>產生 unpkg</h2><p>做完前面兩個步驟以後，就可以按下儲存，來產生 unpkg 的檔案。預設的檔案名稱會使用 <code>&#123;Id&#125;_&#123;Version&#125;.unpkg</code> ，基本上也不用去改名稱，直接找到想要的目錄底下儲存就好。</p><p><img src="/2021/12/29/dll-publish-nuget/save-unpkg.png" alt="save unpkg"></p><h2 id="發佈"><a href="#發佈" class="headerlink" title="發佈"></a>發佈</h2><p>最後就是將做好的內容發佈到 nuget 上啦，在上方的選單中 <code>File</code> 點選 <code>Publish</code> ，選擇要發佈的 server 及填入 api key。</p><p><img src="/2021/12/29/dll-publish-nuget/publish.png" alt="publish"></p><h1 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h1><p>對於一些年久失修的 dll，可以透過這樣的方法來重新打包上 nuget server，讓套件的管理更加統一。一開始操作的時候，我也有嘗試過將好幾顆 dll 一起打包，但這樣會有個缺點，一次參考就一定會所有 dll 都進去，如果每個 dll 是獨立沒有相依性的，就會建議拆開來做，避免這樣的問題發生。這些做好的 unpkg 甚至可以放進版控並且整合 CI&#x2F;CD 流程。</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://github.com/NuGetPackageExplorer/NuGetPackageExplorer">NuGetPackageExplorer&#x2F;NuGetPackageExplorer: Create, update and deploy Nuget Packages with a GUI (github.com)</a></li><li>[<a href="https://marcus116.blogspot.com/2019/02/nuget-nuget-package-explorer-nuget.html">Nuget] 使用 NuGet Package Explorer 製作 Nuget 套件 ~ m@rcus 學習筆記 (marcus116.blogspot.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> nuget </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nuget </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>將專案從 SVN 搬到 Git</title>
      <link href="/2021/12/24/svn-migrate-git/"/>
      <url>/2021/12/24/svn-migrate-git/</url>
      
        <content type="html"><![CDATA[<p>公司還是有舊的專案是放在 Subversion(SVN) 中，為了接下來增加一些 CI&#x2F;CD 的輔助，並且希望在 Teams 能夠集中並且即時的收到專案的資訊，就必須要做搬移的動作。</p><blockquote><p>之前有做過一次，今天在做的時候又有點卡關，一定是沒有做筆記的原因!! </p></blockquote><span id="more"></span><h1 id="SVN-問題"><a href="#SVN-問題" class="headerlink" title="SVN 問題"></a>SVN 問題</h1><p>SVN 也有 hooks 可以發通知之類的，公司就有在 hooks 檢查 message 的格式，把 commit 的資訊推到專案管理的平台。但有點美中不足的地方是，hooks 的設定必須進去 server 然後寫 bat 之類的程式，也就是說這個設定對於新建立專案的人來說並不友善。</p><p>第二點就是 branch 的管理，每個資料夾只能同步到其中一個 branch ，如果同時有 master 和 develop，就必須要開兩個資料夾來存放，這對於開發人員真的是一個很不方便的事情。(也許可以用一個資料夾做到，如果知道的人可以跟我分享喔)</p><p>最後一點應該就是集中式管理，同事會常常要出差到客戶那，或是 VPN 到客戶的環境中作業，這時候將專案放在公司的 SVN server 上，那就會很痛苦要一直切換網路環境。</p><h1 id="搬移"><a href="#搬移" class="headerlink" title="搬移"></a>搬移</h1><h2 id="環境準備"><a href="#環境準備" class="headerlink" title="環境準備"></a>環境準備</h2><p>電腦應該要安裝好以下這幾個軟體已經被安裝，並且開啟 terminal</p><ul><li><a href="https://subversion.apache.org/packages.html">Subversion</a></li><li><a href="https://git-for-windows.github.io/">Git</a></li><li><a href="https://www.kernel.org/pub/software/scm/git/docs/git-svn.html">git-svn</a> (將會透過這個工具做資訊的轉換)</li></ul><blockquote><p>作業系統為 window  10</p></blockquote><h2 id="取得所有作者資訊"><a href="#取得所有作者資訊" class="headerlink" title="取得所有作者資訊"></a>取得所有作者資訊</h2><p>Git 和 SVN 對於作者描述的方法不同，第一步就要先把 SVN 的作者資訊做轉換。</p><p><strong>Subversion users</strong><br><img src="https://docs.microsoft.com/en-us/azure/devops/repos/git/media/perform-migration-from-svn-to-git/svn-log.png?view=azure-devops" alt="SVN users reference from MS"></p><p><strong>Git users</strong><br><img src="https://docs.microsoft.com/en-us/azure/devops/repos/git/media/perform-migration-from-svn-to-git/git-log.png?view=azure-devops" alt="Git users reference from MS"></p><p>從 PowerShell (建議使用 version 7) 執行以下的指令，會將作者資訊存到檔案 <code>authors.txt</code>，格式會是像 <code>jiaming = jiaming &lt;jiaming&gt;</code> 這樣，開啟檔案將 <code>&lt;&gt;</code> 中的內容修改成 email 格式。</p><blockquote><p>這邊要特別注意一下，檔案的編碼必須是 <strong>UTF8</strong> (不能有 bom)，不然下一個步驟 clone 時會有找不到 author 的錯誤。</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn.exe log <span class="literal">--quiet</span> | ? &#123; <span class="variable">$_</span> <span class="operator">-notlike</span> <span class="string">&#x27;-*&#x27;</span> &#125; | % &#123; <span class="string">&quot;&#123;0&#125; = &#123;0&#125; &lt;&#123;0&#125;&gt;&quot;</span> <span class="operator">-f</span> (<span class="variable">$_</span> <span class="operator">-split</span> <span class="string">&#x27; \| &#x27;</span>)[<span class="number">1</span>] &#125; | <span class="built_in">Select-Object</span> <span class="literal">-Unique</span> | <span class="built_in">Out-File</span> <span class="literal">-Encoding</span> UTF8 <span class="string">&#x27;authors.txt&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="使用-git-svn-複製"><a href="#使用-git-svn-複製" class="headerlink" title="使用 git-svn 複製"></a>使用 git-svn 複製</h2><p>接著就要將 svn 的專案轉換成 git，先在目前的專案目錄底下建立一個子目錄 <code>gitsource</code> ，並且執行指令。</p><blockquote><p>如果只有一個主幹，那直接 <code>git svn clone</code> 就好</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git svn clone [svn repo] -A authors.txt ./gitsource</span><br></pre></td></tr></table></figure><p>若專案是標準的 trunk&#x2F;branch&#x2F;tag ，那就可以加上 <code>--stdlayout</code> 來描述</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git svn clone [svn repo] -A authors.txt ./gitsource --stdlayout</span><br></pre></td></tr></table></figure><p>如果 history 很多的話，就會跑比較久一點，建議就是先放著讓他跑，做其他事情去XD</p><h2 id="轉換-ignore"><a href="#轉換-ignore" class="headerlink" title="轉換 ignore"></a>轉換 ignore</h2><p>SVN 也有自己的 ignore 設定，可以透過指令轉換成 .gitignore。</p><blockquote><p>如果是 dotnet 可以參考這兩個 ignore 設定，<a href="https://github.com/dotnet/core/blob/main/.gitignore">for core</a>、<a href="https://github.com/github/gitignore/blob/main/VisualStudio.gitignore">for vs</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd gitsource</span><br><span class="line">git svn show-ignore &gt; .gitignore</span><br><span class="line">git add .gitignore</span><br><span class="line">git commit -m &#x27;convert svn:ignore to .gitignore&#x27;</span><br></pre></td></tr></table></figure><h2 id="推到遠端"><a href="#推到遠端" class="headerlink" title="推到遠端"></a>推到遠端</h2><p>呼~終於到最後一步啦!! 接著就是照平常 push 到遠端的作法，就可以了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin [git repo]</span><br><span class="line">git push -u origin --all</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.microsoft.com/en-us/azure/devops/repos/git/perform-migration-from-svn-to-git?view=azure-devops">Migrate from Subversion (SVN) to Git - Azure Repos | Microsoft Docs</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10140481">30 天精通 Git 版本控管 (29)：如何將 Subversion 專案匯入到 Git 儲存庫 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天 (ithome.com.tw)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> SVN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 元件測試 - 基礎篇</title>
      <link href="/2021/12/23/blazor-testing-basic/"/>
      <url>/2021/12/23/blazor-testing-basic/</url>
      
        <content type="html"><![CDATA[<p>寫了很多的元件來使用，但要怎麼確保行為正確，在修改的時候沒有把一些行為改壞，可以透過<code>測試</code>來進行保護，在 Blazor 中可以透過 <a href="https://bunit.dev/"><strong>bUnit</strong></a> 這個套件來達成。</p><span id="more"></span><p>bUnit 可以套用在 xUnit&#x2F;NUnit&#x2F;MSTest 任何一個測試框架上，寫法不會因為框架的不同而有所差異。跟 API 或是 <strong>method</strong> 不一樣的測試目的，元件通常是由一個 click 或是外部的參數改變，而產生一些行為的變化，在元件的測試中，</p><h1 id="環境建置"><a href="#環境建置" class="headerlink" title="環境建置"></a>環境建置</h1><p>在開始之前要先準備一下專案的環境，直接用 cli 來產生 blazor wasm 的專案，或者用 VS&#x2F;Rider 這種 IDE 來產生</p><blockquote><p>dotnet sdk 版本為 6</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir blazor-tsting-demo</span><br><span class="line">dotnet new sln -n blazor-testing-demo</span><br><span class="line">dotnet new blazorwasm -n client</span><br><span class="line">dotnet sln add ./client/client.csproj</span><br></pre></td></tr></table></figure><p>接著在把測試專案也先建立好，並且增加 bunit 及 client 的參考到專案中。</p><blockquote><p>我使用的是 <strong>nunit</strong> ，如果你有習慣的測試框架也可以使用沒有問題</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dotnet new nunit -n test</span><br><span class="line">dotnet sln add ./test/test.csproj</span><br><span class="line">cd test</span><br><span class="line">dotnet add package bunit</span><br><span class="line">dotnet add test.csproj reference ../client/client.csproj</span><br></pre></td></tr></table></figure><h1 id="撰寫測試"><a href="#撰寫測試" class="headerlink" title="撰寫測試"></a>撰寫測試</h1><h2 id="Render驗證"><a href="#Render驗證" class="headerlink" title="Render驗證"></a>Render驗證</h2><p>不管透過 cli&#x2F;IDE 所建立出來的 blazor wasm 專案都有基本的樣板，這邊就先來看一下樣板中 <code>Pages/Counter.razor</code> 這個元件，有什麼樣的行為，並且如何進行測試。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private int currentCount = 0;</span><br><span class="line"></span><br><span class="line">    private void IncrementCount()</span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在這個樣板中，主要的行為是按下 button 後 count 會加1，測試的動作，就是要模擬使用者點擊 button 後，html 應該要反映出 count 的變化。</p><p>回到測試專案中，把原本的 <code>UnitTest1.cs</code> 改成 <code>CounterTest.cs</code> ，之後我們還會繼續增加其他的測試檔案。<br>將原本的 <code>Test1</code> 改成 <code>CounterRender</code> ，宣告一個 Bunit 的 <strong>TestContext</strong> 並且呼叫 <strong>RenderComponent</strong> 就可以取得 Counter 這個元件的 html 輸出。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterRender</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  Console.WriteLine(comp.Markup);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;h1&gt;Counter&lt;/h1&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;p role=&quot;status&quot;&gt;Current count: 0&lt;/p&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;button class=&quot;btn btn-primary&quot; blazor:onclick=&quot;1&quot;&gt;Click me&lt;/button&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這樣的輸出結果，會發現兩個比較困難的地方</p><ul><li>換行字元</li><li><code>blazer:onclick</code> 屬性並不知道內容是什麼</li></ul><p>我會建議採用部分比對就可以，抓到重點確定內容有符合即可，將測試案例調整如下</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterRender</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Current count: 0&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/counter-render-pass.png" alt="CounterRender test pass"></p><h2 id="互動驗證"><a href="#互動驗證" class="headerlink" title="互動驗證"></a>互動驗證</h2><p>第一個測試案例寫好後，接著要來寫第二個案例，點擊 button 後 count 應該加1。<br>從 render 出來的元件中找到需要的 element，並且進行互動。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterShouldIncrementWhenClicked</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  comp.Find(<span class="string">&quot;button&quot;</span>).Click();</span><br><span class="line"></span><br><span class="line">  StringAssert.Contains(<span class="string">&quot;Current count: 1&quot;</span>, comp.Markup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者是直接拿到 p 這個 element，來驗證裡面的內容</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comp.Find(<span class="string">&quot;p&quot;</span>).TextContent.MarkupMatches(<span class="string">&quot;Current count: 1&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/counter-increment-clicked.png" alt="counter-increment-clicked"></p><h2 id="比對驗證"><a href="#比對驗證" class="headerlink" title="比對驗證"></a>比對驗證</h2><p>畫面有了異動，會想要知道異動的地方是不是如我們所預期，這時候可以透過比對差異的方法，有兩種作法可以做到</p><ul><li>跟第一次比</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterShouldIncrementWhenClicked_CompareWithFirst</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  comp.Find(<span class="string">&quot;button&quot;</span>).Click();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> diffs = comp.GetChangesSinceFirstRender();</span><br><span class="line">  <span class="keyword">var</span> diff = diffs.ShouldHaveSingleChange();</span><br><span class="line">  diff.ShouldBeTextChange(<span class="string">&quot;Current count: 1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/compare-first.png" alt="compare-first"></p><ul><li><p>比對 <code>snapshot</code>，在比對之前要先儲存</p><blockquote><p>在這邊的範例中比較展示不出來差異，因為異動的都是同一個地方。</p></blockquote></li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CounterShouldIncrementWhenClicked_CompareWithSnapshot</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  <span class="keyword">var</span> button = comp.Find(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  button.Click();</span><br><span class="line"></span><br><span class="line">  comp.SaveSnapshot();</span><br><span class="line"></span><br><span class="line">  button.Click();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> diffs = comp.GetChangesSinceSnapshot();</span><br><span class="line">  <span class="keyword">var</span> diff = diffs.ShouldHaveSingleChange();</span><br><span class="line">  diff.ShouldBeTextChange(<span class="string">&quot;Current count: 2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/compare-shapshot.png" alt="compare-shapshot"></p><h2 id="參數給值"><a href="#參數給值" class="headerlink" title="參數給值"></a>參數給值</h2><p>接著要來改一下功能需求，可以由外面來決定初始 Count 是多少，沒有給的話就是0。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@code &#123;</span><br><span class="line">  [Parameter]</span><br><span class="line">  public int currentCount &#123; get; set; &#125; = 0;</span><br><span class="line"></span><br><span class="line">  private void IncrementCount()</span><br><span class="line">  &#123;</span><br><span class="line">    currentCount++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>將剛剛所寫的幾個測試案例重跑過一遍，要確定這樣的修改是正確的。</p><p><img src="/2021/12/23/blazor-testing-basic/counter-testing-after-change.png" alt="image-20211223212905835"></p><p>測試通過後，再來寫傳遞參數的測試案例，有兩個方法可以傳遞參數</p><ul><li>在 init 時就給</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CountShouldBe5_OnInit</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;(parameters =&gt; parameters.Add(p =&gt; p.currentCount, count));</span><br><span class="line">  comp.Find(<span class="string">&quot;p&quot;</span>).TextContent.MarkupMatches(<span class="string">$&quot;Current count: <span class="subst">&#123;count&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/parameter-on-init.png" alt="parameter-on-init"></p><ul><li>先 init 再給值</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CountShouldBe5_AfterInit</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">var</span> ctx = <span class="keyword">new</span> Bunit.TestContext();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">var</span> comp = ctx.RenderComponent&lt;Counter&gt;();</span><br><span class="line">  <span class="keyword">var</span> elm = comp.Find(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">  elm.TextContent.MarkupMatches(<span class="string">&quot;Current count: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line">  comp.SetParametersAndRender(parameters =&gt; parameters.Add(p =&gt; p.currentCount, count));</span><br><span class="line">  elm.TextContent.MarkupMatches(<span class="string">$&quot;Current count: <span class="subst">&#123;count&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/12/23/blazor-testing-basic/parameter-after-init.png" alt="parameter-after-init"></p><h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>今天的重點會放在元件的基本互動，click 還有 parameter 進行測試，可以看到其實都是以 html 的變化作為測試結果的確認，也很符合元件給使用者操作的印象。</p><p>今天的 <a href="https://github.com/jiaming0708/blazor-testing-demo">範例程式</a> 也放在 github 上，如果有需要也可以按照 commit 的步驟來跟著操作學習。</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://bunit.dev/docs/verification/verify-markup.html">verify markup</a></li><li><a href="https://bunit.dev/docs/providing-input/passing-parameters-to-components.html?tabs=csharp">parameter</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在瀏覽器偵測裝置是否已經安裝應用程式</title>
      <link href="/2021/11/18/detect-application-installed/"/>
      <url>/2021/11/18/detect-application-installed/</url>
      
        <content type="html"><![CDATA[<p>前面介紹了在瀏覽器開起應用程式及封裝應用程式，今天要來介紹的是如何在瀏覽器中偵測裝置是否已經安裝，根據狀態來決定是否要顯示不同的文字內容。</p><blockquote><p>還沒有看的話，可以先回頭看看這兩篇 <a href="/2021/10/11/browser-open-application/" title="如何在瀏覽器開啟應用程式">如何在瀏覽器開啟應用程式</a>、<a href="/2021/11/06/vs-installer-project/" title="透過visual studio建立安裝檔案">透過visual studio建立安裝檔案</a></p></blockquote><p>瀏覽器開啓應用程式是透過os層的機制處理，對於瀏覽器來說，不會回報是否開啓成功，這個部分就必須要透過其他的手法來偵測。</p><span id="more"></span><h1 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h1><p>要偵測是否開啟成功的話，就不能開在新視窗或分頁，也不能把現在頁面給換掉，這樣 script 都會失效。這邊可以透過 iframe 的方式來做包裝，將 custom protocol 丟進去，接下來偵測的行為才能夠正確。</p><blockquote><p>iframe 這時候就是香阿，在其他地方使用還是要小心XD</p></blockquote><p>如果有安裝的話，會跳出視窗詢問是否開啟應用程式，對於原本的頁面來算是 <code>unfocus/blur</code> ，大部分的瀏覽器可以透過這樣的概念來做到偵測的行為。<br>接著來看一下基本的範例，利用 <strong>blur</strong> 的事件來判斷是否開啟，並用 <strong>timeout</strong> 來判斷是否沒安裝。</p><blockquote><p>這邊要注意到 timeout 的時間，可能會因為電腦的速度而影響到</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用 timeout 來判斷是否有安裝</span></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail to launch application&quot;</span>);</span><br><span class="line">    handler.<span class="title function_">remove</span>();</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#hiddenIframe&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!iframe) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line">  iframe.<span class="property">src</span> = <span class="string">&quot;about:blank&quot;</span>;</span><br><span class="line">  iframe.<span class="property">id</span> = <span class="string">&quot;hiddenIframe&quot;</span>;</span><br><span class="line">  iframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">appendChild</span>(iframe);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 若離開視窗，則表示有安裝</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onBlur</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">  handler.<span class="title function_">remove</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;launch application successful&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> handler = <span class="title function_">registerEvent</span>(<span class="variable language_">window</span>, <span class="string">&quot;blur&quot;</span>, onBlur);</span><br><span class="line"></span><br><span class="line">iframe.<span class="property">contentWindow</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;jimmy://&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>實作的概念大概是這樣，其實已經有人寫好並且包成 library 可以直接引用，想要看完整的作法就請移駕到 <a href="https://github.com/vireshshah/custom-protocol-check">Custom Protocol Check in Browser</a> 。</p><p>這個作法也適用於手機上，判斷若沒有安裝的話就提示安裝 app 這樣的概念，之前想要用的時候沒查對方向，變成是用手機開啟都會提示安裝 app ，但這樣其實蠻干擾使用者的，透過這樣的機制，能夠對使用者更加友善。</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>透過visual studio建立安裝檔案</title>
      <link href="/2021/11/06/vs-installer-project/"/>
      <url>/2021/11/06/vs-installer-project/</url>
      
        <content type="html"><![CDATA[<p>前一篇  <a href="/2021/10/11/browser-open-application/" title="如何在瀏覽器開啟應用程式">如何在瀏覽器開啟應用程式</a> 中講到開啟應用程式，接著要來講怎麼樣封裝應用程式在安裝檔內。</p><span id="more"></span><blockquote><p>本篇使用的VS版本為 2019 community 英文版 （會選用英文的原因是為了有錯誤訊息時比較好找）</p></blockquote><h1 id="封裝應用程式"><a href="#封裝應用程式" class="headerlink" title="封裝應用程式"></a>封裝應用程式</h1><h2 id="新增Installer專案"><a href="#新增Installer專案" class="headerlink" title="新增Installer專案"></a>新增Installer專案</h2><p>在VS 2019中預設是沒有這種的專案類型，必須要另外安裝，可以點擊 <a href="https://marketplace.visualstudio.com/items?itemName=VisualStudioClient.MicrosoftVisualStudio2017InstallerProjects">這個網址</a> 下載或是在 <code>Extension Manager</code> 搜尋 <code>Installer Project</code> </p><blockquote><p>記得要先關掉 vs 才會開始安裝</p></blockquote><p><img src="/2021/11/06/vs-installer-project/install-extension.png" alt="install-extension"></p><p>安裝重開方案後，要來新增專案，在專案範本中找到 <code>Setup Project</code> 並且建立</p><p><img src="/2021/11/06/vs-installer-project/add-installer-project.png" alt="add-installer-project"></p><blockquote><p>建立好後只要在專案點選編譯，就會有 install 的選項可以安裝測試了，接下來每一個步驟都會建議編譯後安裝確認效果</p></blockquote><h2 id="專案設定"><a href="#專案設定" class="headerlink" title="專案設定"></a>專案設定</h2><p>建立好專案以後，可以看到一個被開啟的畫面，裡面包含下面幾個項目</p><ul><li>Application Folder</li><li>User’s Desktop</li><li>User’s Programs</li></ul><p>首先要將原先的專案輸出結果放進來，點選 <code>Application Folder</code> 右鍵新增 <code>Project Output</code> </p><p><img src="/2021/11/06/vs-installer-project/add-project-output.png" alt="add-project-output"></p><p>接著來改一些基本的資料，在<strong>方案總管</strong>點選專案再開啟<strong>屬性視窗</strong></p><p><img src="/2021/11/06/vs-installer-project/project-properties.png" alt="project-properties"></p><blockquote><p>在設定 Setup Project 的過程中，建議可以把<strong>屬性視窗</strong> pin 起來，還蠻常會用到的</p></blockquote><h2 id="加上註冊碼"><a href="#加上註冊碼" class="headerlink" title="加上註冊碼"></a>加上註冊碼</h2><p>在專案點選右鍵找到 <code>Registry</code> ，開啟註冊碼的設定畫面</p><p><img src="/2021/11/06/vs-installer-project/view-menu.png" alt="view-menu"></p><p><img src="/2021/11/06/vs-installer-project/registry.png" alt="registry"></p><p>根據上一篇的作法，要在 <code>HKEY_CLASSES_ROOT</code> 底下建立，這邊我使用專案屬性中的 Manufacturer 作為 custom protocol。</p><ul><li>專案屬性可以使用 [] 來取得</li><li>預設的值，只要將名稱留空即可</li><li>command 的執行檔名需要寫死</li></ul><p><img src="/2021/11/06/vs-installer-project/registry-url-protocol.png" alt="registry-url-protocol"></p><blockquote><p>記得將刪除時移除註冊碼的部份啟用，這樣才不會有垃圾註冊碼在裡面</p></blockquote><h2 id="增加安裝步驟"><a href="#增加安裝步驟" class="headerlink" title="增加安裝步驟"></a>增加安裝步驟</h2><p>預設的安裝步驟其實很簡易，就是選安裝範圍、路徑，最後就是安裝。</p><p>在這邊我準備要新增一個步驟來輸入值，並且將資料寫入到 config 中。<br>從專案點選右鍵找到 <code>User Interface</code> 。</p><p><img src="/2021/11/06/vs-installer-project/user-interface.png" alt="user-interface"></p><p>在 Start 的區塊點右鍵 <strong>Add Dialog</strong> ，從清單中選擇一個項目來做為預計要新增的步驟，在這邊我選擇的是 <code>Textboxes(A)</code> 。</p><p><img src="/2021/11/06/vs-installer-project/user-interface-add-dialog.png" alt="user-interface-add-dialog"></p><p>就可以看到 Start 的區塊增加了一個 <code>Textboxes(A)</code> 在最後一個項目，可以用滑鼠拖拉改變順序到第三個步驟。</p><p><img src="/2021/11/06/vs-installer-project/user-interface-textbox.png" alt="user-interface-textbox"></p><p>接著打開 <strong>屬性視窗</strong> 來修改基本設定，可以看到可調整的程度很低，只有四個輸入框及畫面的標題這幾個項目而已，連位置什麼的都不能改變。（這邊就先不改任何設定）</p><p><img src="/2021/11/06/vs-installer-project/user-interface-textbox-properties.png" alt="user-interface-textbox-properties"></p><h2 id="使用-Custom-action-修改-exe-config"><a href="#使用-Custom-action-修改-exe-config" class="headerlink" title="使用 Custom action 修改 exe.config"></a>使用 Custom action 修改 exe.config</h2><p>前面所講到的都是透過介面的方式來操作，在這個專案中提供 Custom action 的功能，可以透過寫程式的方法來做更多的事情。</p><h3 id="設定-Custom-action"><a href="#設定-Custom-action" class="headerlink" title="設定 Custom action"></a>設定 Custom action</h3><p>同樣的在專案右鍵中找到 <code>Custom Actions</code> 並且開啟，並且在 <code>Install</code> 的地方點選右鍵 <code>Add Custom Action</code>，選擇前面在 <code>Application Folder</code> 中所建立的 Output 即可。</p><p><img src="/2021/11/06/vs-installer-project/custom-action.png" alt="custom-action"></p><p><img src="/2021/11/06/vs-installer-project/custom-action-add-output.png" alt="custom-action-add-output"></p><p>接著要把安裝步驟中輸入的值，可以讓後面的程式可以讀取，選到剛剛所加入的 Output 並開啟 <strong>屬性視窗</strong> ，將欄位的名稱用這樣的格式包裝 <code>value=[name]</code> 寫到 <code>CustomActionData</code> 中。</p><p><img src="/2021/11/06/vs-installer-project/custom-action-properties.png" alt="custom-action-properties"></p><h3 id="新增-Installer-Class"><a href="#新增-Installer-Class" class="headerlink" title="新增 Installer Class"></a>新增 Installer Class</h3><p>設定完畢以後，若直接這樣安裝，會發現報錯，因為缺少了一個程式的檔案，接著回到來源的專案新增檔案 <code>Installer Class</code> 。</p><p><img src="/2021/11/06/vs-installer-project/custom-action-add-install.png" alt="custom-action-add-install"></p><p>開啟剛新增的檔案，可以看到裡面的程式會是這樣的。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">RunInstaller(true)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Installer1</span> : <span class="title">System.Configuration.Install.Installer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Installer1</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>剛剛是在 <code>Installer</code> 設定輸出，在這邊同樣要對應的寫方法，可以透過 override 的方式來增加方法。相關的作法可以參考 <a href="https://docs.microsoft.com/zh-tw/dotnet/api/system.configuration.install.installer?view=netframework-4.8">MSDN 的文件</a>。</p><h3 id="修改config"><a href="#修改config" class="headerlink" title="修改config"></a>修改config</h3><p>先透過 <code>Context.Parameters</code> 的方法來取得剛剛所設定在 <code>CustomActionData</code> 中的值，接著使用 <code>ExeConfigurationFileMap</code> 取得 config 並且回寫。</p><blockquote><p>System.Diagnostics.Debugger.Launch() 可以用來在安裝過程中偵錯，是一個好用的技巧。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以避免寫入config檔的時候失敗</span></span><br><span class="line"><span class="comment">// [System.Security.Permissions.SecurityPermission(System.Security.Permissions.SecurityAction.Demand)]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Install</span>(<span class="params">IDictionary stateSaver</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">base</span>.Install(stateSaver);</span><br><span class="line">    <span class="comment">// 偵錯時可以取消註解使用</span></span><br><span class="line">    <span class="comment">//System.Diagnostics.Debugger.Launch();</span></span><br><span class="line">    <span class="keyword">var</span> value1 = Context.Parameters[<span class="string">&quot;value1&quot;</span>];</span><br><span class="line">    <span class="comment">//尋找安裝路徑中的App.config檔</span></span><br><span class="line">    <span class="keyword">var</span> exeConfigurationFileMap = <span class="keyword">new</span> ExeConfigurationFileMap();</span><br><span class="line"></span><br><span class="line">    exeConfigurationFileMap.ExeConfigFilename = Context.Parameters[<span class="string">&quot;assemblypath&quot;</span>] + <span class="string">&quot;.config&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> config = ConfigurationManager.OpenMappedExeConfiguration(exeConfigurationFileMap, ConfigurationUserLevel.None);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//將參數值寫回App.config檔</span></span><br><span class="line">    config.AppSettings.Seetings[<span class="string">&quot;Value1&quot;</span>].Value = value1;</span><br><span class="line"></span><br><span class="line">    config.Save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用數位簽章增加信任度"><a href="#使用數位簽章增加信任度" class="headerlink" title="使用數位簽章增加信任度"></a>使用數位簽章增加信任度</h1><p>剛製作完的 msi 檔案，直接放在網站上讓人下載，會被瀏覽器認為是不信任的檔案，使用者必須經過重重關卡才能真正拿到安裝檔<br>瀏覽器怕使用者誤下載一個執行檔，導致電腦出問題，因此會在下載後檢查檔案是否包含合法的數位簽章。</p><p><img src="/2021/11/06/vs-installer-project/download-msi-without-code-sign.png" alt="download-msi-without-code-sign"></p><p>為了避免這樣的問題，必須要加上數位簽章 (code sign)，讓瀏覽器認可。因為這邊是公司其他部門的同事處理，就直接讓大家看一下有數位簽章會是什麼樣子。</p><p><img src="/2021/11/06/vs-installer-project/msi-with-code-sign.png" alt="msi-with-code-sign"></p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>微軟提供的這個專案很陽春，很適合一些簡單需求的人使用，若有要比較客製化的步驟，則不建議使用。也是透過這次的實作才知道，原來瀏覽器會檢查簽章的合法與否，來避免使用者暴露於風險之中。</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>[<a href="https://dotblogs.com.tw/ouch1978/2011/08/11/visualstudio-setup-project-customize-app-config">Visual Studio] 應用程式佈署大作戰 - 為Setup Project加入自訂的對話視窗以修改App.config的內容 | Ouch@點部落 - 點部落 (dotblogs.com.tw)</a></li><li><a href="https://blog.miniasp.com/post/2015/11/23/How-Class-library-read-config-from-webconfig-or-appconfig-file">如何透過 C# 類別庫讀取 Web.config 或 App.config 的參數設定值 | The Will Will Web (miniasp.com)</a></li><li><a href="https://blog.miniasp.com/post/2009/04/06/How-to-pass-property-from-command-line-to-Custom-Actions">如何將自訂參數傳入 Installer 類別的 Install 方法 ( Part 2 ) | The Will Will Web (miniasp.com)</a></li><li><a href="https://limitx5.blogspot.com/2017/05/windows-exe.html">程式學習筆記: 幫自己的exe檔建立自己的數位簽章 (limitx5.blogspot.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> installer </tag>
            
            <tag> VS2019 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在瀏覽器開啟應用程式</title>
      <link href="/2021/10/11/browser-open-application/"/>
      <url>/2021/10/11/browser-open-application/</url>
      
        <content type="html"><![CDATA[<p>現在越來越多的服務會直接用網頁來開啟應用程式（例如 zoom&#x2F;teams），不管是在手機或是電腦中，這篇主要就是要來分享在 windows 中如何做到這件事情。</p><span id="more"></span><blockquote><p>這會是一個系列文，將會介紹如何做安裝程式並且在頁面中自動偵測是否能夠開啟應用程式</p></blockquote><p>我們都知道一般上網的時候都是採用 http 的協定，來瀏覽網頁，如果說你曾經有用過 ftp 這樣的服務，應該記得瀏覽器是能夠直接連 ftp 伺服器。</p><blockquote><p><a href="http://www.google.com/">http://www.google.com</a><br><a href="ftp://localhost/">ftp://localhost</a></p></blockquote><p>在前面的 http &#x2F; ftp 都是屬於一種 URL 協定，那要開啟應用程式，我們也能夠制定這樣的協定，讓系統認識並且啟動我們所需要的指令或程式。</p><h1 id="註冊應用程式"><a href="#註冊應用程式" class="headerlink" title="註冊應用程式"></a>註冊應用程式</h1><p>在 windows 中，<strong>登陸編輯程式</strong> 是一個很強大的功能，我們要讓系統認識新的 URL 協定，就必須透過他來進行。</p><p>首先，我們來參考一下 zoom&#x2F;teams 的作法，開啟 <strong>登陸編輯程式</strong> 後到 <code>HKEY_CLASSES_ROOT</code> 底下，找到 <code>zoommtg</code> 或者 <code>ms-teams</code> 就可以看到像下圖<br><img src="/2021/10/11/browser-open-application/teams.jpg" alt="teasm"></p><p>嘗試匯出成檔案，來看一下內容有些什麼</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Windows</span> <span class="string">Registry</span> <span class="string">Editor</span> <span class="string">Version</span> <span class="number">5.00</span></span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\ms-teams</span>]</span><br><span class="line"><span class="string">&quot;URL Protocol&quot;</span><span class="string">=&quot;&quot;</span></span><br><span class="line"><span class="string">@=&quot;URL:ms-teams&quot;</span></span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\ms-teams\shell</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\ms-teams\shell\open</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\ms-teams\shell\open\command</span>]</span><br><span class="line"><span class="string">@=&quot;\&quot;C:\\Users\\Jimmy\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe\&quot;</span> <span class="string">\&quot;%1\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>最上面的那層機碼就是協定名稱，必須要跟裡面的 URL 相同，並且指定為 URL Protocol，並在 command 指定要啟動的應用程式。<br>來試著在瀏覽器中輸入 <code>ms-teams:\\</code> ，可以看到提示是否開啟 Microsoft Teams。</p><p><img src="/2021/10/11/browser-open-application/launch-teams.jpg" alt="launch teams"></p><p>透過上面的範例就可以知道，如何產生一個新的協定 <code>jimmy-test</code>，接著我們來試著建立一個新的協定，並且開啟 vscode 這個應用程式。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Windows</span> <span class="string">Registry</span> <span class="string">Editor</span> <span class="string">Version</span> <span class="number">5.00</span></span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\jimmy-test</span>]</span><br><span class="line"><span class="string">&quot;URL Protocol&quot;</span><span class="string">=&quot;&quot;</span></span><br><span class="line"><span class="string">@=&quot;URL:jimmy-test&quot;</span></span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\jimmy-test\shell</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\jimmy-test\shell\open</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">HKEY_CLASSES_ROOT\jimmy-test\shell\open\command</span>]</span><br><span class="line"><span class="string">@=&quot;\&quot;D:\\Programes\\Microsoft</span> <span class="string">VS</span> <span class="string">Code\\Code.exe\&quot;</span> <span class="string">\&quot;%1\&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>儲存成 reg 檔以後執行，並且在瀏覽器中輸入 <code>jimmy-test://</code> 就可以看到開啟 vscode 的提示，是不是很簡單呢。</p><blockquote><p>%1 的值會等於瀏覽器中輸入的值，例如 <code>jimmy-test://123</code>，在你的應用程式中，就必須要用這樣的網址做解析</p></blockquote><blockquote><p>如果是在手機的 app ，則是在開發時，就要對外宣告有這樣的協定可以使用，ios&#x2F;android都有支援，在瀏覽器端作法則是不變</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://support.shotgunsoftware.com/hc/en-us/articles/219031308-Launching-applications-using-custom-browser-protocols">Launching applications using custom browser protocols – Shotgun Support (shotgunsoftware.com)</a></li><li><a href="https://blog.poychang.net/registering-and-open-an-app-with-custom-uri-scheme/">使用 URL 開啟 Windows 應用程式</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Frontend </tag>
            
            <tag> browser </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Design Pattern] facade(外觀) 和 interpreter(直繹器) 以及 mediator(協調者)</title>
      <link href="/2021/08/06/design-pattern-facade-mediator-interpreter/"/>
      <url>/2021/08/06/design-pattern-facade-mediator-interpreter/</url>
      
        <content type="html"><![CDATA[<p>繼上篇  <a href="/2017/08/29/design-pattern-observer-decorator/" title="[Design Pattern] Observer(觀察者)、Decoractor(裝飾器)">[Design Pattern] Observer(觀察者)、Decoractor(裝飾器)</a>，我們接著繼續看其他的模式</p><blockquote><p>迷之音:也隔太久了吧!!!</p></blockquote><ul><li>Facade 外觀</li><li>Mediator 協調者</li><li>Interpreter 直譯器</li></ul><span id="more"></span><h1 id="Facade-外觀"><a href="#Facade-外觀" class="headerlink" title="Facade (外觀)"></a>Facade (外觀)</h1><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>這個模式重點是封裝，只讓使用者看到外觀(表層)，這件事情其實大家都很常在做，尤其是當某個事件一定要執行固定邏輯時，那這樣我們就會想要把那些邏輯集中起來，讓外面呼叫端可以固定行為。</p><h2 id="情境"><a href="#情境" class="headerlink" title="情境"></a>情境</h2><p>那用一點現實的例子來看，用便當商店買東西來做說明，你可能會買咖啡&#x2F;便當或是其他東西，不管哪一種的行為都是只有對應店員，剩下的煮咖啡&#x2F;加熱，都會由店員來處理。</p><h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><script src="//gist.github.com/43901411a5164db71ace1d75d2d10cef.js?file=facade.cs"></script><blockquote><p>❯  dotnet run<br>—買餅乾—<br>結帳囉<br>—買咖啡—<br>結帳囉<br>咖啡好了<br>—買便當—<br>結帳囉<br>加熱完成</p></blockquote><h1 id="Mediator-協調者"><a href="#Mediator-協調者" class="headerlink" title="Mediator (協調者)"></a>Mediator (協調者)</h1><h2 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h2><p>將原本互相交錯的溝通，向上抽一層，統一由第三方來轉接收並且轉交。</p><h2 id="情境-1"><a href="#情境-1" class="headerlink" title="情境"></a>情境</h2><p>以現實的世界來看，其實工作中就很多這樣的狀況，工程師、設計師、行銷，老闆除了要跟這些人說明他要的是什麼，同時也要接收他們的狀況回報，並且這些人彼此間也需要互相更新狀態。<br>對於老闆來說，不需要一直收到那麼多的訊息，這時候我們會獨立一個角色叫做 <strong>PM</strong> ，由這個人來負責所有的資訊，彼此間也不用丟出各種訊息給不必要的人，統一由新的角色來做處理，對於老闆來說，也只要叫PM回報狀況就好。</p><h2 id="實作-1"><a href="#實作-1" class="headerlink" title="實作"></a>實作</h2><script src="//gist.github.com/43901411a5164db71ace1d75d2d10cef.js?file=mediator.cs"></script><blockquote><p>❯  dotnet run<br>designer receive login completed from Engineer<br>marketing receive login completed from Engineer<br>engineer receive home page mockup ready from Designer<br>marketing receive home page mockup ready from Designer</p></blockquote><h1 id="Interpreter-直譯器"><a href="#Interpreter-直譯器" class="headerlink" title="Interpreter (直譯器)"></a>Interpreter (直譯器)</h1><h2 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h2><p>偶爾在系統中，會需要一些簡單的文字解析，這時候可以使用這個設計模式來輔助我們，讓後面要擴充的時候更為容易。<br>但效能不是第一考量，因此有效能的需求就應該要重新思考是否適用。</p><h2 id="情境-2"><a href="#情境-2" class="headerlink" title="情境"></a>情境</h2><p>有一組字串，裡面的資料可能要轉換成中文或是英文</p><h2 id="實作-2"><a href="#實作-2" class="headerlink" title="實作"></a>實作</h2><script src="//gist.github.com/43901411a5164db71ace1d75d2d10cef.js?file=interpreter.cs"></script><blockquote><p>❯  dotnet run<br>二零二一 to 2021<br>2021 to 二零二一</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Blazor] 客製化元件</title>
      <link href="/2021/07/03/blazor-customize-component/"/>
      <url>/2021/07/03/blazor-customize-component/</url>
      
        <content type="html"><![CDATA[<p>不管是哪一個前端的框架或套件，寫一個專屬於自己專案的元件，是很基本的行為，今天要來分享的是在 Blazor 中建立元件的一些小撇步。</p><span id="more"></span><h1 id="two-way-binding-雙向綁定"><a href="#two-way-binding-雙向綁定" class="headerlink" title="two-way binding (雙向綁定)"></a>two-way binding (雙向綁定)</h1><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>Blazor 是一個標榜可以做到雙向綁定的一個前端框架，先來看看最基本的範例，使用 <code>bind</code> 這個前綴就可以做到雙向綁定，等於是把 <code>value</code> 以及 <code>onchange</code> 做整合。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;input @bind=&quot;data&quot; /&gt;</span><br><span class="line">&lt;input value=&quot;@data&quot; @onchange=&quot;@((ChangeEventArgs __e) =&gt; data = __e.Value.ToString())&quot; /&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">  string data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>透過上面的範例，可以發現到這兩個行為是相同的，從這邊可以理解到所謂的雙向綁定，也就是將做到輸入以及資料的輸出兩個行為做結合。</p><h2 id="元件雙向綁定"><a href="#元件雙向綁定" class="headerlink" title="元件雙向綁定"></a>元件雙向綁定</h2><p>根據上面的行為，我們要來嘗試所謂的雙向綁定，在 blazor 中有一個規則，只要事件的名稱結尾是 <strong>Changed</strong> 就可以搭配 bind 做雙向綁定。</p><p>底下我們先寫一個元件來測試雙向綁定是否正確，元件的名稱就直接叫做 <strong>Jimmy.razor</strong>，並且公開一個屬性叫做 <code>Value</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @onclick=&quot;clickChange&quot;&gt;change value&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    [Parameter] public string Value &#123; get; set; &#125;</span><br><span class="line">    [Parameter] public EventCallback&lt;string&gt; ValueChanged &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">    void clickChange()</span><br><span class="line">    &#123;</span><br><span class="line">        ValueChanged.InvokeAsync(&quot;jimmy&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我們就在另一個元件中使用剛剛所制定的 <code>Jimmy</code> 這個元件，並且將資料輸出在畫面上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/&quot;</span><br><span class="line"></span><br><span class="line">&lt;Jimmy @bind-Value=&quot;data&quot; /&gt;</span><br><span class="line">&lt;span&gt;hi @data&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">  string data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行以後應該可以看到像下面的結果，雙向綁定的行為是成功的。<br><img src="/2021/07/03/blazor-customize-component/two-way-binding.gif" alt="two-way-binding"></p><h2 id="多層雙向綁定"><a href="#多層雙向綁定" class="headerlink" title="多層雙向綁定"></a>多層雙向綁定</h2><p>接著我們要寫一個元件叫做 <strong>TextField.razor</strong>，裡面會包含 label 以及 input，並且希望能夠直接將 input 的資料做雙向綁定。</p><p>如果只照著前面的做法來做，會遇到一個問題，input 本身有雙向綁定，會需要一個屬性來承接，但又要能直接跟開放出去的屬性作連接，這時可以使用一個新的屬性來做關聯。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;label&gt;</span><br><span class="line">    @Text</span><br><span class="line">    &lt;input @bind=&quot;Data&quot; /&gt;</span><br><span class="line">&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    [Parameter] public string Text &#123; get; set; &#125;</span><br><span class="line">    [Parameter] public string Value &#123; get; set; &#125;</span><br><span class="line">    [Parameter] public EventCallback&lt;string&gt; ValueChanged &#123; get; set; &#125;</span><br><span class="line">    string Data &#123;</span><br><span class="line">    get =&gt; Value;</span><br><span class="line">    set =&gt; ValueChanged.InvokeSync(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="參數"><a href="#參數" class="headerlink" title="參數"></a>參數</h1><h2 id="未定義參數"><a href="#未定義參數" class="headerlink" title="未定義參數"></a>未定義參數</h2><p>如果是很明確所要開放的參數，通常我們會直接定義屬性，但 html 原生的屬性，就不會想要用這樣的方式一個一個去做開放，我們可以將 <strong>ParameterAttribute</strong> 的屬性 <code>CaptureUnmatchedValues</code> 設定為 true，就可以拿到剩下未定義但外面有傳的參數。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div @attributes=&quot;Attributes&quot; id=&quot;test&quot; /&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    [Parameter(CaptureUnmatchedValues = true)]</span><br><span class="line">public IReadOnlyDictionary&lt;string, object&gt; Attributes &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextField</span> <span class="attr">id</span>=<span class="string">&quot;jimmy&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>這邊可以看到輸出的 id 會是 <em>test</em> 而不是 <em>jimmy</em> ，要特別注意的是定義的順序，會影響到輸出的結果，如果希望以外面定義的為主，那就要把 <code>@attributes</code> 放在最後面。</p><h2 id="重新組合-class"><a href="#重新組合-class" class="headerlink" title="重新組合 class"></a>重新組合 class</h2><p>元件通常會有自己的樣式，也會提供給外面覆寫 class，我們可以透過上一個方法所定義的屬性，來取得外面所定義的 class。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;@GetClass()&quot; /&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    [Parameter(CaptureUnmatchedValues = true)]</span><br><span class="line">public IReadOnlyDictionary&lt;string, object&gt; Attributes &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">string GetClass()</span><br><span class="line">&#123;</span><br><span class="line">var baseClass = &quot;d-flex flex-column&quot;;</span><br><span class="line">if (Attributes != null &amp;&amp; Attributes.TryGetValue(&quot;class&quot;, out var @class) &amp;&amp; !string.IsNullOrEmpty(Convert.ToString(@class)))</span><br><span class="line">&#123;</span><br><span class="line">return $&quot;&#123;baseClass&#125; &#123;@class&#125;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return baseClass;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用樣板"><a href="#使用樣板" class="headerlink" title="使用樣板"></a>使用樣板</h1><p>在寫元件時，為了要開放給使用者決定部分區的內容，我們可以透過開放樣板屬性的方式來達成， <strong>RenderFragment</strong> 這個類別可以來承接 html 的內容。</p><h2 id="使用預設名稱"><a href="#使用預設名稱" class="headerlink" title="使用預設名稱"></a>使用預設名稱</h2><p>只有屬性名稱叫做 <code>ChildContent</code> ，使用端才能省略不用屬性名稱包住內容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- JimmyTemplate.razor --&gt;</span><br><span class="line">&lt;div class=&quot;button-wrapper&quot;&gt;</span><br><span class="line">@ChildContent</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">[Parameter] public RenderFragment ChildContent &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">JimmyTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>confirm<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>cancel<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">JimmyTemplate</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="非預設名稱"><a href="#非預設名稱" class="headerlink" title="非預設名稱"></a>非預設名稱</h2><p>不管有幾個樣板，只要屬性名稱不叫 <code>ChildContent</code> ，使用端都要使用屬性名稱包住。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- JimmyTemplate.razor --&gt;</span><br><span class="line">&lt;div class=&quot;button-wrapper&quot;&gt;</span><br><span class="line">@CustomWrapper</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">[Parameter] public RenderFragment CustomWrapper &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">JimmyTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CustomWrapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>confirm<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>cancel<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CustomWrapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">JimmyTemplate</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components/?view=aspnetcore-5.0">ASP.NET Core Razor components | Microsoft Docs</a></li><li><a href="https://github.com/radzenhq/radzen-blazor">radzenhq&#x2F;radzen-blazor: The home of the Radzen Blazor components. (github.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在blazor中使用JavaScript</title>
      <link href="/2021/06/27/blazor-interoperability-js/"/>
      <url>/2021/06/27/blazor-interoperability-js/</url>
      
        <content type="html"><![CDATA[<p>最近都在使用一個很新的前端框架，叫做 <a href="https://docs.microsoft.com/zh-tw/aspnet/core/blazor/?view=aspnetcore-5.0">Blazor</a> ，是由微軟所推出給 dotnet 的開發人員所用，優點是可以使用一個語言打天下(迷之音: 真的能嗎?)，但現在的 Blazor 還太年輕，對應的東西都還沒那麼齊全，JavaScript 反而已經擁有很多套件&#x2F;方法可以使用，今天就一起來看看怎麼將兩個結合一起使用。</p><span id="more"></span><blockquote><p><strong>環境</strong><br>dotnet core 5<br>blazor webassembly</p></blockquote><h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>首先，先來介紹一點基本的應用，如何在 Blazor 呼叫 JS。先準備好一個 <strong>index.js</strong> 的檔案，並且在 html 中載入。接下來的 js 範例都會放在這個檔案中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./scripts/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="呼叫方法"><a href="#呼叫方法" class="headerlink" title="呼叫方法"></a>呼叫方法</h2><p>Blazor 是一個以 dotnet 為基底的框架，因此沒有辦法直接呼叫 js，要使用 <a href="https://docs.microsoft.com/zh-tw/dotnet/api/microsoft.jsinterop.ijsruntime?view=dotnet-plat-ext-6.0">IJSRuntime</a> 這個介面，裡面提供的 <code>InvokeAsync</code> 或是 <code>InvokeVoidAsync</code> 兩個方法。<br>然後有一點要特別注意，不管是哪一個方法都只能呼叫 <code>function</code> ，因此要把需要執行的指令包裝過，先來宣告一個 function 叫做 <code>HelloWorld</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">HelloWorld</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著在 Blazor 使用點擊按鈕來呼叫js。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/sample&quot;</span><br><span class="line">@inject IJSRuntime JS</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">onclick</span>=<span class="string">&quot;clickConsole&quot;</span>&gt;</span> console <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">async Task clickConsole()</span><br><span class="line">&#123;</span><br><span class="line">await JS.InvokeVoidAysnc(&quot;HelloWorld&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="傳遞參數"><a href="#傳遞參數" class="headerlink" title="傳遞參數"></a>傳遞參數</h2><p>通常我們會希望把資料丟給 js 或是從 js 拿到一些回傳值，先來看看怎麼把資料傳給 js。<br>在 <code>InvokeVoidAsync</code> 的第二個參數開始，就是傳給 js function 的所有參數。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">HiName</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hi! <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">clickConsole</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">await</span> JS.InvokeVoidAysnc(<span class="string">&quot;HiName&quot;</span>, <span class="string">&quot;jimmy&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="接受回傳值"><a href="#接受回傳值" class="headerlink" title="接受回傳值"></a>接受回傳值</h2><p>那如果說，我們要拿到 js 的回傳值，就要改用 <code>InvokeAsync</code> 這個方法才能接收到。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getElementHeight</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> elm = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">`#<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> elm.<span class="property">offsetHeight</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">clickConsole</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> height = <span class="keyword">await</span> JS.InvokeAysnc&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;getElementHeight&quot;</span>, <span class="string">&quot;block1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="動態載入"><a href="#動態載入" class="headerlink" title="動態載入"></a>動態載入</h1><p>執行到某個頁面的時候才載入一些 js 的檔案，減少第一次不必要的下載，對於前端來說是蠻常見的事情，在 blazor 中當然也有提供這樣的方法。</p><p>這邊準備另一個檔案叫做 <strong>module.js</strong> ，然後將前面的 <code>HelloWorld</code> 放進去，來測試看看。</p><h2 id="嘗試"><a href="#嘗試" class="headerlink" title="嘗試"></a>嘗試</h2><p>在 blazor 這邊的做法其實一樣，沒有其他的方法可以使用，但參數要稍微改一下，第一個參數使用 <code>import</code> ，第二個參數給<code>路徑</code>，然後回傳的值就會是整個 module 的物件，。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">clickConsole</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> jsmodule = <span class="keyword">await</span> JS.InvokeAysnc&lt;IJSObjectReference&gt;(<span class="string">&quot;import&quot;</span>, <span class="string">&quot;./scripts/module.js&quot;</span>);</span><br><span class="line">    jsmodule.InvokeVoidAysnc(<span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="寫法調整"><a href="#寫法調整" class="headerlink" title="寫法調整"></a>寫法調整</h2><p>如果你按照這樣寫，應該會得到錯誤，找不到 <code>HelloWorld</code> 這個方法。<br>原因是使用 module 的作法，整個就會是封閉的，外面如果要調用，就必須要加上 <strong>export</strong>。</p><blockquote><p>如果對於 module 的寫法不太熟悉，可以參考一下 MDN 的文件，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript modules</a></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">HelloWorld</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="應用分享"><a href="#應用分享" class="headerlink" title="應用分享"></a>應用分享</h1><p>最後來分享幾個自己在開發上會使用到的技巧&#x2F;應用。</p><h2 id="傳入-blazor-自己"><a href="#傳入-blazor-自己" class="headerlink" title="傳入 blazor 自己"></a>傳入 blazor 自己</h2><p>在使用 chart 套件的時候，很常會有互動的行為，那就會需要從套件中來呼叫 blazor 的方法，官方有給出幾個做法，這邊我只介紹其中之一，個人覺得最乾淨的。<br>產生一個該類別的物件，再傳遞給 js 來作為回呼的物件。</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">clickDraw</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> objRef = DotNetObjectReference.Create(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">var</span> height = <span class="keyword">await</span> JS.InvokeAysnc&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;DrawChart&quot;</span>, objRef);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">JSInvokable</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DrawChart</span>(<span class="params">dotnetHelper</span>)&#123;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Chart</span>(<span class="string">&#x27;#chart&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">on_click</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">dotnetHelper.<span class="title function_">invokeMethodAsync</span>(<span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="回傳的物件型態"><a href="#回傳的物件型態" class="headerlink" title="回傳的物件型態"></a>回傳的物件型態</h2><p>從 js 的回傳物件中，如果不是基礎類別，也是可以透過類別來轉型，但這樣的物件再次丟回給 js 時，會導致無法正常找到一些 property，這時候可以使用 <strong>IJSObjectReference</strong> 這個型別。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DrawChart</span>(<span class="params">dotnetHelper</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Chart</span>(<span class="string">&#x27;#chart&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">on_click</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">dotnetHelper.<span class="title function_">invokeMethodAsync</span>(<span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">clickDraw</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> objRef = DotNetObjectReference.Create(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">var</span> chartObj = <span class="keyword">await</span> JS.InvokeAysnc&lt;IJSObjectReference&gt;(<span class="string">&quot;DrawChart&quot;</span>, objRef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="動態載入的動態載入"><a href="#動態載入的動態載入" class="headerlink" title="動態載入的動態載入"></a>動態載入的動態載入</h2><p>在檔案載入的時候，希望能夠直接初始化做一些事情，例如引入第三方套件的 js&#x2F;css，在這邊我們要使用 js 的一個技巧叫做 <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a> (立即執行函式)，並且使用 <code>createElement</code> 的作法來做到在檔案載入後才去引入對應的 js&#x2F;css。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">d, id</span>) &#123;</span><br><span class="line">    <span class="comment">// not create script element again if existing</span></span><br><span class="line">    <span class="keyword">if</span> (d.<span class="title function_">getElementById</span>(id)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> headElm = d.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> linkElm = d.<span class="title function_">createElement</span>(<span class="string">&quot;link&quot;</span>);</span><br><span class="line">    linkElm.<span class="property">rel</span> = <span class="string">&#x27;stylesheet&#x27;</span>;</span><br><span class="line">    linkElm.<span class="property">type</span> = <span class="string">&#x27;text/css&#x27;</span>;</span><br><span class="line">    linkElm.<span class="property">href</span> = <span class="string">&#x27;js/frappe-gantt/dist/frappe-gantt.css&#x27;</span>;</span><br><span class="line">    headElm.<span class="title function_">appendChild</span>(linkElm);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> scriptElm = d.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">    scriptElm.<span class="property">id</span> = id;</span><br><span class="line">    scriptElm.<span class="property">src</span> = <span class="string">&#x27;js/frappe-gantt/dist/frappe-gantt.min.js&#x27;</span>;</span><br><span class="line">    headElm.<span class="title function_">appendChild</span>(scriptElm);</span><br><span class="line">&#125;(<span class="variable language_">document</span>, <span class="string">&#x27;gantt-script&#x27;</span>));</span><br></pre></td></tr></table></figure><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://docs.microsoft.com/zh-tw/aspnet/core/blazor/?view=aspnetcore-5.0">Blazor</a></li><li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/javascript-interoperability/call-javascript-from-dotnet?view=aspnetcore-5.0">Call JavaScript functions from .NET methods in ASP.NET Core Blazor | Microsoft Docs</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript modules</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Blazor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安裝 PowerShell7 及 Window Terminal 並套用 theme 美化</title>
      <link href="/2021/05/19/install-window-terminal-ps7-theme/"/>
      <url>/2021/05/19/install-window-terminal-ps7-theme/</url>
      
        <content type="html"><![CDATA[<p>最近再次投入了 window 平台的筆電，之前已經很習慣 mac 的 iTerm + oh-my-zsh 的功能，一直嘗試找有沒有類似的工具可以使用，很開心的找到了一個類似的工具，<a href="https://github.com/microsoft/terminal">Window Terminal</a> 搭配最新的 <a href="https://github.com/PowerShell/PowerShell">PowerShell 7</a> 套用 <a href="https://ohmyposh.dev/">oh-my-posh</a> （是不是很相似阿，作者有說是參考 oh-my-zsh）</p><span id="more"></span><h1 id="安裝-Window-Terminal-以及-PowerShell-7"><a href="#安裝-Window-Terminal-以及-PowerShell-7" class="headerlink" title="安裝 Window Terminal 以及 PowerShell 7"></a>安裝 Window Terminal 以及 PowerShell 7</h1><h2 id="PowerShell-7"><a href="#PowerShell-7" class="headerlink" title="PowerShell 7"></a>PowerShell 7</h2><p>PowerShell 7 或者是說 PowerShell Core，比原本 Window 10 內建的 PowerShell 5.1 相比，更加強大且跨平台。這套在安裝後會獨立存在，也就是說不會蓋掉原本的 PowerShell 5.1，也就是說會有兩套同時存在於電腦中。</p><blockquote><p>我是蠻懷疑，有多少 Linux 或是 Mac 的使用者會想要安裝這套XDDD</p></blockquote><p>現在微軟都有提供多種安裝方式，可以到 <a href="https://github.com/PowerShell/PowerShell">github</a> 看看，那個人是使用 <a href="https://www.microsoft.com/store/productId/9MZ1SNWT0N5D">Window Store</a> 直接下載安裝，安裝完以後可以在<strong>開始</strong>的選單中搜尋 <code>powershell</code> 就可以發現到有兩種不一樣的版本（不是x86的差異），一個叫做 <strong>Window PowerShell</strong> 也就是原生5.1的版本，另一個 <strong>PowerShell</strong> 就是剛安裝好的7這個版本。</p><p><img src="/2021/05/19/install-window-terminal-ps7-theme/search-powershell.png" alt="search powershell"></p><h2 id="Window-Terminal"><a href="#Window-Terminal" class="headerlink" title="Window Terminal"></a>Window Terminal</h2><p>為什麼有了 PowerShell 這樣的工具，還需要另外一套類似的工具呢？PowerShell 是一個強大的工具，但一次就是一個視窗，分散開來其實有時候要管理的時候不是非常方便，如果同時又開了 cmd 以及 ubnutu wsl 的話，那不就一堆視窗在那邊跑，在這種情況下就蠻適合使用 Window Terminal 這套工具的。</p><blockquote><p>好啦，最重要的原因是跟 mac 很像，所以選他就對了！</p></blockquote><p>一樣的微軟提供許多安裝方式，其中官方推薦的是 <a href="https://www.microsoft.com/store/productId/9N0DX20HK701">Window Store</a> 。</p><p><img src="/2021/05/19/install-window-terminal-ps7-theme/window-terminal-select.png" alt="window terminal select"></p><h1 id="套用-Theme"><a href="#套用-Theme" class="headerlink" title="套用 Theme"></a>套用 Theme</h1><h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><p>打開剛裝好的 <strong>Window Terminal</strong> 以及 <strong>PowerShell 7</strong>，接下來我們就要開始安裝 Theme 相關的套件，總共要安裝兩個套件，一個是 <a href="https://ohmyposh.dev/">oh-my-pos</a> 樣式的套件，另一個就是 <a href="https://github.com/dahlbyk/posh-git">posh-git</a> 是用來顯示 git 的狀態，安裝的指令如下。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span> <span class="literal">-Scope</span> CurrentUser</span><br><span class="line"><span class="built_in">Install-Module</span> posh<span class="literal">-git</span> <span class="literal">-Scope</span> CurrentUser</span><br></pre></td></tr></table></figure><p>接著就是要讓 PowerShell 在啟動的時候就能夠套用，需要去修改設定檔，可以透過 <code>$PROFILE</code> 這個指令來確認設定檔的位置。如果沒有設定檔，則建立一個並且使用 <strong>記事本</strong> 來開啟。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!(<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$PROFILE</span> )) &#123; <span class="built_in">New-Item</span> <span class="literal">-Type</span> File <span class="literal">-Path</span> <span class="variable">$PROFILE</span> <span class="literal">-Force</span> &#125;</span><br><span class="line">notepad <span class="variable">$PROFILE</span></span><br></pre></td></tr></table></figure><p>將以下的內容貼到記事本中，存檔以後，重開一個分頁即可看到套用 <code>Paradox</code> 這個樣式。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> posh<span class="literal">-git</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span></span><br><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span> Paradox</span><br></pre></td></tr></table></figure><h2 id="執行錯誤"><a href="#執行錯誤" class="headerlink" title="執行錯誤"></a>執行錯誤</h2><blockquote><p>若你重開分頁以後有套用成功，請跳過這個章節。</p></blockquote><p>若你開啟後看到後面的錯誤，<strong>「檔案無法載入，因為這個系統已停用指令碼執行」</strong>，也不用太過多的擔心，在預設的情況下，PowerShell 是禁止執行自訂的檔案，可以透過 <strong>管理原權限</strong> 來打開 PowerShell 並且執行以下指令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></table></figure><h2 id="套用樣式"><a href="#套用樣式" class="headerlink" title="套用樣式"></a>套用樣式</h2><p>oh-my-posh 提供蠻多的樣式可以做選擇，可以透過指令 <strong>Get-PoshThemes</strong> 或是 網站<a href="https://ohmyposh.dev/docs/themes">Themes | Oh my Posh</a> 來做參考，下圖是執行指令出來的部份結果。</p><p><img src="/2021/05/19/install-window-terminal-ps7-theme/posh-theme.png" alt="posh theme"></p><blockquote><p>如果發現有些內容顯示不出來，通常是字體的問題，可以改為官方使用的字體 <a href="https://www.nerdfonts.com/">Nerd Fonts</a></p></blockquote><p>如果預設的樣式還是不滿意的話，也可以自己客製化，做一些調整，讓自己開心工作上也會比較有動力！</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Export-PoshTheme</span> <span class="literal">-FilePath</span> C:\.oh<span class="literal">-my-posh</span>.omp.json</span><br></pre></td></tr></table></figure><p>重新開啟 <code>$PROFILE</code> 設定檔，並且將剛剛的第三行 <strong>Set-PoshPrompt</strong> 改成套用客製化的 json 檔案即可。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> posh<span class="literal">-git</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span></span><br><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span> C:\.oh<span class="literal">-my-posh</span>.omp.json</span><br></pre></td></tr></table></figure><p>最後分享一下我自己的設定檔，是參考了 <code>paradox</code> 以及 <code>jandedobbeleer</code> 所整理出來的樣式。</p><p><img src="/2021/05/19/install-window-terminal-ps7-theme/mytheme.png" alt="mytheme"></p><script src="//gist.github.com/7851a94d92f5a5f35d1c7685afe56d44.js?file=.mytheme.omp.json"></script><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://blog.poychang.net/setting-powershell-theme-with-oh-my-posh/">使用 oh-my-posh 美化 PowerShell 樣式 (poychang.net)</a></li><li><a href="https://ppundsh.github.io/posts/ad6e/">PowerShell 美化：oh my posh | Flymia 凡事用心之事 (ppundsh.github.io)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Powershell </tag>
            
            <tag> WindowTerminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular]透過輸入的方法動態載入模組</title>
      <link href="/2021/04/20/angular-dynamic-module-by-input/"/>
      <url>/2021/04/20/angular-dynamic-module-by-input/</url>
      
        <content type="html"><![CDATA[<p>在Angular中，除了先在Route定義好路徑並且載入模組以外，也能透過動態的方式去載入，能夠讓程式更加的靈活。今天想要試著用輸入的方法來做到動態載入模組，最後結果是失敗的，要來看看編譯後的結果，試著去理解原因。</p><span id="more"></span><p>動態載入模組可以參考以下的文章</p><ul><li><a href="https://wellwind.idv.tw/blog/2019/06/04/angular-8-dynamic-load-module/">[Angular 大師之路] Angular 8 之後動態載入模組的方法 (非延遲載入路由)</a></li><li><a href="https://blog.kevinyang.net/2017/11/08/manual-lazy-loading/">[Angular] 手動創造出 Lazy Loading 的效果</a></li></ul><h1 id="載入模組固定"><a href="#載入模組固定" class="headerlink" title="載入模組固定"></a>載入模組固定</h1><h2 id="編譯前"><a href="#編譯前" class="headerlink" title="編譯前"></a>編譯前</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onClickLazyModule</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">import</span>(<span class="string">&#x27;./lazy/lazy.module&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">loadedModule</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>, loadedModule);</span><br><span class="line">  &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="編譯後"><a href="#編譯後" class="headerlink" title="編譯後"></a>編譯後</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onModuleChange</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    __webpack_require__.<span class="title function_">e</span>(<span class="comment">/*! import() | lazy-lazy-module */</span> <span class="string">&quot;lazy-lazy-module&quot;</span>).<span class="title function_">then</span>(__webpack_require__.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="comment">/*! ./lazy/lazy.module */</span> <span class="string">&quot;g5p6&quot;</span>)).<span class="title function_">then</span>(<span class="function"><span class="params">loadedModule</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>, loadedModule);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="載入模組不固定"><a href="#載入模組不固定" class="headerlink" title="載入模組不固定"></a>載入模組不固定</h1><p>模組路徑透過輸入的方法載入</p><h2 id="編譯前-1"><a href="#編譯前-1" class="headerlink" title="編譯前"></a>編譯前</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onClickLazyModule</span>(<span class="params">pathModule</span>) &#123;</span><br><span class="line">  <span class="title function_">import</span>(pathModule).<span class="title function_">then</span>(<span class="function"><span class="params">loadedModule</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>, loadedModule);</span><br><span class="line">  &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="編譯後-1"><a href="#編譯後-1" class="headerlink" title="編譯後"></a>編譯後</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***/</span> <span class="string">&quot;+Huz&quot;</span>:</span><br><span class="line"><span class="comment">/*!***************************************!*\</span></span><br><span class="line"><span class="comment">  !*** ./src/app lazy namespace object ***!</span></span><br><span class="line"><span class="comment">  \***************************************/</span></span><br><span class="line"><span class="comment">/*! no static exports found */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">webpackEmptyAsyncContext</span>(<span class="params">req</span>) &#123;</span><br><span class="line"><span class="comment">// Here Promise.resolve().then() is used instead of new Promise() to prevent</span></span><br><span class="line"><span class="comment">// uncaught exception popping up in devtools</span></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> e = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cannot find module &#x27;&quot;</span> + req + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">e.<span class="property">code</span> = <span class="string">&#x27;MODULE_NOT_FOUND&#x27;</span>;</span><br><span class="line"><span class="keyword">throw</span> e;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">webpackEmptyAsyncContext.<span class="property">keys</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> []; &#125;;</span><br><span class="line">webpackEmptyAsyncContext.<span class="property">resolve</span> = webpackEmptyAsyncContext;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = webpackEmptyAsyncContext;</span><br><span class="line">webpackEmptyAsyncContext.<span class="property">id</span> = <span class="string">&quot;+Huz&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="title function_">onModuleChange</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    <span class="title function_">__webpack_require__</span>(<span class="string">&quot;+Huz&quot;</span>)(path).<span class="title function_">then</span>(<span class="function"><span class="params">loadedModule</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>, loadedModule);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="編譯警告"><a href="#編譯警告" class="headerlink" title="編譯警告"></a>編譯警告</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Warning: ./src/app/app.component.ts 14:8-20</span><br><span class="line">Critical dependency: the request of a dependency is an expression</span><br><span class="line">    at ImportContextDependency.getWarnings (/Work/test/node_modules/webpack/lib/dependencies/ContextDependency.js:40:18)</span><br><span class="line">    at Compilation.reportDependencyErrorsAndWarnings (/Work/test/node_modules/webpack/lib/Compilation.js:1454:24)</span><br><span class="line">    at /Work/test/node_modules/webpack/lib/Compilation.js:1258:10</span><br><span class="line">    at _next0 (eval at create (/Work/test/node_modules/tapable/lib/HookCodeFactory.js:33:10), &lt;anonymous&gt;:30:1)</span><br><span class="line">    at eval (eval at create (/Work/test/node_modules/tapable/lib/HookCodeFactory.js:33:10), &lt;anonymous&gt;:43:1)</span><br><span class="line">    at runMicrotasks (&lt;anonymous&gt;)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:97:5)</span><br><span class="line"> @ ./src/app/app.module.ts</span><br><span class="line"> @ ./src/main.ts</span><br><span class="line"> @ multi ./src/main.ts</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>從上面的結果來看，可以看到當使用 import 沒有給路徑的話，在編譯的時候就會直接給警告，並且輸出的結果永遠都是 <code>Cannot find module</code>。</p><p>要這麼動態的載入，在angular的編譯機制中，就會出現這樣的結果，也許要workaround才能做到，那這邊我就沒有深入去研究了，如果你有其他作法，歡迎留言給我。</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[IIS] Gitea 搭配 reverse proxy 的問題排解</title>
      <link href="/2021/04/19/gitea-iis-reverse-proxy-trouble-shooting/"/>
      <url>/2021/04/19/gitea-iis-reverse-proxy-trouble-shooting/</url>
      
        <content type="html"><![CDATA[<p>繼前一篇 <a href="/2021/04/09/iis-reverse-proxy-header/" title="[IIS] 修正 reverse proxy 的 host 問題">[IIS] 修正 reverse proxy 的 host 問題</a> 後，又持續的跟 IIS 奮鬥了一陣子，才讓 Gitea 搭配 reverse proxy 的運作是正確的！</p><span id="more"></span><h1 id="無法建立PR"><a href="#無法建立PR" class="headerlink" title="無法建立PR"></a>無法建立PR</h1><h2 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h2><p>一進去 repo 的畫面，直接點選 <code>建立合併請求</code> 會提示 <strong>404</strong> 的錯誤，這時候的 URL 如下</p><blockquote><p>git.com&#x2F;jimmy&#x2F;test&#x2F;compare&#x2F;master…master</p></blockquote><p>但這時候如果切換到其他 branch 再來建立 PR 的話，就可以正常顯示。</p><h2 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h2><p>IIS 會針對一些附檔名做一些處理，這邊要將 IIS 設定成忽略所有的副檔名，全部交給 Gitea server 做處理。在 web.config 的設定中加上以下的設定</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 將所有的副檔名都排除 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileExtensions</span> <span class="attr">allowUnlisted</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">clear</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fileExtensions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Push-認證失敗"><a href="#Push-認證失敗" class="headerlink" title="Push 認證失敗"></a>Push 認證失敗</h1><h2 id="問題描述-1"><a href="#問題描述-1" class="headerlink" title="問題描述"></a>問題描述</h2><p>可以使用 domain 做 clone&#x2F;fetch&#x2F;pull 等行為，但 push 的時候會一直跳錯誤 <strong>401 未授權</strong> 。但只要不使用 domain 馬上可以正常的使用，IIS 就是你的鍋阿！！</p><h2 id="解法-1"><a href="#解法-1" class="headerlink" title="解法"></a>解法</h2><blockquote><p>記得設定要將 <code>HTTP_X_ORIGINAL_ACCEPT_ENCODING</code> 及 <code>HTTP_ACCEPT_ENCODING</code> 加到<strong>伺服器變數</strong>中。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rules</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;ReverseProxyInboundRule1&quot;</span> <span class="attr">stopProcessing</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">&quot;(.*)&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditions</span> <span class="attr">logicalGrouping</span>=<span class="string">&quot;MatchAll&quot;</span> <span class="attr">trackAllCaptures</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">serverVariables</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;HTTP_X_ORIGINAL_ACCEPT_ENCODING&quot;</span> <span class="attr">value</span>=<span class="string">&quot;HTTP_ACCEPT_ENCODING&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;HTTP_ACCEPT_ENCODING&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">serverVariables</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">url</span>=<span class="string">&quot;http://localhost:3000&#123;UNENCODED_URL&#125;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;RestoreAcceptEncoding&quot;</span> <span class="attr">preCondition</span>=<span class="string">&quot;NeedsRestoringAcceptEncoding&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;HTTP_ACCEPT_ENCODING&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;^(.*)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;HTTP_X_ORIGINAL_ACCEPT_ENCODING&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">preConditions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">preCondition</span> <span class="attr">name</span>=<span class="string">&quot;NeedsRestoringAcceptEncoding&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;&#123;HTTP_X_ORIGINAL_ACCEPT_ENCODING&#125;&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;.+&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">preCondition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">preConditions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">outboundRules</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>IIS 的 reverse proxy 設定相對於 nginx 複雜，不過他們的功能定義上本身就不一樣，所以也不能單純的這樣比。要使用的話就有許多地方要先設定好來，不然會比較多的小問題。</p><p>另外我有找到一些網路上推薦的設定，但可能我沒有注意到那些問題，這邊附上完整的 web.config。</p><script src="//gist.github.com/bfd0837a9cd224426e334c793cf9ec53.js?file=web.config"></script><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><p>[<a href="https://exfast.me/2018/09/iis-gitlab-using-iis-reverse-proxy-to-add-gitlab-to-https/">IIS][GitLab] 利用 IIS Reverse Proxy 將 GitLab 加上 Https</a></p></li><li><p>[<a href="https://exfast.me/2018/12/iis-gitlab-reverse-proxy-small-problem/">IIS][GitLab] Reverse Proxy 後的小問題</a></p></li><li><p><a href="https://docs.gitea.io/en-us/reverse-proxies/#iis">Gitea document - reverse proxies</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> IIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[IIS] 修正 reverse proxy 的 host 問題</title>
      <link href="/2021/04/09/iis-reverse-proxy-header/"/>
      <url>/2021/04/09/iis-reverse-proxy-header/</url>
      
        <content type="html"><![CDATA[<p>使用 IIS 做 reverse proxy 時，如果網站需要 OAuth，會自動導去其他網站，但會發現這時候 host 沒有被切過去，導致整個 auth 失敗，來分享一下可以怎麼樣解決這個問題。</p><span id="more"></span><h1 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h1><p>先把問題描述的清楚一點，如果你的情況剛好跟我一樣，就可以參考參考。</p><p>在 window 的 server 上，架了兩個服務，要透過 IIS 設定 domain 對應到這兩個服務，使用 URL rewrite 這個模組中的反向代理 (reverse proxy) 設定。</p><blockquote><p>這邊就不介紹怎麼設定 reverse proxy，最下面會放相關連結可以參考。</p></blockquote><ul><li>git.com -&gt; 3000</li><li>ci.com -&gt; 8000</li></ul><p>當進入 ci 這個 domain 會先轉到 git 這邊做 OAuth 的認證，預期的流程如下</p><ol><li>在瀏覽器輸入 ci.com</li><li>轉導至 git.com&#x2F;login?redirect&#x3D;ci.company.com</li><li>帳號登入，導回 ci.com</li></ol><p>那問題出現在第二步，host 沒有轉過去，還保留在 ci 這個 domain ，除了 host 以外，其他路徑及參數都是正確。</p><blockquote><p>錯誤的 URL, ci.com&#x2F;login?redirect&#x3D;ci.com</p></blockquote><h1 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h1><p>將 ARR 中的 <strong>Reverse rewrite host in response headers</strong> 關閉即可。</p><p>在 IIS 的 root 找到 <code>Application Request Routing(ARR)</code></p><p><img src="/2021/04/09/iis-reverse-proxy-header/iis-home.png" alt="iis home"></p><p>在 ARR 的右側點選 <code>Server Proxy Setting</code></p><p><img src="/2021/04/09/iis-reverse-proxy-header/arr-home.png" alt="arr home"></p><p>找到 <code>Reverse rewrite host in response headers</code> 並且取消核選</p><p><img src="/2021/04/09/iis-reverse-proxy-header/arr-setting.png" alt="arr setting"></p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="/2017/09/02/reserve-proxy/" title="設定Reverse Proxy在Windows、Mac">設定Reverse Proxy在Windows、Mac</a></li><li><a href="https://blog.miniasp.com/post/2009/04/13/Using-ARR-to-implement-Reverse-Proxy">如何利用 IIS7 的 ARR 模組實做 Reverse Proxy 機制</a></li><li><a href="https://stackoverflow.com/questions/23508938/url-rewrite-keeps-original-host-location-when-reverse-proxy-301-redirects">URL Rewrite keeps original host Location when reverse proxy 301 redirects</a></li><li><a href="https://confluence.atlassian.com/kb/the-oauth-login-and-approve-has-the-wrong-url-when-using-iis-as-a-proxy-540082192.html">The OAuth Login and Approve has the wrong URL when using IIS as a proxy</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> IIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在本機使用Docker架Gitea和DroneCI</title>
      <link href="/2021/03/22/gitea-drone-docker/"/>
      <url>/2021/03/22/gitea-drone-docker/</url>
      
        <content type="html"><![CDATA[<p>當要選擇自架的 git 伺服器，Gitea 是蠻多公司的選擇，在這個講求效率的開發時代，必須要搭配一個 CI&#x2F;CD 的平台，讓我們可以更好更快的部屬，我選擇 Drone CI 作為平台，今天要來分享一下使用 docker-compose 建置在本機的步驟。</p><span id="more"></span><h1 id="Gitea"><a href="#Gitea" class="headerlink" title="Gitea"></a>Gitea</h1><p>跟著<a href="https://docs.gitea.io/en-us/install-with-docker/">官方的文件</a>試著把 Gitea 的服務建立起來，在這邊就只弄最簡單的SQLite，首先要建立一個 <code>docker-compose.yml</code> 的檔案，並且將內容貼上。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitea-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:1.13.3</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_UID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_GID=1000</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitea:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;222:22&quot;</span></span><br></pre></td></tr></table></figure><p>試著跑看看 <code>docker-compose up -d</code> ，成功的話就可以看到 <strong>done</strong> 的字樣。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">docker-compose up -d</span></span><br><span class="line">Creating network &quot;test_gitea&quot; with the default driver</span><br><span class="line">Creating gitea ... done</span><br></pre></td></tr></table></figure><p>再用瀏覽器打開 <code>localhost:3000</code> 看到以下畫面就沒問題了！</p><p><img src="/2021/03/22/gitea-drone-docker/gitea-install.png" alt="gitea install"></p><h1 id="Drone"><a href="#Drone" class="headerlink" title="Drone"></a>Drone</h1><p>Drone 可以跟很多平台做整合，這邊當然就是選擇前面已經架好的 Gitea 作為我們的目標 <a href="https://docs.drone.io/server/provider/gitea/">參考文件</a>。Drone 總共要起兩個服務，一個是主服務，另一個是 runner 專門執行 task 的。</p><h2 id="Gitea-OAuth"><a href="#Gitea-OAuth" class="headerlink" title="Gitea OAuth"></a>Gitea OAuth</h2><p>根據文件，第一步要在 Gitea 的設定中找到 <code>Applications</code> 這個頁籤，建立一個新的應用。名稱我們給他 <code>drone</code>，URI 的話預期是 <code>http://locahost:8000</code>。</p><blockquote><p>這邊要特別注意的是 <code>Redirect URI</code> 最後必須要帶上 <strong>&#x2F;login</strong>，不然會無法成功</p></blockquote><p><img src="/2021/03/22/gitea-drone-docker/gitea-create-oauth-application.png" alt="Gitea create oauth application"></p><p>按下建立以後就可以看到以下的畫面，這個畫面先留著不要馬上關掉，或者是把 <code>Client ID</code> 以及 <code>Client Secret</code> 存起來，等一下設定會用到。</p><p><img src="/2021/03/22/gitea-drone-docker/gitea-application-data.png" alt="gitea application"></p><h2 id="產生共用密碼"><a href="#產生共用密碼" class="headerlink" title="產生共用密碼"></a>產生共用密碼</h2><p>接著我們要產生一個共用密碼，給主服務和 runner 之間做認證使用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">openssl rand -hex 16</span></span><br><span class="line">81e04d83a6054b464f5c5b13365578fd</span><br></pre></td></tr></table></figure><h2 id="設定docker-compose"><a href="#設定docker-compose" class="headerlink" title="設定docker-compose"></a>設定docker-compose</h2><p>為了讓 container 之間能夠互相的溝通，加上前面的 gitea 已經使用 compose，這邊就繼續往下編輯，讓我們使用一個檔案來起多個服務。</p><p>將資料填入對應的欄位，並且儲存 <code>docker-compose.yml</code> 。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gitea-server:</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="attr">drone-server:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">drone/drone:1</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">drone-server</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8000</span><span class="string">:80</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./drone:/data</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitea-server</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_SERVER_HOST=localhost:8000</span> <span class="comment"># drone server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_SERVER_PROTO=http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RPC_SECRET=81e04d83a6054b464f5c5b13365578fd</span> <span class="comment">#共用密碼</span></span><br><span class="line">    <span class="comment"># Gitea</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_ID=cf9e05e8-53b0-447b-a8d7-86d7c882c64a</span> <span class="comment"># client id</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_SECRET=6nZ8EEJtk6lqI00Fdbf4A3F7_2-rSzxbQbikw-EnsvU=</span> <span class="comment">#client secret</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_SERVER=http://localhost:3000</span> <span class="comment"># gitea server</span></span><br></pre></td></tr></table></figure><p>執行跟剛剛一樣的指令 <code>docker-compose up -d</code> ，不需要先把 gitea 停掉，就可以啟動 drone。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker-compose up -d</span><br><span class="line">gitea is up-to-date</span><br><span class="line">Creating drone-server ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>好了！來用瀏覽器開啟 <code>localhost:8000</code> 這個服務，看到這個畫面表示成功啦！！</p><p><img src="/2021/03/22/gitea-drone-docker/drone-authorize.png" alt="drone authorize"></p><h2 id="錯誤"><a href="#錯誤" class="headerlink" title="錯誤"></a>錯誤</h2><p>auth 的按鈕按下去以後，會看到一個錯誤訊息。</p><blockquote><p>Login Failed. Post “<a href="http://localhost:3000/login/oauth/access_token&quot;">http://localhost:3000/login/oauth/access_token&quot;</a>: dial tcp 127.0.0.1:3000: connect: connection refused</p></blockquote><p>經過 google 大神說明，原來是 container 的網路都是獨立，所以不接受 127.0.0.1，要使用 192.168.0.x 或者是 domain 的方式。</p><h1 id="ngrok"><a href="#ngrok" class="headerlink" title="ngrok"></a>ngrok</h1><p>ngrok 是一個可以將本機的服務直接轉成對外的服務，很適合還在開發階段，但又要給其他人確認畫面之類的時候。因為剛剛的 drone 不能使用 localhost 作設定，因此我們可以先使用這個服務來做測試，確認整個設定都是正確。</p><h2 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h2><p>這邊我們要把預計使用到的 3000 以及 8000 兩個 port 都做監聽，ngrok 的指令一次只能起一個 port ，因此我們要透過 <code>ngrok.yml</code> 做設定一次起多個。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authtoken:</span> &#123;&#123;<span class="string">your</span> <span class="string">token</span>&#125;&#125;</span><br><span class="line"><span class="attr">tunnels:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="number">3000</span></span><br><span class="line">    <span class="attr">proto:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">drone:</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="number">8000</span></span><br><span class="line">    <span class="attr">proto:</span> <span class="string">http</span></span><br></pre></td></tr></table></figure><p>執行 <code>./ngrok start --all --config ngrok.yml</code>，應該可以看到底下的畫面。</p><p><img src="/2021/03/22/gitea-drone-docker/ngrok.png" alt="ngrok"></p><h2 id="修改-docker-compose-yml"><a href="#修改-docker-compose-yml" class="headerlink" title="修改 docker-compose.yml"></a>修改 docker-compose.yml</h2><p>將 ngrok 所產生的 domain 貼回去 <code>docker-compose.yml</code> 中，這邊只有兩個地方要調整</p><ul><li>DRONE_SERVER_HOST</li><li>DRONE_GITEA_SERVER</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">drone-server:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">drone/drone:1</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">drone-server</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8000</span><span class="string">:80</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./drone:/data</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitea-server</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_SERVER_HOST=b42812f5966a.ngrok.io</span> <span class="comment">#改用nrok的domain</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_SERVER_PROTO=http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RPC_SECRET=81e04d83a6054b464f5c5b13365578fd</span></span><br><span class="line">    <span class="comment"># Gitea</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_ID=cf9e05e8-53b0-447b-a8d7-86d7c882c64a</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_CLIENT_SECRET=6nZ8EEJtk6lqI00Fdbf4A3F7_2-rSzxbQbikw-EnsvU=</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_GITEA_SERVER=http://4fe6164979a9.ngrok.io</span> <span class="comment">#改用nrok的domain</span></span><br></pre></td></tr></table></figure><h2 id="修改-Application-的-redirect-URI"><a href="#修改-Application-的-redirect-URI" class="headerlink" title="修改 Application 的 redirect URI"></a>修改 Application 的 redirect URI</h2><p>重新啟動服務以後，一樣可以使用 localhost:3000 進去 gitea 的服務頁面，將前面設定好的 <code>Redirect URI</code> 修改為 ngrok 的 domain。</p><p>都修改好後，就可以重新進入 8000 的那個 domain，應該就可以成功進入到 drone 的首頁。</p><p><img src="/2021/03/22/gitea-drone-docker/drone-empty-home.png" alt="drone empty home"></p><h1 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h1><h2 id="drone-runner"><a href="#drone-runner" class="headerlink" title="drone runner"></a>drone runner</h2><p>前面有講到 drone 是分兩個服務，一個 server 另一個是 runner，但剛剛其實都沒有起這個服務，在測試之前，先將這個服務起起來！</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">drone-agent:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">drone/drone-runner-docker:1</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">drone-runner</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">drone-server</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RPC_HOST=b42812f5966a.ngrok.io</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RPC_PROTO=http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RPC_SECRET=81e04d83a6054b464f5c5b13365578fd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RUNNER_CAPACITY=2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DRONE_RUNNER_NAME=$&#123;HOSTNAME&#125;</span></span><br></pre></td></tr></table></figure><h2 id="push-一個-commit做測試"><a href="#push-一個-commit做測試" class="headerlink" title="push 一個 commit做測試"></a>push 一個 commit做測試</h2><p>萬事具備！先建立一個 repo 並且 push 檔案 <code>.drone.yml</code> 作為確認。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">pipeline</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">docker</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">default</span></span><br><span class="line">   </span><br><span class="line"><span class="attr">steps:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">alpine</span></span><br><span class="line">  <span class="attr">commands:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">hello</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">world</span></span><br></pre></td></tr></table></figure><p>可以看到一個 task 就跑起來了！但是，凡事都有個 but！在 clone 的時候竟然失敗了！！！</p><p><img src="/2021/03/22/gitea-drone-docker/drone-pull-fail.png" alt="drone pull fail"></p><h2 id="重新設定gitea"><a href="#重新設定gitea" class="headerlink" title="重新設定gitea"></a>重新設定gitea</h2><p>還記得一開始啟動 gitea 的時候，我們什麼都沒有改，直接就建立了，但後來我們使用了 ngrok 作為 domain，在 gitea 建立後這個 URI 就已經被固定，因此我們要在 <code>docker-compose.yml</code> 中加上 <code>ROOT_URL</code> ，並且將 gitea 的資料夾砍掉，重新啟動！</p><blockquote><p>這邊可以使用 <code>docker-compose down</code> 的指令先將服務都停止</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gitea-server:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">gitea/gitea:1.13.3</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">USER_UID=1000</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">USER_GID=1000</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ROOT_URL=http://4fe6164979a9.ngrok.io</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./gitea:/data</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;222:22&quot;</span></span><br></pre></td></tr></table></figure><p>在 install 的設定中找到 <code>Gitea Base URL</code> 這個欄位，並且確認 domain 是預期的 ngrok。</p><p><img src="/2021/03/22/gitea-drone-docker/gitea-base-url.png" alt="gitea base url"></p><p>接著按照前面的步驟，重新建立 application 等的動作，就可以看到 drone 成功的跑完啦！！</p><p><img src="/2021/03/22/gitea-drone-docker/drone-sucessful.png" alt="drone run successful"></p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這些服務在一開始設計的時候，就不是預期在本機，如果是在有 domain 的 server 上，這些問題都不會發生。</p><blockquote><p>很妙的是 drone 用 0.8 就可以使用 localhost，應該是後面他們有做過調整導致。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CI/CD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> CI/CD </tag>
            
            <tag> Gitea </tag>
            
            <tag> Drone </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[nginx] 設定reverse proxy當location使用regex</title>
      <link href="/2021/03/13/nginx-location-regex-reverse-proxy/"/>
      <url>/2021/03/13/nginx-location-regex-reverse-proxy/</url>
      
        <content type="html"><![CDATA[<p>一個網站有部分頁面是需要連到其他網站的，但又希望網址改變，這時候我們可以使用 reverse proxy 的技術來達成，今天要來分享的是如何在 nginx 中完成這樣的需求。</p><blockquote><p>reverse proxy 可以參考我之前 <a href="/2017/09/02/reserve-proxy/" title="設定Reverse Proxy在Windows、Mac">寫的這篇</a></p></blockquote><span id="more"></span><h1 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h1><p>先來個基本題，使用者進到 <strong>course</strong> 這個路徑時，希望能夠開啟維持一樣的 url 但是內容呈現在 webflow 上做好的一頁，我們所要使用的指令叫做 <code>proxy_pass</code>。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ /course</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> https://mkt-hk.webflow.io/hkdse-courses;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="proxy-pass-與-regex"><a href="#proxy-pass-與-regex" class="headerlink" title="proxy_pass 與 regex"></a>proxy_pass 與 regex</h1><p>進階題來了，想要限制只有特定前綴 <strong>zh-hk</strong> 以及 <strong>en-hk</strong> 的 course 路徑才顯示 academy 的內容。</p><p>先來列一下預期的 URL</p><ul><li>&#x2F;zh-hk&#x2F;course</li><li>&#x2F;en-hk&#x2F;course</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ /*-hk/course</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> https://mkt-hk.webflow.io/hkdse-courses;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>很開心的做完了，重起 nginx 卻發現到錯誤</p><blockquote><p>“proxy_pass” cannot have URI part in location given by regular expression, or inside named location, or inside “if” statement, or inside “limit_except”</p></blockquote><p>當 location 是動態 (regex) 路徑時，就只能指定 domain 那層，後面的 folder 不能存在。雖然只有兩個前綴，可以簡單的重複寫兩次，但總是覺得這樣很笨。</p><p>查了相關的設定以後，需要透過 <strong>rewrite</strong> 的方式，先讓這個頁面先轉到目標 folder，但又不能真的執行 (break)，再來執行 proxy_pass 就可以達成目的。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ /*-tw/course</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^</span> /hkdse-courses <span class="literal">break</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> https://mkt-hk.webflow.io;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://stackoverflow.com/questions/53353572/proxy-pass-cannot-have-uri-part-in-location-given-by-regular-expression">stackoverflow</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#break">nginx</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AWS] Elastic Load Balancer變更TLS的設定</title>
      <link href="/2021/02/20/aws-elb-tls-setting/"/>
      <url>/2021/02/20/aws-elb-tls-setting/</url>
      
        <content type="html"><![CDATA[<p>網站的安全性中，其中有一項是關於 TLS 的檢查，建議是v1.2版以上。那服務如果是架設在 AWS 的 ELB 上，應該要怎麼做調整呢？</p><span id="more"></span><h1 id="TLS簡介"><a href="#TLS簡介" class="headerlink" title="TLS簡介"></a>TLS簡介</h1><p>在瀏覽網站的時候，現在大部分的網站都會是 <code>https</code> ，與 http 的差異也就是加密，這個加密的方法是透過所謂的 SSL &#x2F; TLS 來做進行。那為什麼要進行加密呢，因為 http 是明碼的傳輸，也就是說只要你想看，就能看到有哪些資料被傳送並且有機會進行修改。</p><p>SSL 的全名是 Secure Sockets Layer，用來確保瀏覽器與伺服器之間的資料傳輸，減少被修改的可能性，但因為存在著一些問題無法解決，因此在2016年的時候被 TLS 取代。</p><p>TLS 的全名是 Transport Layer Security，比 SSL 更強大的加密，並且解決掉了部分的問題。</p><blockquote><p>現在外面所發的憑證基本上都是 TLS，但因為大家都習慣了，因此還是繼續稱呼為 SSL 憑證。</p></blockquote><h1 id="調整ELB設定"><a href="#調整ELB設定" class="headerlink" title="調整ELB設定"></a>調整ELB設定</h1><p>ELB 是 AWS 中的一個服務，全名是 Elastic Load Balancer 或稱為 Network Load Balancer，TLS 則是透過 <strong>Security policy</strong> 來做設定。</p><p>從上面介紹可以得知，會需要設定 TLS 的只有 443 也就是 https 那組 Listener ，我們可以看到預設的 <strong>Security policy</strong> 是 <strong>ELBSecurityPolicy-2016-08</strong> 。</p><p><img src="/2021/02/20/aws-elb-tls-setting/ELB-Listeners.png" alt="ELB Listeners"></p><p>接著把 443 打勾並且點擊上方的 edit 按鈕，可以進入到編輯的頁面。</p><p><img src="/2021/02/20/aws-elb-tls-setting/listener-setting.png" alt="listener setting"></p><p>請找到 <strong>Security policy</strong> 這個欄位，並且<a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-tls-listener.html#describe-ssl-policies">參考這張表</a>，重新調整為你所需要的即可。</p><p>因為我的目的只有要先關閉，TLS v1.0 以及 V1.1，因此最終選擇的是 <strong>ELBSecurityPolicy-TLS-1-2-Ext-2018-06</strong>，當然可以的話就選擇最安全的設定 <strong>ELBSecurityPolicy-FS-1-2-Res-2020-10</strong>。</p><blockquote><p>如果選擇的越安全，有可能瀏覽器支援度越低，還是要根據使用者的瀏覽器使用狀況來做決定。</p></blockquote><p><img src="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/images/security_policy_fs.png" alt="security_policy_fs"></p><p><img src="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/images/security_policy_tls.png" alt="security_policy_tls"></p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/">What is Transport Layer Security (TLS)?</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10219106">簡介 SSL、TLS 協定</a></li><li><a href="https://www.nss.com.tw/whyssl/">何謂SSL、TLS 以及HTTPS？為什麼網站都須要安裝SSL？</a></li><li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-tls-listener.html#describe-ssl-policies">TLS listeners for your Network Load Balancer</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> AWS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>設定nginx的log備份機制</title>
      <link href="/2021/01/26/logrotate-nginx/"/>
      <url>/2021/01/26/logrotate-nginx/</url>
      
        <content type="html"><![CDATA[<p>前幾天公司部屬新的版本到 prod server 的時候失敗了，檢查以後才發現是空間不足，問題是出現在 nginx log 目錄太肥，到底是發生什麼事情，今天來探討一下。</p><span id="more"></span><h1 id="環境與前言"><a href="#環境與前言" class="headerlink" title="環境與前言"></a>環境與前言</h1><p>目前我們還有些服務還是直接架設在 ec2 上，所以我們會在上面安裝 nginx 來指向我們的服務，因為這台 server 已經運行蠻久的時間，上面的版本也比較舊，為了安全性問題，前陣子將 nginx 升級到 1.18（強烈建議安裝到此版本，之前的版本都有安全性的問題），但升級以後沒有注意到 logrotate 的設定跟之前不同。</p><ul><li>ubuntu v16</li><li>nginx v1.18</li></ul><h1 id="logrotate"><a href="#logrotate" class="headerlink" title="logrotate"></a>logrotate</h1><p><code>logrotate</code> 是一個 linux 上的定時服務，會根據設定來做壓縮以及產生新的檔案。</p><blockquote><p>舉例來說，log是以天為單位作為切分，那 logfile.1 就會變成 logfile.2 並且產生新的 logfile.1</p></blockquote><h2 id="目前設定"><a href="#目前設定" class="headerlink" title="目前設定"></a>目前設定</h2><p>執行以下指令查看 logrotate 目前設定。</p><blockquote><p>cat &#x2F;etc&#x2F;logrotate.d&#x2F;nginx</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">        daily</span><br><span class="line">        missingok</span><br><span class="line">        rotate 52</span><br><span class="line">        compress</span><br><span class="line">        delaycompress</span><br><span class="line">        notifempty</span><br><span class="line">        create 640 nginx adm</span><br><span class="line">        sharedscripts</span><br><span class="line">        postrotate</span><br><span class="line">                if [ -f /var/run/nginx.pid ]; then</span><br><span class="line">                        kill -USR1 `cat /var/run/nginx.pid`</span><br><span class="line">                fi</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="參數介紹"><a href="#參數介紹" class="headerlink" title="參數介紹"></a>參數介紹</h2><ul><li>daily，以天為單位做檔案切割，另外還有其他三種<ul><li>weekly</li><li>monthly</li><li>yearly</li></ul></li><li>missingok，沒檔案的時候略過且不會發生錯誤</li><li>rotate 52，保留的檔案個數，這邊指的是52個檔案</li><li>compress，切割出來的檔案，將會壓縮成 gzip</li><li>delaycompress，延遲壓縮，避免檔案還被咬著導致失敗</li><li>notifempty，檔案內容是空的時候不做動作</li><li>create 640 nginx adm，產生檔案時要給的使用者及權限</li><li>sharedscripts，一般來說 postrotate &#x2F; prerotate 會在每個檔案 rotate 後執行，加上這個指令的話就等於只會執行一次</li><li>postrotate，在 endscript 的區間內是 rotate 結束後會執行的指令</li></ul><h2 id="調整設定"><a href="#調整設定" class="headerlink" title="調整設定"></a>調整設定</h2><p>根據上面的一些介紹，可以得知會保留52天的檔案，並且一個檔案沒有上限，那為了讓開檔更順利且不會佔用太多的空間，限縮檔案是 <code>10M</code> 並且只保留 <code>7個</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--- /etc/logrotate.d/nginx</span><br><span class="line">+++ /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">+size=10M</span><br><span class="line">        daily</span><br><span class="line">        missingok</span><br><span class="line">-rotate 52</span><br><span class="line">+       rotate 7</span><br><span class="line">        compress</span><br><span class="line">        delaycompress</span><br><span class="line">        notifempty</span><br><span class="line">        create 640 nginx adm</span><br><span class="line">        sharedscripts</span><br><span class="line">        postrotate</span><br><span class="line">                if [ -f /var/run/nginx.pid ]; then</span><br><span class="line">                        kill -USR1 `cat /var/run/nginx.pid`</span><br><span class="line">                fi</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="測試執行"><a href="#測試執行" class="headerlink" title="測試執行"></a>測試執行</h2><p>基本上 logrotate 是每天定時跑起來，改完以後是可以不用特別重新執行，但通常改完我們會希望確定是不是如我們預期，那我們可以下個指令要求立刻執行。</p><blockquote><p>sudo logrotate -v &#x2F;etc&#x2F;logrotate.d&#x2F;nginx</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><p><a href="https://unix.stackexchange.com/questions/116136/how-to-make-log-rotate-change-take-effect/116141#116141">StatckExchange - How to make log-rotate change take effect</a></p></li><li><p><a href="https://linux.die.net/man/8/logrotate">Linux man page - logrotate</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在GitKraken中使用template</title>
      <link href="/2020/10/25/git-template-in-kraken/"/>
      <url>/2020/10/25/git-template-in-kraken/</url>
      
        <content type="html"><![CDATA[<p>最近團隊開始規範 git commit 並且導入 <a href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional commit</a>，剛開始不熟悉都會一直要去翻文件，看看到底這時候要用什麼樣的類型，為了加速類別的輸入，可以在 commit 的 template 中設定，今天就來分享一下使用這個規範並且如何有效的套用在 <a href="https://www.gitkraken.com/">GitKraken</a> 這套工具中。</p><span id="more"></span><h1 id="介紹Conventional-commit"><a href="#介紹Conventional-commit" class="headerlink" title="介紹Conventional commit"></a>介紹Conventional commit</h1><p>這是一個由 angular 團隊推動的 commit message 規範，主要是把每個 commit 做一個分類，分類的好處除了人在看比較輕鬆以外，也是有機會能夠使用工具去拿到某個分類的全部 commit，在 release 時要整理就會比較輕鬆。</p><p>目前的類別大概有 <code>feat</code>, <code>fix</code>, <code>build:</code>, <code>chore</code>, <code>ci</code>, <code>docs</code>, <code>style</code>, <code>refactor</code>, <code>perf</code>, <code>test</code>…等，基本上大部分的 commit 應該都能夠被分類到；目前我最常用到的應該是 <code>feat</code>, <code>style</code>, <code>refactor</code>, <code>fix</code> 這幾個，剩下幾個就沒那麼常使用到。</p><p>要導入一個規範最好的方法還是用強迫的，那就必須要安裝 commit lint 的套件 <a href="https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional">config-conventional</a>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @commitlint/config-conventional @commitlint/cli</span><br></pre></td></tr></table></figure><h1 id="使用Git-Template"><a href="#使用Git-Template" class="headerlink" title="使用Git Template"></a>使用Git Template</h1><p>剛剛有說到可以使用套件來作為規範，但初期的時候就是很容易忘記有哪些類別，這時候可以考慮使用 git 的 template 功能，讓我們在 commit 時，能有一個快速的參考，當然這個 template 並不會真的進入到你的 message 中。</p><p>接著就來試試看在 git 中加上 template，首先建立一個檔案叫做 <code>.gitmessage</code> ，並且放在 root 底下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">touch .gitmessage</span><br><span class="line">vi .gitmessage</span><br></pre></td></tr></table></figure><p>接著將 conventional commit 的類別放進去，輸入 <code>i</code> 然後 <code>cmd+v</code> 貼上，這個是我目前使用的內容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Conventional Commit Types:</span><br><span class="line"># build</span><br><span class="line"># ci</span><br><span class="line"># chore</span><br><span class="line"># docs</span><br><span class="line"># feat</span><br><span class="line"># fix</span><br><span class="line"># perf</span><br><span class="line"># refactor</span><br><span class="line"># revert</span><br><span class="line"># style</span><br><span class="line"># test</span><br></pre></td></tr></table></figure><p>最後把這個檔案指定給 git。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config commit.template .gitmessage</span><br></pre></td></tr></table></figure><h1 id="設定-GitKaren"><a href="#設定-GitKaren" class="headerlink" title="設定 GitKaren"></a>設定 GitKaren</h1><blockquote><p>如果你是 CLI 派的，就麻煩這邊左轉離開囉。</p></blockquote><p>使用過的 GUI 工具還蠻多種的，目前就剩下一套 GitKaren 固定在使用，關於這套的介紹建議大家可以去參考 <a href="https://wellwind.idv.tw/blog/2018/04/03/git-using-gitkraken-1-basic/">Mike 的文章</a>，畢竟介紹這套工具不是我們今天的重點，今天的重點在於使用了 commit template 以後，怎麼樣更方便的在 GitKaren 中應用。</p><p>做完上面的步驟以後，就可以看到在 message 的欄位已經自動帶入所建立的 template。</p><p><img src="/2020/10/25/git-template-in-kraken/message_template.png" alt="message template"></p><p>這時候可以先來試一下 commit 一個檔案，看看結果是什麼。</p><p><img src="/2020/10/25/git-template-in-kraken/try_a_commit.png" alt="try a commit"></p><p>唉～等等！為什麼我們的 template 也跟著進去，這跟我們預期的不同，如果你有 <code>SourceTree</code> 這套 GUI 的話也能夠試試看，結果應該會有點不同。</p><p>讓我們試著找找看設定沒有沒地方可以修改，開啟 <code>preference</code> 可以看到下方有一個屬於個別專案的設定，點進去以後將 <code>remove comment from commit messages</code> 打勾即可。</p><blockquote><p>這個地方比較麻煩，還沒找到好的設定可以套用全部，如果你有找到方法，歡迎留言告訴我</p></blockquote><p><img src="/2020/10/25/git-template-in-kraken/preference_for_repo.png" alt="preference for repo"></p><p><img src="/2020/10/25/git-template-in-kraken/remove_comment.png" alt="remove comment"></p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional commit</a></li><li><a href="https://www.gitkraken.com/">GitKraken offical site</a></li><li><a href="https://support.gitkraken.com/working-with-commits/commits/#commit-templates">GitKraken commit template</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> GitKraken </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>create-react-app 開發心得分享</title>
      <link href="/2020/09/07/create-react-app/"/>
      <url>/2020/09/07/create-react-app/</url>
      
        <content type="html"><![CDATA[<p>最近公司的一個新專案，因為網站的功能都必須要登入以後才能操作，因此選擇了 <code>create-react-app (CRA)</code> 這個來做為 project base，前陣子剛上線第一個版本，順便來整理一些心得。</p><span id="more"></span><h1 id="why-CRA"><a href="#why-CRA" class="headerlink" title="why CRA"></a>why CRA</h1><p>在開始之前先和 PM 確認這個網站的功能要有哪些，是否會有所謂的內容或是行銷頁面，那經過 PM 確認後，網站主要是登入後的內容。既然要登入，有沒有所謂的 server-side-render (SSR) 根本不重要，因為對於網站來說也沒辦法那些內容呈現給爬蟲，因此這個時候我們就只需要 client-side-render (CSR) 的功能。</p><p>既然只是 CSR 的網站，react 的團隊也提供已經建置好的一個架構也就是 CRA，讓你不用再煩惱 webpack 等等的設定。</p><h1 id="專案建置"><a href="#專案建置" class="headerlink" title="專案建置"></a>專案建置</h1><p>CRA 本身提供的功能真的很陽春，react 團隊只是提供了一個平台，讓你不用在乎專案的一些架構設定等等，但如果要達到稍微複雜的開發需求，還是有不少東西需要被調整，接著我會說明怎麼去建置所需要的環境。</p><h2 id="建立有redux的專案"><a href="#建立有redux的專案" class="headerlink" title="建立有redux的專案"></a>建立有redux的專案</h2><p>根據<a href="https://create-react-app.dev/">官網的介紹</a>，我們可以使用下面的指令很輕鬆的建立好專案，完成後使用 vscode 打開，可以發現到只有 <code>public</code> 以及 <code>src</code> 兩個目錄而已，而且是只有 <code>react</code> 的功能， <code>redux</code> 等等的功能都沒有。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-project</span><br><span class="line">cd my-project</span><br><span class="line">code .</span><br></pre></td></tr></table></figure><p>作為一個完整的專案，基本上就是會有 <code>redux</code> 以及 <code>middleware</code> （也許有人會說用 context 就好，但就不再這邊討論囉！），那有沒有更簡單的方法呢？當然是有的， 在 npm 中搜尋 <a href="https://www.npmjs.com/search?q=cra-template-*">cra-template</a> 就可以使用這些別人已經建立好的範本來做初始專案。</p><p>目前團隊是使用 redux+saga ，因此我這邊就選擇一個已經整合好的<a href="https://www.npmjs.com/package/cra-template-react-redux-saga">範本</a>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-project --template react-redux-saga</span><br><span class="line">cd my-project</span><br><span class="line">code .</span><br></pre></td></tr></table></figure><h2 id="CSS管理"><a href="#CSS管理" class="headerlink" title="CSS管理"></a>CSS管理</h2><p>在 CRA 中有兩種的 css 管理方法，一種是全域的檔案，另一種就是 css module ，基本上兩種模式都有用到，但主要用比較多的會是 css module ，因此再建立 component 時，就必須要將 css 的檔案名稱加上 ***.module.css** 這樣才會變成 module scope，不然的話預設就會是全域。</p><p>另外就是使用預處理器 scss 來撰寫，webpack的處理已經準備好，只是需要安裝 <code>node-sass</code> 的 library 即可！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add node-sass</span><br></pre></td></tr></table></figure><h2 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h2><p>建立一個稍微有點規模的專案，都一定不會只有一個頁面，因此我們一定會需要使用到 route ，那想當爾就是我們要自己安裝囉！</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router-dom</span><br></pre></td></tr></table></figure><h2 id="Format-及-ESLint-x2F-StyleLint"><a href="#Format-及-ESLint-x2F-StyleLint" class="headerlink" title="Format 及 ESLint &#x2F; StyleLint"></a>Format 及 ESLint &#x2F; StyleLint</h2><p>排版是一件麻煩的事情，尤其是大家的習慣不同，使用 formatter 以及 linter 是最簡單的，我們團隊是使用 <a href="https://github.com/prettier/prettier">prettier</a> 為基礎，另外套一些 react &#x2F; scss 的 lint，基本上不太會去改什麼設定，<a href="https://create-react-app.dev/docs/setting-up-your-editor/#formatting-code-automatically">參考這邊使用方法</a>。</p><p>如果有另外定義 <code>.eslintrc</code> 記得要再 env 檔案中加上 <code>EXTEND_ESLINT=TRUE</code>，才不會一直套用到 CRA 預設的 eslint</p><blockquote><p>使用 ESLint 時要注意一下，如果開啟 error 會導致編譯失敗，一定要修復才會正常編譯（但我還是開了！）</p></blockquote><h2 id="環境變數"><a href="#環境變數" class="headerlink" title="環境變數"></a>環境變數</h2><p>CRA 已經定義好每個 script 所對應的 env 檔案是什麼，先參考一下<a href="https://create-react-app.dev/docs/adding-custom-environment-variables#what-other-env-files-can-be-used">這邊</a>。公司的開發環境一共有三個，分別是<strong>本機</strong>、<strong>測試</strong>、<strong>正式</strong>，但根據文件所介紹的， build 只能對應 <code>.env.production</code> ，那測試環境的 <code>.env.uat</code> 檔案該怎麼讓 build 的指令可以被使用到？還好他們也有考慮到這問題，可以參考<a href="https://create-react-app.dev/docs/deployment#customizing-environment-variables-for-arbitrary-build-environments">這邊</a>，透過 <code>env-cmd</code> 的 library來替換檔案。</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>其實可以發現 CRA 真的很基本，著重在於編譯相關的事情，但也有考慮到一個專案應該會要有的東西，只是需要使用者自己去針對所需做設定，也算是蠻符合 react 本身的精神。</p><blockquote><p>原本還想寫寫客製 <code>react-scripts</code> ，但沒有想出比較好的介紹方式，這邊就先不提了，有興趣的可以從 <code>eject</code> 的相關介紹著手。</p></blockquote><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://create-react-app.dev/">CRA 官網</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>專案設定 - vscode 以及 nvmrc</title>
      <link href="/2020/07/19/project-setting/"/>
      <url>/2020/07/19/project-setting/</url>
      
        <content type="html"><![CDATA[<p>open source總是有些不一樣的東西可以挖，今天為了要找一些使用action的範例，反而讓我找到了一些不一樣的設定，可以幫助我們。</p><span id="more"></span><h1 id="vscode"><a href="#vscode" class="headerlink" title=".vscode"></a>.vscode</h1><p>當改變了一些設定是只有為了專案的時候，vscode 就會產生一個 <code>settings.json</code> 的檔案在根目錄底下，除了設定以外，vscode 也支援 推薦 extensions 給專案的使用者，只要在 <code>.vscode</code> 的目錄下建立 <code>extensions.json</code> 即可，範例如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;recommendations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// format: &#123;publisher&#125;.&#123;extension&#125;</span></span><br><span class="line">    <span class="string">&quot;ms-vscode.vscode-typescript-tslint-plugin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;dbaeumer.vscode-eslint&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;msjsdiag.debugger-for-chrome&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>若是有一些推薦的設定，但不希望強制的話，就可以在 <code>.vscode</code> 的目錄下，建立一些 <code>recommended-*</code> 的檔案，由使用者自行改檔名套用，例如： <code>.vscode/recommended-settings.json</code> 可以複製成 <code>.vscode/settings.json</code></p><h1 id="nvmrc"><a href="#nvmrc" class="headerlink" title="nvmrc"></a>nvmrc</h1><p>手邊每一個 node 的專案都不同版本，那為了確保版本的正確性，可以使用 <code>.nvmrc</code> 的檔案搭配 zsh script 自動載入版本，這樣就可以避免每次開啟 terminal 都還要手動切換版本的問題。</p><p>首先要在專案中產生 <code>.nvmrc</code> 的檔案</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v &gt; .nvmrc</span><br></pre></td></tr></table></figure><p>接著到 <code>.zshrc</code> 中將以下的 script 貼上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">place this after nvm initialization!</span></span><br><span class="line">autoload -U add-zsh-hook</span><br><span class="line">load-nvmrc() &#123;</span><br><span class="line">  local node_version=&quot;$(nvm version)&quot;</span><br><span class="line">  local nvmrc_path=&quot;$(nvm_find_nvmrc)&quot;</span><br><span class="line"></span><br><span class="line">  if [ -n &quot;$nvmrc_path&quot; ]; then</span><br><span class="line">    local nvmrc_node_version=$(nvm version &quot;$(cat &quot;$&#123;nvmrc_path&#125;&quot;)&quot;)</span><br><span class="line"></span><br><span class="line">    if [ &quot;$nvmrc_node_version&quot; = &quot;N/A&quot; ]; then</span><br><span class="line">      nvm install</span><br><span class="line">    elif [ &quot;$nvmrc_node_version&quot; != &quot;$node_version&quot; ]; then</span><br><span class="line">      nvm use</span><br><span class="line">    fi</span><br><span class="line">  elif [ &quot;$node_version&quot; != &quot;$(nvm version default)&quot; ]; then</span><br><span class="line">    echo &quot;Reverting to nvm default version&quot;</span><br><span class="line">    nvm use default</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">add-zsh-hook chpwd load-nvmrc</span><br><span class="line">load-nvmrc</span><br></pre></td></tr></table></figure><p>接著用一個新視窗來開啟專案，就可以看到 zsh 自動載入 node 版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cd</span> /Grapefruit</span></span><br><span class="line">Found &#x27;/Grapefruit/.nvmrc&#x27; with version &lt;v12.6.0&gt;</span><br><span class="line">Now using node v12.6.0 (npm v6.9.0)</span><br></pre></td></tr></table></figure><blockquote><p>實測以後，發現這個功能雖然好用，但開啟的速度就會變比較慢一點點，如果在意的話，建議不要使用</p></blockquote><h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><ul><li><a href="https://github.com/angular/angular/blob/master/.vscode/README.md">angular vscode readme</a></li><li><a href="https://code.visualstudio.com/docs/editor/extension-gallery#_workspace-recommended-extensions">vscode recommend extensions</a></li><li><a href="https://github.com/nvm-sh/nvm#zsh">nvmsh</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
            <tag> nvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 elasticsearch 更新後立即能夠查詢</title>
      <link href="/2020/05/21/elastic-update-refresh/"/>
      <url>/2020/05/21/elastic-update-refresh/</url>
      
        <content type="html"><![CDATA[<p>一般的關聯式資料庫下 update 以後，如果沒有下 commit 大部分情況是拿到舊的資料，但是在 elastic search 的環境下，沒有所謂的 commit，在異動資料後馬上執行 search 卻拿不到更新後的結果。</p><span id="more"></span><p>只要你在下指令的時候，加上 <strong>refresh</strong> 這個條件並且指定為 true，就可以馬上讓 search 看到異動後的資料。</p><blockquote><p>官方不太建議使用，如果真的要用要小心，<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-refresh.html">官方文件</a></p></blockquote><p>這邊附上 elasticsearchjs 的範例，將符合的 id 都改為 deleted 的狀態。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">elastic.<span class="title function_">updateByQuery</span>(&#123;</span><br><span class="line">  <span class="attr">index</span>: <span class="variable constant_">TABLE_NAME</span>,</span><br><span class="line">  <span class="attr">refresh</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">script</span>: &#123;</span><br><span class="line">      <span class="attr">lang</span>: <span class="string">&#x27;painless&#x27;</span>,</span><br><span class="line">      <span class="attr">source</span>: <span class="string">&#x27;ctx._source[&quot;deleted&quot;] = true&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">query</span>: &#123;</span><br><span class="line">      <span class="attr">terms</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: ids,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Github Action 作為 CI/CD 將 libraray 發佈到 Github Package</title>
      <link href="/2020/05/21/github-action-and-package/"/>
      <url>/2020/05/21/github-action-and-package/</url>
      
        <content type="html"><![CDATA[<p>Continuous Integration (以下簡稱CI)，是在開發中很重要的一環，大家常用或常聽到的例如：Jenkins, Travis…等等的，我們常在使用的 Github 本身也有提供類似的服務。<br>今天來使用 Github 的全套服務，使用 Action 做 CI&#x2F;CD 並且發佈到 Package。</p><span id="more"></span><h1 id="使用Action"><a href="#使用Action" class="headerlink" title="使用Action"></a>使用Action</h1><blockquote><p>Github本身對於Action有一些<a href="https://help.github.com/en/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-github-actions">限制</a>和<a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#usage-limits">收費</a>的方式，詳細請參考官方文件。</p></blockquote><h2 id="使用範本建立"><a href="#使用範本建立" class="headerlink" title="使用範本建立"></a>使用範本建立</h2><p>在開始之前當然就要先建立好一個 repo ，點選到 Action 的頁籤，就可以開始建立囉</p><p><img src="/2020/05/21/github-action-and-package/start-action.png" alt="start action"></p><p>一個還沒有建立過 Action 的專案，會先看到上圖的畫面，可以從現有的範本中做建立的動作，那我們就使用 <code>Simple workflow</code> 來做為我們的第一個 Action，從範本中我們可以發現到兩件事情</p><ul><li><code>yaml</code> 的格式做撰寫</li><li>檔案存在 <code>.github/workflow</code> 底下</li></ul><p><img src="/2020/05/21/github-action-and-package/simple-action.png" alt="simple action"></p><p>先什麼都不改然後 commit 就可以到 Action 的頁籤中確認執行狀況，從下圖中可以看到 <code>CI</code> 的 workflow 已經執行成功</p><p><img src="/2020/05/21/github-action-and-package/commit.png" alt="commit"></p><h2 id="了解yaml"><a href="#了解yaml" class="headerlink" title="了解yaml"></a>了解yaml</h2><p>為了之後能夠寫出自己的檔案，就要先了解檔案的每個區塊是怎麼運作，詳細可以<a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions">參考官網</a></p><blockquote><p>為了篇幅我將註解都刪除</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">master</span> ]</span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">master</span> ]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">a</span> <span class="string">one-line</span> <span class="string">script</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">echo</span> <span class="string">Hello,</span> <span class="string">world!</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">a</span> <span class="string">multi-line</span> <span class="string">script</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo Add other actions to build,</span></span><br><span class="line"><span class="string">        echo test, and deploy your project.</span></span><br></pre></td></tr></table></figure><h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>workflow 的名稱，為了區別不同的行為，可以將名稱取成不一樣。</p><h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><p>觸發 workflow 的時機點，按照範例觸發時機是 push 新 commit 或是對這個 branch 發 PR 。</p><h3 id="jobs"><a href="#jobs" class="headerlink" title="jobs"></a>jobs</h3><p>定義要執行的工作項目，可以一個或多個<em>（預設每個工作項目是平行處理）</em>。</p><h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p>第一層的 <strong>build</strong> 是 job_id ，若有多個 job 請記得不要重複並且取好懂一點的名字</p><h4 id="runs-on"><a href="#runs-on" class="headerlink" title="runs-on"></a>runs-on</h4><p>要以哪個環境做執行 (window&#x2F;ubuntu&#x2F;macos)，支援列表可以<a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#github-hosted-runners">參考這邊</a></p><h4 id="steps"><a href="#steps" class="headerlink" title="steps"></a>steps</h4><p>執行的步驟，會按照順序的往下執行</p><h5 id="uses"><a href="#uses" class="headerlink" title="uses"></a>uses</h5><p>使用別人已經寫好的功能作為基礎來進行後續的動作，以此範例是用來 checkout repo</p><blockquote><p>官方建議後面要加上版本號，避免突然間炸掉</p></blockquote><h5 id="name-x2F-run"><a href="#name-x2F-run" class="headerlink" title="name&#x2F;run"></a>name&#x2F;run</h5><p>每個步驟的名稱，以及要執行的指令</p><h2 id="看看build-log"><a href="#看看build-log" class="headerlink" title="看看build log"></a>看看build log</h2><p><img src="/2020/05/21/github-action-and-package/build-log.png" alt="build log"></p><p>可以看到左邊的 <strong>build</strong> 就是所有的 job，右邊則是列出所有的 steps</p><p>###執行錯誤</p><p><img src="/2020/05/21/github-action-and-package/build-fail.png" alt="build fail"></p><p>如果有執行錯誤從外面其實看不到是在哪一個步驟錯誤，必須要到詳細的 log 中查看才行</p><h1 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h1><p>前面已經了解完了 Action，接著第二個目的是使用 Github Package 這個服務，這個服務本身不是只能放 javascript 的 library 也是能夠放其他語言的 library ，例如 nugget、gem 等等的，詳細請見<a href="https://github.com/features/packages">官方說明</a></p><h2 id="登入"><a href="#登入" class="headerlink" title="登入"></a>登入</h2><p>使用 npm 的方式做登入，只是要另外指定 registry；登入的時候使用的是 Github 的帳號以及 <strong>token</strong> ，token產生方式可以<a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">參考這邊</a></p><blockquote><p>因為我們要用的是 package 功能，所以除了 repo 以後還要將 package 的權限也打開</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm login --registry=https://npm.pkg.github.com</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Username: USERNAME</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Password: TOKEN</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Email: PUBLIC-EMAIL-ADDRESS</span></span><br></pre></td></tr></table></figure><h2 id="設定-package-json"><a href="#設定-package-json" class="headerlink" title="設定 package.json"></a>設定 package.json</h2><p>要發佈到 package 之前要先將 package.json 設定好，這邊有兩個地方要注意一下</p><ul><li>publishConfig 要設定 registry</li><li>name 必須是 <code>organization</code>&#x2F;<code>personal account</code> 加上這個 repo 的名稱</li></ul><blockquote><p>我們的 repo 假設叫做 <code>jimmy-first-library</code> 那我們發佈到 npm 的時候可以改名稱叫做 <code>jimmy-library</code>，但是在 Github 是不被允許的，因為他是基於 repo 去產生的 package 所以名稱必須相同</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@jiaming0708/schematics-react&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;publishConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;registry&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://npm.pkg.github.com/&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="發佈"><a href="#發佈" class="headerlink" title="發佈"></a>發佈</h2><p>做完以上的動作以後，我們就可以用 npm 的 publish 指令，進行發佈</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>接著我們可以到 Github 的 repo 中查看</p><p><img src="/2020/05/21/github-action-and-package/repo-package.png" alt="repo package"></p><p><img src="/2020/05/21/github-action-and-package/package-info.png" alt="package info"></p><h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><p>發佈以後我們可以來安裝看看，在專案的根目錄中，加上 <code>.npmrc</code> 在裡面要加上 package 所屬的 owner，接著就可以使用一般的 npm 安裝方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry=https://npm.pkg.github.com/jiaming0708</span><br></pre></td></tr></table></figure><blockquote><p>如果你是到另一個環境做測試的話，記得要重新登入</p></blockquote><h1 id="使用-Action-發佈到-Package"><a href="#使用-Action-發佈到-Package" class="headerlink" title="使用 Action 發佈到 Package"></a>使用 Action 發佈到 Package</h1><p>我們要在steps底下，加上下面的語法</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node.js</span> <span class="string">environment</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">node-version:</span> <span class="string">&#x27;12.6.0&#x27;</span></span><br><span class="line">    <span class="attr">registry-url:</span> <span class="string">&#x27;https://npm.pkg.github.com&#x27;</span></span><br><span class="line">    <span class="attr">scope:</span> <span class="string">&#x27;@jiaming0708&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">publish</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">NODE_AUTH_TOKEN:</span> <span class="string">$&#123;&#123;secrets.GITHUB_TOKEN&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="node環境建置"><a href="#node環境建置" class="headerlink" title="node環境建置"></a>node環境建置</h2><p>使用別人寫好的 node 環境，並且加上 <code>with</code> 指定一些參數</p><h2 id="發佈-1"><a href="#發佈-1" class="headerlink" title="發佈"></a>發佈</h2><p>執行發佈的時候，一樣要提供 token 讓 action 來幫我們登入，這邊必須要將 token 放在 env 的設定中</p><p>這邊有一個很厲害的地方， <code>GITHUB_TOKEN</code> 是一個預設的變數，每次會執行時自動產生並且提供對應的權限，因此你不需要特別的再產生什麼樣的 token 來給 action 使用</p><h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>Github Action 基本上蠻方便的，除了做 CI&#x2F;CD 以外，也可以拿來做 issue 上的 tag，對於一個很多人在使用的 open repo 管理上會很有幫助。 </p><p>Github Package 以 javascript 就是另一個私人的 libraies，使用上較為麻煩，一定要做登入的動作； repo 和 library 名稱一定要相同，不然會發佈失敗。</p><p>第一次的使用上來說對於 Action 的評價高過於 Package，但因為 npm 已經被 github 買下，所以未來會不會移到 package 也不好說。</p><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul><li><a href="https://github.com/jiaming0708/schematics-react">sample repo</a></li><li><a href="https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes">Learn YAML</a></li><li><a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions">Workflow syntax for GitHub Actions</a></li><li><a href="https://help.github.com/en/packages">Github package documentation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CI/CD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chrome devtool介紹</title>
      <link href="/2020/03/26/chrome-devtool-intro/"/>
      <url>/2020/03/26/chrome-devtool-intro/</url>
      
        <content type="html"><![CDATA[<p>今天晚上聽 <strong>林亨力</strong> 在 <em>GDG台中</em> 分享的 <strong>如果你連DevTools都不會用，還敢說你是網頁設計者嗎</strong>，滿滿的乾貨，所以趁新鮮趕快來記錄一下自己所不知道的部份。</p><span id="more"></span><h1 id="命令列選單"><a href="#命令列選單" class="headerlink" title="命令列選單"></a>命令列選單</h1><p>在DevTool任何地方按下 <code>cmd+shift+p</code> ，就可以叫出選單，才發現滿滿的功能！！</p><blockquote><p>window請用 <code>control+shift+p</code></p></blockquote><p><img src="/2020/03/26/chrome-devtool-intro/command-list.png" alt="command-list"></p><h2 id="檢視animation"><a href="#檢視animation" class="headerlink" title="檢視animation"></a>檢視animation</h2><p>在命令列選單輸入 <code>animation</code> 就只會看到一個選項，點下去就可以在下方看到新的 tab（如下圖）。</p><p><img src="/2020/03/26/chrome-devtool-intro/animation.png" alt="animation"></p><p>在裡面就能夠看到目前頁面中所有的動畫元素，並且可以暫停重跑。</p><p><img src="/2020/03/26/chrome-devtool-intro/animation-result.png" alt="animation-result"></p><p>在今天之前，如果要看 animation 的效果並且調整，我會選擇 firefox 查看，現在才知道原來chrome也有類似的功能。<br>實際操作了一下，發現還是 firefox 比較強，在 firefox 是顯示某個元素底下所有的結果，不用另外開出來，直接在檢視中就提供（如下圖）。</p><p><img src="/2020/03/26/chrome-devtool-intro/firefox-animation.png" alt="firefox-animation"></p><h2 id="截圖"><a href="#截圖" class="headerlink" title="截圖"></a>截圖</h2><p>想要把整個網頁截取的話，可以不用額外的工具，只需要在命令列中輸入 <code>screenshot</code> 選取 <code>capture full size</code> 就會開始執行截圖的行為，但需要一下下的執行時間，請耐心等候。</p><p><img src="/2020/03/26/chrome-devtool-intro/screenshot.png" alt="screenshot"></p><h2 id="Sensors"><a href="#Sensors" class="headerlink" title="Sensors"></a>Sensors</h2><p>一樣在命令列輸入 <code>sensor</code> ，這個 tab 中可以看到下面這幾個功能，個人覺得這 tab 的功能很酷！</p><h3 id="Geolocation"><a href="#Geolocation" class="headerlink" title="Geolocation"></a>Geolocation</h3><p>可以模擬訊號位置到別的地區，對於這方面的測試是蠻方便的，最簡單的測試是打開 google map 並且變更設定到 <code>berlin</code> ，重新整理後就會發現自己離開台灣啦🤩（<s>可以打卡出國了</s></p><p><img src="/2020/03/26/chrome-devtool-intro/geolocation.png" alt="geolocation"></p><h3 id="Orientation"><a href="#Orientation" class="headerlink" title="Orientation"></a>Orientation</h3><p>模擬手機的陀螺儀功能，可以到這個<a href="https://intel.github.io/generic-sensor-demos/websensor-panorama/">網站</a>，並且將 orientation 設定改為 <code>protrait upsite down</code> ，重新整理後在右邊手機的地方點著旋轉，就可以上下左右的觀看了🤩</p><p><img src="/2020/03/26/chrome-devtool-intro/orientation.png" alt="orientation"></p><p><img src="/2020/03/26/chrome-devtool-intro/orientation-result.png" alt="orientation-result"></p><h2 id="Network-Condition"><a href="#Network-Condition" class="headerlink" title="Network Condition"></a>Network Condition</h2><p>在命令列輸入 <code>network condition</code> 開啟 tab ，看到下面的 <code>user-agent</code> ，可以更改想要模擬的裝置</p><p><img src="/2020/03/26/chrome-devtool-intro/network-condition.png" alt="network-condition"></p><h2 id="Coverage"><a href="#Coverage" class="headerlink" title="Coverage"></a>Coverage</h2><p>在命令列輸入 <code>coverage</code> 開啟 tab 後點擊 refresh 的圖示，就可以看到你網站的所有 css 以及 js 檔案使用率，對於效能調教上有著很大的幫助。基本上應該是越少紅色越好，因為紅色代表著未被該頁面使用到。</p><p><img src="/2020/03/26/chrome-devtool-intro/coverage.png" alt="coverage"></p><h1 id="偵錯"><a href="#偵錯" class="headerlink" title="偵錯"></a>偵錯</h1><h2 id="design-mode"><a href="#design-mode" class="headerlink" title="design mode"></a>design mode</h2><p>在 console 的 tab 中輸入 <code>document.designMode=&#39;on&#39;</code> 就可以直接在畫面上編輯元素的文字，這對於要測試多文字樣式的確認還蠻方便的。</p><h1 id="CSS-overview"><a href="#CSS-overview" class="headerlink" title="CSS overview"></a>CSS overview</h1><p>目前在 <code>stable</code> 版本是沒有的，可以看看<a href="https://umaar.com/dev-tips/209-css-overview/">別人的介紹</a>，會讓我有點期待想要看到公司的網站會顯示什麼樣的內容</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://docs.google.com/presentation/d/e/2PACX-1vQhCWJLiTCLcEhPsL1-ixogj6vTqzv4FW5KKXb6UmxCE87Omr1CctZyXXIb4igmD1B1cdqPPacfTeN2/pub?slide=id.g71b87befdc_0_6">slide</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> chrome </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CSS] ios的iframe問題</title>
      <link href="/2020/03/14/ios-safari-iframe-issue/"/>
      <url>/2020/03/14/ios-safari-iframe-issue/</url>
      
        <content type="html"><![CDATA[<p>如果要掛載另一個網站的內容進來時，通常會使用iframe，今天要來分享一下在ios safari的bug，並且要如何解決</p><blockquote><p>iframe使用雖然方便但也要小心一些安全性的問題</p></blockquote><span id="more"></span><h1 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h1><p>發現的問題有兩個，也都蠻容易重現的，剛好有用到iframe的話，就必須要注意一下！</p><ul><li>寬度超過100%</li><li>捲動穿透看到iframe後層的內容</li></ul><p><img src="/2020/03/14/ios-safari-iframe-issue/issue.gif" alt="issue"></p><p>可以從底下的button看到，寬度是不正確的，並且在捲動的時候，有個莫名的背景出現。</p><blockquote><p> 發生環境是在 <strong>ios 11 &amp; 12</strong> ，在 <strong>ios 13</strong> 已經修正。<br>（更低版本的就沒有特別測試，因為公司產品的 app 最低也只有支援到 11）</p></blockquote><h1 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h1><p>先來看一下html的結構</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>原始網站內容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;right: 10px;bottom: 10px;width: 300px;max-width: 100%;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;height: 100%&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="寬度超過100"><a href="#寬度超過100" class="headerlink" title="寬度超過100%"></a>寬度超過100%</h2><p>首先看一下 iframe 的父層設定 <code>width: 300px;</code> ，為了讓 iframe 佔滿整個空間，因此設定 <code>width: 100%;</code> 但是在safari上偏偏就是會發現他超過了！！</p><p>必須要使用一個workaround來解決這個問題，不要直接設定 <code>width</code> 而是改成設定 <code>min-width</code> 並且加上 <code>scrolling</code> 的屬性。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">style</span>=<span class="string">&quot;width: 0;min-width: 100%;&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果同時需要支援手機和桌機的話，記得加上檢查瀏覽器版本的語法來控制 <code>scrolling</code> 的屬性</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isiOS</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="regexp">/iP(hone|od|ad)/</span>.<span class="title function_">test</span>(navigator.<span class="property">platform</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="捲動穿透"><a href="#捲動穿透" class="headerlink" title="捲動穿透"></a>捲動穿透</h2><p>捲動的問題可以透過 <code>overflow</code> 相關的兩個屬性來解決，這次就不是放在 iframe 身上，而是要放在父層才會有效果；目前測試起來不會因為手機或桌機而有所區別。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;-webkit-overflow-scrolling: touch;overflow-y: scroll;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這些問題在safari似乎存在很久，使用關鍵字 <strong>ios iframe issue</strong> 蠻容易查到相關的資料，但不知道為什麼 apple 拖到 <code>ios 13</code> 才修正掉，只能說前端真的很辛苦，要面對各種瀏覽器廠商所留下的坑。</p><p>順帶一提，如果是用mac的朋友，可以使用 <code>simulator</code> 來進行測試，還能透過本機的safari來針對device上的做檢視。</p><blockquote><p>safari真的是新一代的IE</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CSS] 利用animation做圓形的移動</title>
      <link href="/2020/02/29/circle-path-animation/"/>
      <url>/2020/02/29/circle-path-animation/</url>
      
        <content type="html"><![CDATA[<p>在畫面上的一個物件的移動方式希望能夠是圓形的，除了用javascript計算的方式以外，有沒有css的方式能做到呢？今天要來一探究竟</p><span id="more"></span><h1 id="position模擬"><a href="#position模擬" class="headerlink" title="position模擬"></a>position模擬</h1><p>不知道你會不會跟我第一時間的想法一樣，用兩點移動近似圓形的走法可不可以呢？使用 <code>animation</code> 搭配 <code>position</code> 的變化，理論上應該是可以做到這件事情</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> move&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但因為是兩點的移動是直線，這就等於要切非常細才會趨近於圓，可以想像一下…要算多久才能寫好一個圓形的移動？</p><h1 id="使用rotate"><a href="#使用rotate" class="headerlink" title="使用rotate"></a>使用rotate</h1><p>另外一個方法就是使用 <code>rotate</code> 可以更輕鬆的達成目標，首先來看一下<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotate">MDN的定義</a></p><blockquote><p>The <strong><code>rotate()</code></strong> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a> function defines a transformation that rotates an element around a fixed point on the 2D plane, without deforming it</p></blockquote><p>從定義中可以知道，<code>rotate</code> 會做角度的旋轉</p><h2 id="原地旋轉"><a href="#原地旋轉" class="headerlink" title="原地旋轉"></a>原地旋轉</h2><p>因此先寫個來測試一下旋轉這件事情，設定一個 <code>keyframe</code> 角度是從0到360</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> move&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><iframe id="cp_embed_dyoWBJw" src="//codepen.io/jiaming0708/embed/dyoWBJw?height=300&theme-id=dark&slug-hash=dyoWBJw&default-tab=[result]&editable=true" scrolling="no" frameborder="no" height="300" allowTransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><h2 id="加上移動距離"><a href="#加上移動距離" class="headerlink" title="加上移動距離"></a>加上移動距離</h2><p>現在已經有了旋轉的效果，那要讓物件有圓形的移動感，這時候可以使用 <code>translate</code> 來加上位移量</p><blockquote><p>要記得只能有一個 <code>transform</code>，儘管 <code>translate</code> 沒有變化還是要每次都寫</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> move&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><iframe id="cp_embed_KKpmjRW" src="//codepen.io/jiaming0708/embed/KKpmjRW?height=300&theme-id=dark&slug-hash=KKpmjRW&default-tab=[result]&editable=true" scrolling="no" frameborder="no" height="300" allowTransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><h2 id="維持正面"><a href="#維持正面" class="headerlink" title="維持正面"></a>維持正面</h2><p>其實這樣已經完成了八成了，但還差一點點，就是希望字不要跟著轉，這時候要用到 <code>transform</code> 的特性</p><ul><li>同一個function會累加計算</li><li>由左至右計算</li></ul><h3 id="累加計算"><a href="#累加計算" class="headerlink" title="累加計算"></a>累加計算</h3><p>那我們先來測試第一件事情，<strong>同一個function會累加計算</strong>，寫 <code>rotate</code> 一個<em>0</em>和一個<em>45</em>，最後結果會是 <em>45</em></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>) <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><iframe id="cp_embed_QWbvXVd" src="//codepen.io/jiaming0708/embed/QWbvXVd?height=300&theme-id=dark&slug-hash=QWbvXVd&default-tab=[result]&editable=true" scrolling="no" frameborder="no" height="300" allowTransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><h3 id="由左至右"><a href="#由左至右" class="headerlink" title="由左至右"></a>由左至右</h3><p><code>animation</code> 會根據數字的不同來做動畫的效果，根據上面的作法，如果 <code>rotate</code> 先給一個數字接著減去同樣的數字，是不是就能夠移動了呢？</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> move&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>) <span class="built_in">rotate</span>(-<span class="number">0deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>) <span class="built_in">rotate</span>(-<span class="number">360deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>答案是不行的，當 <code>rotate</code> 給了一個數值接著馬上減掉，這時候並不會讓 <code>animation</code> 認為這個function有變化量，因此再兩個 <code>rotate</code> 中間，必須要加上其他的 <code>function</code> 來做為緩衝，讓 <code>animation</code> 誤以為 <code>rotate</code> 有變化</p><h3 id="組合結果"><a href="#組合結果" class="headerlink" title="組合結果"></a>組合結果</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> move&#123;</span><br><span class="line">  <span class="number">0%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>) <span class="built_in">rotate</span>(-<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>) <span class="built_in">translateX</span>(<span class="number">10px</span>) <span class="built_in">rotate</span>(-<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><iframe id="cp_embed_KKpmjeW" src="//codepen.io/jiaming0708/embed/KKpmjeW?height=300&theme-id=dark&slug-hash=KKpmjeW&default-tab=[result]&editable=true" scrolling="no" frameborder="no" height="300" allowTransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這個作法一開始看到的時候，其實我根本無法理解原理，因為 <code>rotate</code> 算出來就是0阿，但為什麼他能夠引發角度的變化呢，原來是還要加上另一個特性，才能夠做出這樣的效果</p><p>另外，有興趣的話也可以加上 <code>scale</code> 或是將 <code>translate</code> 的值改變，試試看效果是什麼喔！</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><p><a href="https://www.useragentman.com/blog/2013/03/03/animating-circular-paths-using-css3-transitions/">Animating Circular Paths Using CSS3 Animations</a></p></li><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function">MDN</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>讓vscode讀懂alias path</title>
      <link href="/2020/01/31/alias-path-vscode/"/>
      <url>/2020/01/31/alias-path-vscode/</url>
      
        <content type="html"><![CDATA[<p>在專案開發的時候，為了讓import的路徑短一點，通常都會用alias來處理，例如<code>../../../components/Button</code>會用<code>@components/Button</code>來做為取代</p><blockquote><p>這邊不討論用auto import還是用alias的好壞</p></blockquote><span id="more"></span><h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import Button from &#x27;../../../components/Button&#x27;;</span></span><br><span class="line"><span class="comment">// alias</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;@components/Button&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><p>首先我們會在webpack加上resolve的設定</p><blockquote><p>相關資料可以參考<a href="https://webpack.js.org/configuration/resolve/">官網</a></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line"><span class="attr">alias</span>: &#123;</span><br><span class="line"><span class="string">&#x27;@components&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/components&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這樣的設定是為了讓編譯看的懂，但是vscode還是看不懂，當你滑鼠移動到 <code>@components/Button</code> 就無法知道真正的路徑，也沒辦法快速的用<em>f12</em>移動到檔案中看內容</p><h1 id="jsconfig"><a href="#jsconfig" class="headerlink" title="jsconfig"></a>jsconfig</h1><p>為了要能夠讓vscode讀懂alias，可以在根目錄底下建立<code>jsconfig.json</code>，在裡面加上下面的設定，儲存後不用重開只要等個幾秒，就可以測試是不是有效了！</p><blockquote><p>相關資料可以參考<a href="https://code.visualstudio.com/docs/languages/jsconfig">官網</a></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@components/*&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/components/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>在我的專案中，如果只有設定<code>baseUrl</code>和<code>paths</code>是沒有效果的，必須要搭配上<code>target</code>才能正確的解析，在使用上需要注意一下，避免設定完了結果還是不會work</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> vscode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Debug] iterm2的頁籤標題設定</title>
      <link href="/2019/10/22/iterm2-session-title/"/>
      <url>/2019/10/22/iterm2-session-title/</url>
      
        <content type="html"><![CDATA[<p>一直以來都有用 <code>iterm2</code> 作為 bash 的工具，最近不知道什麼樣的更新，讓頁籤的標題永遠都只會顯示 <code>zsh</code> ，但工作的關係，一次都會開好幾個專案在跑，那每個都顯示 <code>zsh</code> 說真的還真沒記得哪個頁籤是什麼…</p><span id="more"></span><p><img src="/2019/10/22/iterm2-session-title/incorrect_title.png" alt="incorrect_title"></p><p>上圖是壞掉的狀況，為了示範只有兩個頁籤，但是實際上在工作的時候我會開四五個，到底是哪邊的設定跑掉呢？</p><p>首先，要先定義一下名詞，在 <code>iterm</code> 裡面，每個頁籤其實叫做 session ，這樣在查找資料的時候才會比較容易，不然會像我一樣一直用 tab title 去查，查到的不一定是錯的，但就是解不了我的問題</p><h1 id="設定"><a href="#設定" class="headerlink" title="設定"></a>設定</h1><p>這個問題其實很簡單，只是一個設定跑掉而已，找了很久才找到，打開 <code>preferences</code> 的設定，進入到 <code>Profiles</code> 的頁籤，然後找到 <code>Title</code> 這個下拉選單</p><h2 id="錯誤"><a href="#錯誤" class="headerlink" title="錯誤"></a>錯誤</h2><p><img src="/2019/10/22/iterm2-session-title/profile_title_incorrect.png" alt="profile_title_incorrect"></p><p>從上面這張可以看到，只選了 <code>Job</code> 然後其他都沒了，試著每個都選選看可以看到不一樣的變化</p><h2 id="預設"><a href="#預設" class="headerlink" title="預設"></a>預設</h2><p>那預設的是什麼呢？應該要選 <code>Session Name + Job</code></p><p><img src="/2019/10/22/iterm2-session-title/profile_title_correct.png" alt="profile_title_correct"></p><p>設定完的 <code>iterm</code> 就會回到正常的資料夾顯示於標題</p><p><img src="/2019/10/22/iterm2-session-title/correct_title.png" alt="correct_title"></p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><a href="https://iterm2.com/documentation-session-title.html">https://iterm2.com/documentation-session-title.html</a></p>]]></content>
      
      
      <categories>
          
          <category> iterm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Debug </tag>
            
            <tag> iterm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[mac] Catalina的notification設定</title>
      <link href="/2019/10/14/mac-catalina-notifiction/"/>
      <url>/2019/10/14/mac-catalina-notifiction/</url>
      
        <content type="html"><![CDATA[<p>上禮拜官方release了最新的作業系統，當然要跟上體驗最新的Catalina這個作業系統，但是蘋果提昇了Catalina的一些安全性管理，如果你跟我一樣討厭被notification打擾，那可以看一下我怎麼設定</p><span id="more"></span><p>在更新完系統後，開啟各種app就會開始提示你是否允許notification，如果你跟我一樣都按 <code>Not allow(不允許)</code>然後就GG惹，會發現app的所有通知都不見（包含badge）</p><h1 id="開啟notification"><a href="#開啟notification" class="headerlink" title="開啟notification"></a>開啟notification</h1><p>接著我們要來重新設定一下</p><ol><li>在 <code>System Preferences</code> 找到 <code>Notifications</code> 並且打開</li></ol><p><img src="/2019/10/14/mac-catalina-notifiction/system_preferences.png" alt="System Preferences"></p><ol start="2"><li>找到不被允許的app，並且設定成允許通知</li></ol><p><img src="/2019/10/14/mac-catalina-notifiction/notifications.png" alt="Notifications"></p><ol start="3"><li>對我來說只需要有badge就可以，其他都不需要，將設定改成只剩下badge就好</li></ol><p><img src="/2019/10/14/mac-catalina-notifiction/enable_notification.png" alt="Enable Notification"></p><h1 id="slack設定"><a href="#slack設定" class="headerlink" title="slack設定"></a>slack設定</h1><p>只要在Notifications中沒有被列出來的app就代表沒有需要通知的功能，如果你的slack是沒有被列在裡面的，可以參考一下我的作法</p><p>前面有說到我很不喜歡太多的notification，因此我把slack設定成都沒有任何提醒只會顯示badge</p><p><img src="/2019/10/14/mac-catalina-notifiction/slack_preferences.png" alt="Slack preferences"></p><p>在這個情況下，對於Catalina來說是等於沒有需要通知這個功能，因此完全不會被列在 <code>Notifications</code> 中，那要做的事情很簡單</p><p><img src="/2019/10/14/mac-catalina-notifiction/slack_notification.png" alt="slack notification"></p><ol><li>將 <code>Nothing</code> 改成其他的任何一種</li><li>新的訊息進來時候系統就會問你是否要開啟或是關閉notification的功能</li><li>一樣到 <code>Notifications</code> 做詳細的設定</li><li>看你的習慣要不要再把slack的設定改回去成 <code>Nothing</code></li></ol><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>照習慣還是要結論一下，因為新系統的安全性提高，因此有些地方要重新設定，以免跟之前的使用習慣都不一樣。</p><blockquote><p> 如果你還沒升級或是升級以後遇到類似的情況，希望這篇能對你有所幫助</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rxjs之operator使用介紹</title>
      <link href="/2019/07/16/rxjs-operator/"/>
      <url>/2019/07/16/rxjs-operator/</url>
      
        <content type="html"><![CDATA[<p>很多人在使用rx的時候，往往遇到的瓶頸是operator的使用，因為實在太多可以使用，今天要來分享一下我曾經用過以及常用的operator是哪些</p><span id="more"></span><h1 id="operator"><a href="#operator" class="headerlink" title="operator"></a>operator</h1><p>從一開始寫Rx到現在，全部使用的operator有差不多18個左右，其中只有五個是最常用的，其他都是遇到需求而使用</p><blockquote><p>目前官方大概有100個左右</p></blockquote><h2 id="of"><a href="#of" class="headerlink" title="of"></a>of</h2><p>將參數輸出成資料流，常用建構observable之一</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).<span class="title function_">subscribe</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h2 id="from"><a href="#from" class="headerlink" title="from"></a>from</h2><p>跟<code>of</code>類似，個人蠻常用在將陣列拆解</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).<span class="title function_">subscribe</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h2 id="fromEvent"><a href="#fromEvent" class="headerlink" title="fromEvent"></a>fromEvent</h2><p>監聽element的事件最佳利器！！沒有之一XD</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fromEvent</span>(<span class="variable language_">window</span>, <span class="string">&#x27;scroll&#x27;</span>).<span class="title function_">subscribe</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>這個是最常用之一，只要有任何的物件轉換就一定會使用到，而且一段裡面可能會使用好幾次</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> (&#123;</span><br><span class="line"><span class="attr">id</span>: p.<span class="property">id</span>,</span><br><span class="line"><span class="attr">name</span>: p.<span class="property">Name</span>,</span><br><span class="line">&#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="mergeMap"><a href="#mergeMap" class="headerlink" title="mergeMap"></a>mergeMap</h2><p>把merge和map的功能合一，兩個observable資料是可以並行進來輸出</p><h2 id="switchMap"><a href="#switchMap" class="headerlink" title="switchMap"></a>switchMap</h2><p>功能與<code>mergeMap</code>類似，資料進來後會取消前面的資料重新要一次</p><h2 id="concatMap"><a href="#concatMap" class="headerlink" title="concatMap"></a>concatMap</h2><p>跟<code>mergeMap</code>類似，但會等到前一個observable結束才會執行，通常使用於前面的API結束後才能執行後面的API</p><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>顧名思義，就是過濾資料用，例如重複的資料不想要，或是只想要拿到某些資料</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">from</span>([<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>]).<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> !!p)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="tap"><a href="#tap" class="headerlink" title="tap"></a>tap</h2><p>基本上寫rx應該要讓每一個function都是pure的，減少side effect<br>但如果真的再中間需要寫入一些值的話就可以使用，另一個使用狀況就是debug啦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">from</span>([<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>]).<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> !!p),</span><br><span class="line">  <span class="title function_">tap</span>(<span class="variable language_">console</span>.<span class="property">log</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h2><p>比較多使用在unsubscribe一個observable，在angular中就是<strong>ngOnDestroy</strong>事件中，在react就是<strong>componentWillUnmount</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fromEvent</span>(<span class="variable language_">window</span>, <span class="string">&#x27;scroll&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">takeUntil</span>(<span class="variable language_">this</span>.<span class="property">destory$</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">destory$ = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">ngOneDestory</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">destory$</span>.<span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">destory$</span>.<span class="title function_">complete</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="toArray"><a href="#toArray" class="headerlink" title="toArray"></a>toArray</h2><p>前面有說到會用<code>switchMap</code>把陣列拆解開，但最後的資料就是需要陣列，這時候就很適合使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">toArray</span>()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>資料整理上的好幫手，可以把陣列拆解，然後可以輸出任何類型的資料</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from([1, 2, 3]).pipe(</span><br><span class="line">reduce((acc, value) =&gt; &#123;</span><br><span class="line">acc.push(value * 2);</span><br><span class="line">&#125;, [])</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="catchError"><a href="#catchError" class="headerlink" title="catchError"></a>catchError</h2><p>我主要應用在串接API，當發生錯誤時要先做處理然後再讓呼叫端拿到error</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="literal">undefined</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> p.<span class="property">name</span>),</span><br><span class="line">  <span class="title function_">catchError</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="comment">// 結束整個observable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Observable</span>.<span class="keyword">throw</span>(p);</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="debounceTime"><a href="#debounceTime" class="headerlink" title="debounceTime"></a>debounceTime</h2><p>收到資料沒有變化多久的時間後就會觸發，適合在不想要被頻繁觸發的事件上，例如<code>autocomplete</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fromEvent</span>(input, <span class="string">&#x27;keyDown&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">debounceTime</span>(<span class="number">200</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h2><p>跟sleep差不多的概念（笑），基本上只使用過一次，demo project為了模擬api的效果才用的</p><h2 id="bufferCount"><a href="#bufferCount" class="headerlink" title="bufferCount"></a>bufferCount</h2><p>累積n筆資料以後才輸出，輸出為陣列，但要注意，如果數量不夠，那些資料就會一直卡在拿不到！基本上也只使用過一次</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">bufferCount</span>(<span class="number">2</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="pairwise"><a href="#pairwise" class="headerlink" title="pairwise"></a>pairwise</h2><p>情境是為了要可以拿到連續配對的資料 <code>[1, 2] [2, 3] [3, 4]</code>；只使用過一次</p><blockquote><p>補充，也能用在scroll事件，可以用來判斷前次和這次的捲軸位置</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">pairwise</span>()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="bufferTime"><a href="#bufferTime" class="headerlink" title="bufferTime"></a>bufferTime</h2><p>資料需要被累積一定時間後再一起輸出，輸出為陣列；只使用過一次</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">bufferTime</span>(<span class="number">100</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>好的，介紹完曾經使用過的operator，有沒有發現有不少都非常的難用到，因為情境太少，畢竟大部分的情況都還是在整理資料或是串接的用途</p><h1 id="subject"><a href="#subject" class="headerlink" title="subject"></a>subject</h1><p>為什麼要額外提subject呢，因為這個功能實在太好用啦，使用情境來列一下</p><ul><li><p>變數值是一樣的，但希望被重複觸發</p><blockquote><p>例如alert message，什麼時候不會管，外層只需要呼叫讓component顯示就好</p></blockquote></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只會觸發一次</span></span><br><span class="line"><span class="keyword">var</span> openDialog = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//&lt;app-dialog [open]=&quot;openDialog&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openDialog$ = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line">openDialog$.<span class="title function_">next</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//&lt;app-dialog [open]=&quot;openDialog$&quot; /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>手動控制資料時間點，例如destory</li><li>需要有預設值或是取得前幾次的結果（其他subject）</li></ul><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>operator常用的就那幾個，剩下都是屬於情境型的應用，再沒有看到那種case的情況下，就是不知道這些要怎麼使用，所以也不用擔心，先開始用並且寫下去就知道<br>我也寫過一個map露露等5.60行的，先交差，後面再來想要怎麼改善，一次到位永遠都是最痛苦的</p><p>看完這篇也能看看另一篇 <a href="/2018/08/20/rx-sample/" title="Rx真實案例展示">Rx真實案例展示</a> 會更有感覺喔!</p><blockquote><p>如果覺得挑戰不夠，可以看看這個<a href="https://github.com/jiaming0708/draw-demo">repo</a>，絕對給你滿滿的應用！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> RxJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Debug] AI匯出svg小雷</title>
      <link href="/2019/07/07/ai-export-svg/"/>
      <url>/2019/07/07/ai-export-svg/</url>
      
        <content type="html"><![CDATA[<p>AI全名是Adobe Illustrator，由Adobe出的一個繪圖工具，今天為什麼會講到這個工具呢？<br>原因是最近公司要做re-brand的動作，designer出的icon都是用svg做匯出，但卻發生了顏色跑掉的問題，原本是<strong>藍色</strong>變成<strong>黑色</strong></p><span id="more"></span><blockquote><p>版本介紹</p><ul><li>Adobe Illustrator 2017 cc中文</li></ul></blockquote><h1 id="簡單介紹SVG"><a href="#簡單介紹SVG" class="headerlink" title="簡單介紹SVG"></a>簡單介紹SVG</h1><p>SVG全名是Scalable Vector Graphics，透過xml的格式撰寫，可縮放的向量圖。因為是直接把顏色當成是attribute的方式做宣告因此同一個svg要呈現不同顏色時不用再重出一張圖，只要透過css就可以做到染色的行為。</p><h1 id="問題檔案內容"><a href="#問題檔案內容" class="headerlink" title="問題檔案內容"></a>問題檔案內容</h1><p>剛剛有說到顏色可以透過attribute的方式宣告，並且可以透過css的方式做染色的行為，今天這個狀況就是發生在css的部份</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;Layer_1&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;Layer 1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"><span class="selector-class">.cls-1</span>&#123;fill:<span class="number">#231714</span>;&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>ic_audio_pause_240<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,20a9,9,0,1,1,9-9A9,9,0,0,1,12,21Z&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;9&quot;</span> <span class="attr">y</span>=<span class="string">&quot;8&quot;</span> <span class="attr">width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">height</span>=<span class="string">&quot;8&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;13&quot;</span> <span class="attr">y</span>=<span class="string">&quot;8&quot;</span> <span class="attr">width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">height</span>=<span class="string">&quot;8&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因為是透過AI產生的圖檔，class的名稱對軟體來說不重要，只要有產生預期的效果就好，因此所有的icon都是從<code>.cls-1</code>開始做命名，然後輸出的時候又是用style的方式做顏色的宣告。</p><h2 id="問題解析"><a href="#問題解析" class="headerlink" title="問題解析"></a>問題解析</h2><p>可能有人發現問題點了，**<style></style>**是一種全域的宣告，也就是說今天你的html中只要有任何一個class叫做<code>.cls-1</code>的全部都會符合這個selector被染成紅色</p><p>再加上css的特性之一，相同的宣告後面的會蓋掉前面的，也就是常在說的覆蓋，因此只要<code>.cls-1</code>這個class的顏色有不一樣，那就會變成看誰是最後被載入的，全部都會跟著變成他的顏色</p><p>請看<a href="https://codepen.io/jiaming0708/pen/dBZZmm">完整範例</a></p><h1 id="AI怎麼設定"><a href="#AI怎麼設定" class="headerlink" title="AI怎麼設定"></a>AI怎麼設定</h1><p>這個問題當然只要把svg修掉就解決，問題是每次designer出圖的時候都要在那邊檢查修改嗎？難道AI沒有辦法從輸出的時候就處理掉這個問題嗎？</p><p>首先來看一下AI輸出的畫面，點選工具列 <strong>檔案</strong> &gt; <strong>轉存</strong> &gt; <strong>轉存為螢幕適用</strong></p><p>就可以看到下方這個畫面，右側選擇格式的右上方有一個小小齒輪（紅色圈）</p><p><img src="/2019/07/07/ai-export-svg/export.png" alt="export"></p><p>點進去以後可以看到下面這個畫面，接著選到<strong>SVG</strong>看一下裡面有哪些設定</p><p><img src="/2019/07/07/ai-export-svg/export_setting.png" alt="export setting"></p><p>這次的目標是要把樣式改對，因此點選樣式設定，可以看到有三個選項</p><ul><li>內部CSS &lt;&#x3D;&#x3D; 預設</li><li>內嵌樣式</li><li>簡報屬性 &lt;&#x3D;&#x3D; 請選擇</li></ul><blockquote><p>是說有沒有人覺得<strong>簡報屬性</strong>的翻譯很難懂阿，我看到的當下完全不知道是要做什麼用…lol</p></blockquote><p>將樣式改為簡報屬性，再次輸出測試，可以看到顏色就變成使用attribute做宣告，這樣就可以打完收工</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;Layer_1&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;Layer 1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>ic_audio_pause_240<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#231714&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,20a9,9,0,1,1,9-9A9,9,0,0,1,12,21Z&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;9&quot;</span> <span class="attr">y</span>=<span class="string">&quot;8&quot;</span> <span class="attr">width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">height</span>=<span class="string">&quot;8&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">class</span>=<span class="string">&quot;cls-1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;13&quot;</span> <span class="attr">y</span>=<span class="string">&quot;8&quot;</span> <span class="attr">width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">height</span>=<span class="string">&quot;8&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這個問題真的很難遇到(?)，要不是公司要做re-brand，平常designer畫UI出mockup時用<strong>sketch</strong>這套軟體產生的檔案也都沒問題，但本著從根本解決問題，遇到的當下就拉著designer一起坐下來看有什麼地方是可以調整</p><blockquote><p>另外補充一個小雷，很多人用svg來產生圖檔之類，有的圖可能包含著漸層，如果說把圖sketch再輸出的話，漸層就會有部分被吃掉，如果是直接輸出的話就沒有這個問題喔</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Debug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Debug </tag>
            
            <tag> SVG </tag>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CSS] flex和float應用情境</title>
      <link href="/2019/06/13/flex-float-case/"/>
      <url>/2019/06/13/flex-float-case/</url>
      
        <content type="html"><![CDATA[<p>一直以來都很習慣用flex來解決排版上面的問題，但最近剛好遇到了一個情況，其實用float會更加方便，今天就來探討一下這個案例</p><span id="more"></span><h1 id="情境說明"><a href="#情境說明" class="headerlink" title="情境說明"></a>情境說明</h1><h2 id="基本題"><a href="#基本題" class="headerlink" title="基本題"></a>基本題</h2><p>有一個畫面是這樣的，在desktop的寬度下顯示三欄</p><p><img src="/2019/06/13/flex-float-case/desktop.png" alt="desktop"></p><p>ipad寬度顯示兩欄</p><p><img src="/2019/06/13/flex-float-case/ipad.png" alt="ipad"></p><p>mobile顯示一欄</p><p><img src="/2019/06/13/flex-float-case/mobile.png" alt="mobile"></p><h2 id="進階題"><a href="#進階題" class="headerlink" title="進階題"></a>進階題</h2><p>每一個欄的高度都不是固定，會根據資料來變化，並且有max-height超過時，每個欄要自己有scrollbar</p><h1 id="使用flex"><a href="#使用flex" class="headerlink" title="使用flex"></a>使用flex</h1><p>不管看到幾欄，起手勢就是先來用個flex（誤），先來看看要怎麼樣用flex來實作這塊</p><h2 id="desktop、mobile呈現"><a href="#desktop、mobile呈現" class="headerlink" title="desktop、mobile呈現"></a>desktop、mobile呈現</h2><p>這種三欄一欄的變化，對於flex來說根本是輕而易舉，只要稍微調整一下就好</p><ul><li><strong>html</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>css</strong></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#cacaca</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#E7F6FC</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* mobile */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">599px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ipad呈現"><a href="#ipad呈現" class="headerlink" title="ipad呈現"></a>ipad呈現</h2><p>使用flex最麻煩的會是ipad的2*1+1的呈現方式，因為比較不好這樣操作，這邊會分作兩種模式來寫</p><h3 id="基本題-1"><a href="#基本題-1" class="headerlink" title="基本題"></a>基本題</h3><p>html不變，只是調整一下css的寫法，加上wrap讓第三欄自動的換行，這這個缺點就是第一欄和第二欄的高度不夠彈性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1023px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.item3</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* mobile */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">599px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: unset;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.item3</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="進階題-1"><a href="#進階題-1" class="headerlink" title="進階題"></a>進階題</h3><p>先來做個簡單的微調，看看當欄位資料超過100%會發生什麼事情</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1023px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.item1</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">30%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.item2</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">75%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.item3</span>&#123;</span><br><span class="line">    <span class="attribute">flex-basis</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2019/06/13/flex-float-case/wrap-two-column-error.png" alt="錯誤的兩欄"></p><p>ㄟ～奇怪，怎麼變成三欄了，說好的兩欄呢！？但應該要怎麼完成我們的需求？其實非常的簡單就是把<code>item1</code>、<code>item2</code>包起來，以結構上來說就是變成兩欄的變化</p><p>先來把html做個調整</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column column1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column column2&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>這邊就不寫其他尺寸的css，只先寫一種case</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#cacaca</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.column</span>&#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#E7F6FC</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.column1</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用float"><a href="#使用float" class="headerlink" title="使用float"></a>使用float</h1><p>看完flex以後，接著來看看怎麼使用float做到同樣的效果，只是float比較討厭的一點就是必須要清除，不然空間會有問題</p><h2 id="desktop"><a href="#desktop" class="headerlink" title="desktop"></a>desktop</h2><ul><li><strong>html</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>css</strong></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#cacaca</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">33%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line">  <span class="attribute">clear</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ipad呈現-1"><a href="#ipad呈現-1" class="headerlink" title="ipad呈現"></a>ipad呈現</h2><p>這邊唯一的問題就是如果有邊框或是底色，第二欄就沒辦法滿版</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#cacaca</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item1</span>&#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item2</span>&#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">clear</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item3</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line">  <span class="attribute">clear</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mobile"><a href="#mobile" class="headerlink" title="mobile"></a>mobile</h2><p>這邊就都把float拉掉就行，因為block預設就是一個row的行為</p><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><p>我有一個算是潔癖？或是怪癖？希望不要出現多餘的html，像是<code>clearfix</code>的element，但是float一旦沒有被清除，parent的空間呈現上是有問題的，這時候有沒有比較好的作法呢？</p><p>有兩個方法可以解決這問題</p><ol><li><p>pseudo element</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line"><span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="attribute">display</span>: block;</span><br><span class="line"><span class="attribute">clear</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>overflow，這是一個奇淫技巧，可以發現有一樣的效果</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>其實不管用哪個來實作都可以，都可以做出目的的效果，但在寫css的時候還是可以看一下應用的情境，也許剛好那個情境會比較適合，那何必要用更麻煩的方式來完成呢</p><p>最後來推廣一下Amos的<a href="https://www.youtube.com/user/AmosLee1">youtube頻道</a>和<a href="https://www.facebook.com/cssCoke/">FB粉絲團</a>，最近在暴力班收穫滿滿阿</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[抓蟲] npm全域安裝路徑錯誤</title>
      <link href="/2019/05/25/npm-global-install-folder/"/>
      <url>/2019/05/25/npm-global-install-folder/</url>
      
        <content type="html"><![CDATA[<p>很久沒寫angular，最近接了一個小的靜態網站，想要拿牛刀來殺雞XDDD<br>第一件事情當然就是更新最新的angular cli，但是更新後系統卻跟我說 <code>ng command not found</code></p><span id="more"></span><h1 id="問題情境"><a href="#問題情境" class="headerlink" title="問題情境"></a>問題情境</h1><p>先來看看電腦環境</p><blockquote><p>macos一開始直接裝node後來改裝nvm<br>node: v9.3.0</p></blockquote><p>既然我們是用nvm那我們安裝的npm global應該是跟著nvm底下跑，但當我下指令 <code>npm i -g @angular/cli</code> 卻一直跑去另一個node version的目錄底下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/jimmy/.nvm/versions/node/v6.11.1/bin/ng -&gt; /Users/jimmy/.nvm/versions/node/v6.11.1/lib/node_modules/@angular/cli/bin/ng</span><br></pre></td></tr></table></figure><p>因此這樣在目前版本的node目錄中永遠不會有<code>@angular/cli</code>可以使用，但是到底是哪邊的設定影響到呢？</p><h1 id="問題排查"><a href="#問題排查" class="headerlink" title="問題排查"></a>問題排查</h1><h2 id="nvm版本"><a href="#nvm版本" class="headerlink" title="nvm版本"></a>nvm版本</h2><p>第一次先確認的是nvm中的node版本是不是根本就錯誤，因此先把<code>v6.11.1</code>以及<code>v9.3.0</code>版本刪掉，接著重新安裝<code>v9.3.0</code>並且設定為預設</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvm uninstall v9.3.0</span><br><span class="line">nvm uninstall v6.11.1</span><br><span class="line">nvm install v9.3.0</span><br><span class="line">nvm alias default v9.3.0</span><br></pre></td></tr></table></figure><p>再次安裝cli但還是失敗</p><h2 id="重新安裝nvm"><a href="#重新安裝nvm" class="headerlink" title="重新安裝nvm"></a>重新安裝nvm</h2><p>因此改成檢查nvm本身是不是正確的，可以參考一下這篇文章<a href="https://medium.com/@toumasaya/node-js-%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A-for-mac-a2628836feaf">Node.js 環境設定-for mac</a>，但我們按照步驟重新做完以後，再次安裝cli還是一樣的結果</p><h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><p>最後試著往npm的相關設定找，很剛好的讓我找到了<code>.npmrc</code>在根目錄底下有設定了一個<code>prefix</code>的目錄就是<code>v6.11.1</code>，先註解掉試試看，再次安裝cli果然成功，可以找到<strong>ng</strong>的指令了</p><h1 id="npmrc"><a href="#npmrc" class="headerlink" title="npmrc"></a>npmrc</h1><p>試著回想一下為什麼會設定prefix…原來是因為之前vscode的terminal都會一直說prefix有問題，因此找到了一個錯誤的設定，但也剛好能夠解決我的問題，就這樣用下去，設定完以後也一直沒有再使用其他的global套件，因此相安無事到現在orz</p><p>但我們還是要來了解一下<code>.npmrc</code>，參考一下<a href="https://docs.npmjs.com/files/npmrc">官方的文件</a></p><p>prefix的目的是什麼呢，npm的指令全部都會改成到prefix指定的路徑下，而不是目前的node目錄，因此這個如果設定在<code>~/.npmrc</code>就會發生像我一樣的悲劇</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>要解決問題也要找對資料，不然就可能造成悲劇，其實vscode會報那個錯誤是因為當初我直接安裝node變成用nvm，因此一些設定上錯誤，這次找到<a href="https://medium.com/@mvpdw06/%E8%A7%A3%E6%B1%BA-nvm-is-not-compatible-with-the-npm-config-prefix-option-currently-set-to-usr-local-%E5%95%8F%E9%A1%8C-cb1f3462ef40">其他資料</a>才發現原來問題是在用brew安裝nvm，最後成功解決問題，可以繼續使用angular啦！！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>[CSS] 在flex呈現省略號</title>
      <link href="/2019/04/16/flex-text-overflow/"/>
      <url>/2019/04/16/flex-text-overflow/</url>
      
        <content type="html"><![CDATA[<p>最近做一些新的畫面，其中有一個問題很妙，在一般的情況下要呈現省略號，其實算是蠻容易的，但在flex中卻有點麻煩，今天要來探討一下這個部分</p><span id="more"></span><h1 id="畫面架構"><a href="#畫面架構" class="headerlink" title="畫面架構"></a>畫面架構</h1><p>來看一下畫面需求是這樣，左邊有一個清單，每一張卡片裡面還分兩塊，右邊的資訊過長的時候，必須是需要呈顯省略號</p><p><img src="/2019/04/16/flex-text-overflow/layout.png" alt="layout"></p><h1 id="討論省略號"><a href="#討論省略號" class="headerlink" title="討論省略號"></a>討論省略號</h1><p>要能夠呈現省略號，必須要達成三個條件，少掉一個其實都無法看到省略號</p><ul><li>width</li><li>overflow</li><li>text-overflow</li></ul><p>後面兩個其實非常容易達成，但是width呢，在flex中該怎麼讓width固定，尤其是按照比例的那種</p><h1 id="程式撰寫"><a href="#程式撰寫" class="headerlink" title="程式撰寫"></a>程式撰寫</h1><h2 id="html結構"><a href="#html結構" class="headerlink" title="html結構"></a>html結構</h2><p>這個需求的重點是在左邊的list，因此右邊就簡單做就好，在這邊可以看到在一張card裡面會有所謂的圖片和內容區在左右兩邊，</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 重點區塊 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;descr&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">    Body</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><p>接下來來看一下css的部份，先用最直覺的寫法，結果發現怎麼都超過了阿!!</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.list</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.card</span>&#123;</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid blue;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="selector-class">.pic</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid green;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 重點區塊</span></span><br><span class="line">      <span class="selector-class">.content</span>&#123;</span><br><span class="line">        <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">0.5rem</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="selector-class">.title</span>&#123;</span><br><span class="line">          <span class="attribute">font-weight</span>: bold;</span><br><span class="line">          <span class="attribute">overflow</span>: hidden;</span><br><span class="line">          <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">          <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="selector-class">.descr</span>&#123;</span><br><span class="line">          <span class="attribute">margin-top</span>: <span class="number">0.25rem</span>;</span><br><span class="line">          <span class="attribute">overflow</span>: hidden;</span><br><span class="line">          <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">          <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.body</span>&#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2019/04/16/flex-text-overflow/overflow.png" alt="oveflow"></p><p>怎麼完全width完全沒有被控制住呢，說好的省略號呢！</p><h1 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h1><p>那先試著給width一個固定值，省略號的確可以work，跟上面所講的三要素是相同，但給固定值絕對不是我們需要的，就讓我們一起試著找一些方法來解決吧</p><h2 id="overflow-hidden"><a href="#overflow-hidden" class="headerlink" title="overflow:hidden"></a>overflow:hidden</h2><blockquote><p>這應該算是比較合理的解法</p></blockquote><p>一定會有人覺得奇怪，在 <code>.descr</code> 和 <code>.title</code> 已經有給，但為什麼還要在給呢？<br>這邊要增加的是設定在 <code>.content</code> ，因為已經設定了 <code>flex:1</code> ，這時候寬度已經被分配剩餘的空間，那我們只要加上這個屬性，就能夠正常顯示省略號</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="comment">// 重點</span></span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.title</span>&#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.descr</span>&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.25rem</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="min-width-0"><a href="#min-width-0" class="headerlink" title="min-width:0"></a>min-width:0</h2><blockquote><p>小心服用，而且不好解釋給同事聽orz</p></blockquote><p>這是一個<a href="https://css-tricks.com/flexbox-truncated-text/">查來的作法</a>，其實我也沒有很懂他的概念，也許有人比較清楚可以在分享分享，但一樣可以達到目的，讓寬度限制住，一個黑魔法來著…</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="comment">// 重點</span></span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.title</span>&#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.descr</span>&#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.25rem</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><p><a href="https://codepen.io/jiaming0708/pen/vMWaeP">codepen</a></p></li><li><p><a href="https://css-tricks.com/flexbox-truncated-text/">flexbox-truncated-text</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>postgres對於json的支援度</title>
      <link href="/2019/03/14/postgres-json/"/>
      <url>/2019/03/14/postgres-json/</url>
      
        <content type="html"><![CDATA[<p>data team的同事回報了一個bug，是我寫入的資料格式不正確，導致他們在解析資料上的有困難，先把寫入資料的問題解決以後，要幫忙把錯誤的資料導正回來，才發現postgres對於json的支援度蠻高</p><span id="more"></span><h1 id="緣由"><a href="#緣由" class="headerlink" title="緣由"></a>緣由</h1><p>先來說說這種資料格式怎麼產生的，我們有一個academy的網站，app會用web view的方式開啟，為了要追蹤這是由哪邊連近來的，所以app在開網頁的時候會加上query parameter給我們，並且我們將這些資訊寫入到db作為觀看記錄</p><p>格式大概會是這樣 <code>?region=tw&amp;platform=android</code>，但是就出現了這種情況<code>?region=tw&amp;platform=android&amp;region=tw&amp;patform=android</code>，收到了雙份的參數，導致寫入的時候變成了錯誤的格式</p><p>寫入的資料變成這樣</p><table><thead><tr><th></th><th>region</th><th>platform</th></tr></thead><tbody><tr><td>正常</td><td>tw</td><td>android</td></tr><tr><td>錯誤</td><td>{‘tw’,’tw’}</td><td>{‘android’,’android’}</td></tr></tbody></table><h1 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h1><p>這個資料格式第一眼看到，就是往json的方向去找，剛好查到postgres<a href="https://www.postgresql.org/docs/9.3/functions-json.html">官方文件</a>表示從<strong>9.3</strong>的版本以後就可以直接使用</p><p>因此就馬上很開心的使用了裡面的一個function叫做<code>json_object_keys</code>是用來拿到json物件的key值，沒想到收到錯誤是傳進去的值不對，馬上試著用另一個看看<code>to_json</code>，沒想到一樣收到錯誤說這個資料格式不正確</p><p>原來這個根本不是json物件，而是一個不知道什麼的資料格式，那該怎麼辦呢</p><h2 id="資料轉型"><a href="#資料轉型" class="headerlink" title="資料轉型"></a>資料轉型</h2><p>幸好，還有另一種轉型的function叫做<code>array_to_json(anyarray [, pretty_bool])</code>，我們可以這樣使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_to_json(region::text[]) <span class="keyword">from</span> table1</span><br><span class="line"><span class="comment">-- [&#x27;tw&#x27;, &#x27;tw&#x27;]</span></span><br></pre></td></tr></table></figure><p>並且得到一個正確的json陣列，接著就能根據這樣的資料透過json function做解析</p><h2 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h2><p>在postgres有提供一種operator的寫法，來取得json物件的資料</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#123;&quot;tw&quot;:123&#125;&#x27;</span>::json<span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;tw&#x27;</span></span><br><span class="line"><span class="comment">-- 123</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[&quot;tw&quot;, 123]&#x27;</span>::json<span class="operator">-</span><span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"><span class="comment">-- &quot;tw&quot;</span></span><br></pre></td></tr></table></figure><p>那我們就來試試看搭配我們的資料，沒錯啦，可以完美的拿到資料，但有沒有發現一個小缺點資料是<code>&#39;tw&#39;</code>帶著單引號的</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_to_json(region::text[])::json<span class="operator">-</span><span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">from</span> table1</span><br><span class="line"><span class="comment">-- &#x27;tw&#x27;</span></span><br></pre></td></tr></table></figure><p>這時候要用另一個方法來拿到只有<code>tw</code>的資料，使用<code>&gt;&gt;</code>，真是太完美了！</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_to_json(region::text[])::json<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="number">0</span> <span class="keyword">from</span> table1</span><br><span class="line"><span class="comment">-- tw</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>在postgres的json相關功能提供的蠻齊全，並且也有支援json作為欄位格式，在使用上就更加的彈性</p><p>這次的意外順便學到了一個新的東西，順便碰一下很久沒有碰到的資料庫，趕快把技能點上來XD</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://www.postgresql.org/docs/9.3/functions-json.html">JSON Functions and Operators</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Postgres </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Postgres </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react component重構心得分享</title>
      <link href="/2019/03/12/react-refactor-component/"/>
      <url>/2019/03/12/react-refactor-component/</url>
      
        <content type="html"><![CDATA[<p>最近在寫新的功能時，因為有些跟舊有的功能有關係，所以一定會去改到原本的code，沒去看都不知道，看了大罵WTF，這也太噁心了吧…</p><p>寫過react的人都知道，component分為兩種，一個是class component，而另一個就是pure component，不管用哪一種，不知道各位可以接受一個js(x)的行數有多少，或者更精準的是render幾行內你可以接受</p><span id="more"></span><p>先說說我可以接受的一個render element大概是50行內，但通常我自己寫是10行左右，我是覺得一個element如果超過太多，閱讀性整個會很差，不管是不是包含邏輯</p><h1 id="可怕的component"><a href="#可怕的component" class="headerlink" title="可怕的component"></a>可怕的component</h1><p>先來看看底下這段，經過一點點的處理，但基本上架構是跟原本一樣</p><script src="//gist.github.com/9218dae11fca571f215a0173de9e09ad.js?file=HugeComponent.jsx"></script><blockquote><p> 現在需求來了，要增加一個button在sidebar，請問你要花多久時間才能夠增加</p></blockquote><h1 id="重構"><a href="#重構" class="headerlink" title="重構"></a>重構</h1><p>第一次看到的時候，完全不知道怎麼下手，所以我打算要做一件事情<strong>重構</strong>，先把element整理的比較好懂一點，就讓我們來動作試試看吧</p><h2 id="先抽變數後的"><a href="#先抽變數後的" class="headerlink" title="先抽變數後的"></a>先抽變數後的</h2><p>看到程式中，有一些element是根據變數來決定要不要render，這種的最好被拉出來，因此我們先針對這種來做</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showCancelPopup &amp;&amp; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onClose</span>=<span class="string">&#123;this.closePopup&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>把上面的這種element變成獨立的function，讓主render可以看起來輕鬆一點，從原本的190行變成90行</p><blockquote><p><a href="https://gist.github.com/jiaming0708/9218dae11fca571f215a0173de9e09ad#file-hugestep1-jsx">完整的可以看這邊</a></p></blockquote><script src="//gist.github.com/9218dae11fca571f215a0173de9e09ad.js?file=HugeStep1OnlyRender.jsx"></script><h2 id="區塊抽離"><a href="#區塊抽離" class="headerlink" title="區塊抽離"></a>區塊抽離</h2><p>做完第一步以後，覺得有舒服一點，但還是不夠好，閱讀了一下整個結構，發現其實是可以分為幾個區塊，接下來就針對這些來動個手術</p><p>把兩個最大的拆出去以後，主render就只剩下20行，整個爽度都上來了</p><blockquote><p><a href="https://gist.github.com/jiaming0708/9218dae11fca571f215a0173de9e09ad#file-hugestep2-jsx">完整的可以看這邊</a></p></blockquote><script src="//gist.github.com/9218dae11fca571f215a0173de9e09ad.js?file=HugeStep2OnlyRender.jsx"></script><h2 id="component化"><a href="#component化" class="headerlink" title="component化"></a>component化</h2><p>做完前面兩個步驟，已經可以先交卷，為什麼會這樣說，主力的時間應該都在feature上面，重構只是順帶一做，當然如果有足夠的時間一定要把這步驟做完，整個才會夠乾淨</p><p>要做這步驟前一定是前面兩個做完，才有機會做到，至於這個component有沒有機會被共用這又是另一件事情了，這邊不討論</p><p>接著來說一下我怎麼規劃component，主要考量會是這兩個部分</p><h3 id="資料的來源"><a href="#資料的來源" class="headerlink" title="資料的來源"></a>資料的來源</h3><p>理論上我們會希望這是一個pure component，所以資料都是由外面傳進來，但會不會有那種資料反而是去redux中取得會比較好？例如說資料只有這個component用，結果已經傳遞了n層</p><h3 id="事件的觸發"><a href="#事件的觸發" class="headerlink" title="事件的觸發"></a>事件的觸發</h3><p>是把事件往外傳，還是直接由component呼叫redux的action執行？</p><h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>講了那麼多，就來實作一下，把<code>renderCancelPopup</code>變成component，至於為什麼我會拿這個，因為這個行為最為單純，最適合第一時間重構</p><p>總共有三個事件，那我們都讓事件往外傳，至於文字要不要是外面傳的就看你囉，基本上非共用的我比較不會從外面傳，除非真的超級少</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">CancelPopup</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    t,</span></span><br><span class="line"><span class="params">    closePopup,</span></span><br><span class="line"><span class="params">    cancelQ,</span></span><br><span class="line"><span class="params">&#125;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClose</span>=<span class="string">&#123;closePopup&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">SimpleDialog</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">title</span>=<span class="string">&#123;t(</span>&#x27;&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">theme</span>=<span class="string">&#123;dialogTheme&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">theme</span>=<span class="string">&#123;gray&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">ghost</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;closePopup&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">text</span>=<span class="string">&#123;t(</span>&#x27;&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">theme</span>=<span class="string">&#123;pink&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;cancelQ&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">text</span>=<span class="string">&#123;t(</span>&#x27;&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">SimpleDialog</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在render就可以變成這樣</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;showCancelPopup &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">CancelPopup</span> <span class="attr">closePopup</span>=<span class="string">&#123;closePopup&#125;</span> <span class="attr">cancelQ</span>=<span class="string">&#123;cancelQ&#125;</span> /&gt;</span></span>&#125;</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>在一開始寫的時候我也傾向先不拆分，因為那時候這個component的拆法和行為整個都還不是非常確定，而等到整個行為比較確定以後，再來開始進行重構的動作，讓自己好閱讀以外，也讓review你的code的人不會腦袋打結</p><p>這個功能的重構，我目前只有做到第二步以後就交卷了，要等下個sprint稍微有空一點的時候才有辦法來處理</p><blockquote><p> 重構是必經的路程，適時的重構可以讓心情愉悅，不用鬱悶的寫到吐血</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[JS] date自定義格式</title>
      <link href="/2019/03/03/js-date-parse-regex/"/>
      <url>/2019/03/03/js-date-parse-regex/</url>
      
        <content type="html"><![CDATA[<p>前幾天收到QA開的一個bug，是關於日期時間顯示的錯誤，因為開發習慣都是以chrome為主，所以沒特別發現問題，結果QA是在firefox使用而發現的bug，經過追查以後才發現是字串轉成日期格式有問題</p><span id="more"></span><h1 id="日期格式"><a href="#日期格式" class="headerlink" title="日期格式"></a>日期格式</h1><p>從後端來的資料格式是<code>2019-03-03 10:35:15 +0800</code>，如果用chrome可以正確的解析出來，但如果是用firefox、safari則會出現<code>NaN</code>代表著轉換失敗，遇到這種狀況就是先去查一下文件，確認標準格式是什麼，並且測試看看怎樣的轉換是可以work的</p><p>根據<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse#Date_Time_String_Format">MDN文件</a>表示，支援三種ISO格式</p><blockquote><p>這邊不使用GTM，是因為資料格式差異比較大，轉換上更麻煩</p></blockquote><ul><li>只有日期<code>2011-10-10</code></li><li>日期加時間<code>2011-10-10T14:48:00</code></li><li>毫秒加時區<code>2011-10-10T14:48:00.000+09:00</code></li></ul><p>從這邊可以知道後端回來的格式跟標準還是有所差異，但因為這個改動會影響到app端，因此就只好web這邊自己改掉，解決的方法很簡單，就是給所謂的自訂格式</p><h1 id="自訂格式"><a href="#自訂格式" class="headerlink" title="自訂格式"></a>自訂格式</h1><p>如果你有寫過其他語言，可能都會有提供這樣的方法<code>new Date(&quot;2011-10-10 14:48:00&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;)</code>，但是在js中並沒有提供，因此你就必須要自己拆解字串去做到這樣的事情</p><p>拆解字串的作法很多種，這邊提供兩種比較常見的</p><h2 id="字串拆解"><a href="#字串拆解" class="headerlink" title="字串拆解"></a>字串拆解</h2><p>固定格式這種的最簡單就是直接拆解字串硬解</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dateString = <span class="string">&#x27;2019-03-03 10:35:15 +0800&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> date = dateString.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> time = dateString.<span class="title function_">substring</span>(<span class="number">11</span>, <span class="number">19</span>);</span><br><span class="line"><span class="keyword">const</span> zoneHour = dateString.<span class="title function_">substring</span>(<span class="number">20</span>, <span class="number">23</span>);</span><br><span class="line"><span class="keyword">const</span> zoneMin = dateString.<span class="title function_">substring</span>(<span class="number">23</span>);</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`<span class="subst">$&#123;date&#125;</span>T<span class="subst">$&#123;time&#125;</span><span class="subst">$&#123;zoneHour&#125;</span>:<span class="subst">$&#123;zoneMin&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><h2 id="使用regex"><a href="#使用regex" class="headerlink" title="使用regex"></a>使用regex</h2><p>另外一種作法，就是moment或是luxon的作法，用regex來解析，但在專案中還是有點寫死，不太像是他們是用定義的比較活一點</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dateString = <span class="string">&#x27;2019-03-03 10:35:15 +0800&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> dateFormat = <span class="regexp">/^(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;) (\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;) (\+\d&#123;2&#125;)(\d&#123;2&#125;)$/</span>;</span><br><span class="line"><span class="keyword">const</span> matchs = dateString.<span class="title function_">match</span>(dateFormat);</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`<span class="subst">$&#123;matchs[<span class="number">1</span>]&#125;</span>T<span class="subst">$&#123;matchs[<span class="number">2</span>]&#125;</span><span class="subst">$&#123;matchs[<span class="number">3</span>]&#125;</span>:<span class="subst">$&#123;matchs[<span class="number">4</span>]&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這個問題的最佳解會是從backend傳回來的資料格式就應該是iso，就不用這麼麻煩的做這些workaround。也許會問為什麼不直接把luxon引入使用就好，雖然<code>luxon</code>已經比<code>moment</code>還要小，但還是相對用到的功能來說是相對肥阿，不如參考別人的作法，在自己專案中實作比較好</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><a href="https://github.com/moment/luxon">luxon repo</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> regex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rx用expand達成recursive</title>
      <link href="/2019/02/25/rx-expand/"/>
      <url>/2019/02/25/rx-expand/</url>
      
        <content type="html"><![CDATA[<p>昨天看了一部<a href="https://www.youtube.com/watch?v=6qw3d3eCIOA">影片</a>，是由大神Ben介紹expand的功能</p><p>這篇是跟著實作並且去理解使用，將透過pagination的應用來做介紹，每頁10筆，假設不確定會有幾頁，要全部都拿回來的話可以怎麼實作</p><span id="more"></span><h1 id="模擬API資料"><a href="#模擬API資料" class="headerlink" title="模擬API資料"></a>模擬API資料</h1><p>首先我們要先有模擬api的功能，因此我們寫一段rx並帶上500的timer作為示意，這邊就固定只給到10頁</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getPagedData</span> = index =&gt; <span class="title function_">timer</span>(<span class="number">500</span>).<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">map</span>(<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">    <span class="attr">pageIndex</span>: index,</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">10</span> &#125;, <span class="function">(<span class="params">_, i</span>)=&gt;</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: (index * <span class="number">10</span>) + i,</span><br><span class="line">      <span class="attr">data</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">    &#125;)),</span><br><span class="line">    <span class="attr">nextPageIndex</span>: index &lt; <span class="number">10</span> ? index + <span class="number">1</span>: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;)),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="title function_">getPagedData</span>(<span class="number">0</span>);</span><br><span class="line">source.<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(p));</span><br></pre></td></tr></table></figure><p>執行後可以看到這樣的資料，那初期的準備就完成了</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    data<span class="punctuation">:</span> Array<span class="punctuation">[</span><span class="number">10</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    nextPageIndex<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    pageIndex<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="recursive實作"><a href="#recursive實作" class="headerlink" title="recursive實作"></a>recursive實作</h1><p>如果用原本熟悉的那些operator下去做，會怎麼實作呢？這時候我會使用subject來達到這個目的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nextPage$ = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line"></span><br><span class="line">nextPage$.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">concatMap</span>(<span class="function"><span class="params">index</span> =&gt;</span> <span class="title function_">getPagedData</span>(index))</span><br><span class="line">).<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;nextPageIndex&#125; = p;</span><br><span class="line">    <span class="keyword">if</span>(nextPageIndex !== <span class="literal">undefined</span>)&#123;</span><br><span class="line">        nextPage$.<span class="title function_">next</span>(nextpageIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">nextPage$.<span class="title function_">next</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>其實subscribe的那段判斷，可以拉上去變成用tap來做</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = nextPage$.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">concatMap</span>(<span class="function"><span class="params">index</span> =&gt;</span> <span class="title function_">getPagedData</span>(index)),</span><br><span class="line">    <span class="title function_">tap</span>(&#123;nextPageIndex&#125; =&gt; nextPageIndex !== <span class="literal">undefined</span> &amp;&amp; nextPage$.<span class="title function_">next</span>(nextpageIndex))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="重構改用expand"><a href="#重構改用expand" class="headerlink" title="重構改用expand"></a>重構改用expand</h1><p>但rx有提供更好的寫法，就是<code>expand</code>先來看看官方的說法</p><blockquote><p>Recursively projects each source value to an Observable which is merged in the output Observable.</p></blockquote><p>這非常類似於<code>mergeMap</code>但在條件完成前就是不斷的呼叫同一個方法，直到呼叫<code>EMPTY</code>為止，那就來試著改寫上面的那段程式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">expand</span>(&#123;nextPageIndex&#125; =&gt; nextPageIndex !== <span class="literal">undefined</span> ? <span class="title function_">getPagedData</span>(nextPageIndex) : <span class="variable constant_">EMPTY</span>)</span><br></pre></td></tr></table></figure><p>哇賽，整個變得好簡潔呢，但是來源資料要怎麼給呢？<br>因為我們改成用<code>expand</code>，因此資料要符合他的格式，才能讓他遞迴下去，因此就改成用這樣的寫法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = <span class="title function_">of</span>(&#123;<span class="attr">nextPageIndex</span>: <span class="number">0</span>&#125;).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">expand</span>(&#123;nextPageIndex&#125; =&gt; nextPageIndex !== <span class="literal">undefined</span> ? <span class="title function_">getPagedData</span>(nextPageIndex) : <span class="variable constant_">EMPTY</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>雖然這個應用場景我還沒遇到，但能多學到一個operator是還蠻不錯的，畢竟rx所提供的operator還蠻多的，而且只看範例完全無法想像那個應用情境，剛好有大神開示，試著自己玩玩看還不錯！</p><p>完整的程式碼可以到<a href="https://stackblitz.com/edit/rxjs-expend?file=index.ts">這邊</a>來看！</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><a href="https://rxjs.dev/api/operators/expand">https://rxjs.dev/api/operators/expand</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> RxJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[GTM] pageview加上content group</title>
      <link href="/2019/02/19/gtm-content-group/"/>
      <url>/2019/02/19/gtm-content-group/</url>
      
        <content type="html"><![CDATA[<p>最近有一個需求是在特定頁面要加上content group的資料，很多的功能用GA都還蠻簡單，但是用了GTM就會變得比較複雜一點，今天來分享一下用GTM怎麼完成這個需求</p><span id="more"></span><p>#設定GA</p><p>最一開始當然就是要先把GA設定起來，這樣後續才有辦法做測試並且確認資料是否正確，首先contnet group是設定在<code>view</code>底下而不是<code>property</code>，所以要先到admin中找到<code>Content Grouping</code>的設定</p><p><img src="/2019/02/19/gtm-content-group/admin-view.png" alt="admin-view"></p><p>接著點擊新增然後輸入Name和index，在規劃的時候也要注意一下content group只能有五組</p><blockquote><p>這邊要注意新增後只能停用不能刪除</p></blockquote><p><img src="/2019/02/19/gtm-content-group/create-content-grouping.png" alt="create-content-grouping"></p><p>有注意到圖的最下面，有給一些範例要怎麼去寫入這個資料，但這個對於我們要搭配GTM的來說，其實是沒什麼幫助的，因此可以忽略不看</p><h1 id="設定GTM"><a href="#設定GTM" class="headerlink" title="設定GTM"></a>設定GTM</h1><h2 id="Data-Layer-Variable"><a href="#Data-Layer-Variable" class="headerlink" title="Data Layer Variable"></a>Data Layer Variable</h2><p>GTM有一個功能叫做<strong>Data Layer Variable</strong>，這個可以接收從web打上來的一些資料，但缺點是資料會一直保留到清除為止，因此除了DL以外還要設定一個<strong>Custom Function</strong></p><ul><li><p>DL-TYPE(<strong>Data Layer Variable</strong>)<br>名稱就給他<code>TYPE</code>，在程式我們只要給對應的名稱GTM就會對應到<br><img src="/2019/02/19/gtm-content-group/DL-TYPE.png" alt="DL-TYPE"></p></li><li><p>Get TYPE<br>寫一個判斷式，當網址不是指定頁面(<strong>post</strong>)的時候要給其他值，避免掉資料殘留的問題，因為網站本身架構比較單純主要分兩個頁面，HOME、POST，所以只要簡單判斷並且給一個定值就好</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> val = &#123;&#123;<span class="variable constant_">DL</span>-<span class="variable constant_">TYPE</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">var</span> path = &#123;&#123;<span class="title class_">Page</span> <span class="title class_">Path</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">if</span>(!<span class="regexp">/(\/post\/)/</span>.<span class="title function_">test</span>(path))&#123;</span><br><span class="line">      val = <span class="string">&#x27;HOME&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="GA-Setting"><a href="#GA-Setting" class="headerlink" title="GA Setting"></a>GA Setting</h2><p>接著就可以在<code>Google Analytics Settings</code>加上content group的設定，打開<code>More Setting</code>找到<code>Content Groups</code>新增一個index是1，值從<code>Get TYPE</code>這個function取得<br><img src="/2019/02/19/gtm-content-group/GA-setting.png" alt="GA-setting"></p><h1 id="Send-Data-Layer"><a href="#Send-Data-Layer" class="headerlink" title="Send Data Layer"></a>Send Data Layer</h1><h2 id="push-data-layer"><a href="#push-data-layer" class="headerlink" title="push data layer"></a>push data layer</h2><p>TYPE的資料是<code>componentDidMount</code>的時候透過API拿回來，因此我們可以在這邊再打出Data Layer資料</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">dataLayer</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="string">&#x27;TYPE&#x27;</span>: <span class="string">&#x27;VIDEO&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>寫完使用preview的功能看一下有沒有資料，慘～怎麼都沒拿到，再仔細思考一下整個流程</p><blockquote><p>home -&gt; (page view) -&gt; post -&gt; (send data layer)</p></blockquote><p>從首頁到post頁面的時候，就已經會先打一個history，然後在GTM會發一個page view出去，然後post頁面會等到api回來的時候才打datalayer，這時候GTM已經把資料送出去根本不會包含datalayer</p><h2 id="event取代history"><a href="#event取代history" class="headerlink" title="event取代history"></a>event取代history</h2><p>上面的狀況導致我們不能直接在history change就送page view，因此要改一下時機點，變成是由程式自己發一個事件，這時候在triggers新增一個<code>Custom Event</code><br><img src="/2019/02/19/gtm-content-group/post-view-event.png" alt="post-view-event"></p><p>當然也要過濾掉原本的history設定，從<code>All History Changes</code>改成<code>Some History Changes</code>，並且設定path不包含 <code>/post/</code><br><img src="/2019/02/19/gtm-content-group/hisotry-event.png" alt="hisotry-event"></p><p>整個設定完以後，程式也在<code>componentDidMount</code>發送event，就可以用preview看看結果是不是如預期！</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這個功能其實很簡單，官方也有說明怎麼設定，但因為時間點的問題，導致要多做一些動作，才能達到原本的預期，如果說你只是一個url的值當做content group，就完全可以忽略上面所講的這些</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> GTM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GTM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>quokka搭配webpack設定</title>
      <link href="/2019/02/15/quokka-webpack/"/>
      <url>/2019/02/15/quokka-webpack/</url>
      
        <content type="html"><![CDATA[<p><a href="https://quokkajs.com/">quokka</a>是一個測試工具，支援蠻多的編輯器，可以直接即時的就看到結果，所以大部分都是開發或是測試的時候可以拿出來使用</p><p>在使用webpack作為打包編譯的工具的時候，有一些設定會讓quokka看不懂，這邊就來介紹一下怎麼設定</p><span id="more"></span><h1 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h1><p>在專案中通常會加上alias的設定，這樣可以讓import比較乾淨，大概會像是這樣設定</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="attr">resolve</span>: &#123;</span><br><span class="line">            <span class="attr">alias</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;@app&#x27;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./app&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那在程式中通常會這樣寫</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">&#x27;@app/services/api&#x27;</span>;</span><br></pre></td></tr></table></figure><p>但是這個時候使用quokka會告訴你找不到這個module，根據<a href="https://quokkajs.com/docs/configuration.html">官方的文件</a>可以透過設定<code>.quokka</code>的檔案(<em>json  format</em>)，來讓工具看的懂</p><h2 id="without-babel"><a href="#without-babel" class="headerlink" title="without babel"></a>without babel</h2><p>alias有兩種方法，一個是有babel，當然另一種就是沒有，這兩個都有寫好的套件可以使用<br>首先介紹一下沒有babel的情況下要使用<a href="https://github.com/Gozala/alias-quokka-plugin">alias-quokka-plugin</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --save --dev alias-quokka-plugin</span><br></pre></td></tr></table></figure><p>再來就是把<code>.quokka</code>的檔案產生好</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;alias-quokka-plugin&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@app&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>設定完以後就不用怕啦，開始使用在程式裡面吧</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> api = <span class="built_in">require</span>(<span class="string">&#x27;@app/services/api&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="with-babel"><a href="#with-babel" class="headerlink" title="with babel"></a>with babel</h2><p>有使用babel的話，我們要安裝另一個套件<a href="https://github.com/timhuff/babel-alias-quokka-plugin">babel-alias-quokka-plugin</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --save --dev babel-alias-quokka-plugin</span><br></pre></td></tr></table></figure><p>改一下<code>.quokka</code>檔案的內容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;babel&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;babel-alias-quokka-plugin&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@app&quot;</span><span class="punctuation">:</span><span class="string">&quot;./app&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>可以看到這邊主要多了一個設定叫做<code>babel</code>，那預設會載入<code>.babelrc</code>並且env是<strong>test</strong>，當然你也可以特別指定env之類的，但我是全部都交給<code>babelrc</code>就好，<code>.quokka</code>只做最基本的設定</p><h1 id="global-variable"><a href="#global-variable" class="headerlink" title="global variable"></a>global variable</h1><p>很開心的設定完上面的步驟，一按下去執行，🤬又有錯誤，這次是**<code>__CLIENT__</code>**找不到，突然想到在webpack中有定義了一些屬於全域型的變數</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in webpack.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">    <span class="attr">__CLIENT</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="自定plugin"><a href="#自定plugin" class="headerlink" title="自定plugin"></a>自定plugin</h2><p>這時候我們就要採用自訂plugin的方式，宣告一個變數讓quokka看懂，這時候就先產生一個<code>quokkaPlugin.js</code>的檔案</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">global</span>.<span class="property">__CLIENT__</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>在<code>.quokka</code>的設定中，把這個檔案當做plugin放進去</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;babel&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;./quokkaPlugin.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;babel-alias-quokka-plugin&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@app&quot;</span><span class="punctuation">:</span><span class="string">&quot;./app&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>終於設定完畢，可以正常的使用<code>quokka</code>這個工具，如果你的import很多的話，可能會使用到<strong>Pro</strong>的版本，可以先看一下官方的差異介紹，試用後再決定要不要買</p><p>如果你是有套用完整的測試框架像是jest或是protractor，就要改使用<a href="https://wallabyjs.com/">wallaby</a>，絕對可以讓你享受到TDD的紅綠燈開發方式</p><p>再設定上面如果有一些問題的話可以去參考官方的<a href="https://github.com/wallabyjs">repo</a>，裡面有非常多種的範例</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Quokka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[crop系列] 5 完整實作</title>
      <link href="/2019/01/09/crop/"/>
      <url>/2019/01/09/crop/</url>
      
        <content type="html"><![CDATA[<p>系列文終於要來到最終章，前面的每一個都是重要的元素，但要怎麼整合起來會在這篇完整的交代</p><span id="more"></span><blockquote><p>如果還沒看過系列其他篇的麻煩這邊請</p><a href="/2018/12/20/css-scale-position/" title="[crop系列] 1 scale和position的糾葛">[crop系列] 1 scale和position的糾葛</a>、<a href="/2018/12/22/canvas-drawimage/" title="[crop系列] 2 canvas drawimage應用">[crop系列] 2 canvas drawimage應用</a>、<a href="/2018/12/25/css-mask/" title="[crop系列] 3 圖片mask">[crop系列] 3 圖片mask</a>、<a href="/2019/01/08/crop-drag/" title="[crop系列] 4 drag實作">[crop系列] 4 drag實作</a></blockquote><blockquote><p>使用react作為範例</p></blockquote><h1 id="準備畫面"><a href="#準備畫面" class="headerlink" title="準備畫面"></a>準備畫面</h1><p>既然這是最終章，當然就是要把畫面什麼的都準備好啦，這邊就直接來把html、css準備好<br>畫面的功能是這樣，一開始進去要先上傳圖片，然後接著可以開始放大&#x2F;縮小&#x2F;移動，最後按下確定，把區域內的畫面顯示出來</p><h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;file-input&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;file&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">accept</span>=<span class="string">&#x27;image/*&#x27;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;crop-root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;photo-block&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;photo-mask&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">img</span> <span class="attr">draggable</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">draggable</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zoom-block&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zoom-out&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;slide&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;range&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">min</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">max</span>=<span class="string">&quot;1.5&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">step</span>=<span class="string">&quot;0.01&quot;</span></span></span><br><span class="line"><span class="tag">              /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zoom-in&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button-block&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">              cut</span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最後顯示用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.crop-root</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#808080</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.photo-block</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">440px</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">img</span>&#123;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="selector-tag">object</span>-fit: contain;</span><br><span class="line">      <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp; &gt; <span class="selector-tag">img</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#ffffff</span>;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.photo-mask</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">clip-path</span>: circle(<span class="number">125px</span> at center <span class="number">180px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.zoom-block</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">18px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%zoomIconLine&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#808080</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: calc(<span class="number">50%</span> - <span class="number">1px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%zoomIcon&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.zoom-out</span>&#123;</span><br><span class="line">    <span class="keyword">@extend</span> %zoomIcon;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">        <span class="keyword">@extend</span> %zoomIconLine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.zoom-in</span>&#123;</span><br><span class="line">    <span class="keyword">@extend</span> %zoomIcon;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">        <span class="keyword">@extend</span> %zoomIconLine;</span><br><span class="line">        <span class="attribute">transform</span>: rotate(-<span class="number">90deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">        <span class="keyword">@extend</span> %zoomIconLine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="scale和drag結合"><a href="#scale和drag結合" class="headerlink" title="scale和drag結合"></a>scale和drag結合</h1><h2 id="scale計算"><a href="#scale計算" class="headerlink" title="scale計算"></a>scale計算</h2><p>前面用了兩篇各自的講到scale和drag，但是這兩個結合在一起以後計算的方式一定會有所不一樣，現在我們要把這塊完成</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parent = <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">parentNode</span>;</span><br><span class="line"><span class="keyword">const</span> maxLeft = parent.<span class="property">offsetWidth</span> - <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetWidth</span>;</span><br><span class="line"><span class="keyword">const</span> maxTop = parent.<span class="property">offsetHeight</span> - <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetHeight</span>;</span><br><span class="line"></span><br><span class="line">point = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="title function_">validValue</span>(point.<span class="property">left</span>, <span class="number">0</span>, maxLeft),</span><br><span class="line">  <span class="attr">top</span>: <span class="variable language_">this</span>.<span class="title function_">validValue</span>(point.<span class="property">top</span>, <span class="number">0</span>, maxTop),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上面是前一篇所用的方法，如果不管邊界值，我們只要把<code>this.dragNode</code>的<code>offsetWidth</code>乘上scale值就可以</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parent = <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">parentNode</span>;</span><br><span class="line"><span class="keyword">const</span> maxLeft = parent.<span class="property">offsetWidth</span> - (<span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetWidth</span> * zoomValue);</span><br><span class="line"><span class="keyword">const</span> maxTop = parent.<span class="property">offsetHeight</span> - (<span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetHeight</span> * zoomValue);</span><br></pre></td></tr></table></figure><p>接下來我們要把邊界的條件拉近來，並且邊界從四周改成中間的圓，也就是圖片不能超過圓形的範圍，因此計算的方式要重新來</p><h2 id="圓為邊界"><a href="#圓為邊界" class="headerlink" title="圓為邊界"></a>圓為邊界</h2><p>前面我們所用到的邊界取值的方式還記得嗎，<strong>使用目前值和最大最小做計算</strong>。<br>用圓當做邊界也是一樣，我們要拿到圓的上下左右四個值，而不能偷懶直接用0當做最小值，這邊先來個暖身沒有任何scale的問題要帶入</p><p>我們只要拿一邊來做計算，因此思考的方式要調整一下，先來看一下操作模式<br><img src="/2019/01/09/crop/move.gif" alt="move"></p><p>當圖左邊拉到圓的左邊時就要停止，而反邊的話是左邊拉到圓的右邊減去寬度，因此我們可以用這兩個值當做最大和最小</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> circle = &#123;</span><br><span class="line">    <span class="attr">radius</span>: <span class="number">125</span>,</span><br><span class="line">    <span class="attr">offsetY</span>: <span class="number">54</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//　取得圓在drag區域的offset</span></span><br><span class="line"><span class="keyword">const</span> photoRect = <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">parentNode</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line"><span class="keyword">let</span> circleNode = &#123;</span><br><span class="line">  <span class="attr">left</span>: (photoRect.<span class="property">width</span> / <span class="number">2</span>) - circle.<span class="property">radius</span>,</span><br><span class="line">  <span class="attr">top</span>: circle.<span class="property">offsetY</span>,</span><br><span class="line">&#125;;</span><br><span class="line">circleNode = &#123;</span><br><span class="line">  ...circleNode,</span><br><span class="line">  <span class="attr">right</span>: circleNode.<span class="property">left</span> + (circle.<span class="property">radius</span> * <span class="number">2</span>),</span><br><span class="line">  <span class="attr">bottom</span>: circleNode.<span class="property">top</span> + (circle.<span class="property">radius</span> * <span class="number">2</span>),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//　以上的計算只需要一次，所以可以放在 componentDidMount</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> minLeft = circleNode.<span class="property">right</span> - <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetWidth</span>;</span><br><span class="line"><span class="keyword">const</span> minHeight = circleNode.<span class="property">bottom</span> - <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetHeight</span>;</span><br><span class="line"></span><br><span class="line">point = &#123;</span><br><span class="line">  <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="title function_">validValue</span>(point.<span class="property">left</span>, minLeft, circleNode.<span class="property">left</span>),</span><br><span class="line">  <span class="attr">top</span>: <span class="variable language_">this</span>.<span class="title function_">validValue</span>(point.<span class="property">top</span>, minHeight, circleNode.<span class="property">top</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>乎～第一版搞定，那接著就要把scale的變數加進來！</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; offsetWidth, offsetHeight &#125; = <span class="variable language_">this</span>.<span class="property">dragNode</span>;</span><br><span class="line"><span class="keyword">let</span> minLeft = <span class="variable language_">this</span>.<span class="property">circleNode</span>.<span class="property">right</span> - (offsetWidth * zoomValue);</span><br><span class="line"><span class="keyword">let</span> minTop = <span class="variable language_">this</span>.<span class="property">circleNode</span>.<span class="property">bottom</span> - (offsetHeight * zoomValue);</span><br><span class="line"><span class="keyword">let</span> maxLeft = <span class="variable language_">this</span>.<span class="property">circleNode</span>.<span class="property">left</span>;</span><br><span class="line"><span class="keyword">let</span> maxTop = <span class="variable language_">this</span>.<span class="property">circleNode</span>.<span class="property">top</span>;</span><br></pre></td></tr></table></figure><p>但這裡有個問題是，圖放大了，但是我們的座標本身是沒有放大，因此在做max、min的比較時，不能用放大後的值來運算，應該要換算回正確的值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (zoomValue &gt; <span class="number">1</span>) &#123;</span><br><span class="line">  minLeft = <span class="variable language_">this</span>.<span class="title function_">calOriginPosition</span>(offsetWidth, minLeft, zoomValue);</span><br><span class="line">  minTop = <span class="variable language_">this</span>.<span class="title function_">calOriginPosition</span>(offsetHeight, minTop, zoomValue);</span><br><span class="line">  maxLeft = <span class="variable language_">this</span>.<span class="title function_">calOriginPosition</span>(offsetWidth, maxLeft, zoomValue);</span><br><span class="line">  maxTop = <span class="variable language_">this</span>.<span class="title function_">calOriginPosition</span>(offsetHeight, maxTop, zoomValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">calOriginPosition</span> = (<span class="params">originLength, value, zoomValue</span>) =&gt;</span><br><span class="line">    value + ((zoomValue - <span class="number">1</span>) * originLength / <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h2 id="mobile放大-pinch"><a href="#mobile放大-pinch" class="headerlink" title="mobile放大-pinch"></a>mobile放大-pinch</h2><a href="/2019/01/08/crop-drag/" title="[crop系列] 4 drag實作">前面一篇</a>有提到在mobile上的touch是一個陣列，為了可以記錄多點觸控時的位置，在mobile上scale有個名詞叫做**pinch**，可以看一下這張圖上面有各種在mobile上的操作行為<p><img src="/2019/01/09/crop/gesturecard.jpg" alt="gesture"></p><p>這邊跟drag只有一個地方要調整，就是一定要觸控兩個點，接著變更<code>zoomValue</code>即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(event =&gt; event.touches.length === 2)</span><br></pre></td></tr></table></figure><h1 id="輸出"><a href="#輸出" class="headerlink" title="輸出"></a>輸出</h1><p>drag和scale都處理完以後就只剩下最後的輸出，在專案中為了上傳方便，因此使用的是<code>blob</code>來放檔案，當然你也能夠不要轉直接用<code>base64</code>做顯示，因為已經轉成blob，因此我們需要用<strong>URL.createObjectURL</strong>的方法去轉換成瀏覽器內部的連結</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">afterCutBlob = <span class="function"><span class="params">blob</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">cutBlob</span>: url,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>不要忘記離開前釋放一下記憶體，可以參考一下這篇<a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">MDN</a>，在這篇中我就沒有寫上去</p></blockquote><h1 id="小應用"><a href="#小應用" class="headerlink" title="小應用"></a>小應用</h1><p>這是一個在專案上用到的情境，designer跟我說希望一開始進去的時後，如果高比寬長，那就將寬設為圓的直徑，高等比比縮放，然後位置是在圓的左上角</p><p>這個需求其實很簡單，在image加上<code>onLoad</code>的事件，寫個判斷式，然後再把left和top重新計算取得正確的位置，就可以打完收工啦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  loadedImage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      naturalHeight,</span><br><span class="line">      naturalWidth,</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">image</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> stateName = naturalHeight &gt; naturalWidth ? <span class="string">&#x27;width&#x27;</span> : <span class="string">&#x27;height&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> diameter = circle.<span class="property">radius</span> * <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">image</span>[stateName] = diameter;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      [stateName]: diameter,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      left,</span><br><span class="line">      top,</span><br><span class="line">      zoomValue,</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calMovedPosition</span>(&#123;</span><br><span class="line">      left,</span><br><span class="line">      top,</span><br><span class="line">    &#125;, zoomValue);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;img</span></span><br><span class="line"><span class="comment">  src=&#123;imageBlob&#125;</span></span><br><span class="line"><span class="comment">  style=&#123;imageStyle&#125;</span></span><br><span class="line"><span class="comment">  draggable=&quot;false&quot;</span></span><br><span class="line"><span class="comment">  ref=&#123;node =&gt; &#123; this.image = node; &#125;&#125;</span></span><br><span class="line"><span class="comment">  onLoad=&#123;this.loadedImage&#125;</span></span><br><span class="line"><span class="comment">/&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>到這邊，整個功能已經算是介紹的差不多，剩下的就是把前面所講過的程式碼拼湊起來，需要的話請到這邊看<a href="https://stackblitz.com/edit/react-crop?embed=1&file=index.js&view=editor">demo</a></p><p>在這邊我用的是兩個image搭配出來的效果，但其實也有另一個作法是用canvas直接畫，如果有需要的話可以研究一下怎麼做，但我想作法應該是不會差太多</p><p>在這整個系列中，最麻煩的一定就是跟scale扯上關係，一有關係以後整個計算就變得麻煩，不斷的在做轉換的動作，其實這功能不難，只是在於一些小細節上要注意，踩過了就知道XD</p><blockquote><p>範例中的<code>Crop</code>這個component沒寫的很好，做太多事情，如果有什麼好的建議歡迎告訴我喔🥂</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crop </tag>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[crop系列] 4 drag實作</title>
      <link href="/2019/01/08/crop-drag/"/>
      <url>/2019/01/08/crop-drag/</url>
      
        <content type="html"><![CDATA[<p>crop系列之第n篇，這篇要來說怎麼用rxjs來實作drag並且要支援手機的touch行為</p><span id="more"></span><blockquote><p>如果還沒看過系列其他篇的麻煩這邊請</p><a href="/2018/12/20/css-scale-position/" title="[crop系列] 1 scale和position的糾葛">[crop系列] 1 scale和position的糾葛</a>、<a href="/2018/12/22/canvas-drawimage/" title="[crop系列] 2 canvas drawimage應用">[crop系列] 2 canvas drawimage應用</a>、<a href="/2018/12/25/css-mask/" title="[crop系列] 3 圖片mask">[crop系列] 3 圖片mask</a></blockquote><blockquote><p>所有的範例都會是以react為主，angular版本改天再出</p></blockquote><h1 id="mouse"><a href="#mouse" class="headerlink" title="mouse"></a>mouse</h1><p>Drag的操作行為分為desktop和mobile兩種，在desktop上面大家都很清楚就是用mouse，但是在mobile上面則用touch，基本上兩個的概念是差不多，只是差在事件上面的不同，那就讓我們先用mouse的event來做</p><h2 id="event參數"><a href="#event參數" class="headerlink" title="event參數"></a>event參數</h2><p>首先要先了解drag的行為模式，點在一個物件上(down)，然後移動(move)，最後放開(up)，那物件要根據移動的位移量來跟著移動，所以要計算位移量的話就會是跟x, y軸有關係，因此我們先來看看<a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent">MDN</a>有哪些參數可以使用</p><ul><li>clientX、clientY<br>Returns the coordinate of the mouse pointer, relative to the current window, when the mouse event was triggered</li><li>movementX、movementY<br>Returns the coordinate of the mouse pointer relative to the position of the last <code>mousemove</code> event</li><li>offsetX、offsetY<br>Returns the coordinate of the mouse pointer relative to the position of the edge of the target element</li><li>pageX、pageY<br>Returns the coordinate of the mouse pointer, relative to the document, when the mouse event was triggered</li><li>screenX、screenY<br>Returns the coordinate of the mouse pointer, relative to the screen, when an event was triggered</li></ul><p>上面這些講的很漏漏等，還是用一張圖來呈現比較明確</p><p><img src="/2019/01/08/crop-drag/mouse_events.png" alt="mouse event"></p><blockquote><p><a href="https://courses.cs.washington.edu/courses/cse190m/11sp/lectures/slides/lecture16-events.shtml#slide15">圖片來源</a></p></blockquote><p>看完圖片有沒有比較清楚知道每一個的用途，那最好用的應該會是<code>movement</code>這個參數，但這個不支援部分瀏覽器，所以我們要改用其他的參數，而其中<code>client</code>這個會比<code>offset</code>還要好，等一下我們來實作看看兩個的差異</p><h2 id="非rx實作"><a href="#非rx實作" class="headerlink" title="非rx實作"></a>非rx實作</h2><p>那我們先來用傳統的addEventListener來實作看看，首先我們用一個component叫做dragable，裡面只有一個div作為可以被拖拉的element，那我們第一步就是註冊各個事件</p><blockquote><p>當然不要忘記在<code>componentWillUnMount</code>取消註冊</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseDown</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseUp</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseMove</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mouseDown<br>透過全域變數來記當下的座標以及開始拖拉</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mouseDown = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">isDrag</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">lastPoint</span>: &#123;</span><br><span class="line">        <span class="attr">left</span>: event.<span class="property">clientX</span>,</span><br><span class="line">        <span class="attr">top</span>: event.<span class="property">clientY</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mouseUp<br>取消拖拉狀態</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mouseUp = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">isDrag</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mouseMove<br><em>將目前所在位置</em> 減掉 <em>前一次移動的值</em> 再加上 <code>目前element所在位置</code>，最後將計算的結果寫入到element</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mouseMove = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        isDrag,</span><br><span class="line">        top,</span><br><span class="line">        left,</span><br><span class="line">        lastPoint,</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">if</span>(!isDrag)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">const</span> newLeft = event.<span class="property">offsetX</span> - lastPoint.<span class="property">left</span> + left;</span><br><span class="line">    <span class="keyword">const</span> newTop = event.<span class="property">offsetY</span> - lastPoint.<span class="property">top</span> + top;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">left</span>: newLeft,</span><br><span class="line">        <span class="attr">top</span>: newTop,</span><br><span class="line">        <span class="attr">lastPoint</span>: &#123;</span><br><span class="line">            <span class="attr">left</span>: event.<span class="property">offsetX</span>,</span><br><span class="line">            <span class="attr">top</span>: event.<span class="property">offsetY</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>寫完以上的程式實際操作一下，發現會有點卡卡的，尤其是滑鼠會跑超過drag的框，但又希望dragable的物件能跟著走，因此在監聽的地方要改一下，<code>mouseup</code>、<code>mousemove</code>要改成document的全域監聽</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseDown</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseup&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseUp</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="variable language_">this</span>.<span class="property">mouseMove</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這樣改完再跑一次，發現還是跑的不順，這時候我們改用<code>client</code>來取代<code>offset</code>，再跑一次會發現整個順暢了，非常完美！完整的範例如下</p><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/react-not-rx-drag?embed=1&file=Dragable.jsx&view=editor"></iframe>## rx版本實作<p>那接著我們就要來使用rx的方法實作同樣的功能，首先一樣先定義事件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> down$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;mousedown&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> up$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseup&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事件組合"><a href="#事件組合" class="headerlink" title="事件組合"></a>事件組合</h3><p>接著要來開始把這些事件組合，首先我們是透過<code>mousedown</code>作為起點，然後<code>mousemove</code>接著再<code>mouseup</code>的時候結束</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> down$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;mousedown&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> up$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseup&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>);</span><br><span class="line">    down$.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">mergeMap</span>(<span class="function"><span class="params">down</span> =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">        )),</span><br><span class="line">        <span class="title function_">takeUntil</span>(up$),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時候將<code>up$</code>的事件當做結束，但是這樣會有一個問題，因為<code>takeUntil</code>是有值進來的時候會觸發<code>complete</code>，因此只要mouseup過一次以後這個流程就結束了</p><p>但期望的應該是每次<code>mousedown</code>的時候都要能夠被觸發，因此我們應該要將<code>takeUntil(up$)</code>放在<code>move$</code>的身上，讓流程只斷移動，而不會影響到<code>down$</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> down$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;mousedown&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> up$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseup&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>);</span><br><span class="line">    down$.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">mergeMap</span>(<span class="function"><span class="params">down</span> =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">takeUntil</span>(up$),</span><br><span class="line">        )),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="計算位移"><a href="#計算位移" class="headerlink" title="計算位移"></a>計算位移</h3><p>事件的流程搞定以後就可以開始的來針對位移量做計算，概念會跟前面有點類似，但又會有點不同，直接來說說不同的點，<strong>不是每次的偏移量，而是這次位置和初始位置的偏移量</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">down$.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">mergeMap</span>(<span class="function"><span class="params">down</span> =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">takeUntil</span>(up$),</span><br><span class="line">        <span class="title function_">map</span>(<span class="function"><span class="params">move</span> =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">deltaX</span>: down.<span class="property">clientX</span> - move.<span class="property">clientX</span>,</span><br><span class="line">            <span class="attr">deltaY</span>: down.<span class="property">clientY</span> - move.<span class="property">clientY</span>,</span><br><span class="line">        &#125;)),</span><br><span class="line">    )),</span><br><span class="line">).<span class="title function_">subscribe</span>(<span class="function"><span class="params">point</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        left,</span><br><span class="line">        top,</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">       <span class="attr">left</span>: point.<span class="property">deltaX</span> + left,</span><br><span class="line">       <span class="attr">top</span>: point.<span class="property">deltaY</span> + top,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>很開心的寫完執行，發現怎麼跑的飛快，原因是delta的量是重新計算後跟一開始的偏移量，但我們卻拿最新的位置做計算，那當然會跑的飛快，這邊要微調一下，從<code>down$</code>的時候要就拿到<code>state</code>的資料</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">down$.<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">mergeMap</span>(<span class="function"><span class="params">down</span> =&gt;</span> <span class="title function_">of</span>(<span class="variable language_">this</span>.<span class="property">state</span>).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">      down,</span><br><span class="line">      state,</span><br><span class="line">    &#125;)),</span><br><span class="line">  )),</span><br><span class="line">  <span class="title function_">mergeMap</span>(<span class="function">(<span class="params">&#123;down, state&#125;</span>) =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">takeUntil</span>(up$),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">move</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">deltaX</span>: move.<span class="property">clientX</span> - down.<span class="property">clientX</span>,</span><br><span class="line">      <span class="attr">deltaY</span>: move.<span class="property">clientY</span> - down.<span class="property">clientY</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">delta</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">left</span>: delta.<span class="property">deltaX</span> + state.<span class="property">left</span>,</span><br><span class="line">      <span class="attr">top</span>: delta.<span class="property">deltaY</span> + state.<span class="property">top</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">  ))</span><br><span class="line">).<span class="title function_">subscribe</span>(<span class="function"><span class="params">point</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(point);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在執行看看，跟前面的效果是一樣，完美！完整範例如下</p><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/react-rx-drag?embed=1&file=Dragable.jsx&view=editor"></iframe># touch<p>做完滑鼠的接著當然就是要處理mobile上面的行為，跟mouse的差不多主要都是由<code>touch</code>的事件做處理，一樣先來了解<a href="https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent">MDN</a>的參數內容</p><h2 id="event參數-1"><a href="#event參數-1" class="headerlink" title="event參數"></a>event參數</h2><ul><li>touches</li><li>targetTouches</li><li>changedTouches</li></ul><p>在mobile有多點觸控的功能，所以會是一個陣列，所以在寫的時候必須要注意一下目前的觸控數有多少，那在上面的兩個屬性中，有的參數其實跟<code>mouse</code>一樣</p><ul><li>screen</li><li>client</li><li>page</li></ul><h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><p>了解完參數以後就可以開始動工啦，這邊我就不用傳統的寫法而是直接採用rx</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> start$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;touchstart&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> end$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchend&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchmove&#x27;</span>);</span><br><span class="line">    start$.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">filter</span>(<span class="function"><span class="params">event</span> =&gt;</span> event.<span class="property">touches</span>.<span class="property">length</span> === <span class="number">1</span>),</span><br><span class="line">        <span class="title function_">mergeMap</span>(<span class="function"><span class="params">start</span> =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">takeUntil</span>(end$),</span><br><span class="line">        )),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這邊有兩個地方要注意一下</p><ol><li>要記得filter個數，不然會發生跟預期不一樣的行為</li><li>這邊的邏輯好像跟上面mouse的差不多</li></ol><h2 id="重構"><a href="#重構" class="headerlink" title="重構"></a>重構</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> start$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;touchstart&#x27;</span>).<span class="title function_">pipe</span>(<span class="variable language_">this</span>.<span class="property">parseTouchEvent</span>);</span><br><span class="line">    <span class="keyword">const</span> end$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchend&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchmove&#x27;</span>).<span class="title function_">pipe</span>(<span class="variable language_">this</span>.<span class="property">parseTouchEvent</span>);</span><br><span class="line">    start$.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">filter</span>(<span class="function"><span class="params">event</span> =&gt;</span> event.<span class="property">touches</span>.<span class="property">length</span> === <span class="number">1</span>),</span><br><span class="line">        <span class="title function_">mergeMap</span>(<span class="function"><span class="params">start</span> =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">takeUntil</span>(end$),</span><br><span class="line">        )),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">parseTouchEvent = <span class="function"><span class="params">obs</span> =&gt;</span> obs.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">tap</span>(<span class="function"><span class="params">event</span> =&gt;</span> event.<span class="title function_">preventDefault</span>()),</span><br><span class="line">    <span class="title function_">filter</span>(<span class="function"><span class="params">event</span> =&gt;</span> event.<span class="property">touches</span>.<span class="property">length</span> === <span class="number">1</span>),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">event</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">x</span>: event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span>,</span><br><span class="line">      <span class="attr">y</span>: event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientY</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>因為已經過濾掉只有一個觸控點的情況下會往後，因此直接拿陣列的第一個物件中client資料來使用，這樣在後面的資料都統一用<code>&#123;x, y&#125;</code>的物件做處理</p><blockquote><p>記得要加上*<code>preventDefault</code>*，但千萬記得不要加在end上面，會死的不明不白…</p></blockquote><h1 id="結合touch、mouse"><a href="#結合touch、mouse" class="headerlink" title="結合touch、mouse"></a>結合touch、mouse</h1><p>前面有看到兩個的相似之處，而且在touch的時候我們也針對資料做了處理，接著就是要把這兩段的程式做結合，主要要進行串接的有兩個地方</p><ul><li><p>資料的處理<br>將mouse的事件也加上前置處理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parseMouseEvent = <span class="function"><span class="params">obs</span> =&gt;</span> obs.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">tap</span>(<span class="function"><span class="params">event</span> =&gt;</span> event.<span class="title function_">preventDefault</span>()),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">event</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">x</span>: event.<span class="property">clientX</span>,</span><br><span class="line">      <span class="attr">y</span>: event.<span class="property">clientY</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>事件對事件的串接<br>先把<code>move</code>加上<code>end/up</code>的結束處理，再來就是兩個相同類型的事件做<code>merge</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> start$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;touchstart&#x27;</span>).<span class="title function_">pipe</span>(<span class="variable language_">this</span>.<span class="property">parseTouchEvent</span>);</span><br><span class="line"><span class="keyword">const</span> end$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchend&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> touchMove$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;touchmove&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parseTouchEvent</span>,</span><br><span class="line">    <span class="title function_">takeUntil</span>(end$),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> down$ = <span class="title function_">fromEvent</span>(<span class="variable language_">this</span>.<span class="property">dragNode</span>, <span class="string">&#x27;mousedown&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parseMouseEvent</span>,</span><br><span class="line">    <span class="title function_">merge</span>(start$),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> up$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mouseup&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> move$ = <span class="title function_">fromEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;mousemove&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parseMouseEvent</span>,</span><br><span class="line">    <span class="title function_">takeUntil</span>(up$),</span><br><span class="line">    <span class="title function_">merge</span>(touchMove$),</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><p>最後就是針對新的物件把邏輯做個微調</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">down$.<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">takeUntil</span>(<span class="variable language_">this</span>.<span class="property">destory$</span>),</span><br><span class="line">  <span class="title function_">mergeMap</span>(<span class="function"><span class="params">down</span> =&gt;</span> <span class="title function_">of</span>(<span class="variable language_">this</span>.<span class="property">state</span>).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">      down,</span><br><span class="line">      state,</span><br><span class="line">    &#125;)),</span><br><span class="line">  )),</span><br><span class="line">  <span class="title function_">mergeMap</span>(<span class="function">(<span class="params">&#123;down, state&#125;</span>) =&gt;</span> move$.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">move</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">deltaX</span>: move.<span class="property">x</span> - down.<span class="property">x</span>,</span><br><span class="line">      <span class="attr">deltaY</span>: move.<span class="property">y</span> - down.<span class="property">y</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function"><span class="params">delta</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">left</span>: delta.<span class="property">deltaX</span> + state.<span class="property">left</span>,</span><br><span class="line">      <span class="attr">top</span>: delta.<span class="property">deltaY</span> + state.<span class="property">top</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">  ))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="物件只能在區域內"><a href="#物件只能在區域內" class="headerlink" title="物件只能在區域內"></a>物件只能在區域內</h1><p>最後來點進階的，要把dragable的物件限制在一個區域內，也就是左上、左下、右上、右下</p><p>但是要判斷四個資料寫起來也很煩，漏漏等，因此換個角度思考看看，如過只判斷一邊在一個範圍值之內是不是就可以，例如左邊只能在0<del>100，上面只能在0</del>200</p><p>首先一定要取出外框以及dragable的width、height，接著就要把外框的width、height扣掉dragable的width、height，這樣就能知道物件不超出的最大值是多少</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parent = <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">parent</span>;</span><br><span class="line"><span class="keyword">const</span> maxLeft = parent.<span class="property">offsetWidth</span> - <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetWidth</span>;</span><br><span class="line"><span class="keyword">const</span> maxTop = parent.<span class="property">offsetHeight</span> = <span class="variable language_">this</span>.<span class="property">dragNode</span>.<span class="property">offsetHeight</span>;</span><br></pre></td></tr></table></figure><p>接著就是要來判斷最大最小值，然後這邊用個公式<code>目前值</code>和<code>最小值</code>的<strong>較大者</strong>，然後再和<code>最大值</code>取<strong>較小者</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validValue = <span class="function">(<span class="params">value, min, max</span>) =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(value, min), max)</span><br></pre></td></tr></table></figure><p>最後直接來看一下完整的程式</p><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/react-rx-drag-touch?embed=1&file=Dragable.jsx&view=editor"></iframe># 結論<blockquote><p> 先說一下，原本打算這篇就要給他全部結束，但後來發現很難，因為太多程式碼要交代</p></blockquote><p>Rx真的是我們的好朋友，尤其是在這種情況下使用，你可以發現很多邏輯都可以被抽出去，而且可以合併來合併去，我們就只要關注真正的邏輯面就好（要算算看我總共用了哪些operator嗎？其實答案就在程式的最上面，有沒有覺得使用的類型不多）</p><p>下一篇就會是更進階的zoom，會搭配上比較多的計算，希望下篇能夠完結！</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent">touch event</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent">mouse event</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
            <tag> crop </tag>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[crop系列] 3 圖片mask</title>
      <link href="/2018/12/25/css-mask/"/>
      <url>/2018/12/25/css-mask/</url>
      
        <content type="html"><![CDATA[<p>crop系列文之3，今天要來說一下怎麼用css的方式做一個四周有遮罩中間一個<code>50*50</code>的圓是亮的功能</p><span id="more"></span><blockquote><p>還沒看前面兩篇嗎？趕快來這邊看<a href="/2018/12/20/css-scale-position/" title="[crop系列] 1 scale和position的糾葛">[crop系列] 1 scale和position的糾葛</a>、<a href="/2018/12/22/canvas-drawimage/" title="[crop系列] 2 canvas drawimage應用">[crop系列] 2 canvas drawimage應用</a></p></blockquote><h1 id="目標"><a href="#目標" class="headerlink" title="目標"></a>目標</h1><img src="result.png" height="200px"><p>這是我們要達成的目標，一開始看到的時候覺得很簡單，不就是一張圖，然後給他一個寬高跟圖相同的div然後background是有顏色且透明，再來就是…</p><p>ㄟ都，再來…怎麼再來阿，都已經被蓋上background了，怎麼中間挖洞給他QQ</p><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><ul><li><p>background的區域繞過中間的圓 - 完全沒想法怎麼做（如果你知道請告訴我&lt;(_ _)&gt;）</p></li><li><p>用第二張圖來顯示中間的圓</p></li></ul><p>這個方法比較好理解，那我們來嘗試一下看看</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;imageBlock&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background:white;opacity:0.6;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute;width:50px;height:50px;left:50%;transform:translateX(-50%);&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>寫完了上面這段以後，覺得完工了，這功能實在太簡單了嘛～<br>但偏偏<del>風漸漸把距離吹的好遠</del>，圖怎麼變小了！根本沒有達到我們想要的阿…..</p><h1 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h1><p>還好在css有一個有趣的屬性叫做<code>clip-path</code>，可以先來看一下<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path">MDN</a>的說明</p><blockquote><p>The <strong><code>clip-path</code></strong> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a> property creates a clipping region that sets what part of an element should be shown. Parts that are inside the region are shown, while those outside are hidden.</p></blockquote><p>然後再看一下範例，完全就是我們要的效果阿，太棒了！馬上來套用屬性到功能上</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;imageBlock&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background:white;opacity:0.6;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute;top:0;left:0;bottom:0;right:0;clip-path:circle(50px at center 25px)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>功能完成，可以交差囉！那我們就要來看一下這個屬性的詳細內容<br><code>circle(radius at position)</code></p><ul><li>radius一定不要設定錯，給了直徑就變成兩倍大</li><li>關於position的部份可以參考<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position_value">這篇</a></li></ul><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>這個屬性目前的支援度也不錯，至少在chrome、safari、ios手機上都是正常的，有了這個屬性可以降低很多的麻煩，不然光搞這個可能就又要多花時間…</p><p>慢慢的把核心功能以外的都介紹的差不多了，最後就是drag和zoom的囉，comming soon!</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
            <tag> crop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[crop系列] 2 canvas drawimage應用</title>
      <link href="/2018/12/22/canvas-drawimage/"/>
      <url>/2018/12/22/canvas-drawimage/</url>
      
        <content type="html"><![CDATA[<p>這是接續前一篇<a href="/2018/12/20/css-scale-position/" title="[crop系列] 1 scale和position的糾葛">[crop系列] 1 scale和position的糾葛</a>的系列之二，前面有提到說要做圖片剪裁，經過了drag和scale後，只要留下一個區塊是我們要的，這時候canvas就出現啦</p><span id="more"></span><p>首先我們會把圖片先放在<code>img</code>的element中，然後再讓使用者drag和scale後，只裁切圓形所顯示的部份，但我們不會真的裁切成圓形，而是方形作為儲存</p><h1 id="不是你以為的樣子"><a href="#不是你以為的樣子" class="headerlink" title="不是你以為的樣子"></a>不是你以為的樣子</h1><p>首先我們有一個img的elment，實際大小是<code>300*227</code>，指定寬度為200，下面是實際呈現出來的樣式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><img src="https://mdn.mozillademos.org/files/5397/rhino.jpg" class="" width="200" title="河馬"><p>接著我們要開始使用canvas，把圖片放進去，直接先指定畫布大小是<code>200*200</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> img = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#image&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">canvas.<span class="property">width</span> = <span class="number">200</span>;</span><br><span class="line">canvas.<span class="property">height</span> = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>你可以發現到一件事情，圖被切割了！！畫出來的大小竟然不是跟image的元件所產生的是一樣大，而是根據原始檔案</p><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/canvas-version1?embed=1&file=src/app/app.component.html&hideExplorer=1&view=editor"></iframe># 指定區域截取<p>接下來，就是要開始做截取圖片，在<code>drawImage</code>有提供override可以使用，要使用的是其中最多參數的那個，那要先知道每個參數的意義，可以參考一下<a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">這篇</a>的說明</p><p>放一個<code>50*50</code>的紅框，在畫面上，作為識別我們預期要截取的地方</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.block</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在draw的地方改一下參數</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">drawImage</span>(img, <span class="number">10</span>, <span class="number">100</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/canvas-version2?embed=1&file=src/app/app.component.ts&hideExplorer=1&view=editor"></iframe>完蛋了！取到的地方跟我們預期完全不一樣，其實這跟上面所提到的canvas是用實際大小有關係，所以這時候就要來做一點運算，讓位置是符合我們的預期<p>原圖是<code>300*227</code>，實際是<code>200*151</code>，因此位置要跟著等比例放大，因此先將比例算出來，再拿來計算</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">      offsetWidth,</span><br><span class="line">      naturalWidth,</span><br><span class="line">&#125; = img;</span><br><span class="line"><span class="keyword">const</span> ratio = naturalWidth / offsetWidth;</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    offsetTop,</span><br><span class="line">    offsetLeft,</span><br><span class="line">&#125; = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.block&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> realTop = offsetTop * ratio;</span><br><span class="line"><span class="keyword">const</span> realLeft = oofsetLeft * ratio;</span><br><span class="line"><span class="keyword">const</span> realWidth = blockWidth * ratio;</span><br><span class="line"><span class="keyword">const</span> realHeight = blockHeight * ratio;</span><br><span class="line">ctx.<span class="title function_">drawImage</span>(img, realLeft, realTop, realWidth, realHeight, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/canvas-version2?embed=1&file=src/app/app.component.ts&hideExplorer=1&view=editor"></iframe>耶，終於成功啦！拿到我們要的區域，那我們就可以匯出成圖片囉<h1 id="匯出圖片"><a href="#匯出圖片" class="headerlink" title="匯出圖片"></a>匯出圖片</h1><p>我們要把截取出來的區域變成blob，最簡單的方法可以使用<code>toBlob</code>，但是要注意在<code>safari</code>是不支援的，那這邊有兩個方法，一個是用polyfill，那另一個就是用<code>toDataURL</code>的作法</p><p>這邊介紹的我用的方法<code>toDataURL</code>轉成blob以後丟給api給後端處理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先輸出成為base64的字串</span></span><br><span class="line"><span class="keyword">const</span> image = canvas.<span class="title function_">toDataURL</span>();</span><br><span class="line"><span class="comment">// 將base64的資料還原成array</span></span><br><span class="line"><span class="keyword">const</span> byteString = <span class="title function_">atob</span>(image.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// 轉換成byte</span></span><br><span class="line"><span class="keyword">const</span> ab = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(byteString.<span class="property">length</span>);</span><br><span class="line"><span class="keyword">const</span> ia = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(ab);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteString.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  ia[i] = byteString.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> newBlob = <span class="keyword">new</span> <span class="title class_">Blob</span>([ib], &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>一開始弄的時候被size問題困擾好久，因為還加上了scale的功能，然後怎麼拿到的圖片都不對，後來才發現原來又要拿數學來做計算，然後後來又被一個<code>toBlob</code>搞到，所以才又生出一段轉換的動作</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Using_images">MDN</a></p></li><li><p><a href="https://stackoverflow.com/questions/4998908/convert-data-uri-to-file-then-append-to-formdata">base64 to blob</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> canvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crop </tag>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[crop系列] 1 scale和position的糾葛</title>
      <link href="/2018/12/20/css-scale-position/"/>
      <url>/2018/12/20/css-scale-position/</url>
      
        <content type="html"><![CDATA[<p>最近剛做完一個功能是圖片上傳剪裁(要支援drag和scale)，晚點會把全部整理起來，先來分享一個小東西<br>當我們有一個block要做scale，那這時候的position會是？</p><span id="more"></span><h1 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h1><blockquote><p>使用angular作為樣本，只是因為懶得寫insert值到element中XD</p></blockquote><p>先來看看一開始還沒做scale前，我們的外框距離top是50px並且水平置中，裡面的話是距離外框top是31px，left是21px</p><iframe style="border:none" width="100%" height="450px" src="https://stackblitz.com/edit/scale-position?embed=1&file=src/app/app.component.ts&view=preview"></iframe>根據這樣的條件，我們可以先來想像一下，當內框用`transform`放大的時候，我們要拿到的offset、client各會是多少？<blockquote><p>可以再editor中改<code>app.component.scss</code>的<code>.scale</code>，已經有先放了一個<code>transform: scale(1)</code>在裡面</p></blockquote><h1 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h1><p>其實答案不難，首先要知道<code>[transform](https://developer.mozilla.org/en-US/docs/Web/CSS/transform)</code>是屬於效果，而並不是實際element的width、height放大，所以<strong>offset是不會改變</strong>！</p><p>但是client呢？就可以透過<code>getBoundingClientRect</code>這個方法，拿到我們所預期的值！</p><h1 id="進階"><a href="#進階" class="headerlink" title="進階"></a>進階</h1><p>但你也許會跟我一樣疑惑，client跟offset是完全不一樣的資料，難道我沒有辦法拿到scale後的offset是多少嗎？<br>當然也還是有辦法，這時候我們要透過公式去計算他（一定要寫一點程式，不然有點難過XD）</p><ol><li><p>拿到原始的width、height，並且乘上scale值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> widtd = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> height = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> scale = <span class="number">1.5</span>;</span><br><span class="line"><span class="keyword">const</span> realWidth = width * scale; <span class="comment">// 150</span></span><br><span class="line"><span class="keyword">const</span> realHeight = height * scale; <span class="comment">// 150</span></span><br></pre></td></tr></table></figure></li><li><p>因為scale是以中心等比縮放，所以這邊要將計算後和計算前的數值相減除以2</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> diffX = (realWidth - width) / <span class="number">2</span>; <span class="comment">// 25</span></span><br><span class="line"><span class="keyword">const</span> diffY = (realHeight - height) / <span class="number">2</span>; <span class="comment">// 25</span></span><br></pre></td></tr></table></figure></li><li><p>這個數值就會是top和left的偏移量，只要將原始的座標減掉偏移量即可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="keyword">let</span> position = &#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">10</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// after</span></span><br><span class="line">position = &#123;</span><br><span class="line">    <span class="attr">left</span>: position.<span class="property">left</span> - diffX,</span><br><span class="line">    <span class="attr">top</span>: psoition.<span class="property">top</span> - diffY,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><p>那來總結一下這個算式，<code>(scale - 1) / 2 * value</code>這就是取得偏移量的公式！</p><blockquote><p>2018&#x2F;12&#x2F;22調整title和第一段描述</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
            <tag> crop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AngularJS] 使用es6開發-grunt+webpack+babel</title>
      <link href="/2018/11/28/angularjs-es6/"/>
      <url>/2018/11/28/angularjs-es6/</url>
      
        <content type="html"><![CDATA[<p>在前一篇<a href="/2018/11/12/ng-admin/" title="[AngularJS] ng-admin介紹">[AngularJS] ng-admin介紹</a>中，有提到要使用es6來撰寫，但是angularJS預設是es5，讓我們看一下該怎麼進行整合，使用更強更好用的es6來快樂的開發angularJS</p><span id="more"></span><h1 id="開始之前"><a href="#開始之前" class="headerlink" title="開始之前"></a>開始之前</h1><p>要開始整合編譯工具之前，應該要先知道架構面的事情，原本在寫angularJS時，每個controller或是directive還是會拆分檔案來進行開發，像是下面這樣</p><p>-src<br>–directive.js<br>–directive2.js<br>–controller.js<br>–controller2.js<br>-index.html</p><p>上線到server的時候，會將所有的js變成一個檔案，並且進行ugly，大概會是像這樣</p><p>-disc.js<br>-index.html</p><p>所以在整合es6的時候，我們就要先改變一下寫法，將directive、controller等寫成一個標準export的js檔案，像是下面的寫法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// duplicate.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">duplicate</span> (<span class="title class_">Restangular</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">restrict</span>: <span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">    <span class="attr">scope</span>: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;&lt;span class=&quot;fa fa-clone&quot; aria-hidden=&quot;true&quot;&gt;Duplicate post&lt;/span&gt;&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="keyword">function</span> (<span class="params">scope, element, attrs</span>) &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">duplicate.<span class="property">$inject</span> = [</span><br><span class="line">  <span class="string">&#x27;Restangular&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> duplicate;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> duplicate <span class="keyword">from</span> <span class="string">&#x27;./duplicate&#x27;</span>;</span><br><span class="line"></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">.<span class="title function_">direcitive</span>(<span class="string">&#x27;duplicate&#x27;</span>, duplicate);</span><br></pre></td></tr></table></figure><p>這時候呢，我們只要針對<code>app.js</code>這個檔案做編譯，其他被引用到的就會被編譯到同一個檔案中，那之前所用到把各個檔案集中到一個的作法也就不用</p><h1 id="編譯工具"><a href="#編譯工具" class="headerlink" title="編譯工具"></a>編譯工具</h1><p>現在有兩個方法可以將es6編譯成es5，接下來就來詳細的介紹一下這些工具</p><h2 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h2><p>typescript是一個超集合，所以可以單純的用ts的檔案但內容全部是一般js的寫法，在angular裡面就開始全部使用ts，所以採用這個也是一個很好的選擇</p><blockquote><p>要注意一下，typescript本身是一個語言，支援js所以有編譯的功能，但絕對比單純的編譯器還強</p></blockquote><h2 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h2><p>這套算是目前最多人使用的吧，基本上使用react的人幾乎都是用這個工具在進行編譯，官方也提供讓你在<a href="https://babeljs.io/">線上</a>可以觀看輸出結果，現在babel的版本已經來到7，也跟之前有一些不一樣，所以要注意一下</p><h1 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h1><p>在這次的整合中，我是使用 <code>grunt</code> + <code>webpack</code> + <code>babel</code>作為最後的選擇，先說一下之前嘗試的歷程</p><blockquote><p>因為很少這樣整合，所以在測試上花了很多時間orz</p></blockquote><ul><li><p>typescript<br>在angular中使用過ts，當然想到的第一個整合會是這個，但是在整合的時候發現輸出的結果跟預期的不同，例如<code>import</code>一個檔案進去，但還是有require之類的存在，導致在處理上更加麻煩</p><blockquote><p>建議可以的話還是使用ts，應該會是最佳選擇</p></blockquote></li><li><p>babel<br>使用babel本身是非常正常的，但是一跟<code>grunt</code>會編譯失敗，一直找不到真正的原因，時間上的問題，所以只好放棄</p><blockquote><p>“grunt”: “^1.0.3”<br>“grunt-cli”: “^1.2.0” </p></blockquote></li><li><p>webpack<br>大家最常見的方法，使用<code>webpack</code>+<code>babel</code>的設定，然後再跟<code>grunt</code>整合，這邊來看一下怎麼操作</p></li></ul><blockquote><p>“webpack”: “^4.23.1”<br>“@babel&#x2F;core”: “^7.1.2”</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//將webpack的設定寫在另一個檔案中</span></span><br><span class="line"><span class="keyword">const</span> webpackConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line">grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line"><span class="attr">webpack</span>: &#123;</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">stats</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">prod</span>: webpackConfig,</span><br><span class="line">      <span class="comment">//預設mode是prod，所以在開發時就不用特別給</span></span><br><span class="line">  <span class="attr">dev</span>: <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;none&#x27;</span> &#125;, webpackConfig),</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>建議有在繼續寫angularJS的都應該要使用編譯工具，讓開發上更加輕鬆（因為使用angularJS已經夠辛苦），時間除了花在找工具外，也有一部分是在把原本寫不好的code修好，這種整合的期間很痛苦，但弄好的時候真的很爽，都可以使用es6的語法，輕鬆寫code</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AngularJS] ng-admin介紹</title>
      <link href="/2018/11/12/ng-admin/"/>
      <url>/2018/11/12/ng-admin/</url>
      
        <content type="html"><![CDATA[<h1 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h1><p>當我們要寫一個後台系統的時候，也就兩種方法可以選，一種是全部自己來，一種是拿著別人寫好的樣板來套，今天要來介紹的就是基於angularjs的一套後台系統<a href="https://github.com/marmelab/ng-admin">ng-admin</a></p><span id="more"></span><p>選擇一個系統當然要看看有沒有什麼好處囉，所以我們來看一下有些什麼功能</p><ul><li>restful api</li><li>CRUD，透過設定的方式來完成</li><li>editor</li></ul><blockquote><p> 其實非常基本的功能，但還是要介紹下去…已經在這個系統上花了不少時間orz</p></blockquote><h1 id="初始"><a href="#初始" class="headerlink" title="初始"></a>初始</h1><p>首先要先知道這套系統，基本上不太需要寫太多複雜的程式，只要透過類似設定的方法，就可以做到<strong>CRUD</strong>，下面來看看該怎麼做</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [<span class="string">&#x27;ng-admin&#x27;</span>])</span><br><span class="line">.<span class="title function_">config</span>([<span class="string">&#x27;NgAdminConfigurationProvider&#x27;</span>, <span class="keyword">function</span>(<span class="params">nga</span>)&#123;</span><br><span class="line">    <span class="comment">// application:網站名稱</span></span><br><span class="line">    <span class="comment">// baseApiUrl:api end-point</span></span><br><span class="line">    <span class="keyword">var</span> admin = nga.<span class="title function_">application</span>(<span class="string">&#x27;My First Admin&#x27;</span>)</span><br><span class="line">    .<span class="title function_">baseApiUrl</span>(<span class="string">&#x27;http://jsonplaceholder.typicode.com/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = nga.<span class="title function_">entity</span>(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line">    <span class="comment">//定義list畫面要顯示的欄位</span></span><br><span class="line">    user.<span class="title function_">listView</span>().<span class="title function_">fields</span>([</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;username&#x27;</span>),</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">//刪除和編輯的功能</span></span><br><span class="line">    .<span class="title function_">listActions</span>([<span class="string">&#x27;edit&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>]);</span><br><span class="line">    <span class="comment">//定義create畫面要輸入的欄位</span></span><br><span class="line">    user.<span class="title function_">creationView</span>().<span class="title function_">fields</span>([</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;username&#x27;</span>),</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    ]);</span><br><span class="line">    <span class="comment">//定義edit畫面要輸入的欄位</span></span><br><span class="line">    user.<span class="title function_">editionView</span>().<span class="title function_">fields</span>([</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;username&#x27;</span>),</span><br><span class="line">        nga.<span class="title function_">field</span>(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    admin.<span class="title function_">addEntity</span>(user);</span><br><span class="line">    nga.<span class="title function_">configure</span>(admin);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure><p>前面有說到這是一個引用restful的admin，所以我們要先定義基本的end-point，接著就是定義要顯示的欄位以及真正的資料來源<code>entity</code>，可以透過上面這個範例看到，非常的簡單，我們其實只是用定義欄位的方法就完成了CRUD</p><h2 id="end-point"><a href="#end-point" class="headerlink" title="end-point"></a>end-point</h2><p>基本上打出去的api會是這個模式，當然這套也提供客製request或是response的功能，在這邊我就不特別提到，需要的可以去翻一下參考文件</p><table><thead><tr><th>name</th><th>type</th><th>end-point</th></tr></thead><tbody><tr><td>listView</td><td>GET</td><td>&#x2F;users</td></tr><tr><td>creationView</td><td>POST</td><td>&#x2F;users</td></tr><tr><td>showView</td><td>GET</td><td>&#x2F;users&#x2F;:id</td></tr><tr><td>editionView</td><td>PUT</td><td>&#x2F;users&#x2F;:id</td></tr><tr><td>deletionView</td><td>DELETE</td><td>&#x2F;users&#x2F;:id</td></tr></tbody></table><h2 id="欄位資料關連"><a href="#欄位資料關連" class="headerlink" title="欄位資料關連"></a>欄位資料關連</h2><p>在admin中很常見到的是要關連另一個資料，例如post中要選擇user，這時候我們可以透過field的關聯欄位來完成</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = nga.<span class="title function_">entity</span>(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> post = nga.<span class="title function_">entity</span>(<span class="string">&#x27;posts&#x27;</span>);</span><br><span class="line"></span><br><span class="line">post.<span class="title function_">creationView</span>().<span class="title function_">fields</span>([</span><br><span class="line">    nga.<span class="title function_">field</span>(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">    <span class="comment">//使用reference</span></span><br><span class="line">    nga.<span class="title function_">field</span>(<span class="string">&#x27;userId&#x27;</span>, <span class="string">&#x27;reference&#x27;</span>)</span><br><span class="line">    <span class="comment">//定義關連的資料</span></span><br><span class="line">        .<span class="title function_">targetEntity</span>(user)</span><br><span class="line">        <span class="comment">//定義要顯示的欄位，預設對應欄位是userId=id</span></span><br><span class="line">        .<span class="title function_">targetField</span>(nga.<span class="title function_">field</span>(<span class="string">&#x27;username&#x27;</span>))</span><br><span class="line">    <span class="comment">//顯示的label</span></span><br><span class="line">        .<span class="title function_">label</span>(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">    nga.<span class="title function_">field</span>(<span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h1 id="欄位型態"><a href="#欄位型態" class="headerlink" title="欄位型態"></a>欄位型態</h1><p>#客製</p><p>基本的功能在參考資料中可以找到很多，其實官方也寫了很多的說明，告訴你要怎麼使用，以下是官方所支援的所有類型，詳細的使用方法就到各個詳細連結中看囉</p><ul><li>string</li><li>text</li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#wysiwyg-field-type">wysiwyg</a></li><li>password</li><li>email</li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#date-field-type">date</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#datetime-field-type">datetime</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#number-field-type">number</a></li><li>float</li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#boolean-field-type">boolean</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#choice-and-choices-field-types">choice and choices</a></li><li>json</li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#file-field-type">file</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#reference-field-type">reference</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#referencedlist-field-type">referenced_list</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#embeddedlist-field-type">embedded_list</a></li><li><a href="https://ng-admin-book.marmelab.com/doc/reference/Field.html#referencemany-field-type">reference_many</a></li></ul><p>但你一定會有那種需求是上面都做不到的（我就有一個T_T，那我們要怎麼來自定義這些功能呢</p><h2 id="自定欄位型態"><a href="#自定欄位型態" class="headerlink" title="自定欄位型態"></a>自定欄位型態</h2><p>首先的首先，就是這邊一定要用es6的寫法了，所以當你看到這邊，趕快把你的專案加上babel的編譯吧！<br>在這邊我要做的是當另一個欄位值改變時，要將下拉選單的清單更新，這邊我會使用<code>reference</code>作為基底去進行實作一個叫做<code>relate</code>的型態</p><p>這邊總共會寫三個檔案</p><ol><li><p><code>relateField.js</code>，定義可以在<code>nga.field()</code>後面接續的欄位名稱</p><blockquote><p>就是這裡必須要用es6的class寫法</p></blockquote></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ReferenceField</span> <span class="keyword">from</span> <span class="string">&#x27;admin-config/lib/Field/ReferenceField&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RelateField</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ReferenceField</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name);</span><br><span class="line">        <span class="comment">//必須要跟config中定義的名稱一樣</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_type</span> = <span class="string">&quot;relate&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_referenceField</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">referenceField</span>(<span class="params">field</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">arguments</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_referenceField</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_referenceField</span> = field;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RelateField</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><code>relateFieldView.js</code>，定義在各種情況下要怎麼呈現，我只在write的情況下改成自己的directive</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">getReadWidget</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;&lt;ma-reference-column field=&quot;::field&quot; value=&quot;::value&quot; datastore=&quot;::datastore&quot;&gt;&lt;/ma-reference-column&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">getLinkWidget</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;&lt;ma-reference-link-column entry=&quot;::entry&quot; field=&quot;::field&quot; value=&quot;::value&quot; datastore=&quot;::datastore&quot;&gt;&lt;/ma-reference-link-column&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">getFilterWidget</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;&lt;ma-reference-field field=&quot;::field&quot; value=&quot;value&quot; datastore=&quot;::datastore&quot;&gt;&lt;/ma-reference-field&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">getWriteWidget</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;&lt;relate field=&quot;::field&quot; value=&quot;value&quot; datastore=&quot;::datastore&quot; entry=&quot;::entry&quot;&gt;&lt;/relate&gt;&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li><code>relate.directive.js</code>，定義directive的行為</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">relate</span> (<span class="title class_">ReferenceRefresher</span>, locale) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">scope</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;field&#x27;</span>: <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;=&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;entry&#x27;</span>: <span class="string">&#x27;=?&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;datastore&#x27;</span>: <span class="string">&#x27;&amp;?&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">restrict</span>: <span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;&lt;ma-choice-field field=&quot;field()&quot; datastore=&quot;datastore()&quot; refresh=&quot;refresh($search)&quot;&#x27;</span> +</span><br><span class="line">      <span class="string">&#x27; value=&quot;value&quot;&gt;&lt;/ma-choice-field&gt;&#x27;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="keyword">function</span> (<span class="params">scope</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> field = scope.<span class="title function_">field</span>();</span><br><span class="line">      <span class="keyword">const</span> referenceFieldId = field.<span class="title function_">referenceField</span>().<span class="title function_">name</span>();</span><br><span class="line">      scope.<span class="property">name</span> = field.<span class="title function_">name</span>();</span><br><span class="line">      scope.<span class="property">v</span> = field.<span class="title function_">validation</span>();</span><br><span class="line">      <span class="comment">//主要的功能所在，監聽參考欄位是否變更</span></span><br><span class="line">      scope.$watch(<span class="string">&#x27;entry.values.&#x27;</span> + referenceFieldId, <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!val) &#123;</span><br><span class="line">          scope.<span class="property">value</span> = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> search = &#123;</span><br><span class="line">          [referenceFieldId]: scope.<span class="property">entry</span>.<span class="property">values</span>[referenceFieldId],</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//這邊要特別注意，search的物件會直接變成query string</span></span><br><span class="line">        <span class="comment">//像是這樣 _filters: &#123;&quot;name&quot;:&#123;&quot;region_id&quot;:2&#125;&#125;</span></span><br><span class="line">        <span class="title class_">ReferenceRefresher</span>.<span class="title function_">refresh</span>(field, scope.<span class="property">value</span>, search)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">formattedResults</span>) &#123;</span><br><span class="line">            scope.$broadcast(<span class="string">&#x27;choices:update&#x27;</span>, &#123; <span class="attr">choices</span>: formattedResults &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">relate.<span class="property">$inject</span> = [<span class="string">&#x27;ReferenceRefresher&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> relate;</span><br></pre></td></tr></table></figure><p>都寫好以上的程式以後，只要在一開始的config宣告就可以使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>, [<span class="string">&#x27;ng-admin&#x27;</span>])</span><br><span class="line">.<span class="title function_">config</span>([<span class="string">&#x27;NgAdminConfigurationProvider&#x27;</span>, <span class="string">&#x27;FieldViewConfigurationProvider&#x27;</span>,</span><br><span class="line"><span class="keyword">function</span>(<span class="params">nga, fvp</span>)&#123;</span><br><span class="line">nga.<span class="title function_">registerFieldType</span>(<span class="string">&#x27;relate&#x27;</span>, <span class="title class_">RelateField</span>);</span><br><span class="line">fvp.<span class="title function_">registerFieldView</span>(<span class="string">&#x27;relate&#x27;</span>, <span class="title class_">RelateFieldView</span>);</span><br><span class="line">        </span><br><span class="line">        post.<span class="title function_">creationView</span>().<span class="title function_">fields</span>([</span><br><span class="line">            nga.<span class="title function_">field</span>(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">            nga.<span class="title function_">field</span>(<span class="string">&#x27;userId&#x27;</span>, <span class="string">&#x27;relate&#x27;</span>)</span><br><span class="line">                .<span class="title function_">targetEntity</span>(user)</span><br><span class="line">                .<span class="title function_">targetField</span>(nga.<span class="title function_">field</span>(<span class="string">&#x27;username&#x27;</span>))</span><br><span class="line">            <span class="comment">//name欄位值變更時，要引發這邊的選單變更</span></span><br><span class="line">            .<span class="title function_">referenceField</span>(nga.<span class="title function_">field</span>(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">                .<span class="title function_">label</span>(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">        ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>但是這邊稍微實驗一下，可以發現在directive中<code>datastore</code>是無法在一開始拿到users的資料，跟<code>reference</code>的行為有一點點的不一樣，追了一下source code以後，發現這是被包起來定義好的，所以沒辦法有相同的行為，但還好的是我不需要一開始就有資料，而是要等到<code>referenceField</code>變更以後再取得</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>今天的介紹就到這邊，這套admin是一個蠻不一樣的架構，不希望你寫太多程式，而是透過設定的模版來達到需求，但是當今天功能越來越複雜，這套的限制就會越來越大，再客製上會有很大的侷限，如果已經知道未來會有很多變化（不管是欄位或是api），那建議就是不要使用這套，而是採用其他模版透過寫程式的方式最沒有侷限</p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://ng-admin-book.marmelab.com/doc/Getting-started.html">gitbook</a></li><li><a href="https://github.com/marmelab/ng-admin">github</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AngularJS] Provider探究</title>
      <link href="/2018/11/07/angularjs-provider/"/>
      <url>/2018/11/07/angularjs-provider/</url>
      
        <content type="html"><![CDATA[<h1 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h1><blockquote><p>此篇是AngularJS 1.x，不是2+以上的喔！</p></blockquote><p>在AngularJS中提供一個很好用的機制叫做DI(Dependecy Injection 依賴注入)，這是一個design pattern，可以降低測試及宣告的程度，想要了解更完整的觀念可以參考一下<a href="https://old-oomusou.goodjack.tw/angular/di/">燈哥的文章</a>，這邊就不探討。</p><span id="more"></span><p>官方也專門寫了一篇來介紹整個的機制，但其實真的很容易搞混，所以特別寫了這篇文章來記錄。<br>首先先來看看有哪些是可以被inject的</p><ul><li>provider</li><li>constant</li><li>value</li><li>factory</li><li>service</li><li>decorator</li><li>filter</li></ul><h1 id="DI時機"><a href="#DI時機" class="headerlink" title="DI時機"></a>DI時機</h1><p>這麼多的類型，他們可以被inject的時機也會有所不同，可以參考<a href="https://docs.angularjs.org/guide/di#using-dependency-injection">官方文件</a>，在使用上要注意一下要寫的service是屬於什麼層級</p><table><thead><tr><th>區塊</th><th>限制</th></tr></thead><tbody><tr><td>run</td><td>除了provider以外的都可以用</td></tr><tr><td>config</td><td>除了provider、constant以外的都不能用</td></tr><tr><td>provider</td><td>除了provider、constant以外的都不能用，如果inject其他provider要注意<strong>順序</strong></td></tr></tbody></table><h1 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h1><p>那到底什麼是<code>provider</code>，為什麼會有這麼多限制在，其實前面所提到的類型基本上都是透過provider來實作出來的，我們先來看一下怎麼寫一個provider</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//provider</span></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">.<span class="title function_">provider</span>(<span class="string">&#x27;first&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">console</span> (str) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// $get一定要有的</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$get</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">console</span>: <span class="variable language_">console</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//config</span></span><br><span class="line">.<span class="title function_">config</span>([<span class="string">&#x27;firstProvider&#x27;</span>, <span class="keyword">function</span>(<span class="params">firstProvider</span>)&#123;</span><br><span class="line">    <span class="comment">//呼叫getData</span></span><br><span class="line">    firstProvider.$get().<span class="title function_">console</span>(<span class="string">&#x27;config&#x27;</span>);</span><br><span class="line">&#125;])</span><br><span class="line"><span class="comment">//directive</span></span><br><span class="line">.<span class="title function_">directive</span>(<span class="string">&#x27;myDirective&#x27;</span>, [<span class="string">&#x27;first&#x27;</span>, <span class="keyword">function</span>(<span class="params">first</span>)&#123;</span><br><span class="line">    first.<span class="title function_">console</span>(<span class="string">&#x27;directive&#x27;</span>);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure><p>可以發現到<code>firstProvider</code>在兩個地方是完全不一樣的表現</p><ul><li>在大部分的使用情況下inject都會直接拿到<code>$get</code>的function內容</li><li>只能使用provider的地方，一定要在使用時必須要像這樣<code>&#123;name&#125;Provider</code>，而且只能自己呼叫 <code>provider.$get()</code>去拿到裡面的內容</li></ul><p>也就是說今天我們有一個provider只打算提供給<code>config</code>、<code>provider</code>使用的話，可以直接寫在provider的object中，但<code>$get</code>還是必須要有的，但我們可以不回傳任何東西</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//provider</span></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">.<span class="title function_">provider</span>(<span class="string">&#x27;first&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">console</span> = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// $get一定要有的</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$get</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="實作類型"><a href="#實作類型" class="headerlink" title="實作類型"></a>實作類型</h2><p><code>constant</code>、<code>value</code>、<code>factory</code>、<code>service</code>都是透過provider來實作的，那實際上到底是怎麼運作的呢，我們可以來看一下這段在<a href="https://docs.angularjs.org/guide/module#module-loading">官方的範例</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;myModule&#x27;</span>, []).</span><br><span class="line">  <span class="title function_">value</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>).</span><br><span class="line">  <span class="title function_">factory</span>(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">123</span>; &#125;).</span><br><span class="line"></span><br><span class="line"><span class="comment">// is same as</span></span><br><span class="line"></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;myModule&#x27;</span>, []).</span><br><span class="line">  <span class="title function_">config</span>(<span class="keyword">function</span>(<span class="params">$provide</span>) &#123;</span><br><span class="line">    $provide.<span class="title function_">value</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>);</span><br><span class="line">    $provide.<span class="title function_">factory</span>(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">123</span>; &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>可以發現到其實都是透過<code>$provider</code>來做註冊，所以我們當然也能夠透過provider來完成實作，各個的詳細範例可以看一下<a href="https://docs.angularjs.org/guide/providers">官方文件</a></p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>講了那麼多，主要就是要知道<code>provider</code>的使用上一些要注意的點，當然你一定會想說既然provider這麼強大，基本上都可以用，那為什麼我們不要全部都寫provider就好呢？<br>其實當然可以，但是寫起來會比較麻煩一點阿，沒事還要自己寫那些<code>$get</code>的內容，不如直接用已經提供的服務不是更好！</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rx真實案例展示</title>
      <link href="/2018/08/20/rx-sample/"/>
      <url>/2018/08/20/rx-sample/</url>
      
        <content type="html"><![CDATA[<p>今天要來帶大家看三個我實際有使用過的案例，並且一個步驟一個步驟的走過，當然我們會從簡單到複雜…</p><span id="more"></span><h1 id="AutoComplete"><a href="#AutoComplete" class="headerlink" title="AutoComplete"></a>AutoComplete</h1><p>這是一個常見的需求，而且這個功能絕對是非常好使用Rx的一個情境，搭配Angular <code>Reactive Form</code>效果更好</p><p>先來描述一下這個案例</p><ol><li>監聽<code>input</code>的<code>keyup</code></li><li>呼叫API</li><li>取得資料顯示</li><li>循環步驟1</li></ol><h2 id="監聽input"><a href="#監聽input" class="headerlink" title="監聽input"></a>監聽input</h2><p>首先我們先寫一個套用<code>Reactive Form</code>的input</p><blockquote><p>使用async可以加上$用來區隔變數</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> [<span class="attr">formGroup</span>]=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">formControlName</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of wastes$ | async as wastes&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;item.OrgName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormBuilder</span>, <span class="title class_">FormGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./app.component.css&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="attr">keyword$</span>: <span class="title class_">Observable</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">FormGroup</span>;</span><br><span class="line">  <span class="attr">wastes$</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">      <span class="attr">keyword</span>: [<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&#x27;keyword&#x27;</span>)</span><br><span class="line">        .<span class="property">valueChanges</span></span><br><span class="line">      .<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;input&#x27;</span>, p));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> fb: FormBuilder</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>透過<code>FormGroup</code>的<code>valueChanges</code>就能夠監聽input的變動了(484很簡單!!)</p></blockquote><h2 id="呼叫API"><a href="#呼叫API" class="headerlink" title="呼叫API"></a>呼叫API</h2><p>這邊我們使用<a href="https://opendata.epa.gov.tw/Data/Contents/WROrg/">環保署的API</a>，並且先不做server的filter，而是採用client的</p><blockquote><p>最好的作法應該是用server做filter</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;County&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宜蘭縣&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;OrgType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;清除&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Grade&quot;</span><span class="punctuation">:</span> <span class="string">&quot;甲&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;OrgName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;境庭有限公司&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;RegistrationNo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;G3004187&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;OrgAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宜蘭縣宜蘭市文昌路一九八之六號一樓&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;TreatMethod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GrantDeadline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022/7/18 上午 12:00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;OrgTel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;03-9356440&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;OperatingAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宜蘭縣宜蘭市文昌路一九八之六號一樓&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>可以看到輸出的資料是一個物件的陣列，所以我們要宣告一個<code>interface</code>來做為資料model</p><blockquote><p>等等將採用OrgName來做為搜尋條件</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Waste</span> &#123;</span><br><span class="line">  <span class="title class_">County</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">OrgType</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">Grade</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">OrgName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">RegistrationNo</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">OrgAddress</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">TreatMethod</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">GrantDeadline</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">OrgTel</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title class_">OperatingAddress</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&#x27;src/environments/environment&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Waste</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@app/models/waste&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;</span><br><span class="line">  <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnvAPIService</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> wasteAPI$ = <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">jsonp</span>(<span class="variable language_">this</span>.<span class="title function_">generatorUrl</span>(<span class="string">&#x27;355000000I-001154&#x27;</span>), <span class="string">&#x27;callback&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">map</span>(<span class="function">(<span class="params">p: <span class="built_in">any</span></span>) =&gt;</span> p.<span class="property">result</span>.<span class="property">records</span> <span class="keyword">as</span> <span class="title class_">Waste</span>[])</span><br><span class="line">    );</span><br><span class="line">  <span class="title function_">generatorUrl</span>(<span class="attr">resouceId</span>: <span class="built_in">string</span>, params?: <span class="built_in">any</span>[]): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> queryParam = !params ? <span class="string">&#x27;&#x27;</span> : <span class="string">`&amp;<span class="subst">$&#123;params.join(<span class="string">&#x27;&amp;&#x27;</span>)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;environment.envAPIEndpoint + resouceId&#125;</span>?format=json&amp;toekn=<span class="subst">$&#123;environment.envToken&#125;</span><span class="subst">$&#123;queryParam&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> http: HttpClient</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著我們要跟service做一個串接，這邊先來解析一下會怎麼思考使用的operator</p><ol><li>API取得資料是一個陣列，但我們要用OrgName作為過濾條件，所以需要要先將陣列拆開(<strong>switchMap</strong>)</li><li>過濾OrgName(<strong>filter</strong>)</li><li>將拆開的陣列組合回去(<strong>toArray</strong>)</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; filter, mergeMap, switchMap, toArray, debounceTime, map &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormBuilder</span>, <span class="title class_">FormGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span>, combineLatest &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Waste</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@app/models/waste&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnvAPIService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@app/service/env-api.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./app.component.css&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="attr">keyword$</span>: <span class="title class_">Observable</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">FormGroup</span>;</span><br><span class="line">  <span class="attr">wastes$</span>: <span class="title class_">Observable</span>&lt;<span class="title class_">Waste</span>[]&gt;;</span><br><span class="line"></span><br><span class="line">  hasKeyword = <span class="function">(<span class="params">keyword: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">waste: Waste</span>) =&gt;</span> waste.<span class="property">OrgName</span>.<span class="title function_">indexOf</span>(keyword) &gt; -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">      <span class="attr">keyword</span>: [<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">keyword$</span> = <span class="variable language_">this</span>.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&#x27;keyword&#x27;</span>).<span class="property">valueChanges</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">wastes$</span> = <span class="variable language_">this</span>.<span class="property">keyword$</span>.<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">mergeMap</span>(<span class="function"><span class="params">keyword</span> =&gt;</span> <span class="variable language_">this</span>.<span class="property">envAPI</span>.<span class="property">wasteAPI$</span>.<span class="title function_">pipe</span>(</span><br><span class="line">        <span class="title function_">switchMap</span>(<span class="function"><span class="params">p</span> =&gt;</span> p),</span><br><span class="line">        <span class="title function_">filter</span>(<span class="variable language_">this</span>.<span class="title function_">hasKeyword</span>(keyword)),</span><br><span class="line">        <span class="title function_">toArray</span>()</span><br><span class="line">      ))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> envAPI: EnvAPIService, <span class="keyword">private</span> fb: FormBuilder</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>這邊必須注意<code>service</code>或是<code>input</code>事件的先後順序，因為<code>input</code>會是持續發生，所以必須要以<code>keyword$</code>為主</p><blockquote><p>如果是es5作法呢？</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = [];</span><br><span class="line">array.<span class="title function_">forEach</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(p.<span class="property">OrgName</span>.<span class="title function_">indexOf</span>(keyword) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">        result.<span class="title function_">push</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><h2 id="優化"><a href="#優化" class="headerlink" title="優化"></a>優化</h2><ul><li>原本使用<code>mergeMap</code>還要考慮先後順序，可以改成<code>combineLatest</code></li><li>加上輸入的間隔時間<code>debounceTime</code>，避免一直呼叫API</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">wastes$</span> = <span class="title function_">combineLatest</span>(</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">keyword$</span>.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">debounceTime</span>(<span class="number">200</span>)</span><br><span class="line">  ), <span class="variable language_">this</span>.<span class="property">envAPI</span>.<span class="property">wasteAPI$</span></span><br><span class="line">).<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">map</span>(<span class="function">(<span class="params">[keyword, wastes]</span>) =&gt;</span> wastes.<span class="title function_">filter</span>(<span class="variable language_">this</span>.<span class="title function_">hasKeyword</span>(keyword)))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="資料整理轉換"><a href="#資料整理轉換" class="headerlink" title="資料整理轉換"></a>資料整理轉換</h1><p>先來看一下資料，一樣有個陣列裡面有著日期和兩種等級</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      modifyTime<span class="punctuation">:</span> &#x27;<span class="number">2018</span>/<span class="number">03</span>/<span class="number">27</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      criticalLevel<span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      oddsLevel<span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      modifyTime<span class="punctuation">:</span> &#x27;<span class="number">2018</span>/<span class="number">02</span>/<span class="number">27</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      criticalLevel<span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      oddsLevel<span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      modifyTime<span class="punctuation">:</span> &#x27;<span class="number">2018</span>/<span class="number">01</span>/<span class="number">27</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      criticalLevel<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      oddsLevel<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      modifyTime<span class="punctuation">:</span> &#x27;<span class="number">2018</span>/<span class="number">04</span>/<span class="number">27</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      criticalLevel<span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      oddsLevel<span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      modifyTime<span class="punctuation">:</span> &#x27;<span class="number">2018</span>/<span class="number">03</span>/<span class="number">22</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>看一下預期目標</p><ul><li><p>沒有<code>criticalLevel</code>或是<code>oddsLevel</code>的忽略</p></li><li><p>輸出資料1，將每一筆資料組合成以下的格式，日期排序</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      id<span class="punctuation">:</span> `$<span class="punctuation">&#123;</span>oddsLevel<span class="punctuation">&#125;</span>-$<span class="punctuation">&#123;</span>criticalLevel<span class="punctuation">&#125;</span>`<span class="punctuation">,</span></span><br><span class="line">      date<span class="punctuation">:</span> &#x27;&#x27;<span class="punctuation">,</span></span><br><span class="line">      order<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><ul><li>輸出資料2，計算相同id的total數並組成以下的格式</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      id<span class="punctuation">:</span> `$<span class="punctuation">&#123;</span>oddsLevel<span class="punctuation">&#125;</span>-$<span class="punctuation">&#123;</span>criticalLevel<span class="punctuation">&#125;</span>`<span class="punctuation">,</span></span><br><span class="line">      total<span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      current<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h2><p>這邊分兩個部分來做，會比較輕鬆一點，不然整段會漏漏等</p><h3 id="第一組資料"><a href="#第一組資料" class="headerlink" title="第一組資料"></a>第一組資料</h3><p>一樣來拆執行步驟</p><ol><li>將陣列拆成資料流(<strong>switchMap</strong>)</li><li>過濾沒有<code>criticalLevel</code>和<code>oddsLevel</code>(<strong>filter</strong>)</li><li>重新組合物件<code>&#123;id, date&#125;</code>(<strong>map</strong>)</li><li>合成陣列(<strong>toArray</strong>)</li><li>排序(<strong>map</strong>、<code>sort</code>)</li><li>加上order(<strong>map</strong>、<code>map</code>)</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getPointList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">obs</span> =&gt;</span> obs.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">switchMap</span>(<span class="function">(<span class="params">p: HistoryRecord[]</span>) =&gt;</span> p),</span><br><span class="line">    <span class="title function_">filter</span>(<span class="function">(<span class="params">p: HistoryRecord</span>) =&gt;</span> !!p.<span class="property">criticalLevel</span> &amp;&amp; !!p.<span class="property">oddsLevel</span>),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function">(<span class="params">p: HistoryRecord</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">`<span class="subst">$&#123;p.oddsLevel&#125;</span>-<span class="subst">$&#123;p.criticalLevel&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">date</span>: p.<span class="property">modifyTime</span></span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="title class_">PointData</span>)),</span><br><span class="line">    <span class="title function_">toArray</span>(),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function">(<span class="params">p: PointData[]</span>) =&gt;</span> p.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title class_">Date</span>.<span class="title function_">parse</span>(b.<span class="property">date</span>) - <span class="title class_">Date</span>.<span class="title function_">parse</span>(a.<span class="property">date</span>))),</span><br><span class="line">    <span class="title function_">map</span>(<span class="function">(<span class="params">p: PointData[]</span>) =&gt;</span> p.<span class="title function_">map</span>(<span class="function">(<span class="params">data, idx</span>) =&gt;</span> (&#123; ...data, <span class="attr">order</span>: idx &#125;)))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第二組資料"><a href="#第二組資料" class="headerlink" title="第二組資料"></a>第二組資料</h3><p>透過第一組資料來組合成第二組，其實步驟很簡單，但是資料從前面來輸出成新的物件，所以我們要把第二步驟的行為視為一個<code>observer</code></p><p>再來拆步驟</p><ol><li>直接把陣列拆開(<strong>from</strong>)</li><li>統計每個id的數量(<strong>reducer</strong>)</li><li>重新產生新的物件(<strong>map</strong>)</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_">getPointCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">obs</span> =&gt;</span> obs.<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">mergeMap</span>(<span class="function">(<span class="params">pointList: PointData[]</span>) =&gt;</span> <span class="title function_">from</span>(pointList)</span><br><span class="line">        .<span class="title function_">pipe</span>(</span><br><span class="line">          <span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, value: PointData</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> id = value.<span class="property">id</span>;</span><br><span class="line">            <span class="keyword">if</span> (!acc[id]) &#123;</span><br><span class="line">              acc[id] = &#123; <span class="attr">total</span>: <span class="number">0</span>, <span class="attr">current</span>: <span class="number">0</span> &#125; <span class="keyword">as</span> <span class="title class_">PointCount</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            acc[id].<span class="property">total</span>++;</span><br><span class="line">            <span class="keyword">return</span> acc;</span><br><span class="line">          &#125;, [] <span class="keyword">as</span> <span class="title class_">PointCount</span>[]),</span><br><span class="line">          <span class="title function_">map</span>(<span class="function"><span class="params">counts</span> =&gt;</span> (&#123; <span class="attr">pointList</span>: pointList, <span class="attr">pointCount</span>: counts &#125;))</span><br><span class="line">        ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="組合"><a href="#組合" class="headerlink" title="組合"></a>組合</h3><p>將第一組和第二組資料做結合，然後輸出成為最終需要的資料</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">api</span>.<span class="property">dataApi$</span>.<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> !!p &amp;&amp; p.<span class="property">length</span> &gt; <span class="number">0</span>),</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getPointList</span>(),</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getPointCount</span>()</span><br><span class="line">).<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(p));</span><br></pre></td></tr></table></figure><h1 id="動態資料監聽"><a href="#動態資料監聽" class="headerlink" title="動態資料監聽"></a>動態資料監聽</h1><p>這個需求比較特別一點，資料流是從API下來（也就是前一個範例的處理），經過component處理後輸出，然後我們要監聽這些經過component處理後的資料。格式如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  top<span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  left<span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  order<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    top<span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    left<span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    order<span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    top<span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">    left<span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">    order<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    top<span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line">    left<span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line">    order<span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>最後我們期望得到的是這樣一組一組的資料集</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>所以這邊我們要先思考一下怎麼解析這個問題…</p><ol><li>監聽component送出的資料</li><li>確認要取得的資料筆數</li><li>根據資料做排序</li><li>組成兩兩一組的資料(<strong>pairewise</strong>)</li></ol><p>思維是這樣，但其實我在寫這個功能的時候為了解決第2、4點，嘗試了很多的方法</p><ul><li>問題一，使用pairewise資料必須要有終點(complete)，不然不會有任何結果出來</li><li>根據問題一延伸問題二，怎麼知道資料已經取完</li></ul><p>最後最後，我使用了<strong>bufferCount</strong>這個operator來解決這個問題，但是又會延伸新問題</p><ul><li>當前面重新取得資料，subject中還有前面舊的資料，這時候buffer會拿不到最新的資料，所以又必須讓buffer重新定位</li></ul><blockquote><p>這問題我找了很多的方法，而且也找人一起討論，重要的是<strong>pairwise</strong>很難debug…TAT</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">api</span>.<span class="property">pointList$</span></span><br><span class="line">  .<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">mergeMap</span>(<span class="function"><span class="params">pointList</span> =&gt;</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">api</span>.<span class="property">elementPoint$</span></span><br><span class="line">        .<span class="title function_">pipe</span>(</span><br><span class="line">          <span class="title function_">bufferCount</span>(pointList.<span class="property">length</span>),</span><br><span class="line">          <span class="title function_">switchMap</span>(<span class="function"><span class="params">p</span> =&gt;</span> p.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">order</span> - b.<span class="property">order</span>)),</span><br><span class="line">          <span class="title function_">pairwise</span>(),</span><br><span class="line">          <span class="title function_">bufferCount</span>(pointList.<span class="property">length</span> - <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">        )))</span><br><span class="line">  .<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(p));</span><br></pre></td></tr></table></figure><h1 id="Conculsion"><a href="#Conculsion" class="headerlink" title="Conculsion"></a>Conculsion</h1><ul><li>在不熟的情況下，先使用最熟悉的作法，再來開始想裡面的步驟如何被拆出來</li><li>不用試著對每個operator都很熟悉，百分之七十以上的情況都在寫常用的那幾個</li><li>最後就是用問的看有沒有更好的寫法</li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://github.com/jiaming0708/RxSample">AutoComplete完整範例</a></li><li><a href="https://github.com/jiaming0708/draw-demo">進階範例</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] 使用AngularCli搭配ng-packagr建立元件</title>
      <link href="/2018/06/13/angular-cli-packagr/"/>
      <url>/2018/06/13/angular-cli-packagr/</url>
      
        <content type="html"><![CDATA[<p>平常我們都用Angular Cli來建立專案，但如果有需要製作元件給別人使用，這時候應該怎麼做比較好</p><p>今天會示範如何使用Angular Cli來建立一個元件並且發佈到npm</p><span id="more"></span><h1 id="產生Component"><a href="#產生Component" class="headerlink" title="產生Component"></a>產生Component</h1><ol><li>使用cli產生一個專案</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng new my-component</span><br></pre></td></tr></table></figure><ol start="2"><li>建立一個獨立的<code>module</code>叫做first</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g m first</span><br></pre></td></tr></table></figure><blockquote><p>給別人的元件一定是獨立的module，除非你要將<code>AppModule</code>當做給人import的module，但一般我們不會這樣做，而是弄一個相對有意義的名稱</p></blockquote><ol start="3"><li>產生一個<code>component</code>叫做red</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g c first/red</span><br></pre></td></tr></table></figure><ol start="4"><li>這個功能我們就先讓component的字顏色變成紅色</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ng-content</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>接著我們先用一般的方式來看看有沒有如我們預期</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-red</span>&gt;</span>this is my first component<span class="tag">&lt;/<span class="name">app-red</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="封裝"><a href="#封裝" class="headerlink" title="封裝"></a>封裝</h1><p>這邊我們使用<code>ng-packagr</code>的套件來協助我們達到這件事情</p><blockquote><p>npm i ng-packagr –save-dev</p></blockquote><p>接著我們要產生兩個檔案，首先是<code>ng-package.json</code>，要注意一定要有<code>whitelistedNonPeerDependencies</code>將一些angular已經包含的東西都過濾掉不打包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;$schema&quot;: &quot;./node_modules/ng-packagr/ng-package.schema.json&quot;,</span><br><span class="line">  &quot;lib&quot;: &#123;</span><br><span class="line">    &quot;entryFile&quot;: &quot;public_api.ts&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;whitelistedNonPeerDependencies&quot;: [</span><br><span class="line">    &quot;.&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再來要產生<code>public_api.ts</code>，這個檔案會描述所有要對外開放的module</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./src/app/first/first.module&#x27;</span>;</span><br></pre></td></tr></table></figure><p>這些前置作業都做完後，我們就可以來進行編譯，那這邊可以偷懶一點在package.json加上指令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;scripts&quot;:&#123;</span><br><span class="line">        &quot;start&quot;: &quot;ng serve&quot;,</span><br><span class="line">        &quot;packagr&quot;: &quot;ng-packagr -p ng-package.json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行完<code>npm run packagr</code>的指令後，就可以看到增加了一個<code>dist</code>的目錄</p><h1 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h1><p>上面的動作都執行完以後，我們可以先進行個簡單的測試，用另一個專案將剛剛打包的東西引入</p><p>首先要先產生一個可以被npm認識的tgz檔案，所以要先切換到<code>dist</code>的目錄，並且執行指令<code>npm pack</code>，就可以看到<code>dist</code>目錄中會多出<code>my-component-0.0.0.tgz</code>的檔案，這就是要放到另一個專案中被install的檔案</p><blockquote><p>0.0.0是根據package.json的version而來</p></blockquote><p>建立了一個新的專案<code>ng new test-component</code>然後把剛剛產生的檔案放到根目錄，並且執行<code>npm install my-component-0.0.0.tgz</code>，就可以開始使用</p><p>首先在<code>AppModule</code>加上我們所建立的Module</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FirstModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;my-component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">FirstModule</span> <span class="comment">//我們所建立的module</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再來就是在<code>app.component.html</code>中加上<code>app-red</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-red</span>&gt;</span>hello component<span class="tag">&lt;/<span class="name">app-red</span>&gt;</span></span><br></pre></td></tr></table></figure><p>執行起來就可以看到畫面上出現<code>hello component</code>並且呈現紅色，那這個功能就是沒問題</p><blockquote><p>當然也可以把這個步驟放到發佈之後，直接從npm上面下載下來</p></blockquote><h1 id="發佈"><a href="#發佈" class="headerlink" title="發佈"></a>發佈</h1><p>這個地方就很簡單啦，只要在<code>dist</code>的目錄下執行<code>npm publish</code>就可以發布到npm中囉！</p><p>只要跟平常我們安裝新的套件方式一樣，執行<code>npm install my-component</code>就可以</p><blockquote><p>記得先要有npm的帳號，並且在本機登入</p></blockquote><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><a href="https://medium.com/@nikolasleblanc/building-an-angular-4-component-library-with-the-angular-cli-and-ng-packagr-53b2ade0701e">Building an Angular 4 Component Library with the Angular CLI and ng-packagr</a></p><p>另一個套件的資料也可以參考</p><p><a href="https://medium.com/@cyrilletuzi/how-to-build-and-publish-an-angular-module-7ad19c0b4464">How to build and publish an Angular module</a></p><h1 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h1><p>2018&#x2F;06&#x2F;20 在線上讀書會中分享，kevin也提到<code>angular cli 6</code>的版本已經包含這個功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g library jimmy-demo</span><br></pre></td></tr></table></figure><p>執行後，可以看到整個目錄中多了一個<code>projects</code>的目錄，可以看到是一個完整的專案，編譯的話就要特別指定</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng build jimmy-demo</span><br></pre></td></tr></table></figure><p>一樣可以在<code>dist</code>中看到一個目錄<code>jimmy-demo</code>，只要切到這個目錄底下就可以做<code>npm publish</code></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何再Wallaby取得package.json檔案</title>
      <link href="/2018/05/28/wallaby-packagejson/"/>
      <url>/2018/05/28/wallaby-packagejson/</url>
      
        <content type="html"><![CDATA[<p>最近看到 Kevin 的一篇<a href="https://www.facebook.com/CKNotepad/posts/542075559526993">文章</a>，說到有用到alias就必須在wallaby另外設定，想說很久沒有弄前陣子上線的專案，開啟來設定看看，沒想到設定後完全沒有用</p><span id="more"></span><p>後來檢查發現到，竟然是因為當初為了要拿到<code>package.json</code>的version而在<code>environment</code>加上require直接取值，像下面這樣</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> environment = &#123;</span><br><span class="line">  <span class="attr">production</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">appVersion</span>: <span class="built_in">require</span>(<span class="string">&#x27;../../package.json&#x27;</span>).<span class="property">version</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>因為wallaby根本不認識<code>package.json</code>的檔案，因此我們必須要先讓wallaby認識，加上兩個地方的設定</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">wallaby</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">files</span>: [</span><br><span class="line">            <span class="string">&#x27;package.json&#x27;</span></span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">middleware</span>: <span class="keyword">function</span> (<span class="params">app, express</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line">            app.<span class="title function_">use</span>(<span class="string">&#x27;/package.json&#x27;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;package.json&#x27;</span>)));</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這樣就可以打完收工，繼續使用<code>wallaby</code>啦</p><blockquote><p>附帶一提，如果有用到<code>chart.js</code>，也一樣要寫進<code>files</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
            <tag> Wallaby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue初體驗</title>
      <link href="/2018/05/21/vue-first-time/"/>
      <url>/2018/05/21/vue-first-time/</url>
      
        <content type="html"><![CDATA[<p>最近朋友要做一個公司的官網，身為前端人（自己說XD），怎麼可以用wix&#x2F;wordpress那些啦一啦而已呢<br>當然要玩一下沒玩過的東西，一直聽說Vue不錯用，因此就來玩玩看囉</p><span id="more"></span><h2 id="建立專案"><a href="#建立專案" class="headerlink" title="建立專案"></a>建立專案</h2><p>起手式，當然要先來個<a href="https://github.com/vuejs/vue-cli">vue-cli</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="literal">-g</span> @vue/<span class="built_in">cli</span></span><br></pre></td></tr></table></figure><p>接著就是要建立專案</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create my<span class="literal">-project</span></span><br></pre></td></tr></table></figure><p>這邊提供兩種方式建立專案，個人建議用manually，原因等一下可以看到</p><p><img src="/2018/05/21/vue-first-time/create.png" alt="create"></p><h3 id="defaul"><a href="#defaul" class="headerlink" title="defaul"></a>defaul</h3><p>首先來看一下default，就是一個很簡單的內容，沒有route沒有scss，但我們通常會希望有route、scss這些基本的東西吧，因此還是要用進階的設定</p><p><img src="/2018/05/21/vue-first-time/default.png" alt="default"></p><h3 id="manually"><a href="#manually" class="headerlink" title="manually"></a>manually</h3><p>這時候我們可以選擇一些想要使用在這個專案中的功能，像是<code>TypeScript</code>、<code>Router</code>、<code>SCSS</code>，這些是我基本會用到的，其他就是要看專案的性質囉</p><p><img src="/2018/05/21/vue-first-time/manually1.png" alt="manually1"></p><p>接著會根據你的選擇，會有不同的設定，像是這樣</p><p><img src="/2018/05/21/vue-first-time/manually2.png" alt="manually2"></p><p>產生出來的專案就會是這樣，是不是比較符合我們要的結果了，可以開工囉！</p><p><img src="/2018/05/21/vue-first-time/manually3.png" alt="manually3"></p><h2 id="開始享受"><a href="#開始享受" class="headerlink" title="開始享受"></a>開始享受</h2><p><code>Vue</code>的整個生命週期是從<code>main.ts</code>開始，從這邊可以看到透過<code>render</code>的方式將<code>App</code>這個內容產生出來，然後替換#app&#96;的dom</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>順著內容看下去，接著來看看<code>App.vue</code>是在做什麼的，<code>.vue</code>這個副檔名就是component的宣告內容，其中分為三塊</p><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><ul><li>一個component必須要有一個element作為root，可以參考下面的範例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--correct--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--error--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>透過大括號的方式<code>&#123;&#123;title&#125;&#125;</code>把model的資料放進畫面中</li><li>使用<code>v-*</code>開頭對element做變化的語法，例如<code>v-for</code>就是重複element的指令；其他指令就去官網查詢囉</li></ul><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><p> 一個component不一定要有這段，但如果需要有model或是引用其他component就必須要加上<code>script</code></p><ul><li>要被引用的component必須要被放在<code>components</code>中，而且是用物件的方式來撰寫</li><li>在這個component自己宣告的model必須要用<code>data</code>宣告，而且必須是一個function</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Header.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Footer</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Footer.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">Header</span>,</span><br><span class="line">    <span class="title class_">Footer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="style"><a href="#style" class="headerlink" title="style"></a>style</h3><p>有兩個方法可以來定義css的範圍</p><ul><li>向下繼承，像是<code>App</code>這個component的定義就會是這種模式，但其他地方不建議使用，很容易污染（這邊我不太喜歡比較喜歡把這種全域的另外拉出去一個檔案，然後直接被index.html引用，但要自己去寫webpack處理….懶）</li><li>component限定，編譯的時候會加上一個id之類的在所有的css，來確保是只有這個component使用到</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>在這邊我喜歡把scss另外開檔案寫，比較乾淨一點</p></blockquote><h3 id="router"><a href="#router" class="headerlink" title="router"></a>router</h3><p>看完了<code>.vue</code>的檔案結構以後，已經有些了解，接著就是來看看SPA一定會遇到的<code>route</code>是怎麼定義和使用</p><p>首先必須要先new一個Router的物件，然後再裡面定義<code>path</code>、<code>name</code>、<code>component</code><br>還記得<code>App.vue</code>中有import一個<code>router</code>嗎？其實就是引入這個地方的設定</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;./views/Home.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;./views/About.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Home</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>接著在template使用<code>router-link</code>就可以</p><ul><li><code>to</code>也就是url，前面檔案所定義的<code>path</code></li><li><code>active-class</code>當目前url跟目前route一樣時，就會套上這個class，預設class是<code>router-link-active</code></li><li><code>exact</code>是為了讓<code>active-class</code>運作更正確一點，當目前到<code>/about</code>的路徑，則<code>/</code>和<code>/about</code>都會被套上class，但我們預期應該是只有一個被套用，因此要將這個屬性設定上去（簡單說就是完全符合path）</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">exact</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>用一個簡單的網站練習一下vue，其實內容整體來說不差，真的不能否認小專案用vue上手還蠻快速的，如果真的要到專案&#x2F;產品中使用，還有很多東西需要摸索</p><p>因此對我來說<code>Angular</code>更適合一點，兩個的寫法上差異真的沒有很大，但是cli的方便性或是檔案的分離，都讓我更加的喜歡（拜託不要來戰我～～）</p><blockquote><p>另外有幾個地方想請教一下大家為什麼要這樣用</p><ul><li>使用export default而不是給一個實際名稱</li><li>把template、script、style都寫在一起，這樣如果這個功能稍微複雜一點，不就會很「漏漏等」，還是說這應該算是component的設計失敗?</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] PrimeNG開發兩三事</title>
      <link href="/2018/03/26/primeng/"/>
      <url>/2018/03/26/primeng/</url>
      
        <content type="html"><![CDATA[<p>前陣子公司的一個產品算是告一段落，這次使用PrimeNG作為元件的基底，但是在使用的過程中，也是有遇到一些值得記錄的事項，因此特別寫了這篇。</p><span id="more"></span><h1 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h1><p>物件的格式是這樣<code>&#123;severity:string, summary:string, details:string&#125;</code>，但每次都要重複寫那些屬性有點多餘，因此我將這個封裝成service，直接提供<code>success</code>、<code>error</code>、<code>info</code>、<code>warn</code>四個方法。</p><p>然後把message的物件用subject傳送，這樣就能在<code>app.component.html</code>直接用async的方式接起來。</p><blockquote><p>另外IE11要特別注意一下，details如果沒給值，畫面上會出現null的字，然後就會被殺了orz<br>這個<a href="https://github.com/primefaces/primeng/issues/5420#event-1540291252">issue</a>確定會在5.2.4改掉</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Message</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;primeng/primeng&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Subject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/Subject&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">  messages$ = <span class="keyword">new</span> <span class="title class_">Subject</span>&lt;<span class="title class_">Message</span>[]&gt;();</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">success</span>(<span class="params">content: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages$</span>.<span class="title function_">next</span>([&#123; <span class="attr">severity</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">summary</span>: content, <span class="attr">detail</span>: <span class="string">&#x27;&#x27;</span> &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">error</span>(<span class="params">content: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages$</span>.<span class="title function_">next</span>([&#123; <span class="attr">severity</span>: <span class="string">&#x27;error&#x27;</span>, <span class="attr">summary</span>: content, <span class="attr">detail</span>: <span class="string">&#x27;&#x27;</span> &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">info</span>(<span class="params">content: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages$</span>.<span class="title function_">next</span>([&#123; <span class="attr">severity</span>: <span class="string">&#x27;info&#x27;</span>, <span class="attr">summary</span>: content, <span class="attr">detail</span>: <span class="string">&#x27;&#x27;</span> &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">warn</span>(<span class="params">content: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages$</span>.<span class="title function_">next</span>([&#123; <span class="attr">severity</span>: <span class="string">&#x27;warn&#x27;</span>, <span class="attr">summary</span>: content, <span class="attr">detail</span>: <span class="string">&#x27;&#x27;</span> &#125;]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-growl</span> [<span class="attr">value</span>]=<span class="string">&quot;msgService.messages$ | async&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-growl</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Menu-x2F-Bread"><a href="#Menu-x2F-Bread" class="headerlink" title="Menu&#x2F;Bread"></a>Menu&#x2F;Bread</h1><p>這邊提供一個小tip，如果說route有很相似的，但在menu&#x2F;bread上面不想要被同時選取，這時候可以加上<code>routerLinkActiveOptions: &#123; exact: true &#125;</code>，這個在<a href="https://angular.io/guide/router#routerlinkactive-binding">angular官網</a>有被提到過。</p><p>route的情境像是這樣，沒有加上exact的情況，進入產品頁面的時候，是三個都會被反白，但這基本上不是我們要的效果，因此就要加上，讓他要完整路徑都對才會反白。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menuList</span>: <span class="title class_">MenuItem</span>[] = [</span><br><span class="line">  &#123;<span class="attr">label</span>: <span class="string">&#x27;產品&#x27;</span>, <span class="attr">routerLink</span>: [<span class="string">&#x27;/product&#x27;</span>], <span class="attr">routerLinkActiveOptions</span>: &#123; <span class="attr">exact</span>: <span class="literal">true</span> &#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">label</span>: <span class="string">&#x27;特賣&#x27;</span>, <span class="attr">routerLink</span>: [<span class="string">&#x27;/product/special&#x27;</span>], <span class="attr">routerLinkActiveOptions</span>: &#123; <span class="attr">exact</span>: <span class="literal">true</span> &#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">label</span>: <span class="string">&#x27;團購&#x27;</span>, <span class="attr">routerLink</span>: [<span class="string">&#x27;/product/together&#x27;</span>], <span class="attr">routerLinkActiveOptions</span>: &#123; <span class="attr">exact</span>: <span class="literal">true</span> &#125;&#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h1 id="Dialog"><a href="#Dialog" class="headerlink" title="Dialog"></a>Dialog</h1><h2 id="包在Component中"><a href="#包在Component中" class="headerlink" title="包在Component中"></a>包在Component中</h2><p>如果你也有把dialog整個包進去component的需求，那這個方法就很適合你！</p><p>dialog的開啟是透過boolean來控制，當寫成component的時候，參數並不會被改變，這時候dialog就不會再次被開啟，因此我們的好朋友<code>subject</code>出現啦！</p><p>首先child component可以這樣寫</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dialog</span> [(<span class="attr">visible</span>)]=<span class="string">&quot;displayFlag&quot;</span> [<span class="attr">modal</span>]=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">show something</span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">YourComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span>&#123;</span><br><span class="line"><span class="meta">@Input</span>() <span class="attr">data</span>: <span class="title class_">Subject</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line"><span class="attr">displayFlag</span>: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">subscribe</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">displayFlag</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再來parent component的地方，就直接把宣告好的<code>subject</code>放進去，然後每次要開啟就呼叫<code>subject</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;open()&quot;</span>&gt;</span>open dialog<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-your</span> [<span class="attr">data</span>]=<span class="string">&quot;openDialog$&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">app-your</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ParentComponent</span> &#123;</span><br><span class="line">  openDialog$ = <span class="keyword">new</span> <span class="title class_">Subject</span>&lt;<span class="built_in">boolean</span>&gt;();</span><br><span class="line">  <span class="title function_">open</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//這邊傳true或false都不影響開啟，重點是要讓subject有值過去觸發</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">openDialog$</span>.<span class="title function_">next</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="onHide"><a href="#onHide" class="headerlink" title="onHide"></a>onHide</h2><p>我們有一個需求是表單填寫的內容放在Dialog中，如果有填寫但最後不儲存，離開前需要提示，像是下面這個範例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dialog</span> [(<span class="attr">visible</span>)]=<span class="string">&quot;displayDialog&quot;</span> [<span class="attr">modal</span>]=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 表單內容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> [<span class="attr">formGroup</span>]=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p-footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">pButton</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ui-button-secondary&quot;</span> <span class="attr">label</span>=<span class="string">&quot;離開&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;close()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">pButton</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ui-button-primary&quot;</span> <span class="attr">label</span>=<span class="string">&quot;儲存&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;save()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p-footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span>&#123;</span><br><span class="line">  <span class="attr">displayDialog</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">FormGroup</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">close</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//show confirm</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">displayDialog</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是右上角有個X，按的時候也視同關閉，因此我們需要加上一個事件<code>onHide</code>來做控制，但是當我們像上面範例，把<code>displayDialog</code>改成false，這時候其實也會觸發<code>onHide</code>的事件，因此就要稍微注意一下順序的控制，才能避免不斷的觸發，大致的作法像是這樣。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span>&#123;</span><br><span class="line">  <span class="attr">displayDialog</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">FormGroup</span>;</span><br><span class="line">  <span class="attr">valueChange</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">valueChanges</span></span><br><span class="line">      .<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span> =&gt;</span> <span class="variable language_">this</span>.<span class="property">valueChange</span> = <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">close</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">displayDialog</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">hide</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">valueChange</span>)&#123;</span><br><span class="line">      <span class="comment">// show confirm</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">displayDialog</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>若將file之類的元件放在dialog中，開啟的時候會觸發一個dection change的錯誤，但這個其實不會真的影響功能操作，只是會讓你看起來不開心QQ，當初遇到這個問題時還有去開<a href="https://github.com/primefaces/primeng/issues/5067">issue</a>只是官方沒人理我TAT</p></blockquote><h1 id="FileUpload"><a href="#FileUpload" class="headerlink" title="FileUpload"></a>FileUpload</h1><p>在使用這個元件的時候，因為畫面的關係，所以採用<code>mode=&quot;basic&quot;</code>，但是這會引發一些狀況，像是<code>maxFileSize</code>上傳的檔案太大應該要提示訊息，但這種模式下不會…TAT</p><p>另外，每次上傳完都要將資料清除，不然再次按上傳的時候，會沒辦法選取直接傳前一次檔案</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span>&#123;</span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="title class_">FileUpload</span>) <span class="attr">fileUpload</span>: <span class="title class_">FileUpload</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">uploadFile</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fileService</span>.<span class="title function_">uploadFile</span>(<span class="variable language_">this</span>.<span class="property">id</span>, <span class="variable language_">this</span>.<span class="property">type</span>, event.<span class="property">files</span>)</span><br><span class="line">      .<span class="title function_">subscribe</span>(<span class="function"><span class="params">fileIds</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fileUpload</span>.<span class="title function_">clear</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DataTable"><a href="#DataTable" class="headerlink" title="DataTable"></a>DataTable</h1><p>這邊我們用的是<code>DataTable</code>而不是新的<code>TurboTable</code>，就只是因為當時只有一個可以用沒得選XD，這個元件其實蠻多小地方要注意的，很容易萬劫不復阿QQ</p><blockquote><p>官方已經不再維護DataTable這個元件了…請大家轉用<code>TurboTable</code></p></blockquote><h2 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h2><p>在官方範例中，sort很簡單，就是在column中，加上<code>sortable</code>這個屬性，但如果你有搭配<code>headerColumnGroup</code>，那就要注意一下放的位置，除了在下面的column要放<code>field</code>以外，也要在header中的column加上<code>field</code>，這樣元件才會知道要排序data中的哪個欄位</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dataTable</span> [<span class="attr">value</span>]=<span class="string">&quot;sales&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-headerColumnGroup</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p-row</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;Brand&quot;</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;Sale Rate&quot;</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p-row</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 正確寫法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;Last Year&quot;</span> [<span class="attr">sortable</span>]=<span class="string">&quot;true&quot;</span> <span class="attr">field</span>=<span class="string">&quot;lastYearSale&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 錯誤寫法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;This Year&quot;</span> [<span class="attr">sortable</span>]=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;Last Year&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">header</span>=<span class="string">&quot;This Year&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p-headerColumnGroup</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;brand&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;lastYearSale&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;thisYearSale&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;lastYearProfit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;thisYearProfit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dataTable</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>另外一個要特別注意的點，就是資料的型別要統一，不然排序也會亂掉</p><p>這邊提供一個我做出來的<a href="https://stackblitz.com/edit/angular-mwrzhy?embed=1&file=app/app.component.ts">範例</a>，可以發現點year那個欄位，VM這筆資料竟然獨立在那邊，其實原因很簡單，資料中有<code>null</code>、<code>undefine</code>、<code>number</code>三種形態，所以對元件來說會把VM那筆獨立排</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VW&quot;</span><span class="punctuation">,</span> year<span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Orange&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dsad231ff&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Audi&quot;</span><span class="punctuation">,</span>  <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Black&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gwregre345&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Renault&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">2005</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gray&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;h354htr&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BMW&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">2003</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Blue&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;j6w54qgh&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mercedes&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">1995</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Orange&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hrtwy34&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Volvo&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Black&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jejtyj&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Honda&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">2012</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Yellow&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g43gr&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Jaguar&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Orange&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;greg34&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ford&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Black&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;h54hw5&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Fiat&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">2013</span><span class="punctuation">,</span> <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Red&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;vin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;245t2s&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="Edit"><a href="#Edit" class="headerlink" title="Edit"></a>Edit</h2><h3 id="行內編輯"><a href="#行內編輯" class="headerlink" title="行內編輯"></a>行內編輯</h3><p>官方給的<a href="https://www.primefaces.org/primeng/#/datatable/editable">範例</a>中，edit的功能只能一個欄位一個欄位的編輯，但如果想要的是整個row一起開放編輯，並且有儲存那些的功能怎麼辦？</p><p>這樣的功能我是自己刻，用一個屬性來控制現在是編輯還是檢視</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dataTable</span> [<span class="attr">value</span>]=<span class="string">&quot;sales&quot;</span> [<span class="attr">rowStyleClass</span>]=<span class="string">&quot;checkHighlight&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">pTemplate</span>=<span class="string">&quot;body&quot;</span> <span class="attr">let-row</span>=<span class="string">&quot;rowData&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> *<span class="attr">ngIf</span>=<span class="string">&quot;!row.isEdit&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;row.isEdit=true&quot;</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> *<span class="attr">ngIf</span>=<span class="string">&quot;row.isEdit&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;save(row)&quot;</span>&gt;</span>Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">header</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">pTemplate</span>=<span class="string">&quot;body&quot;</span> <span class="attr">let-col</span> <span class="attr">let-row</span>=<span class="string">&quot;rowData&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> *<span class="attr">ngIf</span>=<span class="string">&quot;!row.isEdit&quot;</span>&gt;</span>&#123;&#123;row[col.field]&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> *<span class="attr">ngIf</span>=<span class="string">&quot;row.isEdit&quot;</span> <span class="attr">pInputText</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;row[col.field]&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dataTable</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="編輯highlight"><a href="#編輯highlight" class="headerlink" title="編輯highlight"></a>編輯highlight</h3><p>那如果說有需要在編輯的模式中，讓row是呈現被選取的樣式，可以使用<code>rowStyleClass</code>，可以透過這個方法來指定class</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">  <span class="title function_">checkHighlight</span>(<span class="params">row</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> row.<span class="property">isEdit</span> ? <span class="string">&#x27;highlight&#x27;</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="目前頁的rowIndex"><a href="#目前頁的rowIndex" class="headerlink" title="目前頁的rowIndex"></a>目前頁的rowIndex</h3><p>因為我們會有個需求是要新增資料，但如果用splice到第一筆，但是使用者切換到第二頁，會看不到可以編輯的那筆row，翻了文件才發現有這個屬性<code>first</code>，這個的值是這頁的第一筆index</p><p>依照剛剛的案例，這時候<code>first</code>會等於10，這時候就可以有兩種作法，第一種是把新的資料直接insert到10的位置，或者是把<code>first</code>改成0，在這邊我是使用第一個方法</p><blockquote><p>一開始要指定first為0，不然會沒資料</p></blockquote><h2 id="Lazy"><a href="#Lazy" class="headerlink" title="Lazy"></a>Lazy</h2><p>在一個feature中，我不小心加上了這個設定，然後資料明明已經寫入超過一頁的量，但畫面永遠只顯示一頁（就爆炸了TAT）</p><p>去看了<a href="https://www.primefaces.org/primeng/#/datatable/lazy">官方文件</a>才發現原來是誤會他的功能，這是用來解決大量資料時透過api來取得分頁資料的功能</p><p>以這個範例來看，要使用lazy的功能就必須要套用三個屬性&#x2F;方法<code>lazy</code>、<code>totalRecords</code>、<code>onLazyLoad</code>，透過這樣的搭配來取得每頁的資料</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dataTable</span> [<span class="attr">value</span>]=<span class="string">&quot;cars&quot;</span> [<span class="attr">lazy</span>]=<span class="string">&quot;true&quot;</span> [<span class="attr">rows</span>]=<span class="string">&quot;10&quot;</span> [<span class="attr">paginator</span>]=<span class="string">&quot;true&quot;</span> [<span class="attr">rowsPerPageOptions</span>]=<span class="string">&quot;[5,10,20]&quot;</span></span></span><br><span class="line"><span class="tag">            [<span class="attr">totalRecords</span>]=<span class="string">&quot;totalRecords&quot;</span> (<span class="attr">onLazyLoad</span>)=<span class="string">&quot;loadCarsLazy($event)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-header</span>&gt;</span>List of Cars<span class="tag">&lt;/<span class="name">p-header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;vin&quot;</span> <span class="attr">header</span>=<span class="string">&quot;Vin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;year&quot;</span> <span class="attr">header</span>=<span class="string">&quot;Year&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;brand&quot;</span> <span class="attr">header</span>=<span class="string">&quot;Brand&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p-column</span> <span class="attr">field</span>=<span class="string">&quot;color&quot;</span> <span class="attr">header</span>=<span class="string">&quot;Color&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dataTable</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>2018&#x2F;05&#x2F;23 做後續補充…拖有點久QQ</p></blockquote><h2 id="Selection"><a href="#Selection" class="headerlink" title="Selection"></a>Selection</h2><p>同事回報的問題，假設目前<code>selectedList</code>有三筆資料，現在重新取得<code>model</code>，<code>selectedList</code>是不會被清除的，而且還會比對不到任何資料所以就不會被選取，因為這時候的物件和前一次不同，</p><blockquote><p>這個行為我不是很確定算不算問題</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dataTable</span> [<span class="attr">value</span>]=<span class="string">&quot;model&quot;</span> [(<span class="attr">selection</span>)]=<span class="string">&quot;selectedList&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p-dataTable</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Scroll"><a href="#Scroll" class="headerlink" title="Scroll"></a>Scroll</h2><p>想要做到固定表頭或是固定前面欄位，可以使用這個功能，但是在設定的時候，發現很容易整個崩壞跑版，尤其是有用到group的功能情況下</p><p>目前知道必須要寫死欄位寬高才有辦法比較正常顯示，如果是希望能夠根據資料自動長大的話就…</p><h1 id="Dropdown"><a href="#Dropdown" class="headerlink" title="Dropdown"></a>Dropdown</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p-dropdown</span> [<span class="attr">options</span>]=<span class="string">&quot;reasonList&quot;</span> [<span class="attr">autoWidth</span>]=<span class="string">&quot;false&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;請選擇&quot;</span> <span class="attr">appendTo</span>=<span class="string">&quot;body&quot;</span> <span class="attr">formControlName</span>=<span class="string">&quot;versionReason&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p-dropdown</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果資料是透過api取得，這時候因為option還沒有任何東西，所以寬度會變得很小要等到點了下拉選單才會變寬，所以要加上<code>autoWidth=false</code>就可以避免寬度自動縮放。</p><p>另外，如果是把dropdown放在dialog裡面，而且下拉選單會超過dialog大小，這時候會發現下拉選單被吃掉了！這時候要加上<code>appendTo=&quot;body&quot;</code>這個設定，讓下拉選單的z-index提高</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>其實primeng已經可以符合大部分的使用情境，只是有時候官方文件也許寫的沒有很清楚，那跑去看<a href="https://github.com/primefaces/primeng">source code</a>(open source 好處XD)或<a href="https://forum.primefaces.org/viewforum.php?f=35&sid=45e34922772fa61d6741489375083cde">論壇</a>會比較快</p><p>primeng團隊也持續的在開發新元件，也不太需要怕沒有人維護，有什麼好的想法也能提供給他們，一起來讓這個元件更好吧！</p><blockquote><p>讀書會分享時，大家的回響讓我勾起回憶，再補上一些</p><p>2018&#x2F;05&#x2F;23 再補上一些內容</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] 自訂Validator-password format、repeat</title>
      <link href="/2018/02/17/angular-validator/"/>
      <url>/2018/02/17/angular-validator/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在寫Angular專案時，只要遇到表單的部份，通常都會使用驗證的機制來輔助使用者輸入，並且提示訊息，Angular團隊也已經寫好一些驗證的pattern讓我們使用，但總是會有些特殊的格式，勢必要自己寫，這邊來跟大家分享一下作法。</p><span id="more"></span><blockquote><p>底下範例將採用reactive form的方式來介紹</p></blockquote><h1 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h1><h2 id="密碼格式"><a href="#密碼格式" class="headerlink" title="密碼格式"></a>密碼格式</h2><p>最簡單的寫法是直接在formControl後面加上pattern，如果只有一個用到，那這樣寫其實就可以，但如果說有重複用到這樣就不適合。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">form</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">      <span class="attr">password</span>: [<span class="string">&#x27;&#x27;</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="title class_">Validators</span>.<span class="title function_">pattern</span>(<span class="string">&#x27;^(?=.*[0-9])(?=.*[a-zA-Z]).&#123;6,&#125;$&#x27;</span>)]]</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此我們可以將程式抽出來變成一個function，然後呼叫使用。</p><p>這邊要注意一下，當驗證成功是要回傳null，驗證失敗時可以回傳一個物件，這個物件的內容自訂，像是底下的範例，是給<code>password=true</code>這可以用在html決定是否提示錯誤的內容。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">form</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line">      <span class="attr">password</span>: [<span class="string">&#x27;&#x27;</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="variable language_">this</span>.<span class="property">password</span>]]</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">password</span>(<span class="attr">control</span>: <span class="title class_">AbstractControl</span>): <span class="title class_">ValidationErrors</span> | <span class="literal">null</span> &#123;</span><br><span class="line"><span class="keyword">const</span> pattern = <span class="regexp">/^(?=.*[0-9])(?=.*[a-zA-Z]).&#123;6,&#125;$/</span>;</span><br><span class="line"><span class="keyword">return</span> pattern.<span class="title function_">test</span>(control.<span class="property">value</span>) ? <span class="literal">null</span> : &#123; <span class="string">&#x27;password&#x27;</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> [<span class="attr">formGroup</span>]=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">formControlName</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> *<span class="attr">ngIf</span>=<span class="string">&quot;form.get(&#x27;password&#x27;).errors?.password&quot;</span>&gt;</span>密碼必須六位數且包含英數字。<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="確認密碼檢查"><a href="#確認密碼檢查" class="headerlink" title="確認密碼檢查"></a>確認密碼檢查</h2><p>這邊提供兩種方式，第一種是在formGroup，第二種是在formControl</p><blockquote><p>個人偏好第一種，寫法乾淨</p></blockquote><ul><li>在formGroup加上validator，並且傳入兩個controlName，作為判別</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CustomValidator</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">match</span>(<span class="params">firstControlName: <span class="built_in">string</span>, secondControlName: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="attr">control</span>: <span class="title class_">AbstractControl</span>): &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> &#125; =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> firstControl = control.<span class="title function_">get</span>(firstControlName);</span><br><span class="line">            <span class="keyword">const</span> secondControl = control.<span class="title function_">get</span>(secondControlName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (firstControl.<span class="property">value</span> !== secondControl.<span class="property">value</span>) &#123;</span><br><span class="line">                secondControl.<span class="title function_">setErrors</span>(&#123; <span class="string">&#x27;match&#x27;</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">resetForm</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line"><span class="attr">password</span>: [<span class="string">&#x27;&#x27;</span>, <span class="title class_">Validators</span>.<span class="property">required</span>],</span><br><span class="line"><span class="attr">confirmPassword</span>: [<span class="string">&#x27;&#x27;</span>, <span class="title class_">Validators</span>.<span class="property">required</span>]</span><br><span class="line">&#125;, &#123;<span class="attr">validator</span>: <span class="title class_">CustomValidator</span>.<span class="title function_">match</span>(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;confirmPassword&#x27;</span>)&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>這邊使用另一種寫法，回傳<code>ValidatorFn</code>，有別於直接回傳驗證結果，是為了要能夠傳參數進去</p></blockquote><ul><li>在重複輸入formControl上，傳入比對的controlName，這邊處理上比較麻煩一點，我們要先假設一下情境<ol><li>正常情況下，先輸入password，然後再輸入confirmPassword，這時的驗證就是看自己和比對有沒有一致就好。</li><li>但可能會是兩邊都輸入完而且驗證也過了，但去改了password，這時的驗證應該要重新跑過，因此我們需要監聽比對的值變更來讓自己的驗證重新執行，因此要用到<code>updateValueAndValidity</code>這個功能</li></ol></li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CustomValidator</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">repeat</span>(<span class="attr">controlName</span>: <span class="built_in">string</span>): <span class="title class_">ValidatorFn</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">otherControl</span>: <span class="title class_">AbstractControl</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="attr">control</span>: <span class="title class_">AbstractControl</span>): &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> &#125; =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!control.<span class="property">parent</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!otherControl) &#123;</span><br><span class="line">                otherControl = control.<span class="property">parent</span>.<span class="title function_">get</span>(controlName);</span><br><span class="line">                otherControl.<span class="property">valueChanges</span>.<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span> =&gt;</span> control.<span class="title function_">updateValueAndValidity</span>());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> otherControl.<span class="property">value</span> !== control.<span class="property">value</span> ? &#123; <span class="string">&#x27;match&#x27;</span>: <span class="literal">true</span> &#125; : <span class="literal">null</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">form</span> = <span class="variable language_">this</span>.<span class="property">fb</span>.<span class="title function_">group</span>(&#123;</span><br><span class="line"><span class="attr">password</span>: [<span class="string">&#x27;&#x27;</span>, <span class="title class_">Validators</span>.<span class="property">required</span>],</span><br><span class="line"><span class="attr">confirmPassword</span>: [<span class="string">&#x27;&#x27;</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="title class_">CustomValidator</span>.<span class="title function_">repeat</span>(<span class="string">&#x27;password&#x27;</span>)]]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://angular.io/guide/form-validation">官網介紹</a></li><li><a href="https://blog.thoughtram.io/angular/2016/03/14/custom-validators-in-angular-2.html">CUSTOM VALIDATORS IN ANGULAR</a></li><li><a href="https://medium.com/@amcdnl/advanced-validation-with-angular-reactive-forms-2929759bf6e3">Advanced Validation with Angular Reactive Forms</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] 下載image並顯示</title>
      <link href="/2018/02/12/angular-download/"/>
      <url>/2018/02/12/angular-download/</url>
      
        <content type="html"><![CDATA[<h1 id="緣起"><a href="#緣起" class="headerlink" title="緣起"></a>緣起</h1><p>最近公司的產品有一個需求，是要讓使用者自行更換網頁的圖片，所以就有上傳下載圖片的需求，後端API是直接看上傳什麼格式就下載什麼內容，但是這樣的資料其實在angular中是需要加工才能使用的，來記錄一下作法，廢話不多說上code</p><span id="more"></span><h1 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h1><p>這種檔案的下載，後端吐回來其實是blob，所以必須要將httpclient指定類型</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(url, &#123; <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure><p>收到blob的資料後，要轉換成圖片其實有兩種作法，我比較偏好地一種，大家可以根據自己需求來使用</p><h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>使用window的<a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">URL.createObjectURL</a>這個api將檔案直接由瀏覽器暫存於記憶體中，只要使用一個短短的url就可以做使用，免去<code>漏漏長</code>的字串</p><blockquote><p>限定於ie10+使用，萬惡的IE…</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(url, &#123; <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span> &#125;)</span><br><span class="line">  .<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">map</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 避免沒檔案回傳卻還是產生url然後變成叉燒包</span></span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">size</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> urlCreator = <span class="variable language_">window</span>.<span class="property">URL</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">sanitizer</span>.<span class="title function_">bypassSecurityTrustUrl</span>(urlCreator.<span class="title function_">createObjectURL</span>(data));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br></pre></td></tr></table></figure><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>這個傳統的作法其實也叫做<a href="https://en.wikipedia.org/wiki/Data_URI_scheme">data uri schema</a>，就是內容會比較肥大一點，但好處就是瀏覽器都支援</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(url, &#123; <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span> &#125;)</span><br><span class="line">  .<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">mergeMap</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title class_">Observable</span>.<span class="title function_">create</span>(<span class="function"><span class="params">obs</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data.<span class="property">size</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">        <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">        reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          obs.<span class="title function_">next</span>(reader.<span class="property">result</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        reader.<span class="title function_">readAsDataURL</span>(data);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        obs.<span class="title function_">next</span>(<span class="literal">undefined</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker初介紹</title>
      <link href="/2018/01/08/docker-introduction/"/>
      <url>/2018/01/08/docker-introduction/</url>
      
        <content type="html"><![CDATA[<h1 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h1><p>身為開發者的你也許常常碰到以下的情況</p><span id="more"></span><ul><li>每個人的電腦環境都不同，常常說<code>在我電腦上是好的</code>，但在production或是同事的環境就是有問題</li><li>新同事進來要重新setup一個全新的環境，然後又跟其他人不同</li><li>mac、window跑起來不同</li><li>模擬環境非常的困難</li></ul><p>其實簡單講起來，就是因為環境的不同，很容易造成偵錯或是開發上的困擾，要解決這個問題，最簡單的作法就是把環境統一，這樣就不會那麼多的理由和藉口可以去說嘴</p><p>在以往可能會選擇使用VM來解決這個問題，但是一個vm動輒好幾G，常常光要複製就是一個困擾，而且開發上也用不到很多東西，因此我們需要更輕量的一個解決方案<code>docker</code></p><h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><p>簡單說就是虛擬機器，進階一點的說是輕量的虛擬機器；與傳統VM有什麼不同呢，可以透過下圖來做檢視，container少了一層，交由docker來實作這個部分</p><p><img src="/virtualization.png" alt="virtual"><br><img src="/docker.png" alt="docker"></p><h1 id="How"><a href="#How" class="headerlink" title="How"></a>How</h1><p>dockerg是由container、image這兩個組合起來的變形金剛（誤），那接著來介紹一下這兩個玩意</p><h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><p>透過指令將所需要的環境先寫好，container就可以直接使用這些所寫好的image來執行</p><h2 id="container"><a href="#container" class="headerlink" title="container"></a>container</h2><p>用來裝載image，並且每個container是獨立的不會互相影響</p><ul><li>不可變</li><li>輕量</li><li>快速</li><li>一次性</li><li>指令式(CI!!)</li></ul><h1 id="Use"><a href="#Use" class="headerlink" title="Use"></a>Use</h1><p>就讓我們開始進入docker的世界吧！</p><h2 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h2><p>除了可以直接上<a href="https://hub.docker.com/">docker hub</a>下載以外，當然也可以自己產生image（自己的內容自己做）<br>指定基底的image，再來就是開始安裝我們需要的東西</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8</span></span><br><span class="line"><span class="comment"># 執行安裝</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yarn global add @angular/cli</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ng -v</span></span><br><span class="line"><span class="comment"># 指定工作路徑</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="comment"># 複製檔案到container</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./src /app</span></span><br></pre></td></tr></table></figure><h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><p>docker是用go語言基於linux系統開發出來，所以就是滿滿的指令，而且寫的時候也要對image的環境指令有一定熟悉度，弄起來才不會一直碰壁…(苦主QQ)</p><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>寫好的dockerfile產生成為image；產生一個叫做<code>angular</code>的image</p><blockquote><p>docker build -t angular .</p></blockquote><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>將container啟動並且執行指令；指定本機4000的port連接到4200，並且執行ng serve的指令</p><blockquote><p>docker run -p 4000:4200 angular ng serve</p></blockquote><h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker compose"></a>docker compose</h1><p>可以定義與執行多個container，只要用簡單的指令，來完成全部的事情<br>(懶人專用…把指令都寫好只要呼叫就好)</p><blockquote><p>docker-compose up</p></blockquote><h2 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h2><p>透過<code>docker-compose.yml</code>可以事先設定好上面所輸入的那些docker指令</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dev:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4200:4200&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">ng</span> <span class="string">serve</span> <span class="string">-host</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">prod:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:4200&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">ng</span> <span class="string">serve</span> <span class="string">-host</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="string">--prod</span></span><br></pre></td></tr></table></figure><h1 id="conclusion"><a href="#conclusion" class="headerlink" title="conclusion"></a>conclusion</h1><p>docker是一個hen方便的工具，除了讓你快速複製環境，還能跟CI做個搭配，資源還不會吃太多，一起跳坑吧！</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AgnularJS] 與RxJS結合-監聽model變動</title>
      <link href="/2017/11/30/angularJS-rxjs/"/>
      <url>/2017/11/30/angularJS-rxjs/</url>
      
        <content type="html"><![CDATA[<h1 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h1><p>前陣子在公司的舊有專案有個需求，是要做AutoComplete的效果，那時候第一時間腦袋就是浮現了RxJS，用其他作法不是不行，只是剛好學了Rx就是想要用看看（其實想炫技～大誤）</p><span id="more"></span><blockquote><p>angularJS: 1.5.5<br>RxJS: 5.5.2</p></blockquote><h1 id="AngularJS-RxJS"><a href="#AngularJS-RxJS" class="headerlink" title="AngularJS+RxJS"></a>AngularJS+RxJS</h1><h2 id="Rx-Angular-JS"><a href="#Rx-Angular-JS" class="headerlink" title="Rx.Angular.JS"></a>Rx.Angular.JS</h2><p>決定好要使用以後先搜尋看看這相關的資料，沒想到竟然有整合好的套件<a href="https://github.com/Reactive-Extensions/rx.angular.js/"><code>rx.angular.js</code></a>，那當然就是馬上npm來用用看啦<br>但這個套件其實已經很久沒維護，RxJS也沒有更新，所以奉勸想要用的朋友請三思！</p><h2 id="RxJS"><a href="#RxJS" class="headerlink" title="RxJS"></a>RxJS</h2><p>還是直接安裝原生的最快（這邊不談論bundle大小的問題…），在使用的頁面中直接import就可以使用!</p><blockquote><p>npm install rxjs</p></blockquote><h1 id="ngModel-RxJS"><a href="#ngModel-RxJS" class="headerlink" title="ngModel+RxJS"></a>ngModel+RxJS</h1><p>RxJS可以用事件進行監聽，這作法會類似於原生js的寫法，但在angularJS的世界中，因為是用ngModel進行資料的雙向繫結，在這件事情上面就會比較麻煩一點</p><h2 id="建立一個監聽器"><a href="#建立一個監聽器" class="headerlink" title="建立一個監聽器"></a>建立一個監聽器</h2><p>使用 <code>$watch</code> 的方式做監聽model的變化，並且將資料透過Observer發送出去</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Rx</span> <span class="keyword">from</span> <span class="string">&#x27;rxjs/Rx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="property">$watch</span> = <span class="function">(<span class="params">scope, watchExpression, objectEquality</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Rx</span>.<span class="property">Observable</span>.<span class="title function_">create</span>(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 當model變動時，送資料給訂閱者</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">listener</span>(<span class="params">newValue, oldValue</span>) &#123;</span><br><span class="line">            observer.<span class="title function_">next</span>(&#123; <span class="attr">oldValue</span>: oldValue, <span class="attr">newValue</span>: newValue &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用$watch的方式監聽model的變化</span></span><br><span class="line">        <span class="keyword">return</span> scope.$watch(watchExpression, listener, objectEquality)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="開始監聽"><a href="#開始監聽" class="headerlink" title="開始監聽"></a>開始監聽</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Rx</span>.<span class="property">Observable</span>.$watch($scope, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">query</span>.<span class="property">Keyword</span>)</span><br><span class="line">    .<span class="title function_">debounceTime</span>(<span class="number">200</span>)</span><br><span class="line">    .<span class="title function_">subscribe</span>(<span class="function"><span class="params">p</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(p));</span><br></pre></td></tr></table></figure><p>透過這個作法，只要開始輸入資料就會開始接收到資料，這時候在來搭配後端的api去做查詢的動作，基本上AutoComplete的功能就算是完成</p><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>AngularJS雖然沒有像Angular一樣完美的結合了RxJS，但要使用上還是沒有問題，而且開始用以後就會停不下來，目前公司的產品已經開始被我慢慢使用，尤其是要多個API串接，然後有順序性那種，使用起來根本就是爽！</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端測試框架-Jasmine&amp;Protractor介紹</title>
      <link href="/2017/10/17/jasmine-protractor/"/>
      <url>/2017/10/17/jasmine-protractor/</url>
      
        <content type="html"><![CDATA[<p>今天要來談談兩個前端的測試框架，可以被使用在任何的前端網站開發中，當然也被應用在angular-cli中，但今天的內容其實不會搭配angular來做說明，而是以可以被獨立使用的工具</p><span id="more"></span><ul><li>Jasmine</li><li>Protractor</li></ul><h1 id="Jasmine"><a href="#Jasmine" class="headerlink" title="Jasmine"></a>Jasmine</h1><p>一套JS的測試framework，從2009年開始到現在，是一套非常老牌的框架，就直接來看看該怎麼使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install jasmine</span></span><br><span class="line">npm install --save-dev jasmine</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Initialize Jasmine <span class="keyword">in</span> your project</span></span><br><span class="line">./node_modules/.bin/jasmine init</span><br></pre></td></tr></table></figure><p>設定<code>package.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jasmine&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>接著產生一個測試檔案<code>spec/first.spec.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;first test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;hello jasmine&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">expect</span>(<span class="literal">true</span>).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="title function_">expect</span>(<span class="literal">false</span>).<span class="property">not</span>.<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>npm test</p></blockquote><p>執行完上面的指令，可以得到第一次的測試成功</p><ul><li><code>describe</code> 將關連的規格做群組的功能(允許巢狀)</li><li><code>it</code> 描述規格內容</li><li><code>expect</code> 測試的實際值</li><li><code>toBe</code> 判斷是否與前面的實際值相同</li><li><code>not</code> 反向指令</li></ul><p>上面的範例就是jasmine的固定格式，只是說我們要透過不同的Matchers來做為測試的手法，接著就來介紹常用的Matchers</p><h2 id="Machers"><a href="#Machers" class="headerlink" title="Machers"></a>Machers</h2><h3 id="toEqual"><a href="#toEqual" class="headerlink" title="toEqual"></a>toEqual</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;toEqual&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">12</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toEqual</span>(<span class="number">12</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="toBeLessThan-x2F-toBeGreaterThan"><a href="#toBeLessThan-x2F-toBeGreaterThan" class="headerlink" title="toBeLessThan&#x2F;toBeGreaterThan"></a>toBeLessThan&#x2F;toBeGreaterThan</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;toBeLessThan &amp; toBeGreaterThan&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pi = <span class="number">3.1415926</span>;</span><br><span class="line">    <span class="keyword">let</span> e = <span class="number">2.78</span>;</span><br><span class="line">    <span class="title function_">expect</span>(e).<span class="title function_">toBeLessThan</span>(pi);</span><br><span class="line">    <span class="title function_">expect</span>(e).<span class="property">not</span>.<span class="title function_">toBeGreaterThan</span>(pi);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="toThrow-x2F-toThrowError"><a href="#toThrow-x2F-toThrowError" class="headerlink" title="toThrow&#x2F;toThrowError"></a>toThrow&#x2F;toThrowError</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;toThrow &amp; toThrowError&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;foo bar baz&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="title function_">toThrow</span>();</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="title function_">toThrowError</span>(<span class="string">&quot;foo bar baz&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="title function_">toThrowError</span>(<span class="regexp">/bar/</span>);</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="title function_">toThrowError</span>(<span class="title class_">TypeError</span>);</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="title function_">toThrowError</span>(<span class="title class_">TypeError</span>, <span class="string">&quot;foo bar baz&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>當然還有更多的Machers，也可以到<a href="https://jasmine.github.io/api/2.8/matchers.html">官網文件</a>查看，接著來看蠻常用到的功能Global功能</p><h2 id="Global"><a href="#Global" class="headerlink" title="Global"></a>Global</h2><h3 id="beforeEach-x2F-afterEach"><a href="#beforeEach-x2F-afterEach" class="headerlink" title="beforeEach&#x2F;afterEach"></a>beforeEach&#x2F;afterEach</h3><p>每個it在跑的時候都是獨立的事件，如果有些動作是要在每個it都要跑一樣的，那就可以使用這個功能<br>例如：網站登入的動作</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;A spec using beforeEach and afterEach&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        foo += <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">afterEach</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        foo = <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;is just a function, so it can contain any code&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;can have more than one expectation&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="title function_">expect</span>(<span class="literal">true</span>).<span class="title function_">toEqual</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="beforeAll-x2F-afterAll"><a href="#beforeAll-x2F-afterAll" class="headerlink" title="beforeAll&#x2F;afterAll"></a>beforeAll&#x2F;afterAll</h3><p>類似於beforeEach的功能，但beforeAll只會在整個describe中執行一次</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;A spec using beforeAll and afterAll&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">beforeAll</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        foo += <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">afterAll</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        foo = <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;sets the initial value of foo before specs run&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;does not reset foo between specs&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="xit-x2F-xdescribe"><a href="#xit-x2F-xdescribe" class="headerlink" title="xit&#x2F;xdescribe"></a>xit&#x2F;xdescribe</h3><p>disable it&#x2F;describe</p><h3 id="fit-x2F-fdescribe"><a href="#fit-x2F-fdescribe" class="headerlink" title="fit&#x2F;fdescribe"></a>fit&#x2F;fdescribe</h3><p>只執行it&#x2F;describe</p><h2 id="Spies"><a href="#Spies" class="headerlink" title="Spies"></a>Spies</h2><p>在測試中，mock的手法蠻常用到(在jasmine中是叫做spy)，尤其是要呼叫api或是使用第三方套件時，那些function我們認為是正確的，所以不希望把那些包進來測試，就做模擬的方式取代掉真實的呼叫，專注於我們自己所要測試的功能上</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;A spy&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> foo, bar = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        foo = &#123;</span><br><span class="line">            <span class="attr">setBar</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                bar = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        <span class="title function_">spyOn</span>(foo, <span class="string">&#x27;setBar&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">        foo.<span class="title function_">setBar</span>(<span class="number">123</span>);</span><br><span class="line">        foo.<span class="title function_">setBar</span>(<span class="number">456</span>, <span class="string">&#x27;another param&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;tracks that the spy was called&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo.<span class="property">setBar</span>).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;tracks all the arguments of its calls&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo.<span class="property">setBar</span>).<span class="title function_">toHaveBeenCalledWith</span>(<span class="number">123</span>);</span><br><span class="line">        <span class="title function_">expect</span>(foo.<span class="property">setBar</span>).<span class="title function_">toHaveBeenCalledWith</span>(<span class="number">456</span>, <span class="string">&#x27;another param&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;stops all execution on a function&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(bar).<span class="title function_">toBeNull</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><code>toHaveBeenCalled</code> 檢查是否真的有被呼叫過，<code>toHaveBeenCalledWith()</code> 是否符合呼叫function的參數列表</p></blockquote><p>透過<code>spyOn</code>將setBar這個function做模擬，因此在這段的測試中，bar的值依舊是null，這個作法是完全攔截，而且沒有任何回傳結果，但我們通常應該會有一些輸出結果，就可以採用<code>and.returnValue</code>或是<code>and.callFake</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;A spy, when configured to fake a return value&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> foo, bar, fetchedBar;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        foo = &#123;</span><br><span class="line">            <span class="attr">setBar</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                bar = value;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">getBar</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> bar;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">getBar1</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> bar;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        <span class="title function_">spyOn</span>(foo, <span class="string">&quot;getBar&quot;</span>).<span class="property">and</span>.<span class="title function_">returnValue</span>(<span class="number">745</span>);</span><br><span class="line">        <span class="title function_">spyOn</span>(foo, <span class="string">&quot;getBar1&quot;</span>).<span class="property">and</span>.<span class="title function_">callFake</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1001</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        foo.<span class="title function_">setBar</span>(<span class="number">123</span>);</span><br><span class="line">        fetchedBar = foo.<span class="title function_">getBar</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;should not effect other functions&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(bar).<span class="title function_">toEqual</span>(<span class="number">123</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;when called returns the requested value&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(fetchedBar).<span class="title function_">toEqual</span>(<span class="number">745</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;when called returns the requested value&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">expect</span>(foo.<span class="title function_">getBar1</span>()).<span class="title function_">toEqual</span>(<span class="number">1001</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Protractor"><a href="#Protractor" class="headerlink" title="Protractor"></a>Protractor</h1><p>由angular官方出的一套end-to-end(e2e)的framework，測試期間會開啟一個瀏覽器去執行所要測試的項目，如果是使用angular-cli所產生的專案，預設就已經包含，設定放在根目錄底下的<code>protractor.conf.js</code></p><p>但今天說好不管angular-cli的，因此我們要自己安裝</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g protractor</span><br><span class="line">webdriver-manager update</span><br><span class="line">webdriver-manager start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">http://localhost:4444/wd/hub</span></span><br></pre></td></tr></table></figure><p>接著必須要有一個設定檔<code>conf.js</code>，並且寫好測試檔<code>spec.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//conf.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">config</span> = &#123;</span><br><span class="line">  <span class="attr">framework</span>: <span class="string">&#x27;jasmine&#x27;</span>,</span><br><span class="line">  <span class="attr">seleniumAddress</span>: <span class="string">&#x27;http://localhost:4444/wd/hub&#x27;</span>,</span><br><span class="line">  <span class="attr">specs</span>: [<span class="string">&#x27;spec.js&#x27;</span>]<span class="comment">//測試規格檔</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>framework</code> 在這邊我使用了jasmine，但如果有其他習慣的框架也是能夠使用的</p><ul><li>Mocha</li><li>Cucumber</li><li>Serenity&#x2F;JS</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// spec.js</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Protractor Demo App&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should have a title&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    browser.<span class="title function_">get</span>(<span class="string">&#x27;http://juliemr.github.io/protractor-demo/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(browser.<span class="title function_">getTitle</span>()).<span class="title function_">toEqual</span>(<span class="string">&#x27;Super Calculator&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>protractor conf.js</p></blockquote><p>好的，做完上面的動作，已經得到第一次的測試，也可以看到protractor開啟了網頁，並且拿到網頁上的內容做測試，這就是這套工具所提供的功能!</p><ul><li><code>browser.get</code> 載入網頁</li><li><code>browser.getTitle</code> 取得網站title</li></ul><p>到這邊做過第一次測試，但這種不是我們平常會做的測試，因此我們拿上面的網站，來進行內容的測試，首先要取得畫面中的輸入框，並且填入數字</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Protractor Demo App&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        browser.<span class="title function_">get</span>(<span class="string">&#x27;http://juliemr.github.io/protractor-demo/&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;first input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> first = <span class="title function_">element</span>(by.<span class="title function_">css</span>(<span class="string">&#x27;.input-small&#x27;</span>));</span><br><span class="line">        first.<span class="title function_">sendKeys</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">        <span class="title function_">expect</span>(first.<span class="title function_">getAttribute</span>(<span class="string">&#x27;value&#x27;</span>)).<span class="title function_">toEqual</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><code>sendKeys(&#39;2&#39;)</code> 模擬鍵盤並且送出2，<code>getAttribute(&#39;value&#39;)</code> 取得value的屬性</p></blockquote><p>顯然我們只取得第一個輸入框，但畫面中有兩個輸入框，接著調整一下作法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;two input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> els = element.<span class="title function_">all</span>(by.<span class="title function_">css</span>(<span class="string">&#x27;.input-small&#x27;</span>));</span><br><span class="line">    <span class="keyword">let</span> first = els.<span class="title function_">get</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// let first = els.first(); same as get(0)</span></span><br><span class="line">    first.<span class="title function_">sendKeys</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> sec = els.<span class="title function_">get</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// let sec = els.last(); same as get(1)</span></span><br><span class="line">    sec.<span class="title function_">sendKeys</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><code>element.all</code> 取得所有符合條件的element，<code>get(0)</code>、<code>first()</code>、<code>last()</code> 取得指定的element</p></blockquote><p>填入兩個輸入框的值後，就可以按下按鈕，並且取得結果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;calculate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> els = element.<span class="title function_">all</span>(by.<span class="title function_">css</span>(<span class="string">&#x27;.input-small&#x27;</span>));</span><br><span class="line">    <span class="keyword">let</span> first = els.<span class="title function_">get</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// let first = els.first(); same as get(0)</span></span><br><span class="line">    first.<span class="title function_">sendKeys</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> sec = els.<span class="title function_">get</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// let sec = els.last();</span></span><br><span class="line">    sec.<span class="title function_">sendKeys</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">element</span>(by.<span class="title function_">id</span>(<span class="string">&#x27;gobutton&#x27;</span>)).<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>($(<span class="string">&#x27;h2&#x27;</span>).<span class="title function_">getText</span>()).<span class="title function_">toEqual</span>(<span class="string">&#x27;6&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>by.id(&#39;gobutton&#39;)</code> id&#x3D;’gobutton’的選擇器，<code>click()</code> 產生click行為，<code>$(&#39;h2&#39;)</code> 使用jquery的寫法取得特定tag name的element，<code>getText()</code> 取得element的內文</p></blockquote><p>執行完上面的測試案例，結果跟預期的一樣，恭喜測試完成！🥂<br>接著回過頭來看一下在protractor中比較重要的幾個物件</p><ul><li><code>browser</code> 透過WebDriver操作瀏覽器，像是開啟網頁</li><li><code>element</code> 存取網頁的element</li><li><code>by</code> 選擇器</li></ul><p>今天的demo程式<a href="https://github.com/jiaming0708/testTool">github連結</a></p><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul><li><a href="https://angular.io/guide/testing">angular test guide</a></li><li><a href="https://jasmine.github.io/">jasmine</a></li><li><a href="http://www.protractortest.org/#/">protractor</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Testing </tag>
            
            <tag> Jasmine </tag>
            
            <tag> Protractor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] ViewChild遇上ngIf</title>
      <link href="/2017/09/14/angular-viewchild-ngif/"/>
      <url>/2017/09/14/angular-viewchild-ngif/</url>
      
        <content type="html"><![CDATA[<p>當我們有一個child component想要用ViewChild的方法在parent component取得物件，但如果在上面加上ngIf的時候，取得物件的這個動作就會發現根本取不到!!!</p><span id="more"></span><p>在app.component中，使用todo.component，並且加上ngIf作為控制是否顯示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;setFlag(!flag)&quot;</span>&gt;</span>toggle flag<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">app-todo</span> *<span class="attr">ngIf</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app-todo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在component中，使用<code>ViewChild</code>的方法並且在<code>setFlag</code>中印出物件，就可以發現在這個時候是取不到todo這個物件的，就算是用angularJS常用的setTimeout也是一樣</p><p>這個問題應該就是變數還沒反應到html，所以導致根本還沒拿到這個物件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="title class_">TodoComponent</span>) <span class="attr">todo</span>: <span class="title class_">TodoComponent</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setFlag</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flag</span> = flag;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span>, <span class="variable language_">this</span>.<span class="property">todo</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b&#x27;</span>, <span class="variable language_">this</span>.<span class="property">todo</span>);</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h1><p>但這樣根本不能拿到物件要怎麼往後處理，那這邊有兩個作法</p><ol><li><p>在child component使用事件作為觸發，當物件被ngIf啟動後，就可以拋出事件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TodoComponent</span> <span class="keyword">implements</span> <span class="title class_">AfterViewInit</span> &#123;</span><br><span class="line">  <span class="meta">@Output</span>() onInit = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngAfterViewInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onInit</span>.<span class="title function_">emit</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在parent component收到事件後再去操作ViewChild的物件，就可以正常使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;setFlag(!flag)&quot;</span>&gt;</span>toggle flag<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">app-todo</span> (<span class="attr">onInit</span>)=<span class="string">&quot;trigerTodo($event)&quot;</span> *<span class="attr">ngIf</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app-todo</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="title class_">TodoComponent</span>) <span class="attr">todo</span>: <span class="title class_">TodoComponent</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setFlag</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flag</span> = flag;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">trigerTodo</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;component&#x27;</span>, event);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ViewChild使用setter，當物件被建立時，就可以在裡面進行操作</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="title class_">TodoComponent</span>) <span class="keyword">set</span> <span class="title function_">todo</span>(<span class="params">content: ViewContainerRef</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setter&#x27;</span>, content);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setFlag</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flag</span> = flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>其實在使用ViewChild的時候，使用ngIf其實是不好的應用，但如果真的要用就必須要繞路一下，也要去了解一下各種使用方法，上面的兩個方法，我個人比較喜歡setter的作法，簡單乾淨!</p><p>如果有其他作法或想法歡迎來討論喔!!</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>設定Reverse Proxy在Windows、Mac</title>
      <link href="/2017/09/02/reserve-proxy/"/>
      <url>/2017/09/02/reserve-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因為測試的需要，protrator-recorder是在local環境中架設走的是http，但公司的測試環境是在https底下，因此會導致無法將protrator-recorder掛載到測試環境中進行錄製，就開始找方法去解決</p><span id="more"></span><p>錯誤訊息是mixed content，讓我一開始找的方向就是把工具架成https，錄製工具總共要起兩個網站，第一個是webdriver，第二個是recorder本身</p><p>第一個想法就是針對recorder本身改成https，原生程式是用node的express+http，只要改成https即可，但是問題來了，webdriver這個工具該怎麼架成https，這部份我沒找到資料(如果有人知道麻煩告訴我)，在經過幾番詢問後，kevin給了一個新的方向 <code>reverse proxy</code> </p><h1 id="Reverse-Proxy"><a href="#Reverse-Proxy" class="headerlink" title="Reverse Proxy"></a>Reverse Proxy</h1><p>在開始之前，要先複習一下一般的Proxy功能(也就是Forward Proxy)</p><p>透過proxy可以直接連線到無法直接連線的網站，還蠻常應用在要連國外的網站只允許自己國家內的ip；或者是在公司內部不允許對外，就必須要透過proxy來做對外的接口</p><p><img src="/2017/09/02/reserve-proxy/proxy-server.png" alt="proxy-server"></p><p>複習完Proxy後，我們要來看看什麼是Reverse Proxy</p><p>從字面上來看就是反向，我們連線到一個網站，但是他透過ReverseProxy去連線到背後真實的網站，那對使用者來說其實沒有影響，因為還是可以連到對的網站進行瀏覽</p><p><img src="/2017/09/02/reserve-proxy/reverse-proxy.jpg" alt="reverse-proxy"></p><h1 id="架設"><a href="#架設" class="headerlink" title="架設"></a>架設</h1><p>本身有兩個開發環境，mac、windows，底下就針對這兩個環境下怎麼架設來說明一下</p><h2 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h2><p>在mac環境下可以使用 <a href="http://docs.mitmproxy.org/en/stable/index.html">mitmdump</a> ，照著官方安裝即可</p><p>安裝好後，要設定reverse proxy，可以參考<a href="http://docs.mitmproxy.org/en/stable/features/reverseproxy.html">這篇</a>，只要在後面加上-r並且給目標https網站即可<br>那我們瀏覽的時候只要連<code>http://localhost</code>即可</p><blockquote><p>mitmdump -R <a href="https://httpbin.org/">https://httpbin.org</a> -p 80</p></blockquote><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>在mac所用的mitmdump這套軟體，很可惜的在windows只剩下UI版本，沒有command mode，那我們所需要reverse proxy就不知道該怎麼設定，因此要改其他方法</p><p>還好強大的微軟(XDDD)在IIS已經先埋好這個功能，要在IIS上使用，必須要先安裝兩個套件</p><ul><li><a href="https://www.iis.net/downloads/microsoft/application-request-routing">ARR(Application Request Routing)</a></li><li><a href="https://www.iis.net/downloads/microsoft/url-rewrite">URL Rewrite</a></li></ul><blockquote><p>系統環境為:(<font color="red">其他環境的操作畫面可能不同!</font>)<br>Win 10<br>IIS 10</p></blockquote><p>安裝完畢後，先進行ARR的設定，將Proxy啟用</p><p><img src="/2017/09/02/reserve-proxy/IIS_ARR.png" alt="IIS_ARR"></p><p><img src="/2017/09/02/reserve-proxy/ARR_main.png" alt="ARR_main"></p><p><img src="/2017/09/02/reserve-proxy/ARR1.png" alt="ARR1"></p><p><img src="/2017/09/02/reserve-proxy/ARR2.png" alt="ARR2"></p><p>接著就可以設定URL Rewrite的設定</p><p><img src="/2017/09/02/reserve-proxy/IIS_url_rewrite.png" alt="IIS_url_rewrite"></p><p><img src="/2017/09/02/reserve-proxy/URL_Rewrite_main.png" alt="URL_Rewrite_main"></p><p><img src="/2017/09/02/reserve-proxy/URL_Rewrite_rule.png" alt="URL_Rewrite_rule"></p><p><img src="/2017/09/02/reserve-proxy/URLrewrite1.png" alt="URLrewrite1"></p><p><img src="/2017/09/02/reserve-proxy/URLrewrite2.png" alt="URLrewrite2"></p><blockquote><p>這邊要注意一下，重寫URL後面帶的參數，如果錯誤就無法正確導入<br>可以使用測試模式，確認一下內容</p></blockquote><h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><a href="https://docs.microsoft.com/en-us/iis/extensions/url-rewrite-module/reverse-proxy-with-url-rewrite-v2-and-application-request-routing">Microsoft - Reverse Proxy with URL Rewrite v2 and Application Request Routing</a></p><p><a href="https://docs.microsoft.com/en-us/iis/extensions/url-rewrite-module/creating-rewrite-rules-for-the-url-rewrite-module">Microsoft - Creating Rewrite Rules for the URL Rewrite Module</a></p><p><a href="https://en.wikipedia.org/wiki/Reverse_proxy">Reverse Proxy</a></p>]]></content>
      
      
      <categories>
          
          <category> IIS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Design Pattern] Observer(觀察者)、Decoractor(裝飾器)</title>
      <link href="/2017/08/29/design-pattern-observer-decorator/"/>
      <url>/2017/08/29/design-pattern-observer-decorator/</url>
      
        <content type="html"><![CDATA[<p>今天要來談談不一樣的東西，關於Design Pattern的兩三事，在程式開發中應用了這些模式在撰寫上可以更輕鬆一點，那我們先來看看其中的兩個</p><ul><li>Observer 觀察者</li><li>Decoractor 裝飾器</li></ul><span id="more"></span><h1 id="Observer-Pattern"><a href="#Observer-Pattern" class="headerlink" title="Observer Pattern"></a>Observer Pattern</h1><p>當我們今天要去確認一個目標有沒有新的資料，我們必須要不斷的詢問，不只詢問的人很煩，被問的人也要花費力氣去回應(儘管這可能很輕鬆)，但很多人跟他詢問的時候就會佔用太多時間</p><p><img src="/2017/08/29/design-pattern-observer-decorator/request.png" alt="request"></p><p>那這時候其實我們可以反過來思考，請求者跟目標說，你有新的資料就通知我，這種情況下雙方都會比較輕鬆，那這種模式其實就是Observer Pattern</p><p><img src="/2017/08/29/design-pattern-observer-decorator/observer.png" alt="observer"></p><p>那我們最常聽到的範例就是跟報社訂報紙，訂戶跟報社訂閱報紙，只要報社一出版就會送到訂戶手上，也就是說訂戶是被動而報社是主動</p><p>根據上述的內容，我們來試著實作看看</p><script src="//gist.github.com/eeb7fb552d14a06690665ba27a013154.js?file=Producer.ts"></script><script src="//gist.github.com/eeb7fb552d14a06690665ba27a013154.js?file=main.ts"></script><blockquote><p>A new course!!from listener1<br>A new course!!from listener2</p></blockquote><h1 id="Decoractor-Pattern"><a href="#Decoractor-Pattern" class="headerlink" title="Decoractor Pattern"></a>Decoractor Pattern</h1><p>今天買了一台摩托車，很帥的想要去把妹，但是缺少了點個性化，所以我們可以加上一些商家已經做好的套件裝上去，例如換沖天排氣管、翹牌器<br>這個精神可以稱作修飾(decoractor)</p><p>那接著來實作看看吧</p><script src="//gist.github.com/8f9d48ec2263994ac325c1d407260fab.js?file=decoractor.ts"></script><blockquote><p>f(): evaluated<br>g(): evaluated<br>g(): called<br>f(): called</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[FrontEnd] e2e錄製工具</title>
      <link href="/2017/08/17/e2e-tools/"/>
      <url>/2017/08/17/e2e-tools/</url>
      
        <content type="html"><![CDATA[<p>記錄一下，最近找的幾套測試錄製工具</p><span id="more"></span><ul><li><a href="https://www.ranorex.com/">Ranorex</a><ul><li>UI操作簡單</li><li>產生C# code</li><li>單價高</li></ul></li><li><a href="https://smartbear.com/product/testcomplete/overview/">TestComplete</a><ul><li>UI操作不方便</li><li>不知道如何產生腳本</li></ul></li><li><a href="http://www.seleniumhq.org/projects/ide/">Selenium IDE</a><ul><li>firefox套件，只支援34.*版本(目前5x版)</li></ul></li><li><a href="https://testrec.com/">testrec</a><ul><li>還在beta</li><li>無法產生腳本</li></ul></li><li><a href="https://github.com/ealves/protractor-recorder">protractor-recorder</a><ul><li>可以產生protactor腳本</li><li>使用IDE錄製，可以在加工</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> e2e </category>
          
      </categories>
      
      
        <tags>
            
            <tag> e2e </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] Directive介紹</title>
      <link href="/2017/08/16/angular-directive/"/>
      <url>/2017/08/16/angular-directive/</url>
      
        <content type="html"><![CDATA[<p>為什麼要用Directive，可以幫助我們做到什麼事情?</p><span id="more"></span><p>directive是一個可以擴充element的行為或是呈現，最常使用的component則是繼承了directive加上template的部份，</p><p>這時候我們可以使用directive來幫助我們，把重複的東西抽離出來，並且能夠讓element變得精簡</p><p>directive有三種類型</p><ul><li>Component</li><li>Structural Directive</li><li>Attribute Directive</li></ul><h2 id="Structural-Directive"><a href="#Structural-Directive" class="headerlink" title="Structural Directive"></a>Structural Directive</h2><p>對HTML的結構進行操作，像是隱藏、顯示或是迴圈等的動作。<br>常用的功能有<code>ngIf</code>、<code>ngFor</code>、<code>ngSwitch</code>。</p><p><code>*ngIf</code>代表著是否要顯示dom，這邊隱藏的話是不會去真正的產生element</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div *ngIf=&quot;true&quot;&gt;this is show&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div *ngIf=&quot;false&quot;&gt;this is hide&lt;/div&gt;</span><br><span class="line">&lt;!--template bindings=&#123;</span><br><span class="line">  &quot;ng-reflect-ng-if&quot;: null</span><br><span class="line">&#125;--&gt;</span><br></pre></td></tr></table></figure><p><code>*ngFor</code>迴圈顯示，被包在裡面的html可以自行定義</p><blockquote><p>這邊要注意，當變數是null則會死掉，這時候外面可以包一個*ngIf</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div *ngFor=&quot;let todo of todoList&quot;&gt;</span><br><span class="line">  &#123;&#123;todo.name&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><code>ngSwith</code>樣板有多種需要動態決定顯示哪個時可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div [ngSwitch]=&quot;hero?.emotion&quot;&gt;</span><br><span class="line">  &lt;happy-hero    *ngSwitchCase=&quot;&#x27;happy&#x27;&quot;    [hero]=&quot;hero&quot;&gt;&lt;/happy-hero&gt;</span><br><span class="line">  &lt;sad-hero      *ngSwitchCase=&quot;&#x27;sad&#x27;&quot;      [hero]=&quot;hero&quot;&gt;&lt;/sad-hero&gt;</span><br><span class="line">  &lt;confused-hero *ngSwitchCase=&quot;&#x27;confused&#x27;&quot; [hero]=&quot;hero&quot;&gt;&lt;/confused-hero&gt;</span><br><span class="line">  &lt;unknown-hero  *ngSwitchDefault           [hero]=&quot;hero&quot;&gt;&lt;/unknown-hero&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>使用*做為前置詞，用來跟其他功能做區隔<br>當然也可以用其他的寫法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div template=&quot;ngIf hero&quot;&gt;&#123;&#123;hero.name&#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;ng-template [ngIf]=&quot;hero&quot;&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;hero.name&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/ng-template&gt;</span><br></pre></td></tr></table></figure><h2 id="Attribute-Directive"><a href="#Attribute-Directive" class="headerlink" title="Attribute Directive"></a>Attribute Directive</h2><p>可以改變element的行為或是樣式</p><p><code>ngClass</code>改變element的class，使用陣列的方式或用物件的方式來決定要哪些class要被引用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div [ngClass]=&quot;&#x27;selected&#x27;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div [ngClass]=&quot;[&#x27;selected&#x27;]&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div [ngClass]=&#123;&#x27;selected&#x27;:true&#125;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><code>ngStyle</code>改變element的style內容，與ngClass的用法相同</p><h2 id="動手做"><a href="#動手做" class="headerlink" title="動手做"></a>動手做</h2><p> 現在可以來試試看寫個attribute directive</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Directive, ElementRef, Input &#125; from &#x27;@angular/core&#x27;;</span><br><span class="line"></span><br><span class="line">@Directive(&#123; selector: &#x27;[myTodo]&#x27; &#125;)</span><br><span class="line">export class TodoDirective &#123;</span><br><span class="line">    constructor(el: ElementRef) &#123;</span><br><span class="line">       el.nativeElement.classList.add(&#x27;completed&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>selector用法</strong></p><ul><li><code>element-name</code></li><li><code>.class</code></li><li><code>[attribute]</code></li><li><code>[attribute=value]</code></li><li><code>:not(sub_selector)</code></li><li><code>selector1, selector2</code></li></ul><h2 id="Input-x2F-Ouput"><a href="#Input-x2F-Ouput" class="headerlink" title="@Input&#x2F;@Ouput"></a>@Input&#x2F;@Ouput</h2><p>component之間或是和directive要互相傳遞資料的時候，我們能夠透過input和output的方式來做傳遞。<br>接著來看看如何使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Directive(&#123;select: &#x27;[myTodo]&#x27; &#125;)</span><br><span class="line">export class TodoDirective&#123;</span><br><span class="line">  //這是相同的意思</span><br><span class="line">  @Input() todo:string;</span><br><span class="line">  @Input(&#x27;status&#x27;) _status:boolean;</span><br><span class="line">  //Output只能拋出event喔!</span><br><span class="line">  @Output() onEventChange = new EventEmitter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>像上面的例子，如果希望把傳進來的status來改變style狀態，可以這樣做</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Directive(&#123;select: &#x27;[myTodo]&#x27; &#125;)</span><br><span class="line">export class TodoDirective&#123;</span><br><span class="line">  @Input(&#x27;status&#x27;) _status:boolean;</span><br><span class="line">  </span><br><span class="line">  constructor(el: ElementRef)&#123;</span><br><span class="line">    if(this._status)&#123;</span><br><span class="line">      el.nativeElement.classList.add(&#x27;complete&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      el.nativeElement.classList.remove(&#x27;complete&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但其實這樣很麻煩，而且只有第一次產生物件時會執行，可以改成用HostBinding的方法來做</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Directive(&#123;select: &#x27;[myTodo]&#x27; &#125;)</span><br><span class="line">export class TodoDirective&#123;</span><br><span class="line">  @Input(&#x27;status&#x27;) @HostBinding(&#x27;class.completed&#x27;) _status:boolean;</span><br><span class="line">  </span><br><span class="line">  constructor(el: ElementRef)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@HostBinding是用來變更directive所在的那個element的一些屬性，例如：style、class等，那你也許會問可以變更屬性，那能不能監聽element的事件呢？答案是可以的，我們可以來用用@HostListener</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Directive(&#123;select: &#x27;[myTodo]&#x27; &#125;)</span><br><span class="line">export class TodoDirective&#123;</span><br><span class="line">  @Input(&#x27;status&#x27;) @HostBinding(&#x27;class.completed&#x27;) _status:boolean;</span><br><span class="line">  //Output只能拋出event喔!</span><br><span class="line">  @Output() onEventChange = new EventEmitter();</span><br><span class="line">  @HostListener(&#x27;click&#x27;) onHostClick()&#123;</span><br><span class="line">    this.el.nativeElement.classList.toggle(&#x27;complete&#x27;);</span><br><span class="line">    this.onEventChange.emit();</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  constructor(private el: ElementRef)&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><p><a href="https://angular.io/guide/attribute-directives">官網</a><br><a href="https://jeffwu85182.github.io/2017/03/25/angular-directive-reaserch/">Jeff筆記</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular/AngularJS] Exception Handle</title>
      <link href="/2017/07/24/angular-exception/"/>
      <url>/2017/07/24/angular-exception/</url>
      
        <content type="html"><![CDATA[<p>今天來看一下Angular和AngularJS如何去handle在網站中任一個地方發生的exception<br>想要把這種資料回寫到後端，我們可以怎麼去實作他</p><span id="more"></span><h1 id="Angular作法"><a href="#Angular作法" class="headerlink" title="Angular作法"></a>Angular作法</h1><p>在Angular可以攔截在全域未handle到的exception，可以看一下<a href="https://angular.io/api/core/ErrorHandler">官方文件</a></p><p>只要照著寫一個class <code>implements ErrorHandler</code>就可以<br>最簡單的錯誤就是在呼叫api的時候沒有去handle exception(想辦法讓api呼叫失敗)<br>這時候就會進入到自己寫的那個class中</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErrorHandler</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@angular/core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyErrorHandler</span> <span class="keyword">implements</span> <span class="title class_">ErrorHandler</span> &#123;</span><br><span class="line">    <span class="title function_">handleError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="comment">//call backend api</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`this is my error handle, <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="AngularJS作法"><a href="#AngularJS作法" class="headerlink" title="AngularJS作法"></a>AngularJS作法</h1><p>因為工作上還有用到AngularJS，同事就問到有沒有這種東西<br>於是查詢了一下<a href="https://docs.angularjs.org/api/ng/service/$exceptionHandler">官方文件</a></p><p>作法跟Angular蠻像的，果然是前後代XD</p><p>同樣的照著官方文件做，寫一個factory叫做<code>$exceptionHandler</code>，overwrite原生的handler<br>一樣可以輕鬆的搞定需求</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;exceptionModule&#x27;</span>)</span><br><span class="line">    .<span class="title function_">factory</span>(<span class="string">&#x27;$exceptionHandler&#x27;</span>, [<span class="string">&#x27;$log&#x27;</span>, <span class="keyword">function</span> (<span class="params">$log</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">myExceptionHandler</span>(<span class="params">exception, cause</span>) &#123;</span><br><span class="line">            <span class="comment">//call Backend api</span></span><br><span class="line">            $log.<span class="title function_">error</span>(<span class="string">`my error handler, <span class="subst">$&#123;exception&#125;</span>`</span>, cause)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReactiveX介紹</title>
      <link href="/2017/07/05/rx/"/>
      <url>/2017/07/05/rx/</url>
      
        <content type="html"><![CDATA[<p>今天要來探討ReactiveX(底下簡稱Rx)，這個已經紅很久的概念，各語言有各自的實作ex:RxJS、RxJava…<br>我們先來看看Rx是什麼東西，官方給了一個定義<br><code>composing asynchronous and event-based programs by using observable sequences</code></p><span id="more"></span><p>以下範例都將以RxJS為主</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=from.js"></script><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=fromEvent.js"></script><p>從上面的範例中可以看到Rx將事件或是資料的處理方式統一了作法<br>將陣列的資料拆開，然後跟事件一樣一筆一筆的發送出去<code>event-based、sequence</code></p><p>從這邊我們也看到範例中，有Observable、subscribe這兩個東西，到底是什麼</p><h1 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h1><p>我們用個例子來解釋一下…<br>今天到了一間無菜單料理的餐廳，你坐下來後，服務生就開始陸續的把菜送上來<br>套回Rx上面，Subscribe也就是身為客戶的你，餐廳的廚房就是Observable，廚師變化料理也就是Operator</p><blockquote><p>請忽視價格問題:)</p></blockquote><p><em><strong>從這個例子能看到一件事情，其實很重要，也就是當沒有客人(Subscribe)來，廚房(Observable)是不會動作的</strong></em></p><p>還是要回歸正提XDD，Rx提供了多種產生的方式，這邊列舉幾個常用的</p><ul><li>create<br>產生Observable，可以自行控制資料<blockquote><p>其實不常用</p></blockquote></li></ul><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=create.js"></script><p>透過next不斷的發送資料出去，當要讓subscribe知道已經結束則使用complete<br>若是錯誤則是使用throw<br>complete、throw對於observable來說都是結束的意思，後面的動作就不會繼續觸發了</p><ul><li><p>of<br>輸出陣列資料</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=of.js"></script></li><li><p>from<br>將陣列資料拆解，sequence的將資料拋出</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=from.js"></script></li><li><p>fromEvent<br>監聽事件</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=fromEvent.js"></script></li></ul><h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><p>Operator就像是煮飯一樣，搭配的好就像是阿基師，搭配不好吃起來就會…(遠目<br>Rx已經準備好許多的配料，可以讓我們自行搭配，底下用幾個來做範例吧</p><ul><li><p>map</p></li><li><p>filter</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=operator.js"></script></li><li><p>concat</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=concat.js"></script></li><li><p>merge</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=merge.js"></script></li><li><p>mergeMap<br>等於merge+map的合體技</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=mergeMap.js"></script></li></ul><p>看完了上面的介紹，也許有人就會開始想說，那可不可以有多個訂閱者<br>那多個訂閱者收到的資料會是什麼</p><blockquote><p>答案是全部的人收到一模一樣的資料</p></blockquote><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=delay.js"></script><p>那這樣一定會有人說，我只想要從訂閱之後的資料就好，我不想要全部的資料<br>subject粉墨登場~~</p><h1 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h1><p>subject是繼承Observable，同時擁有Observable以及Observer兩個特性，並且記錄了狀態，不再每次從頭收到，而是從subscribe之後的值</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=subject.js"></script><p>有時候會需要subscribe時就拿到值，這時候可以用BehaviorSubject</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=behaviorSubject.js"></script><p>或者是需要拿到最後幾次的輸出，可以使用ReplaySubject</p><script src="//gist.github.com/08101b5d8f3f35c562c2d7df774835c4.js?file=replaySubject.js"></script><h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>Rx是透過Observable實作的一套Library，但他有兩個我認為很重要的特點</p><ol><li>沒有subscribe就沒有執行(沒有買賣就沒有傷害…XDD)<br>其他很多程式都是一開始就先執行，如果後面有callback就做，沒有就結束</li><li>透過functional programming把每個動作獨立，讓程式閱讀性變高</li></ol><p>Operator可以寫的很漂亮也可以寫的很可怕，只能透過練習拆解去學習，才會知道要怎麼用才是適合的</p><p>當然還有其他更強大的應用，但我目前都沒有用到，所以只能感受到這樣<br>歡迎大家一起來討論!</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://reactivex.io/">官網</a><br><a href="http://ithelp.ithome.com.tw/users/20103367/ironman/1199">Jerry-30 天精通 RxJS</a><br><a href="http://rxmarbles.com/">RxMarbles</a><br><a href="http://reactivex.io/rxjs/">RxJS API Document</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> RxJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] Win Form的DataGridView的button事件</title>
      <link href="/2017/06/01/csharp-datagridview-buttonevent/"/>
      <url>/2017/06/01/csharp-datagridview-buttonevent/</url>
      
        <content type="html"><![CDATA[<h2 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h2><p>新公司剛好需要先寫一個winform只好先硬幹了<br>習慣了web form的很多東西，其實win form並沒有像web那樣的方便，或者說他其實更加的彈性<br>很多行為模式都不一樣因此要熟悉一下</p><span id="more"></span><p>其中有個行為其實我們很常用到，那就是在Grid中放了一些元件，然後要觸發事件，像是button的click<br>在DataGridView中，其實沒有那些事件可以直接使用，因此我們要繞點路<br>使用CellContentClick這個事件</p><p>來看看<a href="https://msdn.microsoft.com/zh-tw/library/system.windows.forms.datagridview.cellcontentclick(v=vs.110).aspx">MSDN</a>的說明吧</p><blockquote><p>按一下儲存格內的內容時發生。</p></blockquote><p>非常簡短，也非常好懂，就是當儲存格被按到時會觸發<br>也許你會問到，這樣不是目標被按到的時候不就也會進去事件？<br>是的，這也很無奈╮(－_－)╭</p><h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>讓我們來看一下範例吧</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DataGridView1_CellContentClick</span>(<span class="params"><span class="built_in">object</span> sender, DataGridViewCellEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> colname = DataGridViewLicenseList.Columns[e.ColumnIndex].<span class="function">Name</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">colname.ToLower(</span>)</span> == <span class="string">&quot;edit&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="相似文章"><a href="#相似文章" class="headerlink" title="相似文章"></a>相似文章</h2><p>關於DataGridView的其他操作，之前也有寫過其他篇</p><a href="/2012/05/17/csharp-datagridview-datarowbound/" title="[C#] WinForm的DataGridView類似Web的GridView_DataRowBound事件">WinForm的DataGridView類似Web的GridView_DataRowBound事件</a>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] i18n由淺入深</title>
      <link href="/2017/04/24/angular-i18n/"/>
      <url>/2017/04/24/angular-i18n/</url>
      
        <content type="html"><![CDATA[<h2 id="大綱"><a href="#大綱" class="headerlink" title="大綱"></a>大綱</h2><p>一個要提供給國際使用的網站，一定會遇到多國語系的問題，Angular已經幫我們想好解決方案，i18n，一起進入這個世界探索吧!</p><span id="more"></span><h2 id="入門"><a href="#入門" class="headerlink" title="入門"></a>入門</h2><p>多國語系是網頁必定會遇到的問題，在開始之前，我們先來看一下預期的目標<br><img src="/2017/04/24/angular-i18n/translate.gif" alt="translate"></p><p>我們希望畫面上的字能根據語系來做相對應的呈現<br><a href="https://angular.io/docs/ts/latest/cookbook/i18n.html">i18n</a>!!!粉墨登場</p><p>首先要在component中加上<code>i18n</code>這個directive</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">i18n</span>&gt;</span>Hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接著我們要取得檔案，來維護內容，執行這段指令，將檔案放到src底下的locale這個目錄中</p><blockquote><p>ng xi18n –output-path src&#x2F;locale</p></blockquote><p>messages.xlf</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xliff</span> <span class="attr">version</span>=<span class="string">&quot;1.2&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:oasis:names:tc:xliff:document:1.2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">file</span> <span class="attr">source-language</span>=<span class="string">&quot;en&quot;</span> <span class="attr">datatype</span>=<span class="string">&quot;plaintext&quot;</span> <span class="attr">original</span>=<span class="string">&quot;ng2.template&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">trans-unit</span> <span class="attr">id</span>=<span class="string">&quot;5816217f424111ae4c91dd72ee1db0ae252763b5&quot;</span> <span class="attr">datatype</span>=<span class="string">&quot;html&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>世界你好!<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">trans-unit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xliff</span>&gt;</span></span><br></pre></td></tr></table></figure><p>得到產生的檔案後，就可以來實驗看看囉，執行下面的指令</p><blockquote><p>ng serve –aot –i18n-file&#x3D;src&#x2F;locale&#x2F;messages.xlf –locale&#x3D;en –i18n-format&#x3D;xlf</p></blockquote><p>就可以發現到剛剛的<code>Hello World!</code>被替換成<code>世界你好!</code></p><blockquote><p>試著用建立另一個語言檔看看</p></blockquote><h2 id="進階"><a href="#進階" class="headerlink" title="進階"></a>進階</h2><p>讓我們換個指令，來輸出成檔案看看他的運作模式</p><blockquote><p>ng build –prod –i18n-file&#x3D;src&#x2F;locale&#x2F;messages.zh-TW.xlf –locale&#x3D;zh-TW –i18n-format&#x3D;xlf</p></blockquote><p><img src="/2017/04/24/angular-i18n/build.png" alt="build"></p><p>可以發現到，其實他是直接把html的內容給替換掉了！<br>那這樣是不是說，要產生不同語系，就必須重新編譯一次…!?</p><p><del>這樣的作法不可能應用到網站中，因此我們需要改變一下</del><br>如果只要架一個網站，就要想辦法將檔案動態載入</p><p>首先使用system.import的方式載入檔案，並且載入要在bootstrap之前<br>所以我們可以來看看下面這段，先用固定的語系</p><script src="//gist.github.com/c11fc84c03471a68d2025c2e06c9447e.js?file=i18n-provider_v1.ts"></script><p>接著要在<code>main.ts</code>中載入進來，可以看到的是先把由上面先把檔案載入後，再來bootstrap</p><script src="//gist.github.com/c11fc84c03471a68d2025c2e06c9447e.js?file=main.ts"></script><p>但上面我們是用固定的語系，接著我們要做的事情就是動態的語系<br>這邊使用的方法是在網址列加上語系<br>切換下拉選單時，就讓網頁整個重新載入</p><p>app.component.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> (<span class="attr">ngModelChange</span>)=<span class="string">&quot;changeLocale($event)&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;locale&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;en&quot;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;zh-tw&quot;</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>app.component.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeLocale</span>(<span class="params">event: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">`/<span class="subst">$&#123;event&#125;</span>/`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那我們就可以在getTranslationProviders這個裡面，去解析網址，來取得目前的語系</p><script src="//gist.github.com/c11fc84c03471a68d2025c2e06c9447e.js?file=i18n-provider_v2.ts"></script><p>這時候我們就可以下拉選單來切換語系了!<br><a href="https://github.com/jiaming0708/i18nDemo">i18n demo</a></p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><p><a href="https://angular.io/docs/ts/latest/cookbook/i18n.html">Angular i18n introduction</a><br><a href="https://medium.com/@feloy/deploying-an-i18n-angular-app-with-angular-cli-fc788f17e358">Deploying an i18n Angular app with angular-cli</a><br><a href="http://blog.danieleghidoli.it/2017/01/15/i18n-angular-cli-aot/">Angular 2 internationalization explained: i18n + Angular CLI + AOT</a><br><a href="https://youtu.be/dihyu1a2bPc">Lost in Translation - Oliver Combe @ ng-confg 2017</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReactNative初體驗</title>
      <link href="/2017/03/30/react-native-note/"/>
      <url>/2017/03/30/react-native-note/</url>
      
        <content type="html"><![CDATA[<p>最近要和朋友一起寫個app，他們提出了要用react native<br>但完全沒有經驗，只好邊寫邊摸囉<br>分享一下下自己的一點點經驗囉</p><span id="more"></span><h2 id="element"><a href="#element" class="headerlink" title="element"></a>element</h2><p>在native中，不能使用html中的element<br>而是要改使用Text、View、Image這些…</p><ul><li>Text其實就是span或是label</li><li>View就是div</li><li>Image就img</li><li>TextInput也就是input囉</li></ul><h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><p>native中我們一樣是使用css來作為樣式的設定<br>但寫法有點不一樣，是採用駝峰式的命名，數字以外的都要用單引號包起來<br>而且有的是有限制的，不是每個都能像是css那樣給值喔<br>還是要查一下官方文件，才能確定怎麼使用</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">backgroundColor: <span class="string">&#x27;rgba(0, 0, 0, 0.6)&#x27;</span></span><br><span class="line">margin: <span class="number">2</span> <span class="comment">/*number only*/</span></span><br></pre></td></tr></table></figure><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>在react中，要動態決定哪些內容要不要呈現<br>可以用if去判斷來撰寫，但在native中，這個語法會報錯?<br>因此可以用三元運算子(?:)來實作囉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">this.props.data.publice_date ? (</span><br><span class="line">    &lt;View style=&#123;styles.dateBlock&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.articleDate&#125;&gt;&#123;this.props.data.publice_date + &#x27; by &#x27; + this.props.data.author&#125;&lt;/Text&gt;</span><br><span class="line">    &lt;/View&gt;</span><br><span class="line">) : (</span><br><span class="line">        &lt;View style=&#123;styles.dateBlock&#125;&gt;</span><br><span class="line">            &lt;Text style=&#123;styles.eventDurtion&#125;&gt; &#123;&#x27;日期:&#x27; + this.props.data.s_date + &#x27;~&#x27;this.props.data.e_date&#125;&lt;/Text&gt;</span><br><span class="line">        &lt;/View&gt;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>或是可以用更簡單的方法&amp;&amp;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this.props.data.category &amp;&amp; (</span><br><span class="line">    &lt;View style=&#123;styles.categoryBlock&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.category&#125;&gt;&#123;this.props.data.town&#125;&lt;/Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.category&#125;&gt;&#123;this.props.data.category&#125;&lt;/Text&gt;</span><br><span class="line">    &lt;/View&gt;)</span><br></pre></td></tr></table></figure><p>不管哪種方法，記得都要用()包起來，然後只能有一個root節點<br>也就是說不能像下面這樣</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.props.data.category &amp;&amp; (</span><br><span class="line">        &lt;Text style=&#123;styles.category&#125;&gt;&#123;this.props.data.town&#125;&lt;/Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.category&#125;&gt;&#123;this.props.data.category&#125;&lt;/Text&gt;)</span><br></pre></td></tr></table></figure><h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><p>那如果說要用迴圈去把資料呈現出來，有兩個方法<br>react native有提供ListView，但這個只能row的方式呈現<br>如果需要往橫向發展的，千萬不能用</p><p>那我們要怎麼用勒，可以使用陣列自有的map這個operator<br>裡面有個key的屬性，記得要加，不然執行測試時也會看到他的提示<br>不過還不是很清楚這個功能的作用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.props.data.tagList.map((tag, key) =&gt; &#123;</span><br><span class="line">    return &lt;Text style=&#123;styles.tag&#125; key=&#123;key&#125;&gt;&#123;tag&#125;&lt;/Text&gt;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="排版"><a href="#排版" class="headerlink" title="排版"></a>排版</h2><p>在這邊你能夠盡情的使用flex來協助你排版<br>完全不用考慮到瀏覽器的問題v(￣︶￣)y</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex</span>:<span class="number">1</span>,</span><br><span class="line">flexDirection: <span class="string">&#x27;row&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> ReactNative </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] HostBinding&amp;HostListener</title>
      <link href="/2017/03/27/angular-hostbinding-listener/"/>
      <url>/2017/03/27/angular-hostbinding-listener/</url>
      
        <content type="html"><![CDATA[<h2 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h2><p>今天要來講講HostBinding和HostListener，原本官網還能找到文章，但最近才發現他已經被殺了…<br>但還是要來說一下，誰叫我自己挖洞給自己跳了o(〒﹏〒)o</p><span id="more"></span><h2 id="目標"><a href="#目標" class="headerlink" title="目標"></a>目標</h2><p>來做一個highlight的功能，顏色可以自定，當游標進入時變色，離開則回復<br>如果是寫jquery，你會怎麼做?  使用on監聽事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> color = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="string">&#x27;.class&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="variable language_">this</span>).<span class="title function_">style</span>(<span class="string">&#x27;background-color&#x27;</span>, color);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="string">&#x27;.class&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="variable language_">this</span>).<span class="title function_">style</span>(<span class="string">&#x27;background-color&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>但我們現在是寫angular，當然要想辦法變成directive<br>並且能做到像jquery的事情一樣</p><h2 id="建立directive"><a href="#建立directive" class="headerlink" title="建立directive"></a>建立directive</h2><p>首先，先建立一個directive，並且傳入顏色</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>, <span class="title class_">ElementRef</span>, <span class="title class_">Input</span>, <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;[highlight]&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_defaultColor</span>: <span class="built_in">string</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> el:ElementRef</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Input</span>(<span class="string">&#x27;color&#x27;</span>) <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;highlight&quot;&gt;</span></span><br><span class="line"><span class="string">        Highlight Me!!</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HostListener"><a href="#HostListener" class="headerlink" title="HostListener"></a>HostListener</h2><p>接著開始監聽事件，但是要怎麼做到，從一個element的屬性去監聽他的行為<br>這時候我們需要用到HostListener，從字面其實可以猜的出來，他就是用來監聽來自element(host)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>, <span class="title class_">ElementRef</span>, <span class="title class_">Input</span>, <span class="title class_">HostListener</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;.highlight&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_defaultColor</span>: <span class="built_in">string</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> el:ElementRef</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Input</span>(<span class="string">&#x27;color&#x27;</span>) <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>) <span class="title function_">onEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span>.<span class="property">nativeElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="variable language_">this</span>.<span class="property">color</span> || <span class="variable language_">this</span>.<span class="property">_defaultColor</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>) <span class="title function_">onLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span>.<span class="property">nativeElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>補充說明:<br>beta版本時(遙遠的古代…)，是在directive那邊的描述中加上一個host的來使用</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line"> <span class="attr">selector</span>: <span class="string">&#x27;[highlight]&#x27;</span>,</span><br><span class="line"> <span class="attr">host</span>: &#123;</span><br><span class="line">   <span class="string">&#x27;(mouseenter)&#x27;</span>: <span class="string">&#x27;onMouseEnter()&#x27;</span>,</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="HostBinding"><a href="#HostBinding" class="headerlink" title="HostBinding"></a>HostBinding</h2><p>可是上面那樣寫還是不夠漂亮，還要在事件內去控制，為什麼不能用model去控制呢<br>因此angular有提供HostBinding的功能，讓你可以直接用model來影響element屬性</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>, <span class="title class_">ElementRef</span>, <span class="title class_">Input</span>, <span class="title class_">HostListener</span>, <span class="title class_">HostBinding</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;.highlight&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_defaultColor</span>: <span class="built_in">string</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> el:ElementRef</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Input</span>(<span class="string">&#x27;color&#x27;</span>) <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@HostBinding</span>(<span class="string">&#x27;style.backgroundColor&#x27;</span>) <span class="attr">bgColor</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>) <span class="title function_">onEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bgColor</span> = <span class="variable language_">this</span>.<span class="property">color</span> || <span class="variable language_">this</span>.<span class="property">_defaultColor</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>) <span class="title function_">onLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bgColor</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>哇屋～這樣的code看起來是不是更為清楚，而且好操作</p><p>這個範例是變更style的屬性，那如果要變更class的話，可以用下面的方法<br>使用boolean來控制class是否被引用</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HostBinding</span>(<span class="string">&#x27;class.draging&#x27;</span>) <span class="attr">isDraging</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>來點進階的內容，input和hostBinding合在一起有沒有搞頭<br>答案是，絕對有搞頭</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Input</span>(<span class="string">&#x27;color&#x27;</span>)</span><br><span class="line"><span class="meta">@HostBinding</span>(<span class="string">&#x27;style.backgroundColor&#x27;</span>)</span><br><span class="line"><span class="attr">bgColor</span>: <span class="built_in">string</span>;</span><br></pre></td></tr></table></figure><p>外面的element用color這個屬性來傳入顏色，放入到bgColor這個變數，然後來影響backgroundColor<br>這樣可以讓變數減少，並且整合在一起，閱讀起來也很清楚</p><h2 id="加上Output"><a href="#加上Output" class="headerlink" title="加上Output"></a>加上Output</h2><p>上面的應用其實非常的簡單，但通常不會有這麼簡單的應用，那接著我們來加點料吧<br>在進入時，我們需要拋出event，讓component呈現計數滑動次數吧！</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>, <span class="title class_">ElementRef</span>, <span class="title class_">Input</span>, <span class="title class_">HostListener</span>, <span class="title class_">HostBinding</span>, <span class="title class_">Output</span>, <span class="title class_">EventEmitter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Directive</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;.highlight&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_defaultColor</span>: <span class="built_in">string</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> el:ElementRef</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Input</span>(<span class="string">&#x27;color&#x27;</span>) <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="meta">@Output</span>() onColorChange = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@HostBinding</span>(<span class="string">&#x27;style.backgroundColor&#x27;</span>) <span class="attr">bgColor</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>) <span class="title function_">onEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bgColor</span> = <span class="variable language_">this</span>.<span class="property">color</span> || <span class="variable language_">this</span>.<span class="property">_defaultColor</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onColorChange</span>.<span class="title function_">emit</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>) <span class="title function_">onLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bgColor</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;highlight&quot; (onColorChange)=&quot;onColorChange()&quot;&gt;</span></span><br><span class="line"><span class="string">        Highlight Me!!</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &#123;&#123;enteryCount&#125;&#125;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">    enteryCount = <span class="number">0</span>;</span><br><span class="line">    <span class="title function_">onColorChange</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">enteryCount</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://ng2.codecraft.tv/custom-directives/hostlistener-and-hostbinding/">https://ng2.codecraft.tv/custom-directives/hostlistener-and-hostbinding/</a><br><a href="https://angular.io/docs/ts/latest/guide/cheatsheet.html">https://angular.io/docs/ts/latest/guide/cheatsheet.html</a><br><a href="https://angular.io/docs/ts/latest/guide/attribute-directives.html">https://angular.io/docs/ts/latest/guide/attribute-directives.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RX初體驗(?)</title>
      <link href="/2017/03/16/rxjs-firsttime/"/>
      <url>/2017/03/16/rxjs-firsttime/</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>其實也不算是初體驗啦<br>因為之前就有把promise的程式改成用rx，但那時候還是非常不了解</p><span id="more"></span><p>最近在跟人一起寫angular的workshop，飲料維護及訂購的功能<br>就開始用一些之前沒用到的功能rx、form control等…</p><p>嗯～還是不要太多廢話XD</p><h2 id="從promise改成rx"><a href="#從promise改成rx" class="headerlink" title="從promise改成rx"></a>從promise改成rx</h2><p>從ng1的時候，就都是寫promise，所以剛轉到二的時候，看到官網寫rx，就沒有想要去寫他o.0（年少不懂事…<br>一開始的promise</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getStepListByProjectId</span>(<span class="params">id: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">url</span> + <span class="string">&quot;GetStepListByProjectId&quot;</span>, &#123; <span class="attr">projectId</span>: id &#125;)</span><br><span class="line">       .<span class="title function_">toPromise</span>()</span><br><span class="line">       .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">           <span class="keyword">var</span> data = res.<span class="title function_">json</span>();</span><br><span class="line">           <span class="keyword">if</span> (data.<span class="property">Result</span>) &#123;</span><br><span class="line">               <span class="comment">//轉換為前端使用物件</span></span><br><span class="line">               data.<span class="property">StepList</span> = <span class="variable language_">this</span>.<span class="title function_">parseStepDataList</span>(data.<span class="property">StepList</span>);</span><br><span class="line">               <span class="comment">//預設值第一個選取</span></span><br><span class="line">               <span class="keyword">if</span> (data.<span class="property">StepList</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                   data.<span class="property">StepList</span>[<span class="number">0</span>].<span class="property">SelectedFlag</span> = <span class="literal">true</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           </span><br><span class="line">           <span class="keyword">return</span> data;</span><br><span class="line">       &#125;)</span><br><span class="line">       .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改寫成rx後，在重新整理過，是不是感覺更精簡了<br>但這時候其實還沒什麼感覺，因為比較算是轉換而已，對於rx還是很不熟…</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getStepListByProjectId</span>(<span class="params">id: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">url</span> + <span class="string">&quot;GetStepListByProjectId&quot;</span>, &#123; <span class="attr">projectId</span>: id &#125;)</span><br><span class="line">        .<span class="title function_">switchMap</span>(<span class="variable language_">this</span>.<span class="property">checkResult</span>)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="property">parseStepDataList</span>)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">checkResult</span>(<span class="attr">res</span>: <span class="built_in">any</span>): <span class="title class_">Observable</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> data = res.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">if</span> (!data.<span class="property">Result</span>) &#123;</span><br><span class="line">        <span class="title class_">Observable</span>.<span class="keyword">throw</span>(data.<span class="property">ErrorMessage</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Observable</span>.<span class="title function_">of</span>(data.<span class="property">StepList</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="rx進一步的應用"><a href="#rx進一步的應用" class="headerlink" title="rx進一步的應用"></a>rx進一步的應用</h2><h3 id="concatMap、toArray"><a href="#concatMap、toArray" class="headerlink" title="concatMap、toArray"></a>concatMap、toArray</h3><p>這次的需求是這樣的，從api取得的資料中，沒有其中一個物件中的欄位state<br>所以我要把取得的資料重新assign欄位值</p><p>這樣的寫法其實已經可以達到我的需求，但總覺得不是很好看<br>這是第一版</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getBeverageList</span>(): <span class="title class_">Observable</span>&lt;<span class="title class_">BeverageData</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">beverageAPI</span>, <span class="variable language_">this</span>.<span class="property">options</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>() <span class="keyword">as</span> <span class="title class_">BeverageData</span>[])</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">      p.<span class="property">state</span> = <span class="title class_">StateType</span>.<span class="property">None</span>;</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>剛好kevin介紹了一個工具<a href="https://quokkajs.com/docs/">Quokka.js</a>，可以不用console.log就可以把結果呈現在旁邊<br>於是就開始實驗怎麼寫，可以讓這段更好看<br>先把陣列拆開，做完以後再組合起來，這樣的寫法看起來是不是更清楚一點<br>這是第二版</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getBeverageList</span>(): <span class="title class_">Observable</span>&lt;<span class="title class_">BeverageData</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">beverageAPI</span>, <span class="variable language_">this</span>.<span class="property">options</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>() <span class="keyword">as</span> <span class="title class_">BeverageData</span>[])</span><br><span class="line">    .<span class="title function_">concatMap</span>(<span class="function"><span class="params">p</span> =&gt;</span> p)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">      p.<span class="property">state</span> = <span class="title class_">StateType</span>.<span class="property">None</span>;</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">toArray</span>()</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mergeMap"><a href="#mergeMap" class="headerlink" title="mergeMap"></a>mergeMap</h3><p>post資料回server端後，想要重新取得全部的資料，這時候又不希望由前面再次呼叫<br>這時候可以直接在service層一次做完</p><p>那因為是呼叫另一個已經寫好的service，所以必須要把自己的observable和另一個接起來<br>這時候我們要使用到mergeMap</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">postBeverage</span>(<span class="attr">index</span>:<span class="built_in">number</span>,  <span class="attr">beverage</span>: <span class="title class_">BeverageData</span>):<span class="title class_">Observable</span>&lt;<span class="title class_">BeverageData</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">beverageAPI</span> + <span class="string">&quot;/&quot;</span> + index, beverage, <span class="variable language_">this</span>.<span class="property">options</span>)</span><br><span class="line">    .<span class="title function_">mergeMap</span>(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">getBeverageList</span>())</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="後續"><a href="#後續" class="headerlink" title="後續"></a>後續</h2><p>rx這東西真的要有案例來學，才有辦法體會他的奧妙，不然看文件看多了還是不太清楚如何搭配使用</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> RxJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] DI注入環境變數</title>
      <link href="/2017/03/11/angular-di-provide/"/>
      <url>/2017/03/11/angular-di-provide/</url>
      
        <content type="html"><![CDATA[<p>話說最近弄了一個題目練習Angular，搭配cli使用(只有方便而已啦!!我以前是在白痴什麼orz…)<br>自己想了一個需求，就是我的API Server有分prodction和development</p><span id="more"></span><h2 id="基礎應用"><a href="#基礎應用" class="headerlink" title="基礎應用"></a>基礎應用</h2><p>首先衍生出來的就是要設定在哪，然後怎麼用<br>cli中有一個environment的資料夾，底下兩個檔案，<code>environment.ts、environment.prod.ts</code><br>很簡單的就是在裡面增加一個屬性叫做apiServer，並且應用到service中</p><p><img src="/2017/03/11/angular-di-provide/filePath.png" alt="file path"></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> environment = &#123;</span><br><span class="line">  <span class="attr">production</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">apiServer</span>: <span class="string">&#x27;https://192.168.100.1&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&quot;../../environments/environment&quot;</span>;</span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BeverageService</span> &#123;</span><br><span class="line">  <span class="title function_">getBeverageList</span>(): <span class="title class_">Observable</span>&lt;<span class="title class_">BeverageData</span>[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_http</span>.<span class="title function_">get</span>(environment.<span class="property">apiServer</span>+ <span class="string">&quot;Beverage&quot;</span>)</span><br><span class="line">      .<span class="title function_">map</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>() <span class="keyword">as</span> <span class="title class_">BeverageData</span>[])</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="variable language_">this</span>.<span class="property">handleError</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="進階應用"><a href="#進階應用" class="headerlink" title="進階應用"></a>進階應用</h2><p>這樣寫其實已經滿足我們需求，但是有點low<br>來設想一個情境，如果之後我們的apiServer名字改掉的話，是不是變成service裡面所有使用到environment.apiServer這個全部要換掉<br>其實angular本身有提供一個東西，叫做<a href="https://angular.io/docs/ts/latest/cookbook/dependency-injection.html#!#usevalue">DI</a><br>那我們可以把他做一個轉換，這樣在使用上，就可以脫離environment的直接影響<br>只要在providers放進去，並且在constructor取得就好</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&quot;../../environments/environment&quot;</span>;</span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    &#123; <span class="attr">provide</span>: <span class="string">&#x27;apiServer&#x27;</span>, <span class="attr">useValue</span>: environment.<span class="property">apiServer</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BeverageService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> _http: Http, <span class="meta">@Inject</span>(<span class="string">&#x27;apiServer&#x27;</span>) <span class="keyword">private</span> apiServer: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onInit</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DI學習參考"><a href="#DI學習參考" class="headerlink" title="DI學習參考"></a>DI學習參考</h2><p><a href="https://old-oomusou.goodjack.tw/angular/di/">oomusou的文章，深入探討 Angular 的 DI 與 Provider</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] 動態載入Component</title>
      <link href="/2017/03/02/angular-dynamic-component/"/>
      <url>/2017/03/02/angular-dynamic-component/</url>
      
        <content type="html"><![CDATA[<p>最近在搞一個功能，目標是可以重新設定route，看到了一個功能<code>resetConfig</code>覺得可以用<br>就開始測試，沒想到一直遇到鬼，就是過不去</p><blockquote><p>No component factory found for CreateComponent. Did you add it to @NgModule.entryComponents?</p></blockquote><span id="more"></span><p>表示系統一直不認識這個component<br>但是看來看去ngModule我都有放進去該component</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">AppRoutingModule</span>,</span><br><span class="line">    <span class="title class_">CoreModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">CreateComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>後來請教了<a href="https://www.facebook.com/CKNotepad/">Kevin Yang</a><br>才發現原來是少放了一個地方<code>entryComponents</code><br>完整的如下</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">AppRoutingModule</span>,</span><br><span class="line">    <span class="title class_">CoreModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">CreateComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>],</span><br><span class="line">  <span class="attr">entryComponents</span>: [<span class="title class_">CreateComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>那entryComponents到底有什麼不一樣，首先來看看<a href="https://angular.io/docs/ts/latest/cookbook/ngmodule-faq.html#!#q-entry-component-defined">官方文件</a></p><hr><h3 id="When-do-I-add-components-to-entryComponents"><a href="#When-do-I-add-components-to-entryComponents" class="headerlink" title="When do I add components to entryComponents?"></a>When do I add components to entryComponents?</h3><p>Most application developers won’t need to add components to the entryComponents.</p><p>Angular adds certain components to entry components automatically. Components listed in @NgModule.bootstrap are added automatically. Components referenced in router configuration are added automatically. These two mechanisms account for almost all entry components.</p><p>If your app happens to bootstrap or dynamically load a component by type in some other manner, you must add it to entryComponents explicitly.</p><p>Although it’s harmless to add components to this list, it’s best to add only the components that are truly entry components. Don’t include components that are referenced in the templates of other components.</p><hr><p>也就是說，想要動態載入一個沒有被用到的Component就必須要放到entryComponents中<br>這樣系統才會認識他，不會當他是壞人( ￣ c￣)y▂ξ</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] ViewChild及ContentChild介紹</title>
      <link href="/2017/02/23/angular-viewchild-contentchild/"/>
      <url>/2017/02/23/angular-viewchild-contentchild/</url>
      
        <content type="html"><![CDATA[<p>昨天參加<a href="https://www.facebook.com/groups/1345890212093830/">線上angular讀書會</a>(打個廣告)，分享的內容是ngContent<br>之前自己在寫的時候，套用bootstrap的功能時就有應用到<br>但那時候一直看不懂是什麼意思，在昨天就整個豁然開朗</p><span id="more"></span><p>那到底什麼是ViewChild、ContentChild，底下來看看範例吧</p><h2 id="ViewChild"><a href="#ViewChild" class="headerlink" title="ViewChild"></a>ViewChild</h2><script src="//gist.github.com/af72b77db5c3c9e4ac66721e8c4ab46b.js?file=app.component.ts"></script><p>app-tab這個element就是ViewChild，也就是子Component的概念<br>這時候就會有人問，這樣做有什麼好處</p><p>可以直接引用子Component所有public事件、屬性<br>也就是說，可以不用辛苦的用Input、Output來進行傳遞(好壞先不討論囉!)</p><h2 id="ngContent"><a href="#ngContent" class="headerlink" title="ngContent"></a>ngContent</h2><script src="//gist.github.com/af72b77db5c3c9e4ac66721e8c4ab46b.js?file=tab.component.ts"></script><p>什麼是ngContent，可以說是叫做範本引入或是內容置換<br>也就是把那個位置的內容變成由外面傳進來，app.component.ts中app-tab的內容就是自定義</p><p>那基本上ng-content就是直接把外面傳的東西換掉放進去<br>進階一點的應用就是有多個ngContent，需要指定每個所放的位置<br>在ng-content中加上select並指定就可以取得父component所傳入的內容<br>這邊有三個類型</p><ul><li>.class</li><li>tagName</li><li>沒有指定</li></ul><h2 id="ContentChild"><a href="#ContentChild" class="headerlink" title="ContentChild"></a>ContentChild</h2><p>ContentChild有兩種取得的方式，在同一個parent中，是不能有重複的#id</p><ul><li>#id</li><li>className</li></ul><p>記得要取得ContentChild必須要在AfterContentInit這個事件之後才能拿到物件<br>你才能夠爽爽的使用，不然會鼠翹翹喔!</p><h2 id="Child-vs-Children"><a href="#Child-vs-Children" class="headerlink" title="Child vs Children"></a>Child vs Children</h2><p>差異非常的小，就是一個單數一個複數，收工@@</p><h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><p><a href="https://youtu.be/TMvOew5h85Q">線上angular讀書會 S01E03</a><br><a href="http://blog.mgechev.com/2016/01/23/angular2-viewchildren-contentchildren-difference-viewproviders/">ViewChildren and ContentChildren in Angular 2</a></p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Angular] 2.0.0RC5升級2.4.0的注意事項</title>
      <link href="/2017/02/19/angular-2-0to2-4-upgrade-note/"/>
      <url>/2017/02/19/angular-2-0to2-4-upgrade-note/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>之前自己玩的一個小專案，是一路從beta開始開發一直到RC5<br>後來就都沒有變，一直到把功能開發完上線</p><span id="more"></span><p>最近參加線上讀書會，討論到一個算是bug的功能，kevin就說趕快更新到最新吧!</p><blockquote><p>*change事件，裡面取得到ngModel的參數值是舊的，導致要傳入$event進去</p></blockquote><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>來聊聊升級的坑吧，原本以為是把package.json改一改就好，現實總是殘酷的!</p><p>1.component中移除pieps、directives兩個屬性，改成在@NgModule中宣告</p><p>2.所有使用到的pipe、directive、component都需先在@NgModule中宣告</p><p>3.route寫法改變，一律採用class方式宣告，分檔時先使用NgModule載入</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//舊的寫法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routing = <span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(appRoutes, &#123; <span class="attr">useHash</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appRoutingProviders</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">providers</span>: [appRoutingProviders],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//新的寫法</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(appRoutes, &#123; <span class="attr">useHash</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">exports</span>: [</span><br><span class="line">    <span class="title class_">RouterModule</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppRoutingModule</span> &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Cordova] hooks功能-檢查、壓縮、合併</title>
      <link href="/2016/12/23/cordova-hooks/"/>
      <url>/2016/12/23/cordova-hooks/</url>
      
        <content type="html"><![CDATA[<p>最近才得知cordova可以在編譯輸出前做一些事情<br>這個地方叫做hooks，可以到<a href="https://cordova.apache.org/docs/en/latest/guide/appdev/hooks/">官網</a>查詢</p><span id="more"></span><p>預計要來做幾件事情<br>1.JSHint<br>2.Concat files<br>3.Uglify</p><h2 id="JSHint"><a href="#JSHint" class="headerlink" title="JSHint"></a>JSHint</h2><p>檢查JS語法，這個會放在before_prepare，要讓錯誤扼殺在成長之前XD<br>所以我們要建立一個檔案，<code>010_jshint.js</code></p><p>hooks的運作機制，會根據js前面的號碼作為排序，來依序執行檔案<br>有多個動作時，記得要確認一下要執行的順序為何</p><script src="//gist.github.com/ad926b08234864967c36a72950eb86d1.js?file=010_jshint.js"></script><h2 id="Concat-files"><a href="#Concat-files" class="headerlink" title="Concat files"></a>Concat files</h2><p>撰寫時，我們會將js、css根據模組或功能等需求而分開來<br>等到我們要執行時，為了效能的優化，就會將檔案進行合併</p><p>這個動作會放在after_prepare下，這邊也要建立一個檔案<code>012_concat_files_by_index.js</code><br>這功能主要是將index.html中所宣告引用的js、css進行合併，所以index.html還是要記得先加上</p><script src="//gist.github.com/ad926b08234864967c36a72950eb86d1.js?file=012_concat_files_by_index.js"></script><p>做完這段以後可以發現到，index.html中已經被合併的檔案tag還是存在，那接著我們就要對於這些被合併的tag換成最後輸出的檔案<br>那這邊需要先對index.html中加上一些東西，才能讓接下來的功能順利進行，可以參考<a href="https://github.com/digisfera/useref">node-useref</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- build:css css/app.min.css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/ionic.app.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/style.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- build:js js/app.min.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br></pre></td></tr></table></figure><p>一樣在after_prepare中，加上<code>015_prepare_index.js</code></p><script src="//gist.github.com/ad926b08234864967c36a72950eb86d1.js?file=015_prepare_index.js"></script><h2 id="Uglify"><a href="#Uglify" class="headerlink" title="Uglify"></a>Uglify</h2><p>這是裡面最簡單的好做到的功能XD，只要下個指令就可以<br>會自動在after_prepare下增加一個<code>uglify.js</code>檔案，因為前面沒有順序，所以會是最後執行<br>詳細內容一樣可以到<a href="https://github.com/rossmartin/cordova-uglify">官網</a>中查詢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cordova-uglify --save</span><br></pre></td></tr></table></figure><p>做完以上的動作，我們就可以下個指令確認一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova prepare [platform] --release</span><br></pre></td></tr></table></figure><p>沒有看到任何錯誤就是成功啦<br>可以打完收工囉</p><p>ㄟㄟㄟ～等等！<br>mac用戶明明會遇到另一個錯誤</p><p>好吧～我只好再回來繼續<br>因為mac用戶會有權限的問題，會只看到一個鬼一般的訊息</p><blockquote><p>Error: EACCES</p></blockquote><p>那這個問題不大，只要下個指令給個權限就好，針對我們在after_prepare所新增的兩個檔案012、015</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x hooks/after_prepare/[filename]</span><br></pre></td></tr></table></figure><p>好啦，這次真的要打完收工了</p>]]></content>
      
      
      <categories>
          
          <category> APP </category>
          
          <category> Cordova </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cordova </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Cordova] camera照片大小設定</title>
      <link href="/2016/11/29/cordova-camera-size/"/>
      <url>/2016/11/29/cordova-camera-size/</url>
      
        <content type="html"><![CDATA[<p>最近在用ionic1.x版的開發APP，其中需要一個拍照的功能，使用套件<a href="https://github.com/apache/cordova-plugin-camera"><code>cordova-plugin-camera</code></a><br>那照片會在最後一起上傳到server，但是現在的手機像素其實很高<br>導致一兩張照片而已就已經爆掉無法傳送（當然也可能是我不懂得怎麼寫上傳照片啦，我是轉成base64後上傳）</p><span id="more"></span><p>一開始沒仔細看官方文件（這很重要記得要好好看）<br>就去搜尋了image resize的作法，得到使用canvas轉換，這個作法另外開一篇寫好了<br>這個作法很可怕，圖片縮小後光線強的地方直線都變成鋸齒狀</p><p>就回套件看看有沒有什麼作法</p><table><thead><tr><th align="left">column</th><th align="center">type</th><th align="left">description</th></tr></thead><tbody><tr><td align="left">targetWidth</td><td align="center">number</td><td align="left">Width in pixels to scale image. Must be used with targetHeight. Aspect ratio remains constant.</td></tr><tr><td align="left">targetHeight</td><td align="center">number</td><td align="left">Height in pixels to scale image. Must be used with targetWidth. Aspect ratio remains constant.</td></tr></tbody></table><p>這邊有說到可以等比例，好像是我要的，但是怎麼設定才會等比例阿…<br>看不到太懂說明，只好打開java檔來看看</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (targetHeight &gt; <span class="number">0</span> &amp;&amp; targetWidth &gt; <span class="number">0</span> &amp;&amp; targetWidth == targetHeight) &#123;</span><br><span class="line">    intent.putExtra(<span class="string">&quot;aspectX&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    intent.putExtra(<span class="string">&quot;aspectY&quot;</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原來只要給一樣的值，就會等比例的縮放，下面就是我的範例啦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">camera</span>.<span class="title function_">getPicture</span>(onSuccess, onFail, &#123;</span><br><span class="line">  <span class="attr">quality</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">destinationType</span>: <span class="title class_">Camera</span>.<span class="property">DestinationType</span>.<span class="property">DATA_URL</span>, <span class="comment">//FILE_URI、DATA_URL</span></span><br><span class="line">  <span class="attr">targetWidth</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">targetHeight</span>: <span class="number">500</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> APP </category>
          
          <category> Cordova </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cordova </tag>
            
            <tag> ionic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[Oracle] 記憶體控制sga</title>
      <link href="/2016/05/30/oracle-sga/"/>
      <url>/2016/05/30/oracle-sga/</url>
      
        <content type="html"><![CDATA[<p>最近在玩系統負載測試，PM說用到最新的那台server上跑看看，於是就把系統丟上去開始測試<br>沒跑不知道，測試下去才發現，怎麼記憶體吃了96%<br>很怕是自己的系統導致，所以趕快的確認一下是誰吃了那麼多</p><span id="more"></span><p>還好兇手不是我(乎)，是三個DB，兩個oracle各吃15G，一個MS SQL吃13G（server共47G）<br>問了一下高手看看這種是什麼情況，原來是sga在搞鬼</p><p>先下個指令確認一下，確認現在設定多少</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> sga;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> sga_target</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> sga_max_size;</span><br></pre></td></tr></table></figure><p>果然是target和max_size設定一樣導致，於是將sga_target先調小，sga_max_size不變避免未來需要吃太多</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> sga_target<span class="operator">=</span><span class="number">8192</span>M;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] WebAPI使用</title>
      <link href="/2015/01/08/webapi-note/"/>
      <url>/2015/01/08/webapi-note/</url>
      
        <content type="html"><![CDATA[<p>以前在寫API時，都寫在Controller，而不是ApiController<br>這次的專案，總覺得應該要標準化改走ApiController<br>沒想到遇到了不少問題</p><span id="more"></span><p>1.預設的Route下，每個ApiController只允許一個Get&#x2F;Delete&#x2F;Post<br>若要同一個ApiController底下支援多個，可以修改WebApiConfig</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">WebApiConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params">HttpConfiguration config</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Web API 設定和服務</span></span><br><span class="line">        config.EnableCors();</span><br><span class="line">        <span class="comment">// Web API 路由</span></span><br><span class="line">        config.MapHttpAttributeRoutes();</span><br><span class="line"> </span><br><span class="line">        config.Routes.MapHttpRoute(</span><br><span class="line">            name: <span class="string">&quot;DefaultApi&quot;</span>,</span><br><span class="line">            routeTemplate: <span class="string">&quot;api/&#123;controller&#125;/&#123;action&#125;&quot;</span></span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//config.Routes.MapHttpRoute(</span></span><br><span class="line">        <span class="comment">//   name: &quot;DefaultApiWithAction&quot;,</span></span><br><span class="line">        <span class="comment">//   routeTemplate: &quot;api/&#123;controller&#125;/&#123;action&#125;&quot;,</span></span><br><span class="line">        <span class="comment">//   defaults: new &#123; id = RouteParameter.Optional &#125;</span></span><br><span class="line">        <span class="comment">//);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.ApiController的Route會認前面的字樣，呼叫的方法有限制<br>例如，開頭為Get就不支援Get以外的呼叫<br>若開頭都不在標準方法內，則需使用Post</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用Get</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ReturnDataModel <span class="title">GetUserData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用Post</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ReturnDataModel <span class="title">SignIn</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.Post的傳遞參數，若為物件，則只能接受一個物件</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以多個string</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ReturnDataModel <span class="title">SignIn</span>(<span class="params"><span class="built_in">string</span> user, <span class="built_in">string</span> password</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//將user和password組合成一個物件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> UserName&#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Password&#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以一個物件</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ReturnDataModel <span class="title">SignIn</span>(<span class="params">UserData data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//不可以一個物件以上，必須將這兩個參數合成一個物件</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ReturnDataModel <span class="title">SignIn</span>(<span class="params">UserData data, <span class="built_in">string</span> device</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[AngularJS] 第一個directive</title>
      <link href="/2014/11/25/angularjs-directive/"/>
      <url>/2014/11/25/angularjs-directive/</url>
      
        <content type="html"><![CDATA[<p>同事需要一個按下enter轉成tab的功能，這在JS其實蠻好做的<br>但是在angular的$event屬性都是唯獨，導致這個功能沒有辦法直接實作</p><span id="more"></span><p>我改用另一個想法去實作這個功能<br>使用directive套用在element身上，並且找到下一個有宣告的element<br>為了能在enter後去呼叫API，所以再加上call back的功能</p><p>這是第一個實作出來且符合需求的directive &lt;(￣︶￣)&gt; 得意叉腰</p><script src="//gist.github.com/acdc466842b6f7332455848145535b75.js?file=enterToTab.js"></script>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> AngularJS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AngularJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[windows] 真正關閉Windows 8的UAC</title>
      <link href="/2014/09/17/window-close-uac/"/>
      <url>/2014/09/17/window-close-uac/</url>
      
        <content type="html"><![CDATA[<p>UAC這東西從Vista就開始存在了<br>但以前想要把使用者變成真正的Administrator<br>只要到「使用者帳戶」的管理下把「變更使用者帳戶控制設定」調整為最小即可</p><span id="more"></span><p>但是在win 8開始，這個並不是真正的Administrator，還是需要手動使用系統管理員執行的方式才能擁有權限<br>Microsoft希望讓系統的安全性更高，但是這樣對於我來說其實很大的不方便<br>為了讓自己能夠拿真正的權限，就必須要動手做一些的修改</p><blockquote><p>1.開啟regedit<br>2.到「HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System」下找到「Enable LUA」<br>3.將數值修改為0<br>4.歡樂使用最高權限</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 使用Autofac</title>
      <link href="/2014/09/17/mvc-autofac/"/>
      <url>/2014/09/17/mvc-autofac/</url>
      
        <content type="html"><![CDATA[<p>最近接觸MVC…(好像也接觸一兩年了＠＠…<br>所看到的範例程式，都是使用Interface來呼叫method</p><span id="more"></span><p>去了解後才知道這樣做有一個好處<br>以後若要進行客製，可以直接替換成另一個class來寫該method的內容，而不用改寫呼叫該method的程式<br>這個有一個詞叫做DI或是IoC，想要知道這塊的朋友，請搜尋一下囉</p><p>使用此作法，其實有很多的方法可以做到<br>今天要來說的是Autofac，這類的教學其實已經很多了<br>那我今天的重點會是在如何讓Autofac幫我們自動載入Interface到Controller的建構子中</p><p>那我們就先來準備一下Interface及實作的class</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ILotService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">LotData <span class="title">GetLotByLot</span>(<span class="params"><span class="built_in">string</span> lot</span>)</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LotService</span> : <span class="title">ILotService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LotData <span class="title">GetLotByLot</span>(<span class="params"><span class="built_in">string</span> lot</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">          <span class="keyword">var</span> data = <span class="keyword">new</span> LotData();</span><br><span class="line">          <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那接著我們在Controller加上建構子，並用ILotService當做參數</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HomeController</span> : <span class="title">Controller</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HomeController</span>(<span class="params">ILotService lotService</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> View();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上都好了以後，直接去跑的話，系統一定死給你看<br>接下來我們要把Autofac加入，新增一個AutofacConfig的class到App_Start<br>在AutofacConfig裡面加入Bootstrapper的method</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofaceConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Bootstrapper</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//直接將Services專案中的所有Interface加入，可免除後來新增的忘記加入</span></span><br><span class="line">        builder.RegisterAssemblyTypes(<span class="keyword">typeof</span>(ILotService).Assembly).AsImplementedInterfaces();</span><br><span class="line">        <span class="comment">//可直接在Controller的建構子，使用Interface的參數</span></span><br><span class="line">        builder.RegisterControllers(Assembly.GetExecutingAssembly());</span><br><span class="line">        <span class="comment">//交由MVC的Dependency處理</span></span><br><span class="line">        <span class="keyword">var</span> container = builder.Build();</span><br><span class="line">        DependencyResolver.SetResolver(<span class="keyword">new</span> AutofacDependencyResolver(container));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>想要做到Controller的建構子能夠自動載入Interface，重點是在使用builder.RegisterControllers<br>最後再Global的Application_Start裡面加上AutofaceConfig.Bootstrapper();</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Application_Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    AreaRegistration.RegisterAllAreas();</span><br><span class="line">    FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);</span><br><span class="line">    RouteConfig.RegisterRoutes(RouteTable.Routes);</span><br><span class="line">    BundleConfig.RegisterBundles(BundleTable.Bundles);</span><br><span class="line">    <span class="comment">//載入autofac</span></span><br><span class="line">    AutofaceConfig.Bootstrapper();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CSS] 單位em pt px</title>
      <link href="/2014/02/20/css-unit/"/>
      <url>/2014/02/20/css-unit/</url>
      
        <content type="html"><![CDATA[<p>最近在協助同事調整網頁的樣式<br>發現美工提供的字型大小是用em<br>font-size:0.5em;</p><span id="more"></span><p>同事問了一個問題，em是什麼<br>但我只認識px阿～～～～哀號</p><p>趕緊上網查了一下，才知道那些單位的差異</p><p>em:以瀏覽器的字型大小為基礎做百分比的縮放<br>例:瀏覽器設定字型大小為16px，那0.5em就會產生8px的大小</p><p>pt:point印刷字體大小1 pt &#x3D; 1.333px</p><p>px:像素大小</p>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[jQuery] live改用on寫法</title>
      <link href="/2013/11/14/jquery-live/"/>
      <url>/2013/11/14/jquery-live/</url>
      
        <content type="html"><![CDATA[<p>jQuery在1.7版的時候就把live標記為deprecated，而建議改用on</p><span id="more"></span><p>之前使用的時候都沒特別注意到差異<br>但最近使用到了live(這樣算是老人嗎XD)，但為了要跟上潮流<br>改用on，卻發生悲劇了，後來產生的沒有被綁上事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原本寫法</span></span><br><span class="line">$(<span class="string">&#x27;a.open&#x27;</span>).<span class="title function_">live</span>(<span class="string">&#x27;click&#x27;</span>, <span class="title class_">ToggleDetail</span>);</span><br><span class="line"><span class="comment">//改用新寫法</span></span><br><span class="line">$(<span class="string">&#x27;a.open&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="title class_">ToggleDetail</span>);</span><br></pre></td></tr></table></figure><p>仔細查了一下jQuery官網，才發現原來搞錯寫法了on()<br>原來他們覺得原先的寫法，會讓人錯誤的以為事件的綁定方式，所以要正規化（我已經誤入歧途了orz）<br>自動綁定所有符合條件物件的事件，應該是從body或document開始去掃描<br>所以應該是要改成下面的寫法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原本寫法</span></span><br><span class="line">$(<span class="string">&#x27;a.open&#x27;</span>).<span class="title function_">live</span>(<span class="string">&#x27;click&#x27;</span>, <span class="title class_">ToggleDetail</span>);</span><br><span class="line"><span class="comment">//正確寫法</span></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="string">&#x27;a.open&#x27;</span>, <span class="title class_">ToggleDetail</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> jQuery </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[windows] 7/8變更使用者目錄</title>
      <link href="/2013/09/13/window-user-folder/"/>
      <url>/2013/09/13/window-user-folder/</url>
      
        <content type="html"><![CDATA[<p>好久沒有寫點東西，來分享一個實用的東西</p><span id="more"></span><p>win 7&#x2F;8的User資料夾會存放系統中很多暫存的東西<br>當系統越用越久，就會越來越肥</p><p>如果系統槽很不巧的只有給一點點的空間大小<br>那慘了，會看到系統跟你說空間不足<br>最後可能就使用系統都有問題</p><p>接下來告訴大家一個好方法<br>但是 but 旦夕，這招只能用在剛安裝系統時</p><ol><li>在安裝過程中，要求輸入用戶名及密碼時（或是輸入電腦名稱時），先不輸入按「Shift+F10」呼出DOS視窗（注意的是更換的槽必須為NTFS）</li><li>robocopy “C:\Users” “X:\Users” &#x2F;E &#x2F;COPYALL &#x2F;XJ</li><li>rmdir “C:\Users” &#x2F;S &#x2F;Q</li><li>mklink &#x2F;J “C:\Users” “X:\Users”</li><li>關閉DOS窗口，繼續安裝至完成，這樣安裝的系統，所有「User」的內容都將設置在X槽。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 取得時間到毫秒</title>
      <link href="/2013/09/13/oracle-millisecond/"/>
      <url>/2013/09/13/oracle-millisecond/</url>
      
        <content type="html"><![CDATA[<p>記錄時間的時候，通常會用to_char(sysdate, ‘yyyy&#x2F;MM&#x2F;dd HH24:mi:ss’)<br>但這樣只能顯示到秒，無法在顯示到更小的單位</p><span id="more"></span><p>當想要看到毫秒的話，就不能使用sysdate<br>要改用systimestamp，to_char(systimestamp, ‘yyyy&#x2F;MM&#x2F;dd hh24:mi:ssxff’)</p><p>就可以到這樣的資料 2013&#x2F;02&#x2F;23 21:20:32.299000<br>就可以更精準的做想要看的資料了</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 獨立交易，不影響外層的交易行為</title>
      <link href="/2013/02/23/oracle-autonomus-transaction/"/>
      <url>/2013/02/23/oracle-autonomus-transaction/</url>
      
        <content type="html"><![CDATA[<p>當要調教效能時，會採用寫log的方式<br>但是寫log是一定要commit，但commit下去一定會影響到外面在做的事情</p><span id="more"></span><p>這時候怎麼辦呢，還好同事有經驗<br>這種功能在Oracle中，中文叫做自治事務，英文是Autonomous Transactions</p><p>要怎麼應用勒，其實很簡單<br>在要獨立交易的Procedure中多加一行 PRAGMA AUTONOMOUS_TRANSACTION;<br>還是看一下實際範例吧</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROCEDURE</span> WriteLog (text <span class="keyword">IN</span> VARCHAR2)</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line"> </span><br><span class="line">PRAGMA AUTONOMOUS_TRANSACTION;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> LOG <span class="keyword">VALUES</span> (text, SYSDATE);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 查詢正在執行的JOB及砍掉執行中的Session</title>
      <link href="/2013/02/23/oracle-query-delete-session/"/>
      <url>/2013/02/23/oracle-query-delete-session/</url>
      
        <content type="html"><![CDATA[<p>有時候Procedure&#x2F;Package沒寫好時，會跑超級久<br>這時候會開始寫log或其他的動作來看調教效能</p><span id="more"></span><p>我們要先停下JOB才能夠繼續編輯，可以用以下步驟做</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.先確認一下JOB的資訊</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_jobs;</span><br><span class="line"></span><br><span class="line"><span class="comment">--2.確認正在執行的JOB資訊</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_jobs_running;</span><br><span class="line"></span><br><span class="line"><span class="comment">--3.停止JOB</span></span><br><span class="line"><span class="keyword">exec</span> dbms_job.broken(<span class="string">&#x27;&amp;JOB&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--4.當JOB還是繼續跑的時候，刪除還在執行的Session</span></span><br><span class="line"><span class="keyword">select</span> SID,SERIAL# <span class="keyword">from</span> V$Session <span class="keyword">where</span> SID<span class="operator">=</span><span class="string">&#x27;&amp;SID&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> kill session <span class="string">&#x27;&amp;SID, &amp;SERIAL&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--5.刪除JOB（需要sysdba權限）</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dba_jobs <span class="keyword">where</span> JOB<span class="operator">=</span><span class="string">&#x27;&amp;JOB&#x27;</span>;</span><br></pre></td></tr></table></figure><p>PS:&amp;JOB、&amp;SID、&amp;SERIAL，表示select出來的欄位值</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 重開機oracle無法連線的問題ORA-27101</title>
      <link href="/2013/02/20/oracle-27101/"/>
      <url>/2013/02/20/oracle-27101/</url>
      
        <content type="html"><![CDATA[<p>每次重灌電腦後，一開始安裝oracle都可以正常連線<br>但只要重開機，就會連線不進去</p><span id="more"></span><p>oracle會回報ORA-12514的錯誤，可參考文章<a href="/2011/01/31/oracle-12514/" title="[oracle] ORA-12514 TNS 監聽進程不能解析在連接描述符中給出的 SERVICE_NAME">ORA-12514 TNS 監聽進程不能解析在連接描述符中給出的 SERVICE_NAME</a><br>這個問題解了以後，又出現另一個錯誤</p><blockquote><p>ORA-01034: ORACLE not available<br>ORA-27101: shared memory realm does not exist</p></blockquote><p>天啊，這是在打魔王嗎，一關接著一關<br>關關難過關關，還好不是只有我遇到<br>這個問題其實是SGA_SIZE大於Memory_target，只能使用指令的方式進行修復</p><p>根據以下步驟，就可以修正問題囉</p><ol><li>在cmd中下指令，sqlplus &#x2F; as sysdba</li><li>進入到sqlplus中執行指令，create pfile from spfile;</li><li>安裝oracle的目錄下，app[username]\product\ver\dbhome_1\database<br>用記事本開啟INIT[dbname].ORA，找到*.memory_target和*.SGA_MAX_SIZE，將這兩個參數的值改為一樣後儲存</li><li>改完後，在到sqlplus中執行指令，create spfile from pfile;</li><li>到這邊就算是完成了，接著就是重新啟動oracle</li></ol><p>打完收工!!</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[windows] Window 7如何讀取Window NT4.0的分享資料夾</title>
      <link href="/2012/11/13/window-7-access-nt4-folder/"/>
      <url>/2012/11/13/window-7-access-nt4-folder/</url>
      
        <content type="html"><![CDATA[<p>最近正在做一個專案<br>裡面有一部分功能很簡單，就是讀取檔案然後寫入資料庫</p><span id="more"></span><p>但是沒想到遇到了困難點，有一個電腦的環境是NT4.0<br>連到電腦要求登入時，帳號密碼怎樣輸入就是不給進<br>還好我不是第一個遇到這樣的問題(汗</p><ol><li>按下「開始」，在「搜尋程式與檔案」中，輸入 secpol.msc 並按下 Enter 鍵</li><li>依序展開「本機原則」、「安全性選項」</li><li>在右側窗格中的「Microsoft 網路用戶端: 傳送未加密的密碼到其他廠商的 SMB 伺服器」上，連按兩下滑鼠左鍵</li><li>於「本機安全性設定」索引標籤中，按下 啟用(E) 選項鈕</li><li>按下確定</li><li>在同一個安全性選項中「網路安全性：LAN Manager 驗證層級」，設定為「傳送 LM 和 NTLM 回應-如有交涉，使用NTLMv2工作階段安全性」</li><li>確定後即可</li></ol><p>PS:我搜尋到的資料，其實都是說「網路安全性：LAN Manager 驗證層級」，設定為設定為「傳送 LM 和 NTLM 回應」<br>但我實際設定後，發現這樣還是沒有辦法用，要改成上面說的那種才能使用，如果有人知道是為什麼，歡迎跟我分享</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 使用Sandcastle產生文件</title>
      <link href="/2012/10/16/csharp-sandcastle/"/>
      <url>/2012/10/16/csharp-sandcastle/</url>
      
        <content type="html"><![CDATA[<p>很多人都使用過微軟的Help文件<br>這種文件是實體檔案，不用透過網路<br>自己寫的dll產生一個這樣的文件，可以讓其他使用這個dll的人，快速了解如何使用<br>當然前提是dll有產生XML的註解</p><span id="more"></span><p>要產生像這樣的文件，需要先準備一些東西</p><ol><li>Sandcastle</li><li>Sandcastle Help File Builder，這有GUI可以讓我們快速設定並產生</li><li>HTML Help Document，產生.chm(HtmlHelp 1.x)檔必備</li></ol><p>以上的東西都準備好後，開啟Sandcastle Help File Builder GUI<br>產生新專案後，可以看到以下的畫面<br><img src="/2012/10/16/csharp-sandcastle/GUI.jpg" alt="GUI"></p><p>通常會更改下面的幾個部分<br>1.FrameworkVersion:dll使用的版本，預設採用電腦中安裝的最大framework version<br>HelpFileFormat:基本有HtmlHelp1、MSHelp2、MSHelpViewer、Website，這個部分就看需要產生哪種類型的文件囉</p><p>2.Help Title:在文件內最上方的Title<br>HtmlHelpName:文件的名稱</p><p>3.PresentationType:基本有hana、Prototype、vs2005、vs2010(似乎是看Builder版本)，個人比較喜歡Prototype</p><p>4.這其實才是重點的重點！<br>Documentation Sources:要產出文件的dll、xml放在這邊<br>References:產出文件的dll需要的額外參考，就是那種不想產出在文件內，但是沒有又一定會編譯失敗的參考dll</p><blockquote><p>PS:如果編譯出現「HHC6003 : error : The file Itircl.dll has not been registered correctly」的錯誤<br>請去下載itcc.dll，並且註冊至系統中regsvr32 [c:&#x2F;windows&#x2F;system32&#x2F;itcc.dll]，[]中是檔案目錄</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] TCPClient如何判斷已斷線</title>
      <link href="/2012/10/16/csharp-tcpclient/"/>
      <url>/2012/10/16/csharp-tcpclient/</url>
      
        <content type="html"><![CDATA[<p>TCPClient有一個屬性Connected可以用來判斷是否還有連線<br>但是每次斷線後這個屬性還是沒有改變</p><span id="more"></span><p>MSDN中有說明</p><blockquote><p>如果最近一次的作業是將 Client 通訊端連接至遠端資源，則為 true，否則為 false。<br>Connected 屬性會取得上次 I&#x2F;O 作業的 Client 通訊端連接狀態。<br>當它傳回 false 時，即表示 Client 通訊端不是從未連接過，就是不再連接了。<br>因為 Connected 屬性只反映最近一次作業的連接狀態，所以您應嘗試傳送或接收訊息，以判斷目前的狀態。<br>訊息傳送失敗之後，這個屬性就不再傳回 true。請注意，這種行為是設計上的預期行為。<br>您可能無法很穩定地測試連接的狀態，原因是有可能在測試和收發 (訊息) 之間就失去該連接。<br>您的程式碼應假設該通訊端是連接的，然後再小心處理傳輸失敗的情況。</p></blockquote><p>Connected是記憶最後的連線狀態，通常都是上次連線正常，然後就突然死掉<br>這樣是要怎麼玩阿orz</p><p>可以使用socket的peek功能來試讀資料<br>用這樣可以得知連線是否還在</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    client.Client.Poll(<span class="number">0</span>, SelectMode.SelectRead);</span><br><span class="line">    <span class="built_in">byte</span>[] testRecByte = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (client.Connected)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (client.Available == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//使用Peek，測試client是否還有連線</span></span><br><span class="line">            <span class="keyword">if</span> (client.Client.Receive(testRecByte, SocketFlags.Peek) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line">            Thread.Sleep(<span class="number">20</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (SocketException ex)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><p>黑暗執行續 <a href="http://blog.darkthread.net/post-2011-08-11-detected-tcpclient-connection-status.aspx">偵測TcpClient連線狀態</a></p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 在UpdatePanel裡使用FileUpload控制項</title>
      <link href="/2012/09/20/asp-fileupload-updatepanel/"/>
      <url>/2012/09/20/asp-fileupload-updatepanel/</url>
      
        <content type="html"><![CDATA[<p>一般使用FileUpload控制項時，只要PostBack回後台，有上傳的檔案一定取的到<br>但是某天我在外面包了一個UpdatePanel</p><span id="more"></span><p>慘案發生了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">asp:updatepanel</span> <span class="attr">id</span>=<span class="string">&quot;UpdatePanel1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contenttemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">asp:fileupload</span> <span class="attr">id</span>=<span class="string">&quot;FileUpload1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">asp:button</span> <span class="attr">id</span>=<span class="string">&quot;Button1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Button&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:button</span>&gt;</span><span class="tag">&lt;/<span class="name">asp:fileupload</span>&gt;</span><span class="tag">&lt;/<span class="name">contenttemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:updatepanel</span>&gt;</span></span><br></pre></td></tr></table></figure><p>PostBack回到後台接不到上傳的檔案orz<br>還好有同事愈過這樣的情況</p><p>同事說只要加上Trigger就可以了，馬上測試</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">asp:updatepanel</span> <span class="attr">id</span>=<span class="string">&quot;UpdatePanel1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">updatemode</span>=<span class="string">&quot;Conditional&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contenttemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">asp:fileupload</span> <span class="attr">id</span>=<span class="string">&quot;FileUpload1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">asp:button</span> <span class="attr">id</span>=<span class="string">&quot;Button1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">text</span>=<span class="string">&quot;Button&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:button</span>&gt;</span><span class="tag">&lt;/<span class="name">asp:fileupload</span>&gt;</span><span class="tag">&lt;/<span class="name">contenttemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">triggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">asp:postbacktrigger</span> <span class="attr">controlid</span>=<span class="string">&quot;Button1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:postbacktrigger</span>&gt;</span><span class="tag">&lt;/<span class="name">triggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:updatepanel</span>&gt;</span></span><br></pre></td></tr></table></figure><p>捷克～真的可以了<br>原來是FileUpload一定要觸發PostBack，後台才能取得上傳的檔案<br><a href="http://msdn.microsoft.com/zh-tw/library/bb386454.aspx">MSDN中有說到，FileUpload和UpdatePanel不相容</a><br>學藝不精阿～還是要多多看MSDN</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] WinForm的DataGridView類似Web的GridView_DataRowBound事件</title>
      <link href="/2012/05/17/csharp-datagridview-datarowbound/"/>
      <url>/2012/05/17/csharp-datagridview-datarowbound/</url>
      
        <content type="html"><![CDATA[<p>最近在寫自己的小程式<br>不過是使用WinForm開發，跟工作時使用的Web不一樣<br>蠻多事件都不太一樣</p><span id="more"></span><p>其中，在Web上最好用的事件，GridView_DataRowBound<br>在WinForm的DataGridView竟然沒有&gt;&lt;<br>後來東找找西找找，找到了一個類似的<br>這個方法是一個儲存格一個儲存格的處理，但Web是一個Row一起處理，還是Web好用阿~~~~</p><p>讓我們來看看如何使用吧</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dgvData_CellFormatting</span>(<span class="params"><span class="built_in">object</span> sender, DataGridViewCellFormattingEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!dgvData.Columns[e.ColumnIndex].Name.Equals(<span class="string">&quot;Status&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (e.Value == <span class="string">&quot;Y&quot;</span>)</span><br><span class="line">            e.Value = <span class="string">&quot;是&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            e.Value = <span class="string">&quot;否&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteMessage(ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 寫入的簡體資料變成亂碼</title>
      <link href="/2012/02/17/oracle-nls-lang/"/>
      <url>/2012/02/17/oracle-nls-lang/</url>
      
        <content type="html"><![CDATA[<p>最近用自己的DB去測試程式時，發現簡體的資料存進去都變成空白字元<br>在網路上查詢了一下，是因為DB的一個設定導致<br>可使用底下方法修改，資料儲存就正常了</p><span id="more"></span><p>使用Regedit找到</p><blockquote><p><code>HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE\KEY_ORADB11G_HOME1\NLS_LANG</code><br>原始值為TRADITIONAL CHINESE_TAIWAN.ZHT16MSWIN950<br>修改值為AMERICAN_AMERICA.AL32UTF8</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 連結MySql</title>
      <link href="/2012/01/13/csharp-mysql/"/>
      <url>/2012/01/13/csharp-mysql/</url>
      
        <content type="html"><![CDATA[<p>最近case是要和MySql連結，之前都沒有用過，特別記一下</p><span id="more"></span><p>MySql和Oracle類似，都必須先安裝Client才能夠連線<br><a href="http://dev.mysql.com/downloads/">MySql下載</a></p><p>特別要注意一下<br>如果server版本比較舊，請考慮不要抓最新版本</p><p>我遇到的server版本是4.0.18，client裝的版本是5.1，連線後出現下面的錯誤訊息</p><blockquote><p>DBS-00000 : ERROR [08001] [MySQL][ODBC 5.1 Driver]Driver does not support server versions under 4.1.1</p></blockquote><p>後來client直接改裝3.X版本，連線正常</p><p>MySql的連線可採用OleDb的元件，或是採用另一個MySql元件去做連線</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 使用Tab不停留在物件上</title>
      <link href="/2012/01/06/asp-tabindex/"/>
      <url>/2012/01/06/asp-tabindex/</url>
      
        <content type="html"><![CDATA[<p>這個功能很單純，只是希望按Tab鍵的時候<br>能夠跳過某些物件，按照希望的順序來切換</p><span id="more"></span><p>不停留TabIndex &#x3D; -1，其他順序TabIndex&#x3D;1,2…</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Tab停留 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">asp:textbox</span> <span class="attr">id</span>=<span class="string">&quot;ttbUser&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:textbox</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Tab不停留 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">asp:textbox</span> <span class="attr">id</span>=<span class="string">&quot;ttbUserName&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:textbox</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] lambda的foreach如何使用break/continue</title>
      <link href="/2011/11/07/csharp-lambda-foreach/"/>
      <url>/2011/11/07/csharp-lambda-foreach/</url>
      
        <content type="html"><![CDATA[<p>在一般情況下，使用foreach時，遇到特定條件要讓他continue&#x2F;break<br>會這樣去寫</p><span id="more"></span><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="built_in">string</span>&gt; lstSql;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> sql  <span class="keyword">in</span> lstSql)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(sql))</span><br><span class="line">       <span class="keyword">continue</span>;<span class="comment">//break;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是在如果我們使用lambda還這樣寫，就會error</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="built_in">string</span>&gt; lstSql;</span><br><span class="line">lstSql.Foreach(p=&gt; <span class="keyword">if</span>(stirng.IsNullOrEmpty(p)) <span class="keyword">continue</span>;);</span><br></pre></td></tr></table></figure><p>但我們又想要這樣做，該怎麼辦呢<br>必須知道lambda是怎麼處理foreach的</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ForEach</span>&lt;<span class="title">t</span>&gt;(<span class="params"><span class="keyword">this</span> IEnumerable&lt;t&gt; sequence, Action&lt;t&gt; action</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="keyword">var</span> item <span class="keyword">in</span> sequence) action(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由以上可以得知，我們下continue&#x2F;break對function來說是看不懂的<br>我的作法是直接寫return，這樣就等於離開function</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="built_in">string</span>&gt; lstSql;</span><br><span class="line">lstSql.Foreach(p=&gt; <span class="keyword">if</span>(stirng.IsNullOrEmpty(p)) <span class="keyword">return</span>;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 在UpdatePanel裡執行JavaScript II</title>
      <link href="/2011/11/07/asp-javascript-updatepanel-2/"/>
      <url>/2011/11/07/asp-javascript-updatepanel-2/</url>
      
        <content type="html"><![CDATA[<p>上次發表這篇 <a href="/2011/10/05/asp-javascript-updatepanel/" title="[ASP.NET] 在UpdatePanel裡執行JavaScript">在UpdatePanel裡執行JavaScript</a><br>只是提到如何在UpdatePanel裡面，在後台中去執行前台的Script</p><span id="more"></span><p>那如果是要每次PostBack後都需要執行呢<br>那就必須改用這個方式</p><p>這段必須放在Body裡面，這要特別注意</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="language-javascript">&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">alert</span>(<span class="string">&#x27;hello!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Sys.WebForms.PageRequestManager.getInstance().add_endRequest(hello);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] EXP-00000 Message 0 not found; No message file for product=RDBMS, facility=EXP</title>
      <link href="/2011/11/07/oracle-exp00000/"/>
      <url>/2011/11/07/oracle-exp00000/</url>
      
        <content type="html"><![CDATA[<p>在Server上想要進行Export時，出現了錯誤訊息</p><blockquote><p>EXP-00000: Message 0 not found; No message file for product&#x3D;RDBMS, facility&#x3D;EXP</p></blockquote><span id="more"></span><p>在自己電腦安裝oracle都沒有遇過</p><p>在網路上查詢後，發現是Server上安裝的是Oracle Client<br>在安裝時，沒有安裝到Export的元件</p><p>為了讓Server能夠正常Export<br>首先必須要找到一台可以正常Export的電腦，找到安裝的資料夾路徑<br>跟無法Export的電腦比對，有少的在複製</p><ol><li>複製exp*.exe(不能import改找imp*.exe)</li><li>RMDMS\mesg裡的expus.msb，expzhs.msb(import改impus.msb,impzhs.msb)</li></ol><p>複製完畢，在執行一次ok了，那就打完收工</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 使用者可以查詢卻無法匯出</title>
      <link href="/2011/11/07/oracle-export-issue/"/>
      <url>/2011/11/07/oracle-export-issue/</url>
      
        <content type="html"><![CDATA[<p>最近遇到了一個情況</p><span id="more"></span><p>客戶為了DB的安全性，將密碼做了修改<br>改了以後執行Export和Import動作時，出現了</p><blockquote><p>ORA-12154:TNS:無法解析指定的連接標示符</p></blockquote><p>但是登入使用者時卻又可以登入，也可以查詢資料</p><p>改用測試帳號執行匯出，發現正常沒有問題<br>將測試帳號的密碼改為和正式的密碼相同，也不能執行匯出<br>發現是密碼中帶有@的特殊字元，才無法執行<br>在oracle中，@在DBLink中會使用到</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 在UpdatePanel裡執行JavaScript</title>
      <link href="/2011/10/05/asp-javascript-updatepanel/"/>
      <url>/2011/10/05/asp-javascript-updatepanel/</url>
      
        <content type="html"><![CDATA[<p>昨天遇到一個問題，要在UpdatePanel裡面的某個物件PostBack後執行Script<br>一般在按鈕觸發後回到後台執行完畢，要在執行某個Script<br>我們會這樣寫</p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ClientScript</span>.<span class="title class_">RegisterStartupScript</span>(<span class="variable language_">this</span>.<span class="title class_">GetType</span>(), <span class="string">&quot;ShowMessage&quot;</span>, <span class="string">&quot;alert(&#x27;hello!&#x27;)&quot;</span>);</span><br></pre></td></tr></table></figure><p>但是，如果按鈕被包在UpdatePanel裡面<br>這樣的寫法無效，並不會執行<br>這時我們換一個寫法，就可以正常執行了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ClientScript</span>.<span class="title class_">RegisterClientScriptBlock</span>(<span class="title class_">UpdatePanel1</span>.<span class="title class_">GetType</span>(), <span class="string">&quot;ShowMessage&quot;</span>, <span class="string">&quot;alert(&#x27;hello!&#x27;)&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[jQuery] each迴圈的continue/break</title>
      <link href="/2011/09/30/jquery-each/"/>
      <url>/2011/09/30/jquery-each/</url>
      
        <content type="html"><![CDATA[<p>在jQuery中使用each時，要進行continue&#x2F;break只要這樣做就行了</p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;tag&#x27;</span>).<span class="title function_">each</span>(<span class="function"><span class="params">p</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//continue</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//break</span></span><br><span class="line">    <span class="comment">//return false;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> jQuery </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] Telerik RadGrid的GridButtonColumn修改ConfirmText</title>
      <link href="/2011/09/29/asp-telerik-gridbuttoncolumn/"/>
      <url>/2011/09/29/asp-telerik-gridbuttoncolumn/</url>
      
        <content type="html"><![CDATA[<p>Telerik是第三方的元件，加強了前台和後台的一些功能<br>並且都經過美化，讓開發者可以簡單使用又不失美觀<br><a href="http://www.telerik.com/">telerik官網</a></p><span id="more"></span><p>我們最常使用的是RadGrid（其實就是GridView的功能）<br>會用到的Column有GridButtonColumn、GridTemplateColumn、GridBoundColumna等</p><p>其中GridButtonColumn這樣設定</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">telerik:gridbuttoncolumn</span> <span class="attr">headerstyle-width</span>=<span class="string">&quot;20px&quot;</span> <span class="attr">confirmtext</span>=<span class="string">&quot;Delete this contact?&quot;</span> <span class="attr">ConfirmDialogType</span>=<span class="string">&quot;RadWindow&quot;</span> <span class="attr">ConfirmTitle</span>=<span class="string">&quot;Delete&quot;</span> <span class="attr">ButtonType</span>=<span class="string">&quot;PushButton&quot;</span> <span class="attr">CommandName</span>=<span class="string">&quot;Delete&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;Delete&quot;</span> <span class="attr">UniqueName</span>=<span class="string">&quot;DeleteColumn&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemstyle</span> <span class="attr">horizontalalign</span>=<span class="string">&quot;Center&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">itemstyle</span>&gt;</span><span class="tag">&lt;/<span class="name">telerik:gridbuttoncolumn</span>&gt;</span></span><br></pre></td></tr></table></figure><p>要修改ConfrimText的內容<br>需要先了解另一個屬性ButtonType<br>分為PushButton(Button)、ImageButton(ImageButton)、LinkButton(HyperlinkButton)</p><p>這邊就只用PushButton做範例<br>先找出該物件，物件型別會根據ButtonType有所差異<br>接著使用原始的給Atrribute作法，來進行修改</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">rgFile_ItemDataBound</span>(<span class="params"><span class="built_in">object</span> sender, Telerik.Web.UI.GridItemEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.Item <span class="keyword">is</span> GridDataItem)</span><br><span class="line">    &#123;</span><br><span class="line">        GridDataItem item = e.Item <span class="keyword">as</span> GridDataItem;</span><br><span class="line">        Button btnDelete = item[<span class="string">&quot;DeleteColumn&quot;</span>].Controls[<span class="number">0</span>] <span class="keyword">as</span> Button;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (btnDelete != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            btnDelete.Text = _UIFace.GetFaceString(<span class="string">&quot;btnDelete&quot;</span>);</span><br><span class="line">            <span class="comment">//ANS-00002:確定要刪除？</span></span><br><span class="line">            btnDelete.Attributes[<span class="string">&quot;onclick&quot;</span>] = <span class="built_in">string</span>.Format(<span class="string">&quot;return confirm(&#x27;&#123;0&#125;&#x27;);&quot;</span>, _UIMsg.GetMessageString(<span class="string">&quot;ANS-00002&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] 11G沒有資料的Schema無法匯出</title>
      <link href="/2011/08/05/oracle-schema-export/"/>
      <url>/2011/08/05/oracle-schema-export/</url>
      
        <content type="html"><![CDATA[<p>Oracle在11G開始，匯出整個使用者時，沒有資料的Schema是不會匯出的<br>還好這是可以設定的，我們可以先用下面的語法檢查</p><span id="more"></span><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> deferred_segment_creation</span><br></pre></td></tr></table></figure><p>結果為true，就不會匯出空的Schema<br>只要用下面的語法就可以讓空的Schema也匯出了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> deferred_segment_creation<span class="operator">=</span><span class="literal">false</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[JS] 在Reload頁面時，保持ScrollBar的位置</title>
      <link href="/2011/03/31/js-keep-scroll/"/>
      <url>/2011/03/31/js-keep-scroll/</url>
      
        <content type="html"><![CDATA[<p>最近的案子有一個需求<br>要在頁面Reload時保持ScrollBar的位置</p><span id="more"></span><p>作法其實很簡單<br>就是在ScrollBar移動時將位置記住<br>每次Reload時去抓取存放的位置</p><p>我的作法是用一個暫存位置用的TextBox做儲存</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ttbScroll = $(<span class="string">&#x27;#ttbScroll&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> divMenu = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;divMenu&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(ttbScroll.<span class="title function_">val</span>() != <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> split = ttbScroll.<span class="title function_">val</span>().<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        divMenu.<span class="property">scrollLeft</span> = split[<span class="number">0</span>];</span><br><span class="line">        divMenu.<span class="property">scrollTop</span> = split[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    $(<span class="string">&#x27;#divMenu&#x27;</span>).<span class="title function_">scroll</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        ttbScroll.<span class="title function_">val</span>(divMenu.<span class="property">scrollLeft</span> + <span class="string">&#x27;,&#x27;</span> + divMenu.<span class="property">scrollTop</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[oracle] ORA-12514 TNS 監聽進程不能解析在連接描述符中給出的 SERVICE_NAME</title>
      <link href="/2011/01/31/oracle-12514/"/>
      <url>/2011/01/31/oracle-12514/</url>
      
        <content type="html"><![CDATA[<p>重灌系統後，安裝了11G的Oracle…<br>安裝完後進去SYS的user都沒問題…<br>但把service改為手動啟動…<br>再次開啟時，卻出現了ORA-12514的錯誤訊息…</p><span id="more"></span><p>原本以為有service沒啟動到…<br>但去查了一下才發現…<br>是listener.ora的內容需要加上一些東西…</p><p>找到oracle安裝的資料夾底下<code>/network/admin/listener.ora</code></p><p>更改完畢後，將service重啟…<br>就可以連線到了…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SID_LIST_LISTENER =</span><br><span class="line">  (SID_LIST =</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = CLRExtProc)</span><br><span class="line">      (ORACLE_HOME = D:\app\[username]\product\11.2.0\dbhome_1)</span><br><span class="line">      (PROGRAM = extproc)</span><br><span class="line">      (ENVS = &quot;EXTPROC_DLLS=ONLY:D:\app\[username]\product\11.2.0\dbhome_1\bin\oraclr11.dll&quot;)</span><br><span class="line">    )</span><br><span class="line">    //新增</span><br><span class="line">  (SID_DESC =</span><br><span class="line">       (GLOBAL_DBNAME = [sid])</span><br><span class="line">       (ORACLE_HOME = D:\app\[username]\product\11.2.0\dbhome_1)  </span><br><span class="line">       (SID_NAME = [sid])</span><br><span class="line">      )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 自己寫Event</title>
      <link href="/2010/11/14/csharp-event/"/>
      <url>/2010/11/14/csharp-event/</url>
      
        <content type="html"><![CDATA[<p>好久沒有來寫點東西了…<br>換了工作以後被鳥客戶纏身…<br>每天就是忙盲茫…</p><span id="more"></span><p>廢話不多說…<br>直接進入正題吧…</p><p>這次的需求是這樣的…<br>想要去寫入log資訊…<br>但又不希望每個class都要去加上寫入log的function…<br>因此採用Event的方式…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        EventListen.OnLoggin += <span class="keyword">new</span> EventListen.LogHandler(EventListen_OnLoggin);</span><br><span class="line">        EventListen el = <span class="keyword">new</span> EventListen();</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EventListen_OnLoggin</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(message);</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventListen</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">LogHandler</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> LogHandler OnLoggin;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EventListen</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//避免event沒有被listen</span></span><br><span class="line">        <span class="keyword">if</span> (OnLoggin != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            OnLoggin(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 用js開啟AJAX Accordion</title>
      <link href="/2010/08/10/asp-ajax-accordion/"/>
      <url>/2010/08/10/asp-ajax-accordion/</url>
      
        <content type="html"><![CDATA[<p>專案有一個需求<br>要點了某個物件以後去顯示相關內容(那內容放在Accordion的其中一個panel)<br>我採用了js的ajax的方式去取得<br>主管又希望能夠在點了那個物件後<br>顯示相關內容那塊能顯示出來</p><span id="more"></span><p>由於我都是在前台作業<br>沒有postback到後台<br>因此這個需求就出現了</p><p>這段必須加在form裡面，不然$get會抓不到那個物件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Openpane</span>(<span class="params">paneIndex</span>) &#123;</span><br><span class="line">    <span class="comment">//Accordion is the ID of AJAX Accordion control</span></span><br><span class="line">    <span class="keyword">var</span> behavior = $get(<span class="string">&quot;&lt;%=EmsAccordion.ClientID%&gt;&quot;</span>).<span class="property">AccordionBehavior</span>;</span><br><span class="line">    behavior.<span class="title function_">set_SelectedIndex</span>(paneIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] DataGrid動態產生Template(更新)</title>
      <link href="/2010/05/14/asp-datagrid-dynmic/"/>
      <url>/2010/05/14/asp-datagrid-dynmic/</url>
      
        <content type="html"><![CDATA[<p>這是舊的文章…<br>但這個功能之前其實算是失敗的…<br>在update時後想要再後台去抓取那些動態生成的欄位值…<br>但發現都抓不到…<br>最近都在用jQuery…<br>就改在前台抓完值後存在某個地方…<br>再由後台去處理…</p><span id="more"></span><h2 id="舊的內容"><a href="#舊的內容" class="headerlink" title="舊的內容"></a>舊的內容</h2><p>為了不想要每次資料庫增加一個欄位…<br>就要大費工夫的去改一堆程式…<br>因此想說用動態的去產生要顯示的欄位…</p><p>這是ASP1.1的作法…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Page_Load</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"> TemplateColumn col = <span class="keyword">new</span> TemplateColumn();</span><br><span class="line"> col.ItemTemplate = <span class="keyword">new</span> DataItemTemplate(ListItemType.Item, colu, attr);</span><br><span class="line"> col.EditItemTemplate = <span class="keyword">new</span> DataItemTemplate(ListItemType.EditItem, colu, attr);</span><br><span class="line"> datagrid.Columns.Add(col);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DataItemTemplate</span>:<span class="title">ITemplate</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">private</span> ListItemType mType;</span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">string</span> mColumnName;</span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">string</span> mIDName;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DataItemTemplate</span>(<span class="params">ListItemType type, <span class="built_in">string</span> colname, <span class="built_in">string</span> idname</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">   mType = type;</span><br><span class="line">   mColumnName = colname;</span><br><span class="line">   mIDName = idname;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InstantiateIn</span>(<span class="params">Control container</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="comment">// <span class="doctag">TODO:</span>  加入 DataItemTemplate.InstantiateIn 實作</span></span><br><span class="line">   <span class="keyword">switch</span> (<span class="keyword">this</span>.mType)</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="keyword">case</span> ListItemType.Item:</span><br><span class="line">     <span class="comment">//可自行改成別的物件</span></span><br><span class="line">     Label lb = <span class="keyword">new</span> Label();</span><br><span class="line">     lb.DataBinding += <span class="keyword">new</span> EventHandler(DataBinding);</span><br><span class="line">     container.Controls.Add(lb);</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ListItemType.EditItem:</span><br><span class="line">     <span class="comment">//可自行改成別的物件</span></span><br><span class="line">     DropDownList ddl = <span class="keyword">new</span> DropDownList();</span><br><span class="line">     ddl.Items.Add(<span class="string">&quot;TRUE&quot;</span>);</span><br><span class="line">     ddl.Items.Add(<span class="string">&quot;FALSE&quot;</span>);</span><br><span class="line">     ddl.ID = <span class="string">&quot;ddl&quot;</span> + <span class="keyword">this</span>.mIDName;</span><br><span class="line">     container.Controls.Add(ddl);</span><br><span class="line">     <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">DataBinding</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="comment">//要對應Item的DataBinding</span></span><br><span class="line">   Label lb = (Label)sender;</span><br><span class="line">   DataGridItem container = (DataGridItem)lb.NamingContainer;</span><br><span class="line">   <span class="built_in">object</span> dataValue = DataBinder.Eval(container.DataItem, mColumnName);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(dataValue != DBNull.Value)</span><br><span class="line">   &#123;</span><br><span class="line">    lb.Text = dataValue.ToString();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="新的內容"><a href="#新的內容" class="headerlink" title="新的內容"></a>新的內容</h2><p>ASP2.0的作法請產考這篇文章…<br><a href="http://blog.blueshop.com.tw/hent/archive/2008/02/24/54382.aspx">http://blog.blueshop.com.tw/hent/archive/2008/02/24/54382.aspx</a></p><p>前台抓取動態欄位值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在DataGrid裡面找到叫做update的元件</span></span><br><span class="line">$(<span class="string">&#x27;#dg_ControlStatus&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;a[id$=btnUpdate]&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//input Reason</span></span><br><span class="line">    <span class="keyword">var</span> tempReason = <span class="title function_">prompt</span>(<span class="string">&#x27;Modify Reason?&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(tempReason != <span class="literal">null</span> &amp;&amp; tempReason != <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        $(<span class="string">&#x27;#txtReason&#x27;</span>).<span class="title function_">val</span>(tempReason);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//找出該行中的所有儲存格</span></span><br><span class="line">    $(<span class="variable language_">this</span>).<span class="title function_">parents</span>(<span class="string">&#x27;tr&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;td&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//只要CoboBox的值</span></span><br><span class="line">        <span class="keyword">if</span>($(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;select&#x27;</span>).<span class="property">length</span> &gt; <span class="number">0</span>)</span><br><span class="line">            data += $(<span class="variable language_">this</span>).<span class="title function_">find</span>(<span class="string">&#x27;select&#x27;</span>).<span class="title function_">val</span>() + <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//儲存起來給後台處理</span></span><br><span class="line">    $(<span class="string">&#x27;#txtSaveData&#x27;</span>).<span class="title function_">val</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] ajax使用WebService</title>
      <link href="/2010/04/13/asp-ajax-webservice/"/>
      <url>/2010/04/13/asp-ajax-webservice/</url>
      
        <content type="html"><![CDATA[<p>最近用WebService來做一些功能<br>很奇怪的再local測試都沒問題<br>但一放到server上就有問題</p><span id="more"></span><p>錯誤訊息沒存起來<br>不過大概是說傳遞格式出錯</p><p>網路找一找才發現<br>原來要再<code>web.config</code>中加上這段</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.web</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">webServices</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">protocols</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;HttpPost&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;HttpGet&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">protocols</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">webServices</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 型別當變數</title>
      <link href="/2010/03/29/csharp-type/"/>
      <url>/2010/03/29/csharp-type/</url>
      
        <content type="html"><![CDATA[<p>自己再寫MDI的視窗程式時<br>寫一個檢查子視窗是否開啟的method<br>想傳form的型別過去當參數</p><span id="more"></span><p>不知道該如何寫<br>再網路上問了一下<br>得到解答如下</p><p>就是用typeof轉成Type傳過去</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CheckChildrenFormOpened</span>(<span class="params">Type type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (Form f <span class="keyword">in</span> <span class="keyword">this</span>.MdiChildren)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (f.GetType() == type)</span><br><span class="line">        &#123;</span><br><span class="line">            f.Activate();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (!CheckChildrenFormOpened(<span class="keyword">typeof</span>(AccountManage)))</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] ComboBox和ListBox如何將顯示和值分開</title>
      <link href="/2009/10/08/charp-combobox-display/"/>
      <url>/2009/10/08/charp-combobox-display/</url>
      
        <content type="html"><![CDATA[<p>今天在寫AP時使用了ComboBox和ListBox<br>想要在顯示和值是不同的<br>發現了另一種寫法</p><span id="more"></span><p>一種寫法是將資料放到DataTable</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DataTable dt = QueryTable(sql);</span><br><span class="line"></span><br><span class="line">ComboBox cmb = <span class="keyword">new</span> ComboBox();</span><br><span class="line">cmb.DataSource = dt;</span><br><span class="line">cmb.DisplayMember = <span class="string">&quot;Name&quot;</span>;</span><br><span class="line">cmb.ValueMember = <span class="string">&quot;ID&quot;</span>;</span><br></pre></td></tr></table></figure><p>另一種寫法，自己寫一個class去存放</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectBindItem</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> mDisplay;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> mValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObjectBindItem</span>(<span class="params"><span class="built_in">string</span> dis, <span class="built_in">string</span> val</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.mDisplay = dis;</span><br><span class="line">        <span class="keyword">this</span>.mValue = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Display</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.mDisplay; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Value</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.mValue; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.mDisplay + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.mValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ArrayList ary = <span class="keyword">new</span> ArrayList();</span><br><span class="line">ary.Add(<span class="keyword">new</span> ObjectBindItem(<span class="string">&quot;john&quot;</span>, <span class="string">&quot;A123&quot;</span>);</span><br><span class="line"></span><br><span class="line">ComboBox cmb = <span class="keyword">new</span> ComboBox();</span><br><span class="line">cmb.DataSource = ary;</span><br><span class="line">cmb.DisplayMember = <span class="string">&quot;Display&quot;</span>;</span><br><span class="line">cmb.ValueMember = <span class="string">&quot;Value&quot;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 固定字串長度</title>
      <link href="/2009/08/07/csharp-string-pad/"/>
      <url>/2009/08/07/csharp-string-pad/</url>
      
        <content type="html"><![CDATA[<p>昨天在寫一個動態生成文件的程式…<br>寫出來了…<br>但是格式非常不好看…<br>因為都沒有對齊…</p><span id="more"></span><p>一開使用的方法是空白…<br>接著換使用\t的方式…<br>也都不行…</p><p>後來查到可以改用…<br>.PadLeft()或是.PadRight()…</p><p>平常還真是不會去注意到這個方法阿&#x3D; &#x3D;”</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] xml讀取寫入(續)</title>
      <link href="/2009/07/30/csharp-xml-continue/"/>
      <url>/2009/07/30/csharp-xml-continue/</url>
      
        <content type="html"><![CDATA[<p>前一篇來看的人很多…<br>但應該會覺得介紹的太少了…<br>這次來完整一點吧…<br>算是自己的一個整理…</p><span id="more"></span><p>xml內容…(這是我記帳程式的格式…)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;Big5&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MoneyManage</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">UserClassification</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">Name</span>=<span class="string">&quot;餐飲&quot;</span> <span class="attr">ItemCount</span>=<span class="string">&quot;8&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;早餐&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;101&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;中餐&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;102&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;晚餐&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;103&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;點心宵夜&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;104&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;飲料&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;105&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;其他&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;119&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;水果&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;151&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;麵包&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;152&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Category</span> <span class="attr">Name</span>=<span class="string">&quot;交通&quot;</span> <span class="attr">ItemCount</span>=<span class="string">&quot;6&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;加油&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;206&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;坐車&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;207&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;換機油&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;208&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;停車費&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;233&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;過路費&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;235&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">Name</span>=<span class="string">&quot;修理&quot;</span> <span class="attr">Category</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Type</span>=<span class="string">&quot;支出&quot;</span> <span class="attr">Comment</span>=<span class="string">&quot;&quot;</span> <span class="attr">Key</span>=<span class="string">&quot;242&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">UserClassification</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">MoneyManage</span>&gt;</span></span><br></pre></td></tr></table></figure><p>開始運用…<br>取得所有Category…</p><h2 id="第一種方法"><a href="#第一種方法" class="headerlink" title="第一種方法"></a>第一種方法</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XmlNode root = xmlDoc.SelectSingleNode(<span class="string">&quot;/MoneyManage/UserClassification&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (XmlElement elm <span class="keyword">in</span> root.ChildNodes)</span><br><span class="line">&#123;</span><br><span class="line">     Label1.Text += <span class="string">&quot;Category Name:&quot;</span> + elm.GetAttribute(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="第二種方法"><a href="#第二種方法" class="headerlink" title="第二種方法"></a>第二種方法</h2><p>XmlNodeList root &#x3D; xmlDoc.SelectNodes(“&#x2F;MoneyManage&#x2F;UserClassification”);<br>foreach (XmlElement elm in root)<br>{<br>     Label1.Text +&#x3D; “Category Name:” + elm.GetAttribute(“Name”);<br>}</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接下來是要取得名稱為<span class="string">&quot;停車費&quot;</span>的Item...</span><br><span class="line"></span><br><span class="line">​``` csharp</span><br><span class="line">XmlElement node = (XmlElement)xmlDoc.SelectSingleNode(<span class="string">&quot;/MoneyManage/UserClassification/Category/Item[@Name=\&quot;停車費\&quot;]&quot;</span>);</span><br><span class="line">Label1.Text += <span class="string">&quot;Category Name:&quot;</span> + node.GetAttribute(<span class="string">&quot;Name&quot;</span>);</span><br></pre></td></tr></table></figure><p>如果要多個條件…<br>類似SQL…<br>[@Key &#x3D; ? and @Name &#x3D; ?]</p><p>讀取的部份算是差不多…<br>接下來就是寫入的部份啦…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XmlNode root = xmlDoc.SelectSingleNode(<span class="string">&quot;/MoneyManage/UserClassification&quot;</span>);</span><br><span class="line">XmlNode node = xmlDoc.CreateNode(XmlNodeType.Element, <span class="string">&quot;Category&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">XmlAttribute attribute = Variable.XmlDoc.CreateAttribute(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">attribute.Value = <span class="string">&quot;住宿&quot;</span>;</span><br><span class="line"></span><br><span class="line">node.Attributes.Append(attribute);</span><br><span class="line">root.AppendChild(node);</span><br><span class="line"></span><br><span class="line">xmlDoc.Save(<span class="string">&quot;jiaming.xml&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] String 轉 DateTime</title>
      <link href="/2009/07/23/csharp-string-datetime/"/>
      <url>/2009/07/23/csharp-string-datetime/</url>
      
        <content type="html"><![CDATA[<p>今天同事講到…<br>String在轉DateTime的時候…<br>要先轉double再轉…<br>感覺上蠻複雜的…</p><span id="more"></span><p>其實只要簡單的兩行就可以了…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IFormatProvider culture = <span class="keyword">new</span> System.Globalization.CultureInfo(<span class="string">&quot;zh-TW&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">DateTime time = DateTime.ParseExact(<span class="string">&quot;20090723194530&quot;</span>, <span class="string">&quot;yyyyMMddHHmmss&quot;</span>, culture);</span><br></pre></td></tr></table></figure><p>中間有任何變化的話…<br>請自行搭配時間格式去設定…</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] FileSystemWatcher</title>
      <link href="/2009/04/09/csharp-filesystemwatcher/"/>
      <url>/2009/04/09/csharp-filesystemwatcher/</url>
      
        <content type="html"><![CDATA[<p>這是一個讓我覺得有趣的元件…<br>他是用來監控檔案是否有新增刪除修改…<br>詳細的介紹還是看<a href="http://msdn.microsoft.com/zh-tw/library/system.io.filesystemwatcher.aspx">msdn</a>吧…<br>來點小範例…</p><span id="more"></span><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    FileSystemWatcher fsw = <span class="keyword">new</span> FileSystemWatcher();</span><br><span class="line">    fsw.Path = <span class="string">@&quot;D:\&quot;</span>;</span><br><span class="line">    fsw.Filter = <span class="string">&quot;*.txt&quot;</span>;</span><br><span class="line">    fsw.Created += <span class="keyword">new</span> FileSystemEventHandler(fsw_Created);</span><br><span class="line">    fsw.Changed += <span class="keyword">new</span> FileSystemEventHandler(fsw_Changed);</span><br><span class="line">    fsw.EnableRaisingEvents = <span class="literal">true</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fsw_Changed</span>(<span class="params"><span class="built_in">object</span> sender, FileSystemEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;File: &quot;</span> + e.FullPath + <span class="string">&quot; &quot;</span> + e.ChangeType);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fsw_Created</span>(<span class="params"><span class="built_in">object</span> sender, FileSystemEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;File: &quot;</span> + e.FullPath + <span class="string">&quot; &quot;</span> + e.ChangeType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] OleDbTransaction</title>
      <link href="/2009/03/11/csharp-oledbtransaction/"/>
      <url>/2009/03/11/csharp-oledbtransaction/</url>
      
        <content type="html"><![CDATA[<p>當我要同時對資料庫做兩個刪除一個新增的動作…<br>用一般的方法…OleDbCommand.ExecuteNonQuery<br>當在第二個刪除失敗的時候…<br>要去救回第一個刪除資料…<br>會很麻煩…</p><span id="more"></span><p>這時可以使用這個物件…OleDbTransaction<br>它可以在有失敗時將資料救回…<br>這還蠻方便的…<br>省掉許多自己去寫維護的時間…</p><p>以下是MSDN的範例…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExecuteTransaction</span>(<span class="params"><span class="built_in">string</span> connectionString</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">using</span> (OleDbConnection connection = <span class="keyword">new</span> OleDbConnection(connectionString))</span><br><span class="line">        &#123;</span><br><span class="line">            OleDbCommand command = <span class="keyword">new</span> OleDbCommand();</span><br><span class="line">            OleDbTransaction transaction = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set the Connection to the new OleDbConnection.</span></span><br><span class="line">            command.Connection = connection;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Open the connection and execute the transaction.</span></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                connection.Open();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Start a local transaction</span></span><br><span class="line">                transaction = connection.BeginTransaction();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Assign transaction object for a pending local transaction.</span></span><br><span class="line">                command.Connection = connection;</span><br><span class="line">                command.Transaction = transaction;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Execute the commands.</span></span><br><span class="line">                command.CommandText = <span class="string">&quot;Insert into Region (RegionID, RegionDescription) VALUES (100, &#x27;Description&#x27;)&quot;</span>;</span><br><span class="line">                command.ExecuteNonQuery();</span><br><span class="line">                command.CommandText = <span class="string">&quot;Insert into Region (RegionID, RegionDescription) VALUES (101, &#x27;Description&#x27;)&quot;</span>;</span><br><span class="line">                command.ExecuteNonQuery();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Commit the transaction.</span></span><br><span class="line">                transaction.Commit();</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Both records are written to database.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(ex.Message);</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Attempt to roll back the transaction.</span></span><br><span class="line">                    transaction.Rollback();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Do nothing here; transaction is not active.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// The connection is automatically closed when the</span></span><br><span class="line">            <span class="comment">// code exits the using block.</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 登入驗證</title>
      <link href="/2009/02/16/asp-auth/"/>
      <url>/2009/02/16/asp-auth/</url>
      
        <content type="html"><![CDATA[<p>這是書上所教登入驗證的方法…</p><span id="more"></span><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authentication</span> <span class="attr">mode</span>=<span class="string">&quot;Forms&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">forms</span> <span class="attr">loginUrl</span> = <span class="string">&quot;Logon.aspx&quot;</span> <span class="attr">name</span>=<span class="string">&quot;.ASPXCOOKIEOCS&quot;</span> <span class="attr">defaultUrl</span>=<span class="string">&quot;Main.aspx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authentication</span>&gt;</span></span><br></pre></td></tr></table></figure><p>改webconfig…<br>將mode改為form並且指定登入網頁…<br>接著再各頁面的Load加上…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!User.Identity.IsAuthenticated)</span><br><span class="line">   FormsAuthentication.RedirectToLoginPage();</span><br></pre></td></tr></table></figure><p>萬一忘記加了這兩行…<br>就不會去驗證是否登入成功…</p><p>改公司網頁時發現，同事並沒有加上這兩行…<br>但卻還是會自動轉往登入頁面…<br>詢問後才知道是加了下面這東西…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">deny</span> <span class="attr">users</span>=<span class="string">&quot;?&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 參數傳遞觀念</title>
      <link href="/2009/02/12/csharp-call-by-reference/"/>
      <url>/2009/02/12/csharp-call-by-reference/</url>
      
        <content type="html"><![CDATA[<p>這是從同事那邊得知的知識…<br>原因是同事寫了一段程式讓我十分疑惑…</p><span id="more"></span><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Form1</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line"> &#123;</span><br><span class="line">  DataSet oDataSet=<span class="keyword">new</span> DataSet();</span><br><span class="line">  Function.LoadDbList(DbName, oDataSet);</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;oDataSet.Table[<span class="string">&quot;ALARMLIST&quot;</span>].count;i++)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Function</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadDbList</span>(<span class="params"><span class="built_in">string</span> DbName, DataSet oDataSet</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  dataAdapter.Fill(oDataSet);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在執行完Function.LoadDbList後，竟然就可以直接使用oDataSet這個物件<br>但是程式中oDataSet這個物件並沒有回傳，也沒有ref或是out的用法<br>但是就有辦法在接下的程式中使用</p><p>後來問同事後得知，原來除了基本的型態(string,int…等)<br>其他的型態都是用reference的方式在傳遞參數</p><p>這樣就可以不必用return的方式<br>聽同事說可以不用在new一個物件，似乎可以避免浪費資源</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 按tab+alt切換視窗時隱藏圖示</title>
      <link href="/2009/01/05/csharp-hide-icon/"/>
      <url>/2009/01/05/csharp-hide-icon/</url>
      
        <content type="html"><![CDATA[<p>用到這個的情況是在…<br>一隻AP是不顯示在工作列的…<br>但是卻又常駐在桌面…</p><span id="more"></span><p>要讓圖示消失在切換的工作列中…<br>其實有一個最簡單的設定…<br>只需要兩行…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.FormBorderStyle = System.Windows.Forms.FormBorderStyle.FixedToolWindow;</span><br><span class="line"><span class="keyword">this</span>.ShowInTaskbar = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>但是當我設定改為…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.FormBorderStyle = System.Windows.Forms.FormBorderStyle.None;</span><br></pre></td></tr></table></figure><p>圖示一樣會出現…<br>這樣就無法達到我的需求…</p><p>同事有一隻AP擁有這樣的功能…<br>不過他的需求不同…<br>他是要在按下顯示桌面時…<br>程式不會跟著縮小…</p><p>廢話就不多說了…<br>還是來看看怎樣達到這樣的目的…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DllImport(<span class="string">&quot;USER32.DLL&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">FindWindow</span>(<span class="params"><span class="built_in">string</span> lpClassName, <span class="built_in">string</span> lpWindowName</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="string">&quot;USER32.DLL&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">FindWindowEx</span>(<span class="params">IntPtr parentHandle, IntPtr childAfter, <span class="built_in">string</span> className, IntPtr windowTitle</span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="string">&quot;USER32.DLL&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">SetParent</span>(<span class="params">IntPtr hWndChild, IntPtr hWndNewParent</span>)</span>;</span><br><span class="line"></span><br><span class="line">IntPtr hdesk = FindWindow(<span class="string">&quot;Progman&quot;</span>, <span class="string">&quot;Program Manager&quot;</span>);</span><br><span class="line">hdesk = FindWindowEx(hdesk, IntPtr.Zero, <span class="string">&quot;SHELLDLL_DefView&quot;</span>, IntPtr.Zero);</span><br><span class="line">hdesk = FindWindowEx(hdesk, IntPtr.Zero, <span class="string">&quot;SysListView32&quot;</span>, IntPtr.Zero);</span><br><span class="line">SetParent(<span class="keyword">this</span>.Handle, hdesk);</span><br></pre></td></tr></table></figure><p>不過用了這個以後…<br>原本所寫的top功能就消失了…<br>這個功能還要在找尋…</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 某月的第n個星期w是幾號</title>
      <link href="/2008/12/31/csharp-cal-month-week-day/"/>
      <url>/2008/12/31/csharp-cal-month-week-day/</url>
      
        <content type="html"><![CDATA[<p>得知2009&#x2F;1&#x2F;1為該月的第一個星期四…<br>200&#x2F;1&#x2F;8為第二個星期四…<br>以此類推…</p><span id="more"></span><p>當有人問你2009的1月第三個星期二是幾號…<br>平常你可以看日曆最快…<br>但這樣的東西要怎樣用程式去算出來…</p><p>這聽起來似乎很難…<br>因為每個月的起始都不同…<br>有可能會有的星期w會有五個…</p><p>先講算法…<br>首先要做的是先知道該月的1號是星期幾x…<br>算出第一個w是幾號…<br>判斷w是否大於等於x…<br>大於等於時…f&#x3D;1+(w-x)<br>小於時…f&#x3D;1+[(7-x)+w)]<br>此時f就是第一個星期w的日期了…<br>再來就是看需要計算第幾個星期w…<br>ans&#x3D;f+7*(n-1)</p><p>以下是程式…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DateTime firstDay = DateTime.Now.AddDays(-(DateTime.Now.Day - <span class="number">1</span>));</span><br><span class="line">DayOfWeek queryDay = DayOfWeek.Tuesday;</span><br><span class="line">DateTime firstWeek, ans;</span><br><span class="line"><span class="built_in">int</span> week = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">int</span>)queryDay &gt;= (<span class="built_in">int</span>)firstDay.DayOfWeek)</span><br><span class="line">&#123;</span><br><span class="line">   firstWeek = firstDay.AddDays((<span class="built_in">int</span>)queryDay - (<span class="built_in">int</span>)firstDay.DayOfWeek);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   firstWeek = firstDay.AddDays(<span class="number">7</span> - (<span class="built_in">int</span>)firstDay.DayOfWeek + (<span class="built_in">int</span>)queryDay);</span><br><span class="line">&#125;</span><br><span class="line">ans = firstWeek.AddDays(<span class="number">7</span> * (week - <span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>上面是在說從前面算起第n個星期w…<br>那我要算最後一個星期w呢…<br>算法改一下…<br>變成從月底來計算…</p><p>底下就直接看程式了…</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DateTime lastDay = (firstDay.AddMonths(<span class="number">1</span>)).AddDays(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">int</span>)lastDay.DayOfWeek &gt;= (<span class="built_in">int</span>)queryDay)</span><br><span class="line">&#123;</span><br><span class="line">   ans = lastDay.AddDays(-((<span class="built_in">int</span>)lastDay.DayOfWeek - (<span class="built_in">int</span>)queryDay));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">   ans = lastDay.AddDays(-(<span class="number">7</span> - (<span class="built_in">int</span>)queryDay + (<span class="built_in">int</span>)lastDay.DayOfWeek));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] parse</title>
      <link href="/2008/12/29/csharp-parse/"/>
      <url>/2008/12/29/csharp-parse/</url>
      
        <content type="html"><![CDATA[<h2 id="顏色"><a href="#顏色" class="headerlink" title="顏色"></a>顏色</h2><p>將顏色代碼”#2952A3”要轉成Color型別<br>Color型別只有三種parse<br>FromArgb、FromKnownColor、FromName<br>後面兩種都是Color型別中已存在命名的顏色去做parse</p><span id="more"></span><p>所以只能用第一種，但是他又只支援int32<br>那這種代碼要怎麼轉換<br>其實很明顯的，這種代碼是16進制<br>只要將16先轉成10就可以了</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>.Parse(<span class="string">&quot;#2952A3&quot;</span>.Replace(<span class="string">&quot;#&quot;</span>, <span class="string">&quot;&quot;</span>), System.Globalization.NumberStyles.AllowHexSpecifier)</span><br></pre></td></tr></table></figure><h2 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h2><p>將字串”20081229T120000”轉成DateTime型別<br>DateTime的型別有兩種的parse<br>Parse、ParseExact<br>Parse適用於像這種較為明確的字串格式”2&#x2F;16&#x2F;1992 12:15:12”<br>而所得到的字串是不明確時，要採用ParseExact</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IFormatProvider culture = <span class="keyword">new</span> System.Globalization.CultureInfo(<span class="string">&quot;zh-CHT&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">DateTime.ParseExact(<span class="string">&quot;20081229T120000&quot;</span>.Replace(<span class="string">&quot;T&quot;</span>, <span class="string">&quot; &quot;</span>), <span class="string">&quot;yyyyMMdd HHmmss&quot;</span>, culture);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 單一化執行</title>
      <link href="/2008/12/26/csharp-single-instance/"/>
      <url>/2008/12/26/csharp-single-instance/</url>
      
        <content type="html"><![CDATA[<p>有的時候希望程式只單一執行，可以參考以下的程式</p><span id="more"></span><p>如果你跟我一樣是一個需要登入的系統<br>用下面的方法會在開一次登入視窗<br>如果想要直接執行主視窗，可以用兩種方法</p><ol><li><p>起始的class為主視窗，這個方法我不太會<br>會知道這個方法是公司同事這樣寫</p></li><li><p>起始的class為登入視窗，加上已經登入與否的判斷式在</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Login</span> : <span class="title">Form</span></span><br><span class="line">&#123; </span><br><span class="line">   [<span class="meta">STAThread</span>]</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Application.Run(new Login());</span></span><br><span class="line">            <span class="built_in">string</span>[] args = Environment.GetCommandLineArgs();</span><br><span class="line">            SingleInstanceController controller = <span class="keyword">new</span> SingleInstanceController();</span><br><span class="line">            controller.Run(args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">ProcessParametersDelegate</span>(<span class="params"><span class="built_in">object</span> sender, <span class="built_in">string</span>[] args</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ProcessParameters</span>(<span class="params"><span class="built_in">object</span> sender, <span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">            <span class="keyword">this</span>.Visible = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.TopMost = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.TopMost = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">SingleInstanceController</span> : <span class="title">WindowsFormsApplicationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SingleInstanceController</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Make this a single-instance application</span></span><br><span class="line">            <span class="keyword">this</span>.IsSingleInstance = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.EnableVisualStyles = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// There are some other things available in the VB application model, for</span></span><br><span class="line">            <span class="comment">// instance the shutdown style:</span></span><br><span class="line">            <span class="keyword">this</span>.ShutdownStyle = Microsoft.VisualBasic.ApplicationServices.ShutdownMode.AfterMainFormCloses;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Add StartupNextInstance handler</span></span><br><span class="line">            <span class="keyword">this</span>.StartupNextInstance += <span class="keyword">new</span> StartupNextInstanceEventHandler(<span class="keyword">this</span>.SIApp_StartupNextInstance);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> We are responsible for creating the application&#x27;s main form in this override.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnCreateMainForm</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Instantiate your main application form</span></span><br><span class="line">            <span class="comment">// Create an instance of the main form and set it in the application; </span></span><br><span class="line">            <span class="comment">// but don&#x27;t try to run it.</span></span><br><span class="line">            <span class="keyword">this</span>.MainForm = <span class="keyword">new</span> Login();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// We want to pass along the command-line arguments to this first instance</span></span><br><span class="line">            Random randNum = <span class="keyword">new</span> Random();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> This is called for additional instances. The application model will call this </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> function, and terminate the additional instance when this returns.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;eventArgs&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SIApp_StartupNextInstance</span>(<span class="params"><span class="built_in">object</span> sender, StartupNextInstanceEventArgs eventArgs</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Here you get the control when any other instance is </span></span><br><span class="line">            <span class="comment">// invoked apart from the first one. </span></span><br><span class="line">            <span class="comment">// You have args here in e.CommandLine.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// You custom code which should be run on other instances</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Copy the arguments to a string array</span></span><br><span class="line">            <span class="built_in">string</span>[] args = <span class="keyword">new</span> <span class="built_in">string</span>[eventArgs.CommandLine.Count];</span><br><span class="line">            eventArgs.CommandLine.CopyTo(args, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create an argument array for the Invoke method</span></span><br><span class="line">            <span class="built_in">object</span>[] parameters = <span class="keyword">new</span> <span class="built_in">object</span>[<span class="number">2</span>];</span><br><span class="line">            parameters[<span class="number">0</span>] = <span class="keyword">this</span>.MainForm;</span><br><span class="line">            parameters[<span class="number">1</span>] = args;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Need to use invoke to b/c this is being called from another thread.</span></span><br><span class="line">            <span class="keyword">this</span>.MainForm.Invoke(<span class="keyword">new</span> Login.ProcessParametersDelegate(((Login)<span class="keyword">this</span>.MainForm).ProcessParameters), parameters);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 跳出類似loading的頁面</title>
      <link href="/2008/09/12/asp-loding/"/>
      <url>/2008/09/12/asp-loding/</url>
      
        <content type="html"><![CDATA[<p>這是在改公司網頁時看到的一個小功能…<br>感覺好像可以拿出來應用…<br>就先把他紀錄起來了…</p><span id="more"></span><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">INPUT</span> <span class="attr">id</span>=<span class="string">&quot;ReturnValueObj&quot;</span> <span class="attr">style</span>=<span class="string">&quot;Z-INDEX: 119; LEFT: 8px; WIDTH: 16px; POSITION: absolute; TOP: 264px; HEIGHT: 16px&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Hidden1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span>&gt;</span> </span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全域變數</span></span><br><span class="line"><span class="keyword">protected</span> System.Web.UI.HtmlControls.HtmlInputHidden ReturnValueObj;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//呼叫method</span></span><br><span class="line">ShowDialogBox (ReturnValueObj ,<span class="string">&quot;WebForm1.aspx&quot;</span>,<span class="number">200</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//method函式</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShowDialogBox</span>(<span class="params">System.Web.UI.HtmlControls.HtmlInputHidden ReturnValueObj,<span class="built_in">string</span> sURL ,<span class="built_in">int</span> width ,<span class="built_in">int</span> height, <span class="built_in">int</span> x,<span class="built_in">int</span> y, Boolean isCenter </span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="built_in">string</span> sFeature=<span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="built_in">string</span> sJs=<span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="comment">//iCenter = false;</span></span><br><span class="line">   sFeature += <span class="string">&quot;dialogHeight:&quot;</span> + height + <span class="string">&quot;px;&quot;</span>;</span><br><span class="line">   sFeature += <span class="string">&quot;dialogWidth:&quot;</span> + width + <span class="string">&quot;px;&quot;</span>;</span><br><span class="line">   <span class="keyword">if</span> (isCenter == <span class="literal">false</span>) </span><br><span class="line">   &#123;</span><br><span class="line">    sFeature += <span class="string">&quot;dialogLeft:&quot;</span> + x + <span class="string">&quot;px;&quot;</span>;</span><br><span class="line">    sFeature += <span class="string">&quot;dialogTop:&quot;</span> + y + <span class="string">&quot;px;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   sJs = <span class="string">&quot;&lt;script&gt;&quot;</span>;</span><br><span class="line">   sJs += <span class="string">&quot;Form1.&quot;</span> + ReturnValueObj.ClientID + <span class="string">&quot;.value =window.showModalDialog(&#x27;WebForm2.aspx?url=&quot;</span> + sURL + <span class="string">&quot;&#x27;,&#x27;&#x27;,&#x27;&quot;</span> + sFeature + <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">   sJs += <span class="string">&quot;&lt;/script&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">this</span>.RegisterStartupScript(<span class="string">&quot;ShowDialogBox&quot;</span>,sJs);</span><br><span class="line">   <span class="comment">//把hidden textbox 的值接回window.alert 上</span></span><br><span class="line">   <span class="built_in">string</span> script =<span class="string">&quot;&lt;script&gt;&quot;</span>;</span><br><span class="line">   script +=<span class="string">&quot;if(Form1.&quot;</span> + ReturnValueObj.ClientID + <span class="string">&quot;.value != \&quot;\&quot;) &#123; window.alert(Form1.&quot;</span> + ReturnValueObj.ClientID + <span class="string">&quot;.value); &#125; &quot;</span>;</span><br><span class="line">   script +=<span class="string">&quot;&lt;/script&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">this</span>.RegisterStartupScript(<span class="string">&quot;ShowAlert&quot;</span>,script);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ASP.NET] 無法執行要求，因為無法建立 App-Domain</title>
      <link href="/2008/09/10/asp-regiis/"/>
      <url>/2008/09/10/asp-regiis/</url>
      
        <content type="html"><![CDATA[<p>公司的電腦要跑asp.net…<br>但是不能執行，出現這個錯誤訊息…<br>不過還是沒解決問題…</p><span id="more"></span><p>因為是copy過來的不能run…<br>但開新的可以run…<br>最後同事說直接開一個新專案…<br>然後再把檔案copy過去就可以了…</p><p>無法執行要求，因為無法建立 App-Domain。錯誤: 0x80131902 </p><p>這是安裝IIS6要跑ASP.NET 2.0時所碰到的問題<br>解法如下 </p><ol><li>With a command window, get to the latest version of .net under </li><li>C:\Windows\Microsoft.Net\Framework\ </li><li>Now run the following command: “net stop w3svc” to stop web services. </li><li>Then use “aspnet_regiis.exe -ua” to uninstall all instances of ASP.NET from IIS. </li><li>Follow with “aspnet_regiis.exe -i” to install ASP.NET into IIS. </li><li>Now restart web services with “net start w3svc”.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 讀取xml檔</title>
      <link href="/2008/07/28/csharp-xml/"/>
      <url>/2008/07/28/csharp-xml/</url>
      
        <content type="html"><![CDATA[<p>以下為xml檔案內容</p><span id="more"></span><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;big5&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noval</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BookID</span>&gt;</span>001</span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>天魔神譚<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Writer</span>&gt;</span>手槍<span class="tag">&lt;/<span class="name">Writer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LastReadDate</span>&gt;</span>2008/07/21<span class="tag">&lt;/<span class="name">LastReadDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Chapter</span>&gt;</span>第3部第13集第9章<span class="tag">&lt;/<span class="name">Chapter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Finish</span>&gt;</span>False<span class="tag">&lt;/<span class="name">Finish</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">BookID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BookID</span>&gt;</span>002</span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>魔法炒手<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Writer</span>&gt;</span>張君寶<span class="tag">&lt;/<span class="name">Writer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LastReadDate</span>&gt;</span>2008/07/27<span class="tag">&lt;/<span class="name">LastReadDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Chapter</span>&gt;</span>第609章<span class="tag">&lt;/<span class="name">Chapter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Finish</span>&gt;</span>True<span class="tag">&lt;/<span class="name">Finish</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">BookID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BookID</span>&gt;</span>003</span><br><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>異俠<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Writer</span>&gt;</span>自在<span class="tag">&lt;/<span class="name">Writer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LastReadDate</span>&gt;</span>2008/07/27<span class="tag">&lt;/<span class="name">LastReadDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Chapter</span>&gt;</span>第25集第8章<span class="tag">&lt;/<span class="name">Chapter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Finish</span>&gt;</span>False<span class="tag">&lt;/<span class="name">Finish</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">BookID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">noval</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以下為片段程式碼</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> XmlDocument myXml = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">myXml.Load(strFileName);<span class="comment">//讀取xml檔</span></span><br><span class="line">numBook = myXml.ChildNodes.Item(<span class="number">1</span>).ChildNodes.Count;<span class="comment">//總書本數</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numBook; i++)</span><br><span class="line">&#123;</span><br><span class="line">   cmbBook.Items.Add(myXml.ChildNodes.Item(<span class="number">1</span>).ChildNodes.Item(i).ChildNodes.Item(<span class="number">1</span>).InnerText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[C#] 使用非ASP.NET 1.1</title>
      <link href="/2008/06/08/asp-regiis/"/>
      <url>/2008/06/08/asp-regiis/</url>
      
        <content type="html"><![CDATA[<p>指定的Web伺服器不是執行ASP.NET 1.1版。您將無法執行ASP.NET Web應用程式或服務。</p><span id="more"></span><p>因為IIS跟.FrameWork安裝順序錯誤，導致IIS無法辨別ASP.NET 1.1，所以必須讓兩者<br>認識得重新安裝ASP.NET 1.1 方法為</p><p>開啟「命令提示字元」視窗(按一下 [開始]、[執行]，鍵入 cmd，然後再按一下 [確定])。</p><p>瀏覽至您要使用的 Aspnet_regiis.exe 版本的目錄。請注意，.NET Framework 的每一<br>個版本都附帶有自己的版本。這個檔案通常位於下列目錄： （可使用「檔案總管」瀏覽，<br>查明路徑）</p><p>systemroot\Microsoft.NET\Framework\versionNumber<br>（例：C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322<br>於「命令提示字元」視窗命令提示列輸入及執行<br>cd C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322<br>C:<br>）</p><p>於「命令提示字元」視窗命令提示列輸入及執行<br>ASPNET_REGIIS -i</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
          <category> ASP.NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
